(function(i,j,b,yb,pa){function jb(){this.ie8AndBelow=(this.ie=/msie/.test(navigator.userAgent.toLowerCase())&&!j.opera)&&8>=this.getIeVersion();this.ie9AndBelow=this.ie&&9>=this.getIeVersion();this.opera=!!j.opera;this.firefox=/firefox/.test(navigator.userAgent.toLowerCase());this.chrome=/chrome/.test(navigator.userAgent.toLowerCase())}function P(){this.sUrl="?/Ajax/";this.aRequests=[];this.hasOpenedRequests=!1;i(document).ajaxStart(_.bind(function(){this.hasOpenedRequests=!0},this));i(document).ajaxStop(_.bind(function(){this.hasOpenedRequests=
!1},this))}function Q(){var a=i(j);this.resizeAll=_.debounce(function(){a.resize()},100);this.defaultScreen=f.Screens.Mailbox;this.previousHash=this.currentHash=this.lastMailboxRouting=""}function qa(){}function K(){this.replyText=b.observable("");this.replyDraftUid=b.observable("");this.postponedMailData=null}function ra(){this.prefetchStarted=b.observable(!1);this.init()}function E(a,c,g,t,v,n,e,h,l,j){this.fBeforeSelectCallback=null;this.fSelectCallback=c||function(){};this.fDeleteCallback=g||
function(){};this.fDblClickCallback=t||function(){};this.fEnterCallback=v||function(){};this.bResetCheckedOnClick=d.isUnd(e)?!1:!!e;this.bCheckOnSelect=d.isUnd(h)?!1:!!h;this.bUnselectOnCtrl=d.isUnd(l)?!1:!!l;this.bDisableMultiplySelection=d.isUnd(j)?!1:!!j;this.useKeyboardKeys=b.observable(!1);this.list=b.observableArray([]);a&&a.subscribe&&a.subscribe(function(a){this.list(a)},this);this.multiplyLineFactor=n;this.oScrollScope=this.oListScope=this.oLast=null;this.iTimer=0;this.iFactor=1;this.KeyUp=
f.Key.Up;this.KeyDown=f.Key.Down;this.KeyLeft=f.Key.Up;this.KeyRight=f.Key.Down;this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe(function(a){this.iFactor=0<a?a:1},this):this.iFactor=d.pInt(this.multiplyLineFactor),this.KeyUp=f.Key.Up,this.KeyDown=f.Key.Down,this.KeyLeft=f.Key.Left,this.KeyRight=f.Key.Right,i("html").hasClass("rtl")&&(this.KeyLeft=f.Key.Right,this.KeyRight=f.Key.Left));this.sCheckboxSelector=this.sSelectabelSelector=this.sActionSelector=
"";var Sa=this;this.listChecked=b.computed({read:function(){return _.filter(this.list(),function(a){var c=a.checked(),a=a.selected();return c||Sa.bCheckOnSelect&&a})},write:function(a){a=!!a;_.each(this.list(),function(c){c.checked(a)});this.list.valueHasMutated()},owner:this});this.checkAll=b.computed({read:function(){return 0<this.listChecked().length},write:function(a){this.listChecked(!!a)},owner:this});this.selectorHook=b.observable(null);this.selectorHook.subscribe(function(){var a=this.selectorHook();
a&&a.selected(false)},this,"beforeChange");this.selectorHook.subscribe(function(a){a&&a.selected(true)},this);this.itemSelected=b.computed({read:this.selectorHook,write:function(a){this.selectorHook(a);if(a)this.oLast=a},owner:this});this.list.subscribe(function(a){if(_.isArray(a)){var c=this.itemSelected();c&&(_.find(a,function(a){return c===a})||this.itemSelected(null))}else this.itemSelected(null)},this);this.listCheckedOrSelected=b.computed({read:function(){var a=this.itemSelected(),c=this.listChecked();
return 0<c.length?c:a?[a]:[]},write:function(a){if(a)this.listChecked(true);else{this.itemSelected(null);this.listChecked(false)}},owner:this});this.listCheckedAndSelected=b.computed({read:function(){var a=this.itemSelected(),c=this.listChecked();a&&_.indexOf(c,a)===-1&&c.push(a);return c},write:function(a){if(a)this.listChecked(true);else{this.itemSelected(null);this.listChecked(false)}},owner:this});this.isIncompleteChecked=b.computed(function(){var a=this.list().length,c=this.listChecked().length;
return 0<a&&0<c&&a>c},this);this.onKeydownBinded=_.bind(this.onKeydown,this)}function xa(){}function Ta(){Data.init()}function N(){this.provider=null;this.phoneReport=b.observable("");this.action=b.observable("");this.action.subscribe(function(a){if("connection_end"===a){var c=this;_.delay(function(){c.action("standby")},500)}},this);this.timerValue=b.observable("");this.notShowErrorMore=b.observable(!1);this.voiceApp=b.observable(!1);this.interval=0}function ja(){this.phone=e.Phone;this.voiceApp=
e.Phone.voiceApp;this.phoneReport=e.Phone.phoneReport;this.action=e.Phone.action;this.stack=b.observable(null);this.registerSession=b.observable(null);this.callSession=b.observable(null);this.stackConf=b.observable(null);this.registerConf=b.observable(null);this.hangupConf=b.observable(null);this.hasFatalError=b.observable(!1);this.isStarted=b.observable(!1);this.eventSessionBinded=this.eventSession.bind(this);this.createStackErrorBinded=this.createStackError.bind(this);this.createStackBinded=this.createStack.bind(this);
this.audioRemote=document.getElementById("audio_remote");this.interval=0;this.setConfigs();this.init()}function V(){this.jqFlash=this.flash=null;this.phone=e.Phone;this.voiceApp=e.Phone.voiceApp;this.phoneReport=e.Phone.phoneReport;this.action=e.Phone.action;this.voiceImpi=h.User.VoiceImpi;this.voicePassword=h.User.VoicePassword;this.sessionid=b.observable("");this.callState=b.observable("");this.initStatus=b.observable(!1);this.connectStatus=b.observable(!1);this.init()}function ya(a){this.connection=
this.device=null;this.phone=e.Phone;this.phoneReport=e.Phone.phoneReport;this.fCallback=a;this.init()}function R(){this.alertDesc=b.observable("");this.closeCallback=null;this.title=b.observable("");this.okButtonText=b.observable(d.i18n("MAIN/BUTTON_OK"))}function G(){this.fConfirmCallback=null;this.confirmDesc=b.observable("");this.title=b.observable("");this.okButtonText=b.observable(d.i18n("MAIN/BUTTON_OK"));this.cancelButtonText=b.observable(d.i18n("MAIN/BUTTON_CANCEL"))}function Da(){this.fCallback=
null;this.editedAccountId=h.Accounts.editedId;this.loading=b.observable(!1);this.friendlyName=b.observable("");this.email=b.observable("");this.incomingMailLogin=b.observable("");this.incLoginFocused=b.observable(!1);this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this);this.incomingMailPassword=b.observable("");this.incomingMailPort=b.observable(143);this.incomingMailServer=b.observable("");this.outgoingMailLogin=
b.observable("");this.outgoingMailPassword=b.observable("");this.outgoingMailPort=b.observable(25);this.outgoingMailServer=b.observable("");this.outServerFocused=b.observable(!1);this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this);this.useSmtpAuthentication=b.observable(!0);this.friendlyNameFocus=b.observable(!1)}function za(){this.defaultAccountId=h.Accounts.defaultId;this.loading=b.observable(!1);
this.incomingMailServer=b.observable("");this.incomingMailPort=b.observable(110);this.incomingMailLogin=b.observable("");this.incomingMailPassword=b.observable("");this.folderList=e.MailCache.folderList;this.options=b.computed(function(){return this.folderList().getOptions(void 0,!0)},this);this.folder=b.observable("");this.outgoingMailServer=b.observable("");this.outgoingMailPort=b.observable(25);this.leaveMessagesOnServer=b.observable(!1);this.useSmtpAuthentication=b.observable(!1);this.serverIsSelected=
b.observable(!1);this.loginIsSelected=b.observable(!1);this.passwordIsSelected=b.observable(!1);this.defaultOptionsAfterRender=d.defaultOptionsAfterRender}function Ma(){this.folders=b.observable(null);this.options=b.computed(function(){return this.folders()?this.folders().getOptions(d.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_USAGE_ASSIGNED")):[]},this);this.sTrashFolderOld=this.sSpamFolderOld=this.sDraftFolderOld=this.sSentFolderOld="";this.sentFolderFullName=b.observable("");this.draftsFolderFullName=b.observable("");
this.spamFolderFullName=b.observable("");this.trashFolderFullName=b.observable("");this.sentFolderFullName.subscribe(function(a){this.folders()&&this.folders().sentFolderFullName(a)},this);this.draftsFolderFullName.subscribe(function(a){this.folders()&&this.folders().draftsFolderFullName(a)},this);this.spamFolderFullName.subscribe(function(a){this.folders()&&this.folders().spamFolderFullName(a)},this);this.trashFolderFullName.subscribe(function(a){this.folders()&&this.folders().trashFolderFullName(a)},
this);this.defaultOptionsAfterRender=d.defaultOptionsAfterRender;this.allowSpamFolderExtension=b.computed(function(){return h.Accounts.getEdited().extensionExists("AllowSpamFolderExtension")},this)}function Na(){this.folders=e.MailCache.editedFolderList;this.loading=b.observable(!1);this.options=b.computed(function(){return this.folders().getOptions(d.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_PARENT"),!0,!1,!0)},this);this.namespace=b.computed(function(){return this.folders().sNamespaceFolder},this);this.parentFolder=
b.observable("");this.folderName=b.observable("");this.folderNameFocus=b.observable(!1);this.defaultOptionsAfterRender=d.defaultOptionsAfterRender}function Ea(){this.currentPassword=b.observable("");this.newPassword=b.observable("");this.confirmPassword=b.observable("");this.isHelpdesk=b.observable(!1)}function Ua(){this.fCallback=null;this.folderName=b.observable("");this.folderNameFocus=b.observable(!1)}function Va(){this.fCallback=null;this.item=b.observable(null);this.name=b.observable("");this.nameFocus=
b.observable(!1)}function Aa(){this.item=null;this.pub=b.observable("");this.pubFocus=b.observable(!1)}function Fa(){this.fCallback=null;this.calendarId=b.observable(null);this.calendarName=b.observable("");this.calendarDescription=b.observable("");this.calendarNameFocus=b.observable(!1);this.calendarDescriptionFocus=b.observable(!1);this.colors=b.observableArray([]);this.selectedColor=b.observable(this.colors()[0])}function ba(){this.defaultAccount=h.Accounts.getDefault();this.fCallback=null;this.calendarId=
b.observable(null);this.selectedColor=b.observable("");this.calendarUrl=b.observable("");this.exportUrl=b.observable("");this.icsLink=b.observable("");this.isPublic=b.observable(!1);this.shares=b.observableArray([]);this.oldShares=b.observableArray([]);this.owner=b.observable("");this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500});this.whomAnimate=b.observable("");this.shareAutocompleteItem=b.observable(null);this.shareAutocompleteItem.subscribe(function(a){a&&this.setGlobal(a.email,
this.newShareList())},this);this.newShareList=b.observableArray([]);this.newShare=b.observable("");this.newShareFocus=b.observable(!1);this.newShareAccess=b.observable(2);this.canAdd=b.observable(!1);this.aAccess=[{value:f.CalendarAccess.Read,display:d.i18n("CALENDAR/CALENDAR_ACCESS_READ")},{value:f.CalendarAccess.Write,display:d.i18n("CALENDAR/CALENDAR_ACCESS_WRITE")}];this.autocompleteCallbackBinded=_.bind(this.autocompleteCallback,this)}function $a(){this.fCallback=null;this.calendarId=b.observable(null);
this.selectedColor=b.observable("");this.calendarUrl=b.observable("");this.exportUrl=b.observable("");this.icsLink=b.observable("");this.isPublic=b.observable(!1);this.pubUrl=b.observable("")}function o(){this.defaultAccount=h.Accounts?h.Accounts.getDefault():null;this.modified=!1;this.isPublic=sa;this.isEditable=b.observable(!1);this.selectedCalendarIsShared=b.observable(!1);this.selectedCalendarIsEditable=b.observable(!1);this.callbackDelete=this.callbackSave=null;this.timeFormatMoment="HH:mm";
this.dateFormatMoment="MM/DD/YYYY";this.dateFormatDatePicker="mm/dd/yy";this.calendarId=b.observable(null);this.id=b.observable(null);this.uid=b.observable(null);this.recurrenceId=b.observable(null);this.allEvents=b.observable(f.CalendarEditRecurrenceEvent.AllEvents);this.isMyEvent=b.observable(!1);this.startDom=b.observable(null);this.endDom=b.observable(null);this.repeatEndDom=b.observable(null);this.yearlyDate=b.observable("");this.monthlyDate=b.observable("");this.subject=b.observable("");this.description=
b.observable("");this.startDate=b.observable("");this.startTime=b.observable("");this.startTime.subscribe(function(){this.selectStartDate()},this);this.allDay=b.observable(!1);this.allDay.subscribe(function(a){a||this.setActualTime()},this);this.endDate=b.observable("");this.endTime=b.observable("");this.endTime.subscribe(function(){this.selectEndDate()},this);this.repeatEndDate=b.observable("");this.isEvOneDay=b.observable(!0);this.isEvOneTime=b.observable(!0);this.isRepeat=b.observable(!1);this.location=
b.observable("");this.repeatPeriodOptions=b.observableArray(this.getDisplayedPeriods());this.repeatWeekIntervalOptions=b.observableArray([1,2,3,4]);this.repeatMonthIntervalOptions=b.observableArray(this.getDisplayedIntervals());this.alarmOptions=b.observableArray(this.getDisplayedAlarms([5,10,15,30,60,120,180,240,300,360,420,480,540,600,660,720,1080,1440,2880,4320,5760,10080,20160]));this.timeOptions=b.observableArray(this.getDisplayedTimes(h.User.defaultTimeFormat()===f.TimeFormat.F24?"HH:mm":"hh:mm A"));
this.displayedAlarms=b.observableArray([]);this.displayedAlarms.subscribe(function(){this.disableAlarms()},this);this.excluded=b.observable(!1);this.repeatPeriod=b.observable(0);this.repeatPeriod.subscribe(function(a){this.isRepeat(!!a)},this);this.repeatInterval=b.observable(1);this.repeatEnd=b.observable(0);this.repeatCount=b.observable(null);this.repeatWeekNum=b.observable(null);this.weekDays=b.observable(!1);this.weekMO=b.observable(!1);this.weekTU=b.observable(!1);this.weekWE=b.observable(!1);
this.weekTH=b.observable(!1);this.weekFR=b.observable(!1);this.weekSA=b.observable(!1);this.weekSU=b.observable(!1);this.appointment=b.observable(!1);this.attendees=b.observableArray([]);this.attenderStatus=b.observable(0);this.owner=b.observable("");this.ownerName=b.observable("");this.ownerDisplay=b.computed(function(){return""!==this.ownerName()?this.ownerName():this.owner()},this);this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500});this.whomAnimate=b.observable("");this.guestAutocompleteItem=
b.observable(null);this.guestAutocomplete=b.observable("");this.guestEmailFocus=b.observable(!1);this.guestAutocomplete.subscribe(function(a){""===a&&this.guestAutocompleteItem(null)},this);this.condition=b.observable("");this.autosizeTrigger=b.observable(!0);this.calendars=null;this.visibleCalendarList=b.observable(!1);this.calendarsList=b.observableArray([]);this.calendarsList.subscribe(function(){this.calendars&&1<this.calendars.count()?this.visibleCalendarList(!0):this.visibleCalendarList(!1)},
this);this.calendarColor=b.observable("");this.selectedCalendar=b.observable("");this.selectedCalendarName=b.observable("");this.selectedCalendar.subscribe(function(a){if(a){var c=this.calendars.getCalendarById(a);this.selectedCalendarName(c.name());this.selectedCalendarIsShared(c.isShared);this.visibleCalendarList(c.isEditable());this.selectedCalendarIsEditable(c.isEditable());this.changeCalendarColor(a)}},this);this.subjectFocus=b.observable(!1);this.subjectFocus.subscribe(function(){},this);this.descriptionFocus=
b.observable(!1);this.locationFocus=b.observable(!1);this.dateEdit=b.observable(!1);this.repeatEdit=b.observable(!1);this.guestsEdit=b.observable(!1);this.defaultOptionsAfterRender=d.defaultOptionsAfterRender;this.isEditForm=b.computed(function(){return!!this.id()},this);this.callbackAttendeeActionDecline=null;this.calendarAppointments=h.User.AllowCalendar&&h.User.CalendarAppointments;this.allChanges=b.computed(function(){this.subject();this.description();this.location();this.isRepeat();this.allDay();
this.repeatPeriod();this.repeatInterval();this.repeatEnd();this.repeatCount();this.repeatWeekNum();this.startDate();this.startTime();this.endDate();this.repeatEndDate();this.displayedAlarms();this.weekDays();this.weekMO();this.weekTU();this.weekWE();this.weekTH();this.weekFR();this.weekSA();this.weekSU();this.attendees();this.selectedCalendar();this.modified=!0},this)}function Ga(){this.fCallback=null;this.confirmDesc=d.i18n("CALENDAR/EDIT_RECURRENCE_CONFIRM_DESCRIPTION");this.onlyThisInstanceButtonText=
b.observable(d.i18n("CALENDAR/ONLY_THIS_INSTANCE"));this.allEventsButtonText=b.observable(d.i18n("CALENDAR/ALL_EVENTS_IN_THE_SERIES"));this.cancelButtonText=b.observable(d.i18n("MAIN/BUTTON_CANCEL"))}function ta(){this.phone=e.Phone;this.voiceApp=e.Phone.voiceApp;this.phoneReport=e.Phone.phoneReport;this.action=b.observable("");this.phoneNumber=b.observable("");this.callback=null}function lb(){this.AllowUsersAddNewAccounts=this.AllowUsersChangeEmailSettings=this.AllowUsersChangeInterfaceSettings=
!0;this.SiteName="";this.Languages=[{name:"English",value:"en"}];this.Themes=["Default"];this.DateFormats=[];this.DefaultLanguage="English";this.ImageUploadSizeLimit=this.AttachmentSizeLimit=1024E4;this.AllowFetcher=this.AllowIdentities=this.AllowFirstCharacterSearch=!1;this.AutoSave=!0;this.AutoSaveIntervalSeconds=60;this.IdleSessionTimeout=0;this.AllowInsertImage=!0;this.AllowBodySize=!1;this.MaxBodySize=600;this.MaxSubjectSize=255;this.AllowPrefetch=!0;this.MaxPrefetchBodiesSize=5E4;this.LoginFormType=
f.LoginFormType.Email;this.LoginAtDomainValue="";this.DemoWebMail=!0;this.GoogleAnalyticsAccount=this.LoginDescription=this.DemoWebMailPassword=this.DemoWebMailLogin="";this.FlagsLangSelect=this.AllowLanguageOnLogin=this.ServerUseUrlRewrite=this.ShowQuotaBar=!1;this.IosDetectOnLogin=this.CustomLogoutUrl=this.CustomLoginUrl="";this.UseReCaptcha=!1;this.ReCaptchaPublicKey="";this.DefaultLanguageShort="en"}function ca(){this.IdUser=1;this.ContactsPerPage=this.MailsPerPage=20;this.iInterval=-1;this.autoCheckMailInterval=
b.observable(0);this.autoCheckMailInterval.subscribe(this.changeAutoCheckMailInterval,this);this.DefaultEditor=1;this.Layout=f.MailboxLayout.Side;this.DefaultTheme="Default";this.DefaultLanguage="English";this.DefaultDateFormat="MM/DD/YYYY";this.defaultTimeFormat=b.observable(0);this.ThreadsEnabled=!0;this.useThreads=b.observable(!0);this.AllowForward=this.AllowReply=this.AllowCompose=!0;this.SaveMail=f.SaveMail.Checked;this.ShowPersonalContacts=this.MobileSyncEnable=this.OutlookSyncEnable=!0;this.IsHelpdeskAgent=
this.IsHelpdeskSupported=this.IsFilesSupported=this.ShowGlobalContacts=!1;this.HelpdeskIframeUrl="";this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts;this.LastLogin=0;this.AllowVoice=this.IsDemo=!1;this.VoiceProvider=this.VoicePassword=this.VoiceImpu=this.VoiceImpi=this.VoiceCallerID=this.VoiceOutboundProxyUrl=this.VoiceWebsocketProxyUrl=this.VoiceRealm="";this.AllowCalendar=!0;this.CalendarShowWorkDay=this.CalendarShowWeekEnds=this.CalendarAppointments=this.CalendarSharing=!1;
this.CalendarWeekStartsOn=this.CalendarWorkDayEnds=this.CalendarWorkDayStarts=0;this.CalendarDefaultTab=f.CalendarDefaultTab.Month;this.needToReloadCalendar=b.observable(!1);this.mobileSync=b.observable(null);this.MobileSyncDemoPass="demo";this.outlookSync=b.observable(null);this.OutlookSyncDemoPass="demo";this.AllowHelpdeskNotifications=!1}function U(){this.id=b.observable(0);this.email=b.observable("");this.extensions=b.observableArray([]);this.fetchers=b.observable(null);this.friendlyName=b.observable("");
this.incomingMailLogin=b.observable("");this.incomingMailPort=b.observable(143);this.incomingMailServer=b.observable("");this.isInternal=b.observable(!1);this.isLinked=b.observable(!1);this.isDefault=b.observable(!1);this.outgoingMailAuth=b.observable(0);this.outgoingMailLogin=b.observable("");this.outgoingMailPort=b.observable(25);this.outgoingMailServer=b.observable("");this.isExtended=b.observable(!1);this.signature=b.observable(null);this.autoresponder=b.observable(null);this.forward=b.observable(null);
this.filters=b.observable(null);this.quota=b.observable(0);this.usedSpace=b.observable(0);this.fullEmail=b.computed(function(){return""===this.friendlyName()?this.email():this.friendlyName()+" <"+this.email()+">"},this);this.isCurrent=b.observable(!1);this.isEdited=b.observable(!1)}function W(){this.defaultId=b.observable(0);this.currentId=b.observable(0);this.editedId=b.observable(0);this.currentId.subscribe(function(a){this.getCurrent().requestExtensions();_.defer(_.bind(function(){this.editedId(a)},
this))},this);this.collection=b.observableArray([])}function ua(){this.sEmail=this.sName=""}function S(){this.aCollection=[]}function T(){this.oMoment=null}function J(a,c){this.folderName=b.observable(a||"");this.messageUid=b.observable(c||"");this.tempName=b.observable("");this.fileName=b.observable("");this.extension=b.computed(function(){var a=this.fileName().lastIndexOf(".");return this.fileName().substr(a+1)},this);this.mimePartIndex=b.observable("");this.type=b.observable("");this.size=b.observable(0);
this.friendlySize=b.computed(function(){return d.friendlySize(this.size())},this);this.downloadTitle=b.computed(function(){return d.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()})},this);this.cid=b.observable("");this.inline=b.observable(!1);this.linked=b.observable(!1);this.thumb=b.observable(!1);this.hash=b.observable("");this.accountId=b.observable(0);this.download=b.computed(function(){return d.getDownloadLinkByHash(this.accountId(),this.hash())},
this);this.viewLink=b.computed(function(){return d.getViewLinkByHash(this.accountId(),this.hash())},this);this.viewThumbnailLink=b.computed(function(){var a=this.accountId(),c=this.hash();return this.thumb()?d.getViewThumbnailLinkByHash(a,c):""},this);this.uploadUid=b.observable("");this.uploaded=b.observable(!1);this.uploadError=b.observable(!1);this.isMessageType=b.computed(function(){return"message/rfc822"===this.type()&&""!==this.mimePartIndex()},this);this.messagePart=b.observable(null);this.visibleViewLink=
b.computed(function(){var a=-1!==i.inArray(this.type(),ab);return this.uploaded()&&!this.uploadError()&&(a||this.isMessageType())},this);this.visibleSpinner=b.observable(!1);this.statusText=b.observable("");this.progressPercent=b.observable(0);this.visibleProgress=b.observable(!1);this.uploadStarted=b.observable(!1);this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),
this.uploaded(!0))},this)}function y(){this.iAccountId=0;this.account=b.computed(function(){return h.Accounts.getAccount(this.iAccountId)},this);this.level=b.observable(0);this.name=b.observable("");this.nameForEdit=b.observable("");this.fullName=b.observable("");this.fullNameHash=b.observable();this.uidNext=b.observable("");this.hash=b.observable("");this.routingHash=b.observable("");this.delimiter=b.observable("");this.type=b.observable(f.FolderTypes.User);this.showUnseenMessages=b.computed(function(){return this.type()!==
f.FolderTypes.Drafts},this);this.withoutThreads=b.computed(function(){return this.type()===f.FolderTypes.Drafts||this.type()===f.FolderTypes.Spam||this.type()===f.FolderTypes.Trash},this);this.messageCount=b.observable(0);this.unseenMessageCount=b.observable(0);this.messageCountToShow=b.computed(function(){return this.showUnseenMessages()?this.unseenMessageCount():this.messageCount()},this);this.enableEmptyFolder=b.computed(function(){return 0<this.messageCount()&&(this.type()===f.FolderTypes.Spam||
this.type()===f.FolderTypes.Trash)},this);this.virtual=b.observable(!1);this.virtualEmpty=b.computed(function(){return this.virtual()&&0===this.messageCount()},this);this.hasExtendedInfo=b.observable(!1);this.selectable=b.observable(!0);this.subscribed=b.observable(!0);this.existen=b.observable(!0);this.subfolders=b.observableArray([]);this.isNamespace=b.observable(!1);this.isSubFolder=b.computed(function(){return 0<this.level()},this);this.selected=b.observable(!1);this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500});
this.hasSubscribedSubfolders=b.computed(function(){return!!b.utils.arrayFirst(this.subfolders(),function(a){return a.subscribed()})},this);this.isSystem=b.computed(function(){return this.type()!==f.FolderTypes.User?!0:!1},this);this.visible=b.computed(function(){var a=this.subscribed(),c=this.existen(),g=this.selectable(),b=this.hasSubscribedSubfolders(),d=this.isSystem();return a||d||b&&(!c||!g)},this);this.edited=b.observable(!1);this.edited.subscribe(function(a){!1===a&&this.nameForEdit(this.name())},
this);this.canBeSelected=b.computed(function(){var a=this.existen(),c=this.selectable();return a&&c},this);this.canSubscribe=b.computed(function(){var a=this.account(),c=!1;a&&(c=a.extensionExists("DisableManageSubscribe"));return!this.isSystem()&&this.canBeSelected()&&!c},this);this.canDelete=b.computed(function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this);this.canRename=b.computed(function(){return!this.isSystem()&&this.canBeSelected()},
this);this.usedAs=b.computed(function(){var a="";switch(this.type()){case f.FolderTypes.Inbox:a=d.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_INBOX");break;case f.FolderTypes.Sent:a=d.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SENT");break;case f.FolderTypes.Drafts:a=d.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_DRAFTS");break;case f.FolderTypes.Trash:a=d.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_TRASH");break;case f.FolderTypes.Spam:a=d.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SPAM");break;default:a=""}return a},this);
this.oMessages={};this.oUids={};this.aResponseHandlers=[];this.displayName=b.computed(function(){var a=this.name();switch(this.type()){case f.FolderTypes.Inbox:a=d.i18n("MAIN/FOLDER_INBOX");break;case f.FolderTypes.Sent:a=d.i18n("MAIN/FOLDER_SENT");break;case f.FolderTypes.Drafts:a=d.i18n("MAIN/FOLDER_DRAFTS");break;case f.FolderTypes.Trash:a=d.i18n("MAIN/FOLDER_TRASH");break;case f.FolderTypes.Spam:a=d.i18n("MAIN/FOLDER_SPAM")}return a},this);this.aRequestedUids=[];this.requestedLists=[];this.hasChanges=
b.observable(!1);this.hasChanges.subscribe(function(){this.requestedLists=[]},this)}function L(){this.iAccountId=0;this.bInitialized=b.observable(!1);this.collection=b.observableArray([]);this.options=b.observableArray([]);this.sNamespaceFolder=this.sNamespace="";this.oStarredFolder=null;this.oNamedCollection={};var a=this,c=function(a){return function(c){c&&c.type(a)}},g=function(c){return{read:function(){this.collection();return c()?c().fullName():""},write:function(a){c(this.getFolderByFullName(a))},
owner:a}};this.totalMessageCount=b.computed(function(){return this.getRecursivelyMessageCount(this.collection())},this);this.currentFolder=b.observable(null);this.inboxFolder=b.observable(null);this.sentFolder=b.observable(null);this.draftsFolder=b.observable(null);this.spamFolder=b.observable(null);this.trashFolder=b.observable(null);this.inboxFolder.subscribe(c(f.FolderTypes.User),this,"beforeChange");this.sentFolder.subscribe(c(f.FolderTypes.User),this,"beforeChange");this.draftsFolder.subscribe(c(f.FolderTypes.User),
this,"beforeChange");this.spamFolder.subscribe(c(f.FolderTypes.User),this,"beforeChange");this.trashFolder.subscribe(c(f.FolderTypes.User),this,"beforeChange");this.inboxFolder.subscribe(c(f.FolderTypes.Inbox));this.sentFolder.subscribe(c(f.FolderTypes.Sent));this.draftsFolder.subscribe(c(f.FolderTypes.Drafts));this.spamFolder.subscribe(c(f.FolderTypes.Spam));this.trashFolder.subscribe(c(f.FolderTypes.Trash));this.inboxFolderFullName=b.computed(g(this.inboxFolder));this.sentFolderFullName=b.computed(g(this.sentFolder));
this.draftsFolderFullName=b.computed(g(this.draftsFolder));this.spamFolderFullName=b.computed(g(this.spamFolder));this.trashFolderFullName=b.computed(g(this.trashFolder));this.currentFolderFullName=b.computed(g(this.currentFolder));this.currentFolderType=b.computed(function(){return this.currentFolder()?this.currentFolder().type():f.FolderTypes.User},this);this.delimiter=b.computed(function(){return this.inboxFolder()?this.inboxFolder().delimiter():""},this)}function F(){this.accountId=b.observable(0);
this.folder=b.observable("");this.uid=b.observable("");this.subject=b.observable("");this.emptySubject=b.computed(function(){return""===d.trim(this.subject())},this);this.subjectForDisplay=b.computed(function(){return this.emptySubject()?d.i18n("MAILBOX/EMPTY_SUBJECT"):this.subject()},this);this.messageId=b.observable("");this.size=b.observable(0);this.friendlySize=b.computed(function(){return d.friendlySize(this.size())},this);this.textSize=b.observable(0);this.oDateModel=new T;this.fullDate=b.observable("");
this.oFrom=new S;this.fullFrom=b.observable("");this.oTo=new S;this.to=b.observable("");this.fromOrToText=b.observable("");this.oCc=new S;this.cc=b.observable("");this.oBcc=new S;this.bcc=b.observable("");this.oSender=new S;this.oReplyTo=new S;this.seen=b.observable(!1);this.flagged=b.observable(!1);this.answered=b.observable(!1);this.forwarded=b.observable(!1);this.hasAttachments=b.observable(!1);this.threadsAllowed=b.computed(function(){var a=e.MailCache.getFolderByFullName(this.accountId(),this.folder()),
a=a&&(a.type()===f.FolderTypes.Drafts||a.type()===f.FolderTypes.Spam||a.type()===f.FolderTypes.Trash);return h.User.useThreads()&&!a},this);this.threadPart=b.observable(!1);this.threadUids=b.observableArray([]);this.threadCount=b.computed(function(){return this.threadUids().length},this);this.threadOpened=b.observable(!1);this.threadLoading=b.observable(!1);this.threadLoadingVisible=b.computed(function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()},this);this.threadCountVisible=
b.computed(function(){return this.threadsAllowed()&&0<this.threadCount()&&!this.threadLoading()},this);this.threadCountForLoad=b.observable(5);this.threadNextLoadingVisible=b.observable(!1);this.threadNextLoadingLinkVisible=b.observable(!1);this.threadFunctionLoadNext=null;this.threadShowAnimation=b.observable(!1);this.threadHideAnimation=b.observable(!1);this.importance=b.observable(f.Importance.Normal);this.draftInfo=b.observableArray([]);this.sensitivity=b.observable(f.Sensivity.Nothing);this.hash=
b.observable("");this.download=b.computed(function(){return 0<this.hash().length?d.getDownloadLinkByHash(this.accountId(),this.hash()):""},this);this.completelyFilled=b.observable(!1);this.checked=b.observable(!1);this.selected=b.observable(!1);this.deleted=b.observable(!1);this.inReplyTo=b.observable("");this.references=b.observable("");this.readingConfirmation=b.observable("");this.isPlain=b.observable(!1);this.text=b.observable("");this.textBodyForNewWindow=b.observable("");this.$text=null;this.rtl=
b.observable(!1);this.hasExternals=b.observable(!1);this.isExternalsShown=b.observable(!1);this.isExternalsAlwaysShown=b.observable(!1);this.foundedCids=b.observableArray([]);this.attachments=b.observableArray([]);this.usesAttachmentString=!1;this.safety=b.observable(!1);this.ical=b.observable(null);this.vcard=b.observable(null);this.domMessageForPrint=b.observable(null)}function Ha(){this.resultCount=b.observable(-1);this.search=b.observable("");this.filters=b.observable("");this.collection=b.observableArray([]);
this.threadUids={}}function M(){this.uid=b.observable("");this.uid.subscribe(function(){""!==this.uid()&&"0"!==this.uid()&&e.CalendarCache.addIcal(this)},this);this.file=b.observable("");this.type=b.observable("");this.icalType=b.observable("");this.icalConfig=b.observable("");this.type.subscribe(function(){var a=this.type().split("-"),c=a.shift(),g=_.find(f.IcalType,function(a){return c===a},this),b=a.join("-"),a=_.find(f.IcalConfig,function(a){return b===a},this);c!==g&&(c=f.IcalType.Save);this.icalType(c);
b!==a&&(b=f.IcalConfig.NeedsAction);this.icalConfig(b)},this);this.isRequestType=b.computed(function(){return this.icalType()===f.IcalType.Request},this);this.isCancelType=b.computed(function(){return this.icalType()===f.IcalType.Cancel},this);this.cancelDecision=b.observable("");this.isReplyType=b.computed(function(){return this.icalType()===f.IcalType.Reply},this);this.replyDecision=b.observable("");this.isSaveType=b.computed(function(){return this.icalType()===f.IcalType.Save},this);this.isJustSaved=
b.observable(!1);this.fillDecisions();this.isAccepted=b.computed(function(){return this.icalConfig()===f.IcalConfig.Accepted},this);this.isDeclined=b.computed(function(){return this.icalConfig()===f.IcalConfig.Declined},this);this.isTentative=b.computed(function(){return this.icalConfig()===f.IcalConfig.Tentative},this);this.location=b.observable("");this.description=b.observable("");this.when=b.observable("");this.calendarId=b.observable("");this.calendars=e.CalendarCache.calendars;this.selectedCalendar=
b.observable("");this.chosenCalendarName=b.computed(function(){var a=null;""!==this.calendarId()&&(a=_.find(this.calendars(),function(a){return a.id===this.calendarId()},this));return a?a.name:""},this);this.calendarIsChosen=b.computed(function(){return""!==this.chosenCalendarName()},this);this.visibleCalendarDropdown=b.computed(function(){return!this.calendarIsChosen()&&1<this.calendars().length&&(this.isRequestType()||this.isSaveType())},this);this.visibleCalendarName=b.computed(function(){return this.calendarIsChosen()},
this);this.visibleFirstCalendarName=b.computed(function(){return 1===this.calendars().length&&!this.calendarIsChosen()},this);this.visibleCalendarRow=b.computed(function(){return this.visibleCalendarDropdown()||this.visibleCalendarName()||this.visibleFirstCalendarName()},this);this.animation=b.observable(!1)}function bb(){this.uid=b.observable("");this.uid.subscribe(function(){""!==this.uid()&&"0"!==this.uid()&&e.ContactsCache.addVcard(this)},this);this.file=b.observable("");this.name=b.observable("");
this.email=b.observable("");this.isExists=b.observable(!1);this.isJustSaved=b.observable(!1)}function w(){this.sEmailDefaultType=f.ContactEmailType.Personal;this.sPhoneDefaultType=f.ContactPhoneType.Mobile;this.sAddressDefaultType=f.ContactAddressType.Personal;this.voiceApp=e.Phone.voiceApp;this.idContact=b.observable("");this.idUser=b.observable("");this.global=b.observable(!1);this.itsMe=b.observable(!1);this.isNew=b.observable(!1);this.readOnly=b.observable(!1);this.edited=b.observable(!1);this.extented=
b.observable(!1);this.personalCollapsed=b.observable(!1);this.businessCollapsed=b.observable(!1);this.otherCollapsed=b.observable(!1);this.groupsCollapsed=b.observable(!1);this.displayName=b.observable("");this.firstName=b.observable("");this.lastName=b.observable("");this.nickName=b.observable("");this.skype=b.observable("");this.facebook=b.observable("");this.displayNameFocused=b.observable(!1);this.primaryEmail=b.observable(this.sEmailDefaultType);this.primaryPhone=b.observable(this.sPhoneDefaultType);
this.primaryAddress=b.observable(this.sAddressDefaultType);this.mainPrimaryEmail=b.computed({read:this.primaryEmail,write:function(a){!d.isUnd(a)&&0<=d.inArray(a,[f.ContactEmailType.Personal,f.ContactEmailType.Business,f.ContactEmailType.Other])?this.primaryEmail(a):this.primaryEmail(f.ContactEmailType.Personal)},owner:this});this.mainPrimaryPhone=b.computed({read:this.primaryPhone,write:function(a){!d.isUnd(a)&&0<=d.inArray(a,[f.ContactPhoneType.Mobile,f.ContactPhoneType.Personal,f.ContactPhoneType.Business])?
this.primaryPhone(a):this.primaryPhone(f.ContactPhoneType.Mobile)},owner:this});this.mainPrimaryAddress=b.computed({read:this.primaryAddress,write:function(a){!d.isUnd(a)&&0<=d.inArray(a,[f.ContactAddressType.Personal,f.ContactAddressType.Business])?this.primaryAddress(a):this.primaryAddress(f.ContactAddressType.Personal)},owner:this});this.personalEmail=b.observable("");this.personalStreetAddress=b.observable("");this.personalCity=b.observable("");this.personalState=b.observable("");this.personalZipCode=
b.observable("");this.personalCountry=b.observable("");this.personalWeb=b.observable("");this.personalFax=b.observable("");this.personalPhone=b.observable("");this.personalMobile=b.observable("");this.personalIsEmpty=b.computed(function(){return""===""+this.personalEmail()+this.personalStreetAddress()+this.personalCity()+this.personalState()+this.personalZipCode()+this.personalCountry()+this.personalWeb()+this.personalFax()+this.personalPhone()+this.personalMobile()},this);this.businessEmail=b.observable("");
this.businessCompany=b.observable("");this.businessDepartment=b.observable("");this.businessJob=b.observable("");this.businessOffice=b.observable("");this.businessStreetAddress=b.observable("");this.businessCity=b.observable("");this.businessState=b.observable("");this.businessZipCode=b.observable("");this.businessCountry=b.observable("");this.businessWeb=b.observable("");this.businessFax=b.observable("");this.businessPhone=b.observable("");this.businessIsEmpty=b.computed(function(){return""===""+
this.businessEmail()+this.businessCompany()+this.businessDepartment()+this.businessJob()+this.businessOffice()+this.businessStreetAddress()+this.businessCity()+this.businessState()+this.businessZipCode()+this.businessCountry()+this.businessWeb()+this.businessFax()+this.businessPhone()},this);this.otherEmail=b.observable("");this.otherBirthdayMonth=b.observable("0");this.otherBirthdayDay=b.observable("0");this.otherBirthdayYear=b.observable("0");this.otherNotes=b.observable("");this.etag=b.observable("");
this.birthdayIsEmpty=b.computed(function(){var a="0"===this.otherBirthdayMonth(),c="0"===this.otherBirthdayDay(),b="0"===this.otherBirthdayYear();return a||c||b},this);this.otherBirthday=b.computed(function(){var a="",c=d.pInt(this.otherBirthdayYear()),b=d.pInt(this.otherBirthdayMonth()),n=d.pInt(this.otherBirthdayDay()),e=new T;this.birthdayIsEmpty()||(e.setDate(c,0<b?b-1:0,n),a=e.getShortDate());return a},this);this.otherIsEmpty=b.computed(function(){return""===""+this.otherEmail()+this.otherNotes()&&
this.birthdayIsEmpty()},this);this.groups=b.observableArray([]);this.groupsIsEmpty=b.computed(function(){return 0===this.groups().length},this);this.email=b.computed({read:function(){var a="";switch(this.primaryEmail()){case f.ContactEmailType.Personal:a=this.personalEmail();break;case f.ContactEmailType.Business:a=this.businessEmail();break;case f.ContactEmailType.Other:a=this.otherEmail()}return a},write:function(a){switch(this.primaryEmail()){case f.ContactEmailType.Personal:this.personalEmail(a);
break;case f.ContactEmailType.Business:this.businessEmail(a);break;case f.ContactEmailType.Other:this.otherEmail(a);break;default:this.primaryEmail(this.sEmailDefaultType),this.email(a)}},owner:this});this.phone=b.computed({read:function(){var a="";switch(this.primaryPhone()){case f.ContactPhoneType.Mobile:a=this.personalMobile();break;case f.ContactPhoneType.Personal:a=this.personalPhone();break;case f.ContactPhoneType.Business:a=this.businessPhone()}return a},write:function(a){switch(this.primaryPhone()){case f.ContactPhoneType.Mobile:this.personalMobile(a);
break;case f.ContactPhoneType.Personal:this.personalPhone(a);break;case f.ContactPhoneType.Business:this.businessPhone(a);break;default:this.primaryPhone(this.sEmailDefaultType),this.phone(a)}},owner:this});this.address=b.computed({read:function(){var a="";switch(this.primaryAddress()){case f.ContactAddressType.Personal:a=this.personalStreetAddress();break;case f.ContactAddressType.Business:a=this.businessStreetAddress()}return a},write:function(a){switch(this.primaryAddress()){case f.ContactAddressType.Personal:this.personalStreetAddress(a);
break;case f.ContactAddressType.Business:this.businessStreetAddress(a);break;default:this.primaryAddress(this.sEmailDefaultType),this.address(a)}},owner:this});this.emails=b.computed(function(){var a=[];""!==this.personalEmail()&&a.push({text:d.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalEmail(),value:f.ContactEmailType.Personal});""!==this.businessEmail()&&a.push({text:d.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessEmail(),value:f.ContactEmailType.Business});""!==this.otherEmail()&&
a.push({text:d.i18n("CONTACTS/OPTION_OTHER")+": "+this.otherEmail(),value:f.ContactEmailType.Other});return a},this);this.phones=b.computed(function(){var a=[];""!==this.personalMobile()&&a.push({text:d.i18n("CONTACTS/LABEL_MOBILE")+": "+this.personalMobile(),value:f.ContactPhoneType.Mobile});""!==this.personalPhone()&&a.push({text:d.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalPhone(),value:f.ContactPhoneType.Personal});""!==this.businessPhone()&&a.push({text:d.i18n("CONTACTS/OPTION_BUSINESS")+
": "+this.businessPhone(),value:f.ContactPhoneType.Business});return a},this);this.addresses=b.computed(function(){var a=[];""!==this.personalStreetAddress()&&a.push({text:d.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalStreetAddress(),value:f.ContactAddressType.Personal});""!==this.businessStreetAddress()&&a.push({text:d.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessStreetAddress(),value:f.ContactAddressType.Business});return a},this);this.hasEmails=b.computed(function(){return 0<this.emails().length},
this);this.extented.subscribe(function(a){a&&(this.personalCollapsed(!this.personalIsEmpty()),this.businessCollapsed(!this.businessIsEmpty()),this.otherCollapsed(!this.otherIsEmpty()),this.groupsCollapsed(!this.groupsIsEmpty()))},this);this.birthdayMonthSelect=w.birthdayMonthSelect;this.birthdayYearSelect=w.birthdayYearSelect;this.birthdayDaySelect=b.computed(function(){for(var a=1,c=d.pInt(d.daysInMonth(this.otherBirthdayMonth(),this.otherBirthdayYear())),b="",n=[{text:d.i18n("DATETIME/DAY"),value:"0"}];a<=
c;a++)b=a.toString(),n.push({text:b,value:b});return n},this);for(var a="",c=(new Date).getFullYear();1932<=c;c--)a=c.toString(),this.birthdayYearSelect.push({text:a,value:a});this.canBeSave=b.computed(function(){return!0},this);this.sendMailLink=b.computed(function(){return this.getSendMailLink(this.email())},this);this.sendMailToPersonalLink=b.computed(function(){return this.getSendMailLink(this.personalEmail())},this);this.sendMailToBusinessLink=b.computed(function(){return this.getSendMailLink(this.businessEmail())},
this);this.sendMailToOtherLink=b.computed(function(){return this.getSendMailLink(this.otherEmail())},this)}function Ba(){this.isNew=b.observable(!1);this.readOnly=b.observable(!1);this.idGroup=b.observable("");this.idUser=b.observable("");this.name=b.observable("");this.edited=b.observable(!1);this.nameFocused=b.observable(!1);this.canBeSave=b.computed(function(){return""!==this.name()},this);this.newContactsInGroupCount=b.observable(0);this.newContactsInGroupHint=b.computed(function(){var a=this.newContactsInGroupCount();
return this.isNew()&&0<a?d.i18n("CONTACTS/CONTACT_ADD_TO_NEW_HINT_PLURAL",{COUNT:a},null,a):""},this)}function X(){this.bGlobal=this.bItsMe=this.bReadOnly=this.bIsGroup=!1;this.sEmail=this.sName=this.sId="";this.deleted=b.observable(!1);this.checked=b.observable(!1);this.selected=b.observable(!1);this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500})}function va(){this.id=0;this.name=b.observable("");this.description=b.observable("");this.owner=b.observable("");this.isShared=this.isDefault=
!1;this.isPublic=b.observable(!1);this.access=f.CalendarAccess.Write;this.url=b.observable("");this.davUrl=b.observable("");this.exportUrl=b.observable("");this.pubUrl=b.observable("");this.shares=b.observableArray([]);this.events=[];this.hiddenEvents=[];this.color=b.observable("");this.color.subscribe(function(){var a=[],c=this;_.each(this.events,function(g){g.backgroundColor=c.color();g.borderColor=c.color();a.push(g)});this.events=a;this.name.valueHasMutated()},this);this.active=b.observable(!0);
this.endDateTime=this.startDateTime=0}function ka(a){this.parentOnCalendarActiveChange=a.onCalendarActiveChange;this.defaultCal=b.observable(null);this.currentCal=b.observable(null);this.collection=b.observableArray([]);this.collection.subscribe(function(){this.pickCurrentCalendar(this.defaultCal())},this);this.count=b.computed(function(){return this.collection().length},this);this.sharedCount=b.computed(function(){return _.filter(this.collection(),function(a){return a.isShared}).length},this)}function Y(){this.name=
b.observable("");this.nameForEdit=b.observable("");this.displayName=b.observable("");this.name.subscribe(function(a){this.nameForEdit(a);this.displayName(a);this.value=a},this);this.extension=b.computed(function(){if(null!==this.name()){var a=this.name().lastIndexOf(".");return this.name().substr(a+1)}return""},this);this.size=b.observable(0);this.storageType=b.observable(f.FileStorageType.Private);this.lastModified=b.observable("");this.friendlySize=b.computed(function(){return d.friendlySize(this.size())},
this);this.path=b.observable("");this.hash=b.observable("");this.download=b.computed(function(){return d.getFilestorageDownloadLinkByHash(h.Accounts.currentId(),this.hash())},this);this.view=b.computed(function(){return d.getFilestorageViewLinkByHash(h.Accounts.currentId(),this.hash())},this);this.selected=b.observable(!1);this.checked=b.observable(!1);this.isFolder=b.observable(!1);this.isViewable=b.computed(function(){var a=!1;0<=_.indexOf("JPEG JPG PNG GIF TXT PDF".split(" "),this.extension().toUpperCase())&&
(a=!0);return a},this);this.edited=b.observable(!1);this.edited.subscribe(function(a){!1===a&&this.nameForEdit(this.name())},this);this.uploadUid=b.observable(null);this.uploaded=b.observable(!0);this.progress=b.observable(0);this.deleted=b.observable(!1);this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500});this.shared=b.observable(!1);this.owner=b.observable("");this.ownerHeaderText=b.computed(function(){return d.i18n("FILESTORAGE/OWNER_HEADER_EMAIL",{OWNER:this.owner()})},this);this.lastModifiedHeaderText=
b.computed(function(){return d.i18n("FILESTORAGE/OWNER_HEADER_LAST_MODIFIED_DATE_TEXT",{LASTMODIFIED:this.lastModified()})},this)}function mb(){this.IdOwner=this.IdThread=this.Id=null;this.sDate=this.sFrom="";this.iType=null;this.bSysType=!1;this.bThreadOwner=null;this.sText="";this.collapsed=b.observable(!1);this.attachments=b.observableArray([]);this.allowDownloadAttachmentsLink=!0;this.canBeDeleted=this.itsMe=b.observable(!1)}function Wa(){this.Id=null;this.ThreadHash="";this.IdOwner=null;this.ItsMe=
!1;this.aOwner=[];this.sDate=this.sFromFull=this.sFrom=this.sName=this.sEmail=this.sSubject="";this.state=b.observable(0);this.unseen=b.observable(!1);this.postsCount=b.observable(0);this.printableState=b.computed(function(){var a="",c=this.ItsMe?"_FOR_CLIENT":"";switch(this.state()){case f.HelpdeskThreadStates.Pending:a=d.i18n("HELPDESK/THREAD_STATE_PENDING"+c);break;case f.HelpdeskThreadStates.Resolved:a=d.i18n("HELPDESK/THREAD_STATE_RESOLVED"+c);break;case f.HelpdeskThreadStates.Waiting:a=d.i18n("HELPDESK/THREAD_STATE_WAITING"+
c);break;case f.HelpdeskThreadStates.Answered:a=d.i18n("HELPDESK/THREAD_STATE_ANSWERED"+c);break;case f.HelpdeskThreadStates.Deferred:a=d.i18n("HELPDESK/THREAD_STATE_DEFERRED"+c)}return a},this);this.deleted=b.observable(!1);this.checked=b.observable(!1);this.selected=b.observable(!1)}function wa(){this.parentId=b.observable(null);this.tempName=b.observable("");this.fileName=b.observable("");this.displayName=b.observable("");this.extention=b.computed(function(){var a=this.fileName(),c=a.lastIndexOf(".");
this.displayName(a.substr(0,c));return a.substr(c+1)},this);this.type=b.observable("");this.size=b.observable(0);this.friendlySize=b.computed(function(){return d.friendlySize(this.size())},this);this.downloadTitle=b.computed(function(){return d.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()})},this);this.hash=b.observable("");this.downloadLink=b.computed(function(){return d.getDownloadLinkByHash(!sa&&h&&h.Accounts?h.Accounts.currentId():0,this.hash(),
sa,sa&&h?h.TenantHash:"")},this);this.viewLink=b.computed(function(){return d.getViewLinkByHash(!sa&&h&&h.Accounts?h.Accounts.currentId():0,this.hash(),sa,sa&&h?h.TenantHash:"")},this);this.uploadUID=b.observable("");this.uploaded=b.observable(!1);this.uploadError=b.observable(!1);this.visibleViewLink=b.computed(function(){var a=-1!==i.inArray(this.type(),ab);return this.uploaded()&&!this.uploadError()&&a},this);this.visibleSpinner=b.observable(!1);this.statusText=b.observable("");this.progressPercent=
b.observable(0);this.visibleProgress=b.observable(!1);this.uploadStarted=b.observable(!1);this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this)}function hb(){this.iAccountId=0;this.type=b.observable(!0);this.options=b.observable(0);this.signature=b.observable("")}function nb(){this.iAccountId=0;this.enable=!1;this.message=this.subject=""}function ub(){this.idFetcher=
b.observable(0);this.idAccount=b.observable(0);this.isEnabled=b.observable(!1);this.isLocked=b.observable(!1);this.email=b.observable("");this.userName=b.observable("");this.folder=b.observable("");this.signature=b.observable("");this.incomingMailServer=b.observable("");this.incomingMailPort=b.observable(0);this.incomingMailLogin=b.observable("");this.leaveMessagesOnServer=b.observable("");this.isOutgoingEnabled=b.observable(!1);this.outgoingMailServer=b.observable("");this.outgoingMailPort=b.observable(0);
this.outgoingMailAuth=b.observable(!1);this.fullEmail=b.computed(function(){return""===this.userName()?this.email():this.userName()+" <"+this.email()+">"},this)}function ib(){this.idAccount=0;this.collection=b.observableArray([])}function ob(){this.iAccountId=0;this.enable=!1;this.email=""}function pb(){this.iAccountId=0;this.collection=b.observableArray([])}function cb(a){this.iAccountId=a;this.enable=b.observable(!0);this.field=b.observable("");this.condition=b.observable("");this.filter=b.observable("");
this.action=b.observable("");this.folder=b.observable("")}function Oa(){this.loadingMessage=b.observable("");this.loadingVisible=b.observable(!1);this.reportMessage=b.observable("");this.reportVisible=b.observable(!1);this.iReportTimeout=NaN;this.errorMessage=b.observable("");this.errorNotHide=b.observable(!1);this.errorVisible=b.observable(!1);this.iErrorTimeout=-1;this.isHtmlError=b.observable(!1)}function Xa(){this.oPhone=new Pa;this.allowVoice=h.User.AllowVoice;this.currentAccountId=h.Accounts.currentId;
this.currentAccountId.subscribe(function(){this.changeCurrentAccount()},this);this.tabs=e.headerTabs;this.email=b.observable("");this.accounts=h.Accounts.collection;this.currentTab=e.Screens.currentScreen;this.sMailboxHash=e.Routing.buildHashFromArray([f.Screens.Mailbox]);this.sSettingsHash=e.Routing.buildHashFromArray([f.Screens.Settings]);this.contactsRecivedAnim=e.ContactsCache.recivedAnim;this.calendarRecivedAnim=e.CalendarCache.recivedAnim}function da(a,c){this.currentPage=b.observable(1);this.count=
b.observable(a);this.perPage=b.observable(c);this.pagesCount=b.computed(function(){var a=Math.ceil(this.count()/this.perPage());return 0<a?a:1},this);this.firstPage=b.computed(function(){var a=this.currentPage()-2;return 0<a?a:1},this);this.lastPage=b.computed(function(){var a=this.firstPage()+4;return a<=this.pagesCount()?a:this.pagesCount()},this);this.visibleFirst=b.computed(function(){return 1<this.firstPage()},this);this.visibleLast=b.computed(function(){return this.lastPage()<this.pagesCount()},
this);this.pages=b.computed(function(){var a=this.firstPage(),c=[];if(this.firstPage()<this.lastPage())for(;a<=this.lastPage();a++)c.push({number:a,current:a===this.currentPage(),clickFunc:_.bind(this.clickPage,this)});return c},this)}function r(a){this.creaId="creaId"+Math.random().toString().replace(".","");this.workareaDom=b.observable();this.uploaderAreaDom=b.observable();this.editorUploaderBodyDragOver=b.observable(!1);this.editorUploaderProgress=b.observable(!1);this.colorPickerDropdownDom=
b.observable();this.insertLinkDropdownDom=b.observable();this.insertImageDropdownDom=b.observable();this.isEnable=b.observable(!0);this.allowInsertImage=b.observable(a&&h.App.AllowInsertImage);this.lockFontSubscribing=b.observable(!1);this.aFonts="Arial;Arial Black;Courier New;Tahoma;Times New Roman;Verdana".split(";");this.iDefaultFont="Tahoma";this.selectedFont=b.observable(this.iDefaultFont);this.selectedFont.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontName(this.selectedFont())},
this);this.aSizes=[1,2,3,4,5,6,7];this.iDefaultSize=3;this.selectedSize=b.observable(this.iDefaultSize);this.selectedSize.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontSize(this.selectedSize())},this);this.visibleInsertLinkPopup=b.observable(!1);this.linkForInsert=b.observable("");this.linkFocused=b.observable(!1);this.visibleLinkPopup=b.observable(!1);this.linkPopupTop=b.observable(0);this.linkPopupLeft=b.observable(0);this.linkHref=b.observable("");this.visibleLinkHref=b.observable(!1);
this.visibleImagePopup=b.observable(!1);this.imagePopupTop=b.observable(0);this.imagePopupLeft=b.observable(0);this.visibleInsertImagePopup=b.observable(!1);this.imageUploaderButton=b.observable(null);this.uploadedImagePathes=b.observableArray([]);this.imagePathFromWeb=b.observable("");this.visibleFontColorPopup=b.observable(!1);this.oFontColorPicker=new db(d.i18n("HTMLEDITOR/TEXT_COLOR_CAPTION"),this.setTextColorFromPopup,this);this.oBackColorPicker=new db(d.i18n("HTMLEDITOR/BACKGROUND_COLOR_CAPTION"),
this.setBackColorFromPopup,this);this.activitySource=b.observable(1);this.inactive=b.observable(!1);this.inactive.subscribe(function(){var a=this.removeAllTags(this.getText());this.inactive()?(""===a||"&nbsp;"===a)&&this.setText('<span style="color: #AAAAAA;">'+d.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")+"</span>"):a===d.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")&&this.setText("")},this)}function db(a,c,g){this.aGreyColors="rgb(0, 0, 0);rgb(68, 68, 68);rgb(102, 102, 102);rgb(153, 153, 153);rgb(204, 204, 204);rgb(238, 238, 238);rgb(243, 243, 243);rgb(255, 255, 255)".split(";");
this.aBrightColors="rgb(255, 0, 0);rgb(255, 153, 0);rgb(255, 255, 0);rgb(0, 255, 0);rgb(0, 255, 255);rgb(0, 0, 255);rgb(153, 0, 255);rgb(255, 0, 255)".split(";");this.aColorLines=["rgb(244, 204, 204);rgb(252, 229, 205);rgb(255, 242, 204);rgb(217, 234, 211);rgb(208, 224, 227);rgb(207, 226, 243);rgb(217, 210, 233);rgb(234, 209, 220)".split(";"),"rgb(234, 153, 153);rgb(249, 203, 156);rgb(255, 229, 153);rgb(182, 215, 168);rgb(162, 196, 201);rgb(159, 197, 232);rgb(180, 167, 214);rgb(213, 166, 189)".split(";"),
"rgb(224, 102, 102);rgb(246, 178, 107);rgb(255, 217, 102);rgb(147, 196, 125);rgb(118, 165, 175);rgb(111, 168, 220);rgb(142, 124, 195);rgb(194, 123, 160)".split(";"),"rgb(204, 0, 0);rgb(230, 145, 56);rgb(241, 194, 50);rgb(106, 168, 79);rgb(69, 129, 142);rgb(61, 133, 198);rgb(103, 78, 167);rgb(166, 77, 121)".split(";"),"rgb(153, 0, 0);rgb(180, 95, 6);rgb(191, 144, 0);rgb(56, 118, 29);rgb(19, 79, 92);rgb(11, 83, 148);rgb(53, 28, 117);rgb(116, 27, 71)".split(";"),"rgb(102, 0, 0);rgb(120, 63, 4);rgb(127, 96, 0);rgb(39, 78, 19);rgb(12, 52, 61);rgb(7, 55, 99);rgb(32, 18, 77);rgb(76, 17, 48)".split(";")];
this.caption=a;this.pickHandler=c;this.pickContext=g;this.colorPickerDom=b.observable(null)}function Pa(){this.phone=e.Phone;this.provider=e.Phone.provider;this.phoneReport=e.Phone.phoneReport;this.action=e.Phone.action;this.state=b.observable("offline");this.input=b.observable("");this.inputFocus=b.observable(!1);this.phoneAutocompleteItem=b.observable(null)}function Ca(){this.email=b.observable("");this.login=b.observable("");this.password=b.observable("");this.loginDescription=b.observable("");
this.emailFocus=b.observable(!1);this.loginFocus=b.observable(!1);this.passwordFocus=b.observable(!1);this.loading=b.observable(!1);this.loginFocus.subscribe(function(a){a&&""===this.login()&&this.login(this.email())},this);this.loginFormType=b.observable(h.App.LoginFormType);this.loginAtDomainValue=b.observable(h.App.LoginAtDomainValue);this.loginAtDomainValueWithAt=b.computed(function(){var a=this.loginAtDomainValue();return""===a?"":"@"+a},this);this.emailVisible=b.computed(function(){return f.LoginFormType.Login!==
this.loginFormType()},this);this.loginVisible=b.computed(function(){return f.LoginFormType.Email!==this.loginFormType()},this);this.signMeType=b.observable(h.App.LoginSignMeType);this.signMe=b.observable(f.LoginSignMeType.DefaultOn===this.signMeType());this.signMeType.subscribe(function(){this.signMe(f.LoginSignMeType.DefaultOn===this.signMeType())},this);this.focusedField="";this.aLanguages=h.App.Languages;this.currentLanguage=b.observable(h.App.DefaultLanguage);this.allowLanguages=b.observable(h.App.AllowLanguageOnLogin);
this.viewLanguagesAsDropdown=b.observable(!h.App.FlagsLangSelect);this.canBeLogin=b.computed(function(){var a=this.loginFormType(),c=this.email(),g=this.login(),b=this.password();return!this.loading()&&""!==d.trim(b)&&(f.LoginFormType.Login===a&&""!==d.trim(g)||f.LoginFormType.Email===a&&""!==d.trim(c))},this);this.signInButtonText=b.computed(function(){return this.loading()?d.i18n("LOGIN/BUTTON_SIGNING_IN"):d.i18n("LOGIN/BUTTON_SIGN_IN")},this);this.loginCommand=d.createCommand(this,this.signIn,
this.canBeLogin);this.email(h.App.DemoWebMailLogin||"");this.password(h.App.DemoWebMailPassword||"");this.loginDescription(h.App.LoginDescription||"")}function vb(){this.foldersContainer=b.observable(null);this.folderList=e.MailCache.folderList;this.manageFoldersHash=e.Routing.buildHashFromArray([f.Screens.Settings,f.SettingsTab.EmailAccounts,f.AccountSettingsTab.Folders]);this.quotaProc=b.observable(-1);this.quotaDesc=b.observable("");b.computed(function(){if(!h.App.ShowQuotaBar)return!0;e.MailCache.quotaChangeTrigger();
var a=h.Accounts.getCurrent(),c=a?a.quota():0,a=a?a.usedSpace():0,a=0<c?Math.ceil(100*(a/c)):-1,a=100<a?100:a;this.quotaProc(a);this.quotaDesc(-1<a?d.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:a,QUOTA:d.friendlySize(1024*c)}):"");return!0},this)}function B(){this.isFocused=b.observable(!1);this.messagesContainer=b.observable(null);this.searchInput=b.observable("");this.searchInputFrom=b.observable("");this.searchInputTo=b.observable("");this.searchInputSubject=b.observable("");this.searchInputText=b.observable("");
this.searchSpan=b.observable("");this.highlightTrigger=b.observable("");this.bAdvancedSearch=b.observable(!1);this.currentMessage=e.MailCache.currentMessage;this.currentMessage.subscribe(function(){this.isFocused(!1);this.selector.itemSelected(this.currentMessage())},this);this.folderList=e.MailCache.folderList;this.folderList.subscribe(this.onFolderListSubscribe,this);this.folderFullName=b.observable("");this.filters=b.observable("");this.uidList=e.MailCache.uidList;this.uidList.subscribe(function(){this.uidList().searchCountSubscription&&
(this.uidList().searchCountSubscription.dispose(),this.uidList().searchCountSubscription=void 0);this.uidList().searchCountSubscription=this.uidList().resultCount.subscribe(function(){this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this);0<=this.uidList().resultCount()&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this);this.useThreads=b.computed(function(){var a=this.folderList().currentFolder(),a=a&&a.withoutThreads(),c=""===this.uidList().search()&&
""===this.uidList().filters();return h.User.useThreads()&&!a&&c},this);this.collection=e.MailCache.messages;this.search=b.observable("");this.isEmptyList=b.computed(function(){return 0===this.collection().length},this);this.isNotEmptyList=b.computed(function(){return 0!==this.collection().length},this);this.isSearch=b.computed(function(){return 0<this.search().length},this);this.isLoading=e.MailCache.messagesLoading;this.isError=e.MailCache.messagesLoadingError;this.visibleInfoLoading=b.computed(function(){return!this.isSearch()&&
this.isLoading()},this);this.visibleInfoSearchLoading=b.computed(function(){return this.isSearch()&&this.isLoading()},this);this.visibleInfoSearchList=b.computed(function(){return this.isSearch()&&!this.isLoading()&&!this.isEmptyList()},this);this.visibleInfoMessageListEmpty=b.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.isEmptyList()&&!this.isError()},this);this.visibleInfoSearchEmpty=b.computed(function(){return this.isSearch()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()},
this);this.visibleInfoMessageListError=b.computed(function(){return!this.isSearch()&&this.isError()},this);this.visibleInfoSearchError=b.computed(function(){return this.isSearch()&&this.isError()},this);this.searchText=b.computed(function(){return d.i18n("MAILBOX/INFO_SEARCH_RESULT",{SEARCH:this.search(),FOLDER:this.folderList().currentFolder()?this.folderList().currentFolder().displayName():""})},this);this.collectionChecked=b.computed(function(){var a=_.filter(this.collection(),function(a){return!a.deleted()&&
a.checked()});0===a.length&&(e.MailCache.currentMessage()&&!e.MailCache.currentMessage().deleted())&&(a=[e.MailCache.currentMessage()]);return a},this);this.collectionCheckedUids=b.computed(function(){return _.map(this.collectionChecked(),function(a){return a.uid()})},this);this.isEnableGroupOperations=b.observable(!1).extend({throttle:250});this.selector=new E(this.collection,_.bind(this.routeForMessage,this),_.bind(this.onDeletePress,this),_.bind(this.onMessageDblClick,this),_.bind(this.onEnterPress,
this));b.computed(function(){this.isEnableGroupOperations(0<this.selector.listCheckedOrSelected().length)},this);this.checkAll=this.selector.koCheckAll();this.checkAllIncomplite=this.selector.koCheckAllIncomplete();this.pageSwitcherLocked=b.observable(!1);this.oPageSwitcher=new da(0,h.User.MailsPerPage);this.oPageSwitcher.currentPage.subscribe(function(a){var c=this.folderList().currentFolderFullName(),g=this.currentMessage()?this.currentMessage().uid():"",b=this.search();this.pageSwitcherLocked()||
this.changeRoutingForMessageList(c,a,g,b,this.filters())},this);this.listChangedThrottle=e.browser.firefox||e.browser.ie?b.observable(!1).extend({throttle:10}):b.observable(!1);this.firstCompleteCollection=b.observable(!0);this.collection.subscribe(function(){0<this.collection().length&&this.firstCompleteCollection(!1)},this);this.currentAccountId=h.Accounts.currentId;this.listChanged=b.computed(function(){return[this.firstCompleteCollection(),this.currentAccountId(),this.folderFullName(),this.filters(),
this.search(),this.oPageSwitcher.currentPage()]},this);this.listChanged.subscribe(function(){this.listChangedThrottle(!this.listChangedThrottle())},this)}function z(){this.singleMode=b.observable(h.SingleMode);this.isLoading=b.observable(!1);this.messages=e.MailCache.messages;this.messages.subscribe(this.onMessagesSubscribe,this);this.currentMessage=e.MailCache.currentMessage;this.currentMessage.subscribe(this.onCurrentMessageSubscribe,this);h.User.defaultTimeFormat.subscribe(this.onCurrentMessageSubscribe,
this);this.isCurrentMessage=b.computed(function(){return!!this.currentMessage()},this);this.isCurrentMessageLoaded=b.computed(function(){return this.isCurrentMessage()&&!this.isLoading()},this);this.visibleNoMessageSelectedText=b.computed(function(){return 0<this.messages().length&&!this.isCurrentMessage()},this);this.isEnablePrint=this.isEnableForward=this.isEnableReplyAll=this.isEnableReply=this.isCurrentMessageLoaded;this.isEnableSave=this.isCurrentMessage;this.prevMessageCommand=d.createCommand(this,
this.executePrevMessage);this.nextMessageCommand=d.createCommand(this,this.executeNextMessage);this.replyCommand=d.createCommand(this,this.executeReply,this.isEnableReply);this.replyAllCommand=d.createCommand(this,this.executeReplyAll,this.isEnableReplyAll);this.forwardCommand=d.createCommand(this,this.executeForward,this.isEnableForward);this.printCommand=d.createCommand(this,this.executePrint,this.isEnablePrint);this.saveCommand=d.createCommand(this,this.executeSave,this.isEnableSave);this.ical=
b.observable(null);this.vcard=b.observable(null);this.visiblePicturesControl=b.observable(!1);this.visibleShowPicturesLink=b.observable(!1);this.visibleAppointmentInfo=b.computed(function(){return null!==this.ical()},this);this.visibleVcardInfo=b.computed(function(){return null!==this.vcard()},this);this.sensitivityText=b.computed(function(){var a="";if(this.currentMessage())switch(this.currentMessage().sensitivity()){case f.Sensivity.Confidential:a=d.i18n("MESSAGE/SENSIVITY_CONFIDENTIAL");break;
case f.Sensivity.Personal:a=d.i18n("MESSAGE/SENSIVITY_PERSONAL");break;case f.Sensivity.Private:a=d.i18n("MESSAGE/SENSIVITY_PRIVATE")}return a},this);this.visibleConfirmationControl=b.computed(function(){return this.currentMessage()&&""!==this.currentMessage().readingConfirmation()},this);this.fakeHeader=b.computed(function(){return!(this.visiblePicturesControl()||this.visibleConfirmationControl()||""!==this.sensitivityText())},this);this.isCurrentNotDraftOrSent=b.computed(function(){var a=e.MailCache.folderList().currentFolder();
return a&&0<a.fullName().length&&a.type()!==f.FolderTypes.Drafts&&a.type()!==f.FolderTypes.Sent},this);this.isCurrentNotDraftFolder=b.computed(function(){var a=e.MailCache.folderList().currentFolder();return a&&0<a.fullName().length&&a.type()!==f.FolderTypes.Drafts},this);this.isVisibleReplyTool=this.isCurrentNotDraftOrSent;this.isVisibleForwardTool=this.isCurrentNotDraftFolder;this.uid=b.observable("");this.subject=b.observable("");this.from=b.observable("");this.fullFrom=b.observable("");this.to=
b.observable("");this.cc=b.observable("");this.bcc=b.observable("");this.allRecipients=b.observable("");this.fullDate=b.observable("");this.midDate=b.observable("");this.fromEmail=b.observable("");this.fromName=b.observable("");this.fromExistsInContacts=b.observable(!1);this.fromContactInfoReceived=b.observable(!1);this.fromContact=b.observable(new w);this.hasFromContact=b.computed(function(){return this.fromContactInfoReceived()&&this.fromExistsInContacts()},this);this.shortFromToDisplay=b.computed(function(){var a=
this.from();""===this.fromName()&&(this.hasFromContact()&&""!==this.fromContact().displayName())&&(a=this.fromContact().displayName());return a},this);this.visibleAddToContacts=b.computed(function(){return this.isCurrentNotDraftOrSent()&&this.fromContactInfoReceived()&&!this.fromExistsInContacts()},this);this.textBody=b.observable("");this.textBodyForNewWindow=b.observable("");this.domTextBody=b.observable(null);this.rtlMessage=b.observable(!1);this.contentHasFocus=b.observable(!1);this.attachments=
b.observableArray([]);this.usesAttachmentString=!0;this.attachmentsInString=b.computed(function(){return _.map(this.attachments(),function(a){return a.fileName()},this).join(", ")},this);this.notInlineAttachments=b.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},this);this.detailsVisible=b.observable(!1);this.hasNotInlineAttachments=b.computed(function(){return 0<this.notInlineAttachments().length},this);this.scrollToAttachment=b.observable(".attachments");
this.hasBodyText=b.computed(function(){return 0<this.textBody().length},this);this.visibleAddMenu=b.observable(!1);this.replyText=b.observable("");this.replyHtmlText=b.computed(function(){return e.MessageSender.getHtmlFromText(this.replyText())},this);this.replyTextFocus=b.observable(!1);this.replyPaneVisible=b.computed(function(){return this.currentMessage()&&this.currentMessage().completelyFilled()},this);this.replySendingStarted=b.observable(!1);this.replySavingStarted=b.observable(!1);this.replyDraftUid=
b.observable("");this.replyLoadingText=b.computed(function(){return this.replySendingStarted()?d.i18n("COMPOSE/INFO_SENDING"):this.replySavingStarted()?d.i18n("COMPOSE/INFO_SAVING"):""},this);this.domMessageHeader=b.observable(null);this.domQuickReply=b.observable(null);this.domMessageForPrint=b.observable(null);this.replyTextFocusThrottled=b.observable(!1).extend({throttle:50});this.replyTextFocus.subscribe(function(){this.replyTextFocusThrottled(this.replyTextFocus())},this);this.isQuickReplyActive=
b.computed(function(){return 0<this.replyText().length||this.replyTextFocusThrottled()},this);i(document).on("keyup",i.proxy(function(a){e.Screens.currentScreen()===f.Screens.Mailbox&&(a&&a.keyCode===f.Key.q&&!d.inFocus())&&this.replyTextFocus(!0)},this));this.viewAllMailsWithContactBinded=_.bind(this.viewAllMailsWithContact,this);this.jqPanelHelper=null}function ea(){this.folderList=e.MailCache.folderList;this.domFolderList=b.observable(null);this.oFolderList=new vb;this.oMessageList=new B;this.oMessagePane=
new z;this.isEnableGroupOperations=this.oMessageList.isEnableGroupOperations;this.composeLink=b.observable(e.Routing.buildHashFromArray(e.Links.compose()));this.checkMailCommand=d.createCommand(e.MailCache,e.MailCache.executeCheckMail);this.checkMailStarted=e.MailCache.checkMailStarted;this.markAsReadCommand=d.createCommand(this.oMessageList,this.oMessageList.executeMarkAsRead,this.isEnableGroupOperations);this.markAsUnreadCommand=d.createCommand(this.oMessageList,this.oMessageList.executeMarkAsUnread,
this.isEnableGroupOperations);this.markAllReadCommand=d.createCommand(this.oMessageList,this.oMessageList.executeMarkAllRead);this.moveToFolderCommand=d.createCommand(this,d.emptyFunction,this.isEnableGroupOperations);this.deleteCommand=d.createCommand(this.oMessageList,this.oMessageList.executeDelete,this.isEnableGroupOperations);this.emptyTrashCommand=d.createCommand(e.MailCache,e.MailCache.executeEmptyTrash,this.oMessageList.isNotEmptyList);this.emptySpamCommand=d.createCommand(e.MailCache,e.MailCache.executeEmptySpam,
this.oMessageList.isNotEmptyList);this.spamCommand=d.createCommand(this.oMessageList,this.oMessageList.executeSpam,this.isEnableGroupOperations);this.notSpamCommand=d.createCommand(this.oMessageList,this.oMessageList.executeNotSpam,this.isEnableGroupOperations);this.bVisibleComposeMessage=h.User.AllowCompose;this.isVisibleReplyTool=b.computed(function(){return this.folderList().currentFolder()&&0<this.folderList().currentFolderFullName().length&&this.folderList().currentFolderType()!==f.FolderTypes.Drafts&&
this.folderList().currentFolderType()!==f.FolderTypes.Sent},this);this.isVisibleForwardTool=b.computed(function(){return this.folderList().currentFolder()&&0<this.folderList().currentFolderFullName().length&&this.folderList().currentFolderType()!==f.FolderTypes.Drafts},this);this.isSpamFolder=b.computed(function(){return this.folderList().currentFolderType()===f.FolderTypes.Spam},this);this.allowedSpamAction=b.computed(function(){return h.Accounts.getCurrent().extensionExists("AllowSpamFolderExtension")&&
!this.isSpamFolder()},this);this.allowedNotSpamAction=b.computed(function(){return h.Accounts.getCurrent().extensionExists("AllowSpamFolderExtension")&&this.isSpamFolder()},this);this.isTrashFolder=b.computed(function(){return this.folderList().currentFolderType()===f.FolderTypes.Trash},this);this.jqPanelHelper=null}function q(){this.folderList=e.MailCache.folderList;this.folderList.subscribe(function(){this.getMessageOnRoute()},this);this.singleMode=b.observable(h.SingleMode);this.isDemo=b.observable(h.User.IsDemo);
this.sending=b.observable(!1);this.saving=b.observable(!1);this.oHtmlEditor=new r(!0);this.visibleBcc=b.observable(!1);this.visibleBcc.subscribe(function(){fa.toggleClass("screen-compose-bcc",this.visibleCc());this.computeHeight()},this);this.visibleCc=b.observable(!1);this.visibleCc.subscribe(function(){fa.toggleClass("screen-compose-cc",this.visibleCc());this.computeHeight()},this);this.visibleCounter=b.observable(!1);this.readingConfirmation=b.observable(!1);this.saveMailInSentItems=b.observable(!0);
this.useSaveMailInSentItems=b.observable(!1);this.composeUploaderButton=b.observable(null);this.composeUploaderDropPlace=b.observable(null);this.composeUploaderBodyDragOver=b.observable(!1);this.composeUploaderDragOver=b.observable(!1);this.allowDragNDrop=b.observable(!1);this.uploaderBodyDragOver=b.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this);this.uploaderDragOver=b.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this);
this.selectedImportance=b.observable(f.Importance.Normal);this.selectedSensitivity=b.observable(f.Sensivity.Nothing);this.senderList=b.observableArray([]);this.visibleFrom=b.computed(function(){return 1<this.senderList().length},this);this.selectedSender=b.observable(0);this.selectedSender.subscribe(function(){this.changeSignature()},this);this.senderAccountId=b.observable(h.Accounts.currentId());this.toAddr=b.observable("").extend({reversible:!0});this.ccAddr=b.observable("").extend({reversible:!0});
this.bccAddr=b.observable("").extend({reversible:!0});this.subject=b.observable("").extend({reversible:!0});this.counter=b.observable(0);this.commitedTextBody=b.observable("");this.textBody=b.observable("");this.textBody.subscribe(function(){this.oHtmlEditor.setText(this.textBody());this.commitedTextBody(this.oHtmlEditor.getText())},this);this.toAddrFocused=b.observable(!1);this.ccAddrFocused=b.observable(!1);this.bccAddrFocused=b.observable(!1);this.subjectFocused=b.observable(!1);this.draftUid=
b.observable("");this.draftInfo=b.observableArray([]);this.routeType=b.observable("");this.routeParams=b.observableArray([]);this.inReplyTo=b.observable("");this.references=b.observable("");this.uploadAttachmentsTimer=-1;this.messageUploadAttachmentsStarted=b.observable(!1);this.messageUploadAttachmentsStarted.subscribe(function(){clearTimeout(this.uploadAttachmentsTimer);this.messageUploadAttachmentsStarted()?this.uploadAttachmentsTimer=setTimeout(function(){e.Api.showLoading(d.i18n("COMPOSE/INFO_ATTACHMENTS_LOADING"))},
4E3):e.Api.hideLoading()},this);this.attachments=b.observableArray([]);this.attachmentsChanged=b.observable(!1);this.attachments.subscribe(function(){this.computeHeight()},this);this.notUploadedAttachments=b.computed(function(){return _.filter(this.attachments(),function(a){return!a.uploaded()})},this);this.allAttachmentsUploaded=b.computed(function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()},this);this.notInlineAttachments=b.computed(function(){return _.filter(this.attachments(),
function(a){return!a.linked()})},this);this.allowStartSending=b.computed(function(){return!this.saving()},this);this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(e.MessageSender.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this);this.requiresPostponedSending=b.observable(!1);this.oJua=null;this.isDraftsCleared=b.observable(!1);this.autoSaveTimer=b.observable(-1);this.backToListCommand=d.createCommand(this,this.executeBackToList);
this.sendCommand=d.createCommand(this,this.executeSend,this.isEnableSending);this.saveCommand=d.createCommand(this,this.executeSaveCommand,this.isEnableSaving);this.messageForm=b.observable(null);this.messageFields=b.observable(null);this.shown=b.observable(!1);this.editableArea=b.observable(null);i(document).on("keydown",i.proxy(function(a){var c=a.ctrlKey;if(c){var g=e.Screens.currentScreen()===f.Screens.Compose,b=this.editableArea(),d=a.keyCode,n=f.Key;!b&&this.oHtmlEditor.oCrea&&this.editableArea(this.oHtmlEditor.oCrea.$editableArea[0]);
g&&a&&c&&d===n.s?(a.preventDefault(),a.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):g&&(a&&c&&d===n.Enter&&""!==this.toAddr())&&this.sendCommand()}},this))}function eb(a){this.oJua=null;this.oParent=a;this.visibility=b.observable(!1);this.importing=b.observable(!1)}function x(){var a=this;this.loadingList=b.observable(!1);this.loadingViewPane=b.observable(!1);this.showPersonalContacts=b.observable(!1);this.showGlobalContacts=b.observable(!1);this.selectedGroupType=b.observable(f.ContactsGroupListType.Personal);
this.selectedGroupInList=b.observable(null);this.selectedGroupInList.subscribe(function(){var a=this.selectedGroupInList();a&&a.selected(!1)},this,"beforeChange");this.selectedGroupInList.subscribe(function(a){a&&this.showPersonalContacts()&&(a.selected(!0),this.selectedGroupType(f.ContactsGroupListType.SubGroup),this.requestContactList())},this);this.selectedGroup=b.observable(null);this.selectedContact=b.observable(null);this.oContactModel=new w;this.oGroupModel=new Ba;this.oContactImportViewModel=
new eb(this);this.selectedItem=b.computed({read:function(){return this.selectedContact()||this.selectedGroup()||null},write:function(a){a instanceof w?(this.oContactImportViewModel.visibility(!1),this.selectedGroup(null),this.selectedContact(a)):a instanceof Ba?(this.oContactImportViewModel.visibility(!1),this.selectedContact(null),this.selectedGroup(a)):(this.selectedGroup(null),this.selectedContact(null));this.loadingViewPane(!1)},owner:this});this.sortOrder=b.observable(!0);this.sortType=b.observable(f.ContactSortType.Name);
this.collection=b.observableArray([]);this.isSearchFocused=b.observable(!1);this.searchInput=b.observable("");this.search=b.observable("");this.groupFullCollection=b.observableArray([]);this.selectedContact.subscribe(function(a){if(a){var g=a.groups();_.each(this.groupFullCollection(),function(a){a.checked(a&&0<=d.inArray(a.Id(),g))})}},this);this.selectedGroupType.subscribe(function(a){if(f.ContactsGroupListType.Personal===a&&!this.showPersonalContacts()&&this.showGlobalContacts())this.selectedGroupType(f.ContactsGroupListType.Global);
else if(f.ContactsGroupListType.Global===a&&!this.showGlobalContacts()&&this.showPersonalContacts())this.selectedGroupType(f.ContactsGroupListType.Personal);else if(f.ContactsGroupListType.Personal===a||f.ContactsGroupListType.Global===a)this.selectedGroupInList(null),this.selectedItem(null),this.selector.listCheckedOrSelected(!1),this.requestContactList()},this);this.oPageSwitcher=new da(0,h.User.ContactsPerPage);this.oPageSwitcher.currentPage.subscribe(function(){this.requestContactList()},this);
this.search.subscribe(function(a){this.searchInput(a)},this);this.searchSubmitCommand=d.createCommand(this,function(){this.oPageSwitcher.currentPage(1);this.search(this.searchInput());this.requestContactList()});this.selector=new E(this.collection,function(c){c&&a.requestContact(c)},_.bind(this.executeDelete,this),_.bind(this.onContactDblClick,this));this.checkAll=this.selector.koCheckAll();this.checkAllIncomplite=this.selector.koCheckAllIncomplete();this.newContactCommand=d.createCommand(this,this.executeNewContact);
this.newGroupCommand=d.createCommand(this,this.executeNewGroup);this.addContactsCommand=d.createCommand(this,d.emptyFunction,this.isEnableAddContacts);this.deleteCommand=d.createCommand(this,this.executeDelete,this.isEnableDeleting);this.removeFromGroupCommand=d.createCommand(this,this.executeRemoveFromGroup,this.isEnableRemoveContactsFromGroup);this.importCommand=d.createCommand(this,this.executeImport);this.exportCommand=d.createCommand(this,this.executeExport);this.saveCommand=d.createCommand(this,
this.executeSave,function(){var a=this.selectedItem();return a?a.canBeSave():!1});this.newMessageCommand=d.createCommand(this,function(){var a=this.selector.listCheckedOrSelected(),g=[];_.isArray(a)&&0<a.length&&(g=_.map(a,function(a){return a.EmailAndName()}),g=_.compact(g),e.Api.openComposeMessage(g.join(", ")))},function(){return 0<this.selector.listCheckedOrSelected().length});this.selector.listCheckedOrSelected.subscribe(function(a){this.oGroupModel.newContactsInGroupCount(a.length)},this);this.isLoading=
this.loadingList;this.isSearch=b.computed(function(){return""!==this.search()},this);this.isEmptyList=b.computed(function(){return 0===this.collection().length},this);this.inGrooup=b.computed(function(){return f.ContactsGroupListType.SubGroup===this.selectedGroupType()},this);this.searchText=b.computed(function(){return d.i18n("CONTACTS/INFO_SEARCH_RESULT",{SEARCH:this.search()})},this)}function D(){this.aTabs=[];h.App.AllowUsersChangeInterfaceSettings&&this.aTabs.push(new Z);this.aTabs.push(new C);
h.App.AllowUsersChangeInterfaceSettings&&h.User.AllowCalendar&&this.aTabs.push(new la);h.User.MobileSyncEnable&&this.aTabs.push(new Qa);h.User.OutlookSyncEnable&&this.aTabs.push(new Ra);h.User.IsHelpdeskSupported&&this.aTabs.push(new Ia);ma&&ma.getPluginsSettingsTabs&&_.each(ma.getPluginsSettingsTabs(),_.bind(function(a){this.aTabs.push(new a)},this));this.tab=b.observable(f.SettingsTab.Common);this.allowFolderListOrder=b.computed(function(){return!h.Accounts.getEdited().extensionExists("DisableFoldersManualSort")},
this);this.folderListOrderUpdateDebounce=_.debounce(_.bind(this.folderListOrderUpdate,this),5E3)}function Z(){this.aSkins=h.App.Themes;this.selectedSkin=b.observable(h.User.DefaultTheme);this.layout=b.observable(h.User.Layout);this.aLanguages=h.App.Languages;this.selectedLanguage=b.observable(h.User.DefaultLanguage);this.loading=b.observable(!1);this.rangeOfNumbers=[10,20,30,50,75,100,150,200];this.messagesPerPageValues=b.observableArray(this.rangeOfNumbers);this.messagesPerPage=b.observable(this.rangeOfNumbers[0]);
this.setMessagesPerPage(h.User.MailsPerPage);this.contactsPerPageValues=b.observableArray(this.rangeOfNumbers);this.contactsPerPage=b.observable(this.rangeOfNumbers[0]);this.setContactsPerPage(h.User.ContactsPerPage);this.autocheckmailInterval=b.observable(h.User.autoCheckMailInterval());this.richText=b.observable(h.User.DefaultEditor);this.timeFormat=b.observable(h.User.defaultTimeFormat());this.aDateFormats=d.getDateFormatsForSelector();this.dateFormat=b.observable(h.User.DefaultDateFormat);this.useThreads=
b.observable(h.User.useThreads());this.bAllowContacts=h.User.ShowContacts;this.bAllowCalendar=h.User.AllowCalendar;this.bAllowThreads=h.User.ThreadsEnabled;this.firstState=this.getState()}function C(){this.accounts=h.Accounts.collection;this.currentAccountId=h.Accounts.currentId;this.editedAccountId=h.Accounts.editedId;this.defaultAccountId=h.Accounts.defaultId;this.defaultAccount=h.Accounts.getDefault();this.isAllowFetcher=!!h.App.AllowFetcher;this.oAccountProperties=new ga(this);this.oAccountSignature=
new ha(this);this.oAccountFilters=new O(this);this.oAccountAutoresponder=new na(this);this.oAccountForward=new oa(this);this.oAccountFolders=new fb(this);this.oFetcherIncoming=new Ya(this);this.oFetcherOutgoing=new Za(this);this.oFetcherSignature=new Ja(this);this.fetcher=b.observable(null);this.fetchers=b.observable(null);this.firstFetcher=b.observable(null);this.editedFetcherId=b.observable(null);this.defaultAccount.fetchers.subscribe(function(a){if(a){var a=this.defaultAccount.fetchers(),c=a.collection()[0],
g=c.idFetcher(),b=this.isFetcherTab(this.tab());this.fetchers(a);this.firstFetcher(c);if(this.editedFetcherId()&&b)this.onChangeFetcher(this.editedFetcherId());else b&&(this.editedFetcherId(g),this.onChangeFetcher(g))}else this.changeAccount(this.defaultAccountId())},this);this.tab=b.observable(f.AccountSettingsTab.Properties);this.allowUsersAddNewAccounts=h.App.AllowUsersAddNewAccounts;this.allowUsersChangeInterfaceSettings=h.App.AllowUsersChangeInterfaceSettings;this.allowAutoresponderExtension=
b.observable(!1);this.allowForwardExtension=b.observable(!1);this.allowSieveFiltersExtension=b.observable(!1);this.changeAccount(this.editedAccountId())}function la(){this.showWeekends=b.observable(h.User.CalendarShowWeekEnds);this.loading=b.observable(!1);this.availableTimes=b.observableArray([{text:"00:00",value:"0"},{text:"01:00",value:"1"},{text:"02:00",value:"2"},{text:"03:00",value:"3"},{text:"04:00",value:"4"},{text:"05:00",value:"5"},{text:"06:00",value:"6"},{text:"07:00",value:"7"},{text:"08:00",
value:"8"},{text:"09:00",value:"9"},{text:"10:00",value:"10"},{text:"11:00",value:"11"},{text:"12:00",value:"12"},{text:"13:00",value:"13"},{text:"14:00",value:"14"},{text:"15:00",value:"15"},{text:"16:00",value:"16"},{text:"17:00",value:"17"},{text:"18:00",value:"18"},{text:"19:00",value:"19"},{text:"20:00",value:"20"},{text:"21:00",value:"21"},{text:"22:00",value:"22"},{text:"23:00",value:"23"},{text:"24:00",value:"24"}]);this.selectedWorkdayStarts=b.observable(h.User.CalendarWorkDayStarts);this.selectedWorkdayEnds=
b.observable(h.User.CalendarWorkDayEnds);this.showWorkday=b.observable(h.User.CalendarShowWorkDay);this.weekStartsOn=b.observable(h.User.CalendarWeekStartsOn);this.defaultTab=b.observable(h.User.CalendarDefaultTab);this.firstState=this.getState()}function Qa(){this.mobileSync=h.User.mobileSync;this.mobileSync.subscribe(this.onMobileSyncSubscribe,this);this.enableDav=b.observable(!1);this.davLogin=b.observable("");this.davServer=b.observable("");this.davCalendars=b.observable([]);this.visibleCalendars=
b.computed(function(){return 0<this.davCalendars().length},this);this.davPersonalContactsUrl=b.observable("");this.davCollectedAddressesUrl=b.observable("");this.davGlobalAddressBookUrl=b.observable("");this.bVisiblePersonalContacts=h.User.ShowPersonalContacts;this.bVisibleGlobalContacts=h.User.ShowGlobalContacts;this.bVisibleContacts=h.User.ShowContacts;this.bVisibleCalendar=h.User.AllowCalendar;this.bVisibleFiles=h.User.IsFilesSupported;this.bVisibleIosLink=-1!==navigator.platform.indexOf("iPhone")||
-1!==navigator.platform.indexOf("iPod")||-1!==navigator.platform.indexOf("iPad");this.visibleDavViaUrls=b.computed(function(){return this.visibleCalendars()||this.bVisibleContacts},this);this.password=b.observable(h.User.IsDemo?h.User.MobileSyncDemoPass:d.i18n("SETTINGS/MOBILE_DAVSYNC_PASSWORD_VALUE"));this.bChanged=!1}function Ra(){this.outlookSync=h.User.outlookSync;this.outlookSync.subscribe(this.onOutlookSyncSubscribe,this);this.visibleOutlookSync=b.observable(!1);this.login=b.observable("");
this.server=b.observable("");this.password=b.observable(h.User.IsDemo?h.User.OutlookSyncDemoPass:d.i18n("SETTINGS/OUTLOOKSYNC_PASSWORD_VALUE"));this.bChanged=!1}function ga(){this.allowUsersChangeInterfaceSettings=h.App.AllowUsersChangeInterfaceSettings;this.allowUsersChangeEmailSettings=h.App.AllowUsersChangeEmailSettings;this.account=b.observable(null);this.isInternal=b.observable(!0);this.isLinked=b.observable(!0);this.isDefault=b.observable(!1);this.friendlyName=b.observable("");this.email=b.observable("");
this.incomingMailLogin=b.observable("");this.incomingMailPassword=b.observable("");this.incomingMailPort=b.observable(0);this.incomingMailServer=b.observable("");this.outgoingMailLogin=b.observable("");this.outgoingMailPassword=b.observable("");this.outgoingMailPort=b.observable(0);this.outgoingMailServer=b.observable("");this.loading=b.observable(!1);this.allowChangePassword=b.observable(!1);this.useSmtpAuthentication=b.observable(!1);this.incLoginFocused=b.observable(!1);this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&
""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this);this.outServerFocused=b.observable(!1);this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this);this.account.subscribe(function(a){this.populate(a)},this);this.firstState=null}function fb(a){this.parent=a;this.highlighted=b.observable(!1).extend({autoResetToFalse:500});this.collection=b.observableArray(e.MailCache.editedFolderList().collection());
this.totalMessageCount=b.computed(function(){return e.MailCache.editedFolderList().totalMessageCount()},this);this.enableButtons=b.computed(function(){return e.MailCache.editedFolderList().bInitialized()},this);e.MailCache.editedFolderList.subscribe(function(a){this.collection(a.collection())},this);this.addNewFolderCommand=d.createCommand(this,this.onAddNewFolderClick,this.enableButtons);this.systemFoldersCommand=d.createCommand(this,this.onSystemFoldersClick,this.enableButtons);this.showMovedWithMouseItem=
b.computed(function(){var a=h.Accounts.getEdited();return!qb&&!a.extensionExists("DisableFoldersManualSort")},this)}function ha(a){this.parent=a;this.account=b.observable(null);this.type=b.observable(!1);this.options=b.observable(0);this.signature=b.observable("");this.loading=b.observable(!1);this.account.subscribe(function(){this.getSignature()},this);this.oHtmlEditor=new r(!1);this.isEnabled=b.observable(!0);this.isEnabled.subscribe(function(a){this.oHtmlEditor.stateSwitcher(a)},this);this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},
this);h.Accounts.editedId.subscribe(function(){this.account(h.Accounts.getEdited())},this);this.getSignature();this.firstState=null}function oa(){this.account=b.observable(null);this.available=b.observable(!1);this.loading=b.observable(!1);this.enable=b.observable(!1);this.email=b.observable("");this.available=b.computed(function(){var a=this.account();return a&&a.forward()},this);this.account.subscribe(function(){this.getForward()},this);this.firstState=null}function na(){this.account=b.observable(null);
this.available=b.observable(!1);this.loading=b.observable(!1);this.enable=b.observable(!1);this.subject=b.observable("");this.message=b.observable("");this.available=b.computed(function(){var a=this.account();return a&&a.autoresponder()},this);this.account.subscribe(function(){this.getAutoresponder()},this);this.firstState=null}function O(){this.account=b.observable(null);this.folderList=b.observable(e.MailCache.editedFolderList());e.MailCache.editedFolderList.subscribe(function(a){this.folderList(a)},
this);this.foldersOptions=b.computed(function(){return this.folderList()?this.folderList().getOptions(d.i18n("SETTINGS/ACCOUNT_FOLDERS_NOT_SELECTED"),!0,!0):[]},this);this.available=b.observable(!1);this.loading=b.observable(!1);this.collection=b.observableArray([]);this.available=b.computed(function(){var a=this.account();return!(!a||!a.filters())},this);this.account.subscribe(function(){this.getFilters()},this);this.fieldOptions=[{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_FROM"),value:0},{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_TO"),
value:1},{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_SUBJECT"),value:2}];this.conditionOptions=[{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_COND_CONTAIN_SUBSTR"),value:0},{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_COND_EQUAL_TO"),value:1},{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_COND_NOT_CONTAIN_SUBSTR"),value:2}];this.actionOptions=[{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_MOVE"),value:3},{text:d.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_DELETE"),value:1}];this.phaseArray=[""];_.each(d.i18n("SETTINGS/ACCOUNT_FILTERS_PHRASE").split(/\s/),
function(a){var c=this.phaseArray.length-1;"%"===a.substr(0,1)||"%"===this.phaseArray[c].substr(-1,1)?this.phaseArray.push(a):this.phaseArray[c]+=" "+a},this);this.firstState=null}function Ya(){this.defaultAccountId=h.Accounts.defaultId;this.folderList=e.MailCache.folderList;this.loading=b.observable(!1);this.fetcher=b.observable(null);this.idFetcher=b.observable(null);this.isEnabled=b.observable(!0);this.incomingMailServer=b.observable("");this.incomingMailPort=b.observable(110);this.incomingMailLogin=
b.observable("");this.incomingMailPassword=b.observable("");this.folder=b.observable("");this.options=b.computed(function(){return this.folderList().getOptions(void 0,!0)},this);this.leaveMessagesOnServer=b.observable(!1);this.folderList.subscribe(function(){this.folder(this.fetcher()?this.fetcher().folder():"")},this);this.serverIsSelected=b.observable(!1);this.loginIsSelected=b.observable(!1);this.passwordIsSelected=b.observable(!1);this.defaultOptionsAfterRender=d.defaultOptionsAfterRender}function Za(){this.defaultAccountId=
h.Accounts.defaultId;this.loading=b.observable(!1);this.fetcher=b.observable(null);this.idFetcher=b.observable(null);this.isEnabled=b.observable(!0);this.email=b.observable("");this.userName=b.observable("");this.isOutgoingEnabled=b.observable(!1);this.outgoingMailServer=b.observable("");this.outgoingMailPort=b.observable(25);this.outgoingMailAuth=b.observable(!1);this.serverIsSelected=b.observable(!1)}function Ja(a){this.defaultAccountId=h.Accounts.defaultId;this.idFetcher=b.observable(null);this.fetcher=
b.observable(null);this.signature=b.observable("");this.loading=b.observable(!1);this.type=b.observable(!1);this.options=b.observable(0);this.oHtmlEditor=new r(!1);this.isEnabled=a.oFetcherIncoming.isEnabled;this.isEnabled.subscribe(function(a){this.oHtmlEditor.stateSwitcher(a)},this);this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this);this.firstState=null}function Ia(){this.allowNotifications=b.observable(h.User.AllowHelpdeskNotifications);this.loading=b.observable(!1)}
function k(){this.aDayNames=d.i18n("DATETIME/DAY_NAMES").split(" ");this.correctedDayNames=b.observable(this.aDayNames);var a=this;this.publicCalendarId=(this.isPublic=sa)?h.CalendarPubParams.Id:"";this.publicCalendarName=b.observable("");this.timeFormatGrid=h.User.defaultTimeFormat()===f.TimeFormat.F24?"HH:mm":"hh:mm TT";this.timeFormatMoment=h.User.defaultTimeFormat()===f.TimeFormat.F24?"HH:mm":"hh:mm A";this.dateFormat=h.User.DefaultDateFormat;this.dateTitle=b.observable("");this.dateTitleHelper=
b.observableArray(d.i18n("DATETIME/MONTH_NAMES").split(" "));this.selectedView=b.observable("");this.visibleWeekdayHeader=b.computed(function(){return"month"===this.selectedView()},this);this.selectedView.subscribe(function(){this.resize()},this);this.$calendarGrid=null;this.calendarGridDom=b.observable(null);this.$datePicker=null;this.datePickerDom=b.observable(null);this.calendars=new ka({onCalendarActiveChange:_.bind(function(a){var g=a.active()?"addEventSource":"removeEventSource";this.$calendarGrid.fullCalendar(g,
{events:a.events});this.refreshDatePicker()},this)});this.colors="#f09650 #f68987 #6fd0ce #8fbce2 #b9a4f5 #f68dcf #d88adc #4afdb4 #9da1ff #5cc9c9 #77ca71 #aec9c9".split(" ");this.busyDays=b.observableArray([]);this.inlineEditedEventText=this.$inlineEditedEvent=null;this.checkStarted=b.observable(!1);this.loaded=!1;this.endDateTime=this.startDateTime=0;this.needsToReload=!1;this.calendarListClick=function(a){a.active(!a.active())};this.currentCalendarDropdown=b.observable(!1);this.currentCalendarDropdownOffset=
b.observable(0);this.calendarDropdownToggle=function(c,g){if(g&&c){var b=g.position(),d=g.outerHeight();a.currentCalendarDropdownOffset(parseInt(b.top,10)+d)}a.currentCalendarDropdown(c)};this.dayNamesResizeBinding=_.throttle(_.bind(this.resize,this),50);this.customscrollTop=b.observable(0);this.fullcalendarOptions={header:!1,editable:!this.isPublic,selectable:!this.isPublic,allDayText:d.i18n("CALENDAR/TITLE_ALLDAY"),dayNames:this.aDayNames,isRTL:d.isRTL(),firstHour:8,columnFormat:{month:"dddd",week:"dddd d",
day:"dddd d"},select:_.bind(this.createEventFromGrid,this),eventClick:_.bind(this.openEditEventForm,this),eventDragStop:_.bind(this.refreshDatePicker,this),eventResizeStop:_.bind(this.refreshDatePicker,this),eventDrop:_.bind(this.moveEvent,this),eventResize:_.bind(this.resizeEvent,this),viewRender:_.bind(this.displayViewCallback,this)};this.revertFunction=null;this.calendarSharing=h.User.AllowCalendar&&h.User.CalendarSharing}function p(){this.groups=b.observableArray();this.folders=b.observableArray();
this.files=b.observableArray();this.uploadingFiles=b.observableArray();this.storageType=b.observable(f.FileStorageType.Private);this.aPath=b.observableArray();this.iPathIndex=b.observable(-1);this.path=b.computed(function(){return _.map(this.aPath(),function(a){return a.name()}).join("/")},this);this.dropPath=b.observable("");this.path.subscribe(function(a){this.dropPath(a)},this);this.rootPath=b.computed(function(){var a=d.i18n("FILESTORAGE/TAB_PRIVATE_FILES");this.storageType()===f.FileStorageType.Corporate&&
(a=d.i18n("FILESTORAGE/TAB_CORPORATE_FILES"));return a},this);this.collection=b.computed(function(){var a=_.union(this.files(),this.getUploadingFiles());a.sort(function(a,g){return a.name()===g.name()?0:a.name()<g.name()?-1:1});return _.union(this.folders(),a)},this);this.columnCount=b.observable(1);this.selector=new E(this.collection,null,_.bind(this.onItemDelete,this),_.bind(this.onItemDblClick,this),_.bind(this.onEnter,this),this.columnCount,!0,!0,!0);this.storageType.subscribe(function(){this.selector.listCheckedAndSelected(!1)},
this);this.searchPattern=b.observable("");this.isSearchFocused=b.observable(!1);this.renameCommand=d.createCommand(this,this.executeRename,function(){return 1===this.selector.listCheckedAndSelected().length});this.deleteCommand=d.createCommand(this,this.executeDelete,function(){return 0<this.selector.listCheckedAndSelected().length});this.downloadCommand=d.createCommand(this,this.executeDownload,function(){var a=this.selector.listCheckedAndSelected();return 1===a.length&&!a[0].isFolder()});this.shareCommand=
d.createCommand(this,this.executeShare,function(){var a=this.selector.listCheckedAndSelected();return 1===a.length&&!a[0].isFolder()});this.sendCommand=d.createCommand(this,this.executeSend,function(){var a=this.selector.listCheckedAndSelected();return 0<_.filter(a,function(a){return!a.isFolder()},this).length});this.uploaderButton=b.observable(null);this.uploaderArea=b.observable(null);this.bDragActive=b.observable(!1);this.bDragActiveComp=b.computed(function(){return this.bDragActive()&&""===this.searchPattern()},
this);this.uploadError=b.observable(!1);this.quota=b.observable(0);this.used=b.observable(0);this.quotaDesc=b.observable("");this.quotaProc=b.observable(-1);b.computed(function(){if(!h.App.ShowQuotaBar)return!0;var a=this.quota(),c=this.used(),c=0<a?Math.ceil(100*(c/a)):-1,c=100<c?100:c;this.quotaProc(c);this.quotaDesc(-1<c?d.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:c,QUOTA:d.friendlySize(a)}):"");return!0},this);this.dragover=b.observable(!1);this.loading=b.observable(!1);this.fileListInfoText=b.computed(function(){var a=
"";this.loading()||0===this.collection().length&&(a=""!==this.searchPattern()?d.i18n("FILESTORAGE/INFO_NO_ITEMS_FOUND"):""===this.path()?d.i18n("FILESTORAGE/INFO_FILESTORAGE_IS_EMTY"):d.i18n("FILESTORAGE/INFO_FOLDER_IS_EMPY"));return a},this);this.dragAndDropHelperBinded=_.bind(this.dragAndDropHelper,this);this.lastPath=b.observable(null)}function m(){var a=this,c=function(c){return function(){a.executeChangeState(c);a.isQuickReplyHidden(!a.bAgent);c===f.HelpdeskThreadStates.Resolved&&a.selectedItem(null)}};
this.bRtl=d.isRTL();this.sendFunc=(this.bExtApp=sa)?"sendExt":"send";this.bAgent=h.User.IsHelpdeskAgent;this.singleMode=h.SingleMode;this.externalUrl=b.observable(h.HelpdeskIframeUrl);this.loadingList=b.observable(!0);this.loadingViewPane=b.observable(!1);this.loadingMoreMessages=b.observable(!1);this.threads=b.observableArray([]);this.posts=b.observableArray([]);this.selectedItem=b.observable(null);this.selectedItem.subscribe(function(){this.subject(this.selectedItem()?this.bExtApp?this.selectedItem().sSubject:
this.selectedItem().sFromFull:"");this.internalNote(!1);!this.bExtApp&&this.selectedItem()&&e.ContactsCache.getContactByEmail(this.selectedItem().sEmail,this.onOwnerContactResponse,this)},this);this.listFilter=b.observable(this.bAgent?f.HelpdeskFilters.Open:f.HelpdeskFilters.All);this.listFilter.subscribe(function(){this.requestThreadsList()},this);this.prevListFilter=b.observable("");this.hasMorePosts=b.computed(function(){var a=this.selectedItem();return a&&a.postsCount()>this.posts().length},this);
this.selector=new E(this.threads,_.bind(this.onItemClick,this),_.bind(this.onItemDelete,this),_.bind(this.onItemDblClick,this),null,null,!1,!1,!1,!0);this.checkStarted=b.observable(!1);this.checkAll=this.selector.koCheckAll();this.checkAllIncomplite=this.selector.koCheckAllIncomplete();this.ThreadsPerPage=10;this.oPageSwitcher=new da(0,this.ThreadsPerPage);this.oPageSwitcher.currentPage.subscribe(function(){this.requestThreadsList()},this);this.isSearchFocused=b.observable(!1);this.searchPattern=
b.observable("");this.search=b.observable("");this.search.subscribe(function(a){this.searchPattern(a)},this);this.searchText=b.computed(function(){return d.i18n("HELPDESK/INFO_SEARCH_RESULT",{SEARCH:this.search()})},this);this.searchSubmitCommand=d.createCommand(this,function(){this.oPageSwitcher.currentPage(1);this.search(this.searchPattern());this.requestThreadsList()});this.deleteCommand=d.createCommand(this,this.executeDelete,this.isEnableListActions);this.openNewWindowCommand=d.createCommand(this,
this.executeOpenNewWindow,this.isEnableListActions);this.checkCommand=d.createCommand(this,function(){this.requestThreadsList();this.requestPosts()});this.closeCommand=d.createCommand(this,c(f.HelpdeskThreadStates.Resolved),this.isEnableListActions);this.waitCommand=d.createCommand(this,c(f.HelpdeskThreadStates.Waiting),this.isEnableListActions);this.pendingCommand=d.createCommand(this,c(f.HelpdeskThreadStates.Pending),this.isEnableListActions);this.deferCommand=d.createCommand(this,c(f.HelpdeskThreadStates.Deferred),
this.isEnableListActions);this.answerCommand=d.createCommand(this,c(f.HelpdeskThreadStates.Answered),this.isEnableListActions);this.postCommand=d.createCommand(this,this.executePostCreate,function(){return!!this.selectedItem()&&0<this.posts().length&&0<this.replyText().length&&this.allAttachmentsUploaded()});this.visibleNewThread=b.observable(!1);this.newThreadText=b.observable("");this.newThreadCreating=b.observable(!1);this.createThreadCommand=d.createCommand(this,this.executeThreadCreate,function(){return this.visibleNewThread()&&
0<this.newThreadText().length&&!this.newThreadCreating()});this.createThreadButtonText=b.computed(function(){return this.newThreadCreating()?d.i18n("HELPDESK/BUTTON_SENDING"):d.i18n("HELPDESK/BUTTON_CREATE")},this);this.showThreadsByOwnerCommand=d.createCommand(this,this.executeShowThreadsByOwner);this.commandGetOlderPosts=function(){var a=this.posts();this.requestPosts(null,a[0]?a[0].Id:0)};this.externalContentUrl=b.observable("");h.HelpdeskIframeUrl&&(this.bAgent?this.externalContentUrl=b.computed(function(){var a=
"",c=this.selectedItem();c&&(a=c.Email());return a?h.HelpdeskIframeUrl.replace(/\[EMAIL\]/g,a):""},this):h.User.Email&&(this.externalContentUrl=b.computed(function(){return h.HelpdeskIframeUrl.replace(/\[EMAIL\]/g,h.User.Email)},this)));c=e.Storage.hasData("HelpdeskUserDetails")?e.Storage.getData("HelpdeskUserDetails"):!0;this.clientDetailsVisible=b.observable(c);this.clientDetailsVisible.subscribe(function(a){e.Storage.setData("HelpdeskUserDetails",a)},this);this.subject=b.observable("");this.ownerExistsInContacts=
b.observable(!1);this.ownerContactInfoReceived=b.observable(!1);this.ownerContact=b.observable(!this.bExtApp?new w:null);this.hasOwnerContact=b.computed(function(){return!this.singleMode&&this.ownerContactInfoReceived()&&this.ownerExistsInContacts()},this);this.visibleAddToContacts=b.computed(function(){return!this.singleMode&&this.ownerContactInfoReceived()&&!this.ownerExistsInContacts()},this);this.viewAllMailsWithContactBinded=_.bind(this.viewAllMailsWithContact,this);this.uploadedFiles=b.observableArray([]);
this.allAttachmentsUploaded=b.computed(function(){return _.filter(this.uploadedFiles(),function(a){return!a.uploaded()}).length===0},this);this.uploaderButton=b.observable(null);this.uploaderButtonCompose=b.observable(null);this.uploaderArea=b.observable(null);this.bDragActive=b.observable(!1);this.internalNote=b.observable(!1);this.isQuickReplyHidden=b.observable(!this.bAgent);this.domQuickReply=b.observable(null);this.replySendingStarted=b.observable(!1);this.replyPaneVisible=b.observable(!0);this.replyText=
b.observable("");this.replyTextFocus=b.observable(!1);this.isQuickReplyActive=b.observable(!1);this.replyTextFocus.subscribe(function(){this.replyTextFocus()&&this.isQuickReplyActive(true)},this);this.isQuickReplyActive.subscribe(function(){this.isQuickReplyActive()&&this.replyTextFocus(true)},this);this.isEmptyQuickReplyPane=b.computed(function(){return this.replyText().length===0&&!this.internalNote()&&this.uploadedFiles().length===0},this);this.isSearch=b.computed(function(){return""!==this.search()},
this);this.isEmptyList=b.computed(function(){return 0===this.threads().length},this);this.dynamicEmptyListInfo=this.bAgent?b.computed(function(){return this.isEmptyList()&&this.isSearch()?d.i18n("HELPDESK/INFO_SEARCH_EMPTY"):d.i18n("HELPDESK/INFO_EMPTY_OPEN_THREAD_LIST_AGENT")},this):b.computed(function(){return this.isEmptyList()&&this.isSearch()?d.i18n("HELPDESK/INFO_SEARCH_EMPTY"):d.i18n("HELPDESK/INFO_EMPTY_THREAD_LIST")},this);this.simplePreviewPane=b.computed(function(){var a=this.selectedItem();
return a?a.ItsMe:!this.bAgent},this);this.allowInternalNote=b.computed(function(){return!this.simplePreviewPane()},this);this.scrollToTopTrigger=b.observable(!1);this.scrollToBottomTrigger=b.observable(!1);this.allowDownloadAttachmentsLink=!1;this.newThreadButtonWidth=b.observable(0)}function I(){this.oScreens={};this.currentScreen=b.observable("");this.popupVisibility=b.observable(!1);this.informationScreen=b.observable(null);this.popups=[]}function u(){this.currentAccountId=h.Accounts.currentId;
this.currentAccountId.subscribe(function(a){var c=h.Accounts.getAccount(a),g=this.oFolderListItems[a],a={Action:"FolderList",AccountID:a};c&&(_.delay(_.bind(c.updateQuotaParams,c),5E3),this.messagesLoading(!0),g?this.folderList(g):(this.folderList(new L),this.messages([]),this.currentMessage(null),e.Ajax.send(a,this.onFolderListResponse,this)))},this);this.editedAccountId=h.Accounts.editedId;this.editedAccountId.subscribe(function(a){var c=this.oFolderListItems[a],g={};c?this.editedFolderList(c):
this.currentAccountId()!==a&&(this.editedFolderList(new L),g={Action:"FolderList",AccountID:a},e.Ajax.send(g,this.onFolderListResponse,this))},this);this.oFolderListItems={};this.quotaChangeTrigger=b.observable(!1);this.checkMailStarted=b.observable(!1);this.folderList=b.observable(new L);this.editedFolderList=b.observable(new L);this.newMessagesCount=b.computed(function(){var a=this.folderList().inboxFolder();return a?a.unseenMessageCount():0},this);this.messages=b.observableArray([]);this.uidList=
b.observable(new Ha);this.page=b.observable(1);this.messagesLoading=b.observable(!0);this.messagesLoadingError=b.observable(!1);this.currentMessage=b.observable(null);this.deletedDraftMessageUid=b.observable("");this.aResponseHandlers=[];h.User.useThreads.subscribe(function(){_.each(this.oFolderListItems,function(a){_.each(a.collection(),function(a){a.markHasChanges();a.removeAllMessageListsFromCacheIfHasChanges()},this)},this);this.messages([])},this)}function Ka(){this.contacts={};this.responseHandlers=
{};this.vcardAttachments=[];this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500})}function La(){this.calendars=b.observableArray([]);this.calendarsLoadingStarted=b.observable(!1);this.icalAttachments=[];this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500});this.calendarSettingsChanged=b.observable(!1);this.calendarChanged=b.observable(!1)}function H(){this.browser=new jb;this.headerTabs=b.observableArray([]);this.screensTitle={};this.Ajax=new P;this.Routing=new Q;this.Screens=
new I;this.Links=new qa;this.Api=new xa;this.MessageSender=new K;this.Prefetcher=new ra;this.MailCache=null;this.ContactsCache=new Ka;this.CalendarCache=new La;this.Storage=new Ta;this.Phone=new N;this.$downloadIframe=null;this.currentScreen=this.Screens.currentScreen;this.currentScreen.subscribe(this.setTitle,this);this.focused=b.observable(!0);this.focused.subscribe(this.setTitle,this);this.init();this.newMessagesCount=this.MailCache.newMessagesCount;this.newMessagesCount.subscribe(this.setTitle,
this);this.currentMessage=this.MailCache.currentMessage;this.currentMessage.subscribe(this.setTitle,this);this.notification=null;this.initHeaderInfo()}var f={},d={},rb=j.pSevenI18N||{},e={},ma={},h=j.pSevenAppData||{},sa=!1,fa=i("html"),sb=-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad"),wb=-1<navigator.userAgent.toLowerCase().indexOf("android"),qb=sb||wb,ab="image/jpeg image/png image/gif text/plain text/css text/rfc822-headers message/delivery-status application/x-httpd-php application/javascript".split(" ");
j.Modernizr&&navigator&&j.Modernizr.addTest("pdf",function(){for(var a=navigator.mimeTypes,c=0,g=a.length;c<g;c++)if("application/pdf"===a[c].type)return!0;return!1});jb.prototype.getIeVersion=function(){var a=navigator.userAgent.toLowerCase();return d.pInt(a.slice(a.indexOf("msie")+4,a.indexOf(";",a.indexOf("msie")+4)))};P.prototype.isAllowedActionWithoutAuth=function(a){return-1!==_.indexOf(["Login","LoginLanguageUpdate","Logout","AccountCreate"],a)};P.prototype.isAllowedExtAction=function(a){return"HelpdeskRegister"===
a||"HelpdeskForgot"===a||"HelpdeskLogin"===a||"Logout"===a};P.prototype.doSend=function(a,c,g,b){var b=_.bind(b||null,this,a,c,g),c=_.bind(this.fail,this,a,c,g),g=_.bind(this.always,this,a),d=null;h.Token&&(a.Token=h.Token);this.abortRequests(a);d=i.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:a,success:b,error:c,complete:g});this.aRequests.push({Parameters:a,Xhr:d})};P.prototype.send=function(a,c,g){var b=void 0===a.AccountID,d=b||h.Accounts.hasAccountWithId(a.AccountID);if(a&&(h.Auth&&
d||this.isAllowedActionWithoutAuth(a.Action)))b&&"Login"!==a.Action&&(a.AccountID=h.Accounts.currentId()),this.doSend(a,c,g,this.done)};P.prototype.sendExt=function(a,c,g){var b=-1!==_.indexOf("HelpdeskRegister HelpdeskForgot HelpdeskLogin HelpdeskForgotChangePassword Logout CalendarList EventList".split(" "),a.Action);if(a&&(h.Auth||b))h.TenantHash&&(a.TenantHash=h.TenantHash),this.doSend(a,c,g,this.doneExt)};P.prototype.abortRequests=function(a){switch(a.Action){case "MessageMove":case "MessageDelete":this.abortRequestByActionName("MessageList",
a.Folder);this.abortRequestByActionName("Message");break;case "MessageList":case "MessageSetSeen":this.abortRequestByActionName("MessageList",a.Folder);break;case "FolderClear":this.abortRequestByActionName("MessageList",a.Folder);this.abortRequestByActionName("FolderCounts");break;case "ContactList":case "GlobalContactList":this.abortRequestByActionName("ContactList");this.abortRequestByActionName("GlobalContactList");break;case "Contact":case "GlobalContact":this.abortRequestByActionName("Contact"),
this.abortRequestByActionName("GlobalContact")}};P.prototype.abortRequestByActionName=function(a,c){_.each(this.aRequests,function(g,b){if(g&&g.Parameters.Action===a&&("MessageList"!==a||c===g.Parameters.Folder))g.Xhr.abort(),this.aRequests[b]=void 0},this);this.aRequests=_.compact(this.aRequests)};P.prototype.abortAllRequests=function(){_.each(this.aRequests,function(a){a&&a.Xhr.abort()},this);this.aRequests=[]};P.prototype.done=function(a,c,g,b){var d=this.isAllowedActionWithoutAuth(a.Action),n=
h.Accounts.hasAccountWithId(a.AccountID),A=a.AccountID===h.Accounts.defaultId();if(d||n){if(b&&!b.Result)switch(b.ErrorCode){case f.Errors.InvalidToken:d||e.tokenProblem();break;case f.Errors.AuthError:A&&!d&&(this.abortAllRequests(),e.authProblem())}this.executeResponseHandler(c,g,b,a)}};P.prototype.doneExt=function(a,c,g,b){this.executeResponseHandler(c,g,b,a)};P.prototype.fail=function(a,c,g,b,d,n){b={Result:!1,ErrorCode:0};switch(d){case "abort":b={Result:!1,ErrorCode:f.Errors.NotDisplayedError};
break;default:case "error":case "parseerror":b=""===n?{Result:!1,ErrorCode:f.Errors.NotDisplayedError}:{Result:!1,ErrorCode:f.Errors.DataTransferFailed}}this.executeResponseHandler(c,g,b,a)};P.prototype.executeResponseHandler=function(a,c,g,b){g||(g={Result:!1,ErrorCode:0});"function"===typeof a&&a.apply(c,[g,b])};P.prototype.always=function(a){_.each(this.aRequests,function(c,g){c&&_.isEqual(c.Parameters,a)&&(this.aRequests[g]=void 0)},this);this.aRequests=_.compact(this.aRequests)};f.Screens={Login:"login",
Information:"information",Header:"header",Mailbox:"mailbox",BottomMailbox:"bottommailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files",Helpdesk:"helpdesk",SingleHelpdesk:"single-helpdesk"};f.MailboxLayout={Side:0,Bottom:1};f.CalendarDefaultTab={Day:1,Week:2,Month:3};f.TimeFormat={F24:0,F12:1};f.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,DemoLimitations:106,
Recaptcha:107,AccessDenied:108,CanNotGetMessage:202,ImapQuota:205,NotSavedInSentItems:304,CanNotChangePassword:502,AccountOldPasswordNotCorrect:503,FetcherIncServerNotAvailable:702,FetcherLoginNotCorrect:703,HelpdeskThrowInWebmail:805,HelpdeskUserNotExists:807,HelpdeskUserNotActivated:808,MailServerError:901,DataTransferFailed:1100,NotDisplayedError:1155};f.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,System:9,User:10};f.FolderFilter={Flagged:"flagged"};f.LoginFormType={Email:0,
Login:3,Both:4};f.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2};f.ReplyType={Reply:"reply",ReplyAll:"reply-all",Forward:"forward"};f.Importance={Low:5,Normal:3,High:1};f.Sensivity={Nothing:0,Confidential:1,Private:2,Personal:3};f.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"};f.ContactPhoneType={Mobile:"Mobile",Personal:"Personal",Business:"Business"};f.ContactAddressType={Personal:"Personal",Business:"Business"};f.ContactSortType={Email:"Email",Name:"Name",Frequency:"Frequency"};
f.SaveMail={Hidden:0,Checked:1,Unchecked:2};f.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobile_sync",OutLookSync:"outlook_sync",Helpdesk:"helpdesk"};f.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders",FetcherInc:"fetcher-inc",FetcherOut:"fetcher-out",FetcherSig:"fetcher-sig"};f.ContactsGroupListType={Personal:0,SubGroup:1,Global:2};f.IcalType={Request:"REQUEST",
Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"};f.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"};f.IcalConfigInt={Accepted:1,Declined:2,Tentative:3,NeedsAction:0};f.Key={Tab:9,Enter:13,Shift:16,Ctrl:17,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Left:37,Right:39,Del:46,a:65,c:67,f:70,n:78,p:80,q:81,r:82,s:83,v:86,F5:116,Comma:188,Dot:190};f.FileStorageType={Private:0,Corporate:1};f.HelpdeskThreadStates={None:0,Pending:1,Waiting:2,Answered:3,
Resolved:4,Deferred:5};f.HelpdeskPostType={Normal:0,Internal:1,System:2};f.HelpdeskFilters={All:0,Pending:1,Resolved:2,InWork:3,Open:4,Archived:9};f.CalendarAccess={Full:0,Write:1,Read:2};f.CalendarEditRecurrenceEvent={None:0,OnlyThisInstance:1,AllEvents:2};f.CalendarRepeatPeriod={None:0,Daily:1,Weekly:2,Monthly:3,Yearly:4};f.DesktopNotifications={Allowed:0,NotAllowed:1,Denied:2,NotSupported:9};f.PhoneAction={Settings:"settings",Incoming:"incoming",Outgoing:"outgoing"};f.HtmlEditorImageSizes={Small:"small",
Medium:"medium",Large:"large",Original:"original"};b.bindingHandlers.command={init:function(a,c,g,t){var d=i(a),n=c();if(!n||!n.enabled||!n.canExecute)throw Error("You are not using command function");d.addClass("command");b.bindingHandlers[d.is("form")?"submit":"click"].init.apply(t,arguments)},update:function(a,c){var g=!0,b=i(a),d=c(),g=d.enabled();b.toggleClass("command-not-enabled",!g);g&&(g=d.canExecute(),b.toggleClass("unavailable",!g));b.toggleClass("command-disabled disable disabled",!g);
b.toggleClass("command-disabled",!g)}};b.bindingHandlers.onEnter={init:function(a,c,g,t){b.bindingHandlers.event.init(a,function(){return{keyup:function(g,b){b&&13===j.parseInt(b.keyCode,10)&&(i(a).trigger("change"),c().call(this,g))}}},g,t)}};b.bindingHandlers.onCtrlEnter={init:function(a,c,g,t){b.bindingHandlers.event.init(a,function(){return{keydown:function(g,b){return b&&13===j.parseInt(b.keyCode,10)&&b.ctrlKey?(i(a).trigger("change"),c().call(this,g),!1):!0}}},g,t)}};b.bindingHandlers.onEsc=
{init:function(a,c,g,t){b.bindingHandlers.event.init(a,function(){return{keyup:function(g,b){b&&27===j.parseInt(b.keyCode,10)&&(i(a).trigger("change"),c().call(this,g))}}},g,t)}};b.bindingHandlers.onFocusSelect={init:function(a,c,g,t){b.bindingHandlers.event.init(a,function(){return{focus:function(){a.select()},mouseup:function(){return!1}}},g,t)}};b.bindingHandlers.onFocusMoveCaretToEnd={init:function(a,c,g,t){b.bindingHandlers.event.init(a,function(){return{focus:function(){d.moveCaretToEnd(a)}}},
g,t)}};b.bindingHandlers.onEnterChange={init:function(a,c,g,t){b.bindingHandlers.event.init(a,function(){return{keyup:function(c,g){g&&13===j.parseInt(g.keyCode,10)&&i(a).trigger("change")}}},g,t)}};b.bindingHandlers.jhasfocus={init:function(a,c){i(a).on("focus",function(){c()(!0)}).on("blur",function(){c()(!1)})},update:function(a,c){b.utils.unwrapObservable(c())?i(a).is(":focus")||i(a).focus():i(a).is(":focus")&&i(a).blur()}};b.bindingHandlers.fadeIn={update:function(a,c){b.utils.unwrapObservable(c())&&
i(a).hide().fadeIn("fast")}};b.bindingHandlers.fadeOut={update:function(a,c){b.utils.unwrapObservable(c())&&i(a).fadeOut()}};b.bindingHandlers.i18n={init:function(a,c){var g=i(a).data("i18n"),g=g?d.i18n(g):g;if(""!==g)switch(c()){case "value":i(a).val(g);break;case "text":i(a).text(g);break;case "html":i(a).html(g);break;case "title":i(a).attr("title",g);break;case "placeholder":i(a).attr({placeholder:g})}}};b.bindingHandlers.link={init:function(a,c){i(a).attr("href",b.utils.unwrapObservable(c()))}};
b.bindingHandlers.title={init:function(a,c){i(a).attr("title",b.utils.unwrapObservable(c()))}};b.bindingHandlers.initDom={init:function(a,c){if(c())if(_.isArray(c()))for(var g=c(),b=g.length-1;0<=b;b--)g[b](i(a));else c()(i(a))}};b.bindingHandlers.customScrollbar={init:function(a,c){var g=i(a),b=c();g.addClass("scroll-wrap").customscroll(b);d.isUnd(b.reset)||(a._customscroll_reset=_.throttle(function(){g.data("customscroll").reset()},100));!d.isUnd(b.scrollToTopTrigger)&&d.isFunc(b.scrollToTopTrigger.subscribe)&&
b.scrollToTopTrigger.subscribe(function(){g.data("customscroll")&&g.data("customscroll").scrollToTop()});!d.isUnd(b.scrollToBottomTrigger)&&d.isFunc(b.scrollToBottomTrigger.subscribe)&&b.scrollToBottomTrigger.subscribe(function(){g.data("customscroll")&&g.data("customscroll").scrollToBottom()});!d.isUnd(b.scrollTo)&&d.isFunc(b.scrollTo.subscribe)&&b.scrollTo.subscribe(function(){g.data("customscroll")&&g.data("customscroll").scrollTo(b.scrollTo())})},update:function(a,c){a._customscroll_reset&&a._customscroll_reset();
d.isUnd(c().top)||i(a).data("customscroll").vertical.set(c().top)}};b.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(a,c,g,t,d){for(var e=t=0,f=b.utils.arrayMap(b.utils.arrayFilter(a.childNodes,function(a){return a.tagName&&"OPTION"===a.tagName&&a.selected}),function(a){return b.selectExtensions.readValue(a)||a.innerText||a.textContent}),h=a.scrollTop,c=b.utils.unwrapObservable(c());0<a.length;)b.cleanNode(a.options[0]),a.remove(0);if(c){"number"!==
typeof c.length&&(c=[c]);g=g().optionsBind;t=0;for(e=c.length;t<e;t++){var i=document.createElement("OPTION"),j=b.utils.unwrapObservable(c[t]);b.selectExtensions.writeValue(i,j);i.appendChild(document.createTextNode(j));a.appendChild(i);g&&(i.setAttribute("data-bind",g),b.applyBindings(d.createChildContext(j),i))}d=a.getElementsByTagName("OPTION");c=0;g=0<=navigator.userAgent.indexOf("MSIE 6");t=0;for(e=d.length;t<e;t++)0<=b.utils.arrayIndexOf(f,b.selectExtensions.readValue(d[t]))&&(g?d[t].setAttribute("selected",
!0):d[t].selected=!0,c++);a.scrollTop=h;c<f.length&&b.utils.triggerEvent(a,"change")}}};b.bindingHandlers.splitter={init:function(a,c){var g=i(a),b=c();setTimeout(function(){g.splitter(_.defaults(b,{name:"",sizeLeft:200,minLeft:20,minRight:40}))},1)}};b.bindingHandlers.dropdown={init:function(a,c,g,b){var v=i(a),e=_.defaults(c(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",passClick:!0,trueValue:!0}),a=e.control?v.find(".control"):v,f=i(document),h=function(){d.isUnd(e.callback)||
e.callback.call(b,v.hasClass(e.expand)?e.trueValue:!1,v)},c=function(a){a.stopPropagation()};e.passClick||(v.find(e.container).click(c),a.click(c));v.removeClass(e.expand);e.close&&e.close.subscribe&&e.close.subscribe(function(a){if(!a){f.unbind("click.dropdown");v.removeClass(e.expand)}h()});a.click(function(){if(!v.hasClass(e.disabled)){v.toggleClass(e.expand);_.defer(function(){h()});if(v.hasClass(e.expand)){e.close&&e.close.subscribe&&e.close(true);_.defer(function(){f.one("click.dropdown",function(){e.close&&
e.close.subscribe&&e.close(false);v.removeClass(e.expand);h()})})}}})}};b.bindingHandlers.customSelect={init:function(a,c,g,b){var v=i(a),e=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,input:!1}),f=[],a=e.control?v.find(".control"):v,h=v.find(".dropdown_content"),l=v.find(".link"),j=function(){h.empty();f=[];_.each(e.options,function(a){var c=i('<span class="item"></span>').text(a[e.optionsText]).data("value",a[e.optionsValue]);(a=a.isDisabled)?c.data("isDisabled",
a).addClass("disabled"):c.data("isDisabled",a).removeClass("disabled");f.push(c);h.append(c)},this)};j();h.on("click",".item",function(){var a=i(this);a.data("isDisabled")||e.value(a.data("value"))});!e.input&&(e.value&&e.value.subscribe)&&(e.value.subscribe(function(){var a,c=e.value();_.each(f,function(a){a.removeClass(e.selected)});a=_.find(e.options,function(a){return a[e.optionsValue]===c});d.isUnd(a)&&(a=e.options[0]);f[_.indexOf(e.options,a)].addClass(e.selected);l.text(i.trim(a[e.optionsText]));
a=a[e.optionsValue];e.value()!==a&&e.value(a)},b),e.value.valueHasMutated());e.alarmOptions&&e.alarmOptions.subscribe(function(){j()},b);v.removeClass(e.expand);a.click(function(){if(!v.hasClass(e.disabled)){v.toggleClass(e.expand);v.hasClass(e.expand)&&_.defer(function(){i(document).one("click",function(){v.removeClass(e.expand)})})}})}};b.bindingHandlers.moveToFolderFilter={init:function(a,c){var g=i(a),b=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),
d=b.control?g.find(".control"):g,e=g.find(b.container),f=g.find(".link");g.removeClass(b.expand);b.options.subscribe(function(a){var c=b.value();_.find(a,function(a){return a.id===c})||b.value("")});b.value&&b.value.subscribe&&(b.value.subscribe(function(a){var c=_.isArray(b.options)?b.options:b.options(),g=_.find(c,function(c){return c[b.optionsValue]===a});g||(g=_.find(c,function(a){return""===a[b.optionsValue]}))&&""!==a&&b.value("");g&&f.text(i.trim(g[b.optionsText]))}),b.value.valueHasMutated());
e.on("click",".item",function(){var a=i(this).data("value");b.value(a)});d.click(function(){if(!g.hasClass(b.disabled)){g.toggleClass(b.expand);g.hasClass(b.expand)&&_.defer(function(){i(document).one("click",function(){g.removeClass(b.expand)})})}})},update:function(a,c){var g=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),b=i(a).find(g.container),d=_.isArray(g.options)?g.options:g.options(),e=g.value?g.value():"";b.empty();_.each(d,function(a){var c=
i('<span class="item"></span>').text(a[g.optionsText]).data("value",a[g.optionsValue]);e===a[g.optionsValue]&&c.addClass("selected");b.append(c)})}};b.bindingHandlers.contactcard={init:function(a,c){var g=i(a),b=!1,d=_.defaults(c(),{disabled:"disabled",expand:"expand",control:!0}),e=d.control?g.find(".control"):g;void 0!==d.trigger&&void 0!==d.trigger.subscribe&&(g.removeClass(d.expand),e.bind({mouseover:function(){!g.hasClass(d.disabled)&&d.trigger()&&(b=!0,_.delay(function(){b&&g.addClass(d.expand)},
200))},mouseout:function(){d.trigger()&&(b=!1,_.delay(function(){b||g.removeClass(d.expand)},200))}}))}};b.bindingHandlers.checkmail={update:function(a,c){var g=a.oOptions||null,b=a.jqElement||null,v=a.oIconIE||null,f=c(),h=f.state;void 0!==f.state&&(b||(a.jqElement=b=i(a)),g||(a.oOptions=g=_.defaults(f,{activeClass:"process",duration:800})),d.deferredUpdate(b,h,g.duration,function(c,d){if(e.browser.ie9AndBelow){if(!v)a.oIconIE=v=b.find(".icon");if(!v.__intervalIE&&d){var f=0,n="";v.__intervalIE=
setInterval(function(){n="0px -"+20*f+"px";f=f<7?f+1:0;v.css({"background-position":n})},1E3/12)}else{v.css({"background-position":"0px 0px"});clearInterval(v.__intervalIE);v.__intervalIE=null}}else c.toggleClass(g.activeClass,d)}))}};b.bindingHandlers.heightAdjust={update:function(a,c){var g=a.jqElement||null,b=0,d=c().location;g||(a.jqElement=g=i(a));_.delay(function(){_.each(c().elements,function(a){(a=a())&&(b=b+(a.is(":visible")?a.outerHeight():0))});d==="top"||d===void 0?g.css({"padding-top":b,
"margin-top":-b}):d==="bottom"&&g.css({"padding-bottom":b,"margin-bottom":-b})},400)}};b.bindingHandlers.triggerInview={update:function(a,c){0>=c().trigger().length||_.defer(function(){var g=i(a),b=g.height(),d=c(),e=null,e=g.find(d.selector);e.each(function(){this.$el=i(this);this.inviewHeight=this.$el.height();this.inview=!1});d=_.debounce(function(){e.each(function(){var a=this.inview||!1,c=this.$el.position().top+parseInt(this.$el.css("margin-top"),10);0<c&&c<b?a||(this.inview=!0,this.$el.trigger("inview")):
this.inview=!1})},2E3);g.scroll(d);d()})}};b.bindingHandlers.watchWidth={init:function(a,c){i(j).bind("resize",function(){c()(i(a).outerWidth())})}};b.bindingHandlers.columnCalc={init:function(a,c){var g=i(a),b=c().prop,d=null,e=0,d=g.find(c().itemSelector);void 0!==d[0]&&(e=d.outerWidth(!0),e=1>=e?1:e,b&&i(j).bind("resize",function(){var a=g.width();b(0<a?Math.floor(a/e):1)}))}};b.bindingHandlers.quickReplyAnim={update:function(a,c){var g=a.jqTextarea||null,b=a.jqStatus||null,d=a.jqButtons||null,
f=a.jqElement||null,h=a.oPrevActions||null,s=c(),l=null,l=_.defaults(s,{saveAction:!1,sendAction:!1,activeAction:!1});f||(a.jqElement=f=i(a),a.jqTextarea=g=f.find("textarea"),a.jqStatus=b=f.find(".status"),a.jqButtons=d=f.find(".buttons"),a.oPrevActions=h={saveAction:null,sendAction:null,activeAction:null});f.is(":visible")&&(e.browser.ie9AndBelow?(g&&(!f.defualtHeight&&!g.defualtHeight)&&(f.defualtHeight=f.outerHeight(),g.defualtHeight=g.outerHeight(),b.defualtHeight=d.outerHeight(),d.defualtHeight=
d.outerHeight()),_.defer(function(){var a=h.sendAction!==l.sendAction,c=h.saveAction!==l.saveAction;if(h.activeAction!==l.activeAction)if(l.activeAction){g.animate({height:g.defualtHeight+50},300);f.animate({"max-height":f.defualtHeight+d.defualtHeight+50},300)}else{g.animate({height:g.defualtHeight},300);f.animate({"max-height":f.defualtHeight},300)}if(a||c)if(l.sendAction){f.animate({"max-height":"30px"},300);b.animate({"max-height":"30px",opacity:1},300)}else if(l.saveAction)f.animate({"max-height":0},
300);else{f.animate({"max-height":f.defualtHeight+d.defualtHeight+50},300);b.animate({"max-height":0,opacity:0},300)}})):(f.toggleClass("saving",l.saveAction),f.toggleClass("sending",l.sendAction),f.toggleClass("active",l.activeAction)));_.defer(function(){h=l})}};b.extenders.reversible=function(a){var c=a();a.commit=function(){c=a()};a.revert=function(){a(c)};a.commitedValue=function(){return c};a.changed=function(){return c!==a()};return a};b.extenders.autoResetToFalse=function(a,c){a.iTimeout=
0;a.subscribe(function(g){g&&(j.clearTimeout(a.iTimeout),a.iTimeout=j.setTimeout(function(){a.iTimeout=0;a(!1)},d.pInt(c)))});return a};d.createCommand=function(a,c,g){var t=c?function(){return t.canExecute&&t.canExecute()?c.apply(a,Array.prototype.slice.call(arguments)):!1}:function(){};t.enabled=b.observable(!0);g=d.isUnd(g)?!0:g;t.canExecute=d.isFunc(g)?b.computed(function(){return t.enabled()&&g.call(a)}):b.computed(function(){return t.enabled()&&!!g});return t};b.bindingHandlers.autocomplete=
{init:function(a,c){var g=c(),b=i(a);g&&(b&&b[0])&&b.autocomplete({minLength:1,source:function(a,c){g(a.term.split(/,\s*/).pop(),c)},search:function(){return 1>this.value.split(/,\s*/).pop().length?!1:!0},focus:function(){return!1},select:function(a,c){var g=this.value.split(/,\s*/);g.pop();g.push(c.item.value);g.push("");this.value=g.join(", ").slice(0,-2);b.trigger("change");var g=b[0],d=g.value.length;g.blur();g.focus();g.setSelectionRange&&g.setSelectionRange(d,d);return!1}})}};b.bindingHandlers.autocompleteSimple=
{init:function(a,c){var g=i(a),b=c(),d=b.callback,e=b.dataAccessor?b.dataAccessor:null;d&&(g&&g[0])&&g.autocomplete({minLength:1,source:function(a,c){d(a.term,c)},focus:function(){return!1},select:function(a,c){_.delay(function(){g.trigger("change")},5);e&&e(c.item);return!0}})}};b.bindingHandlers.draggablePlace={init:function(a,c,g,t){g=g?g():null;i(a).draggable({distance:20,handle:".dragHandle",cursorAt:{top:0,left:0},helper:function(a){return c().call(t,a&&a.target?b.dataFor(a.target):null)},start:g&&
g.draggableDragStartCallback?g.draggableDragStartCallback:d.emptyFunction,stop:g&&g.draggableDragStopCallback?g.draggableDragStopCallback:d.emptyFunction}).on("mousedown",function(){d.removeActiveFocus()})}};b.bindingHandlers.droppable={init:function(a,c){var g=c();!1!==g&&i(a).droppable({hoverClass:"droppableHover",drop:function(a,c){g(a,c)}})}};b.bindingHandlers.draggable={init:function(a,c){i(a).attr("draggable",b.utils.unwrapObservable(c()))}};b.bindingHandlers.autosize={init:function(a,c){var g=
i(a),b=c(),d=g.height(),f=g.outerHeight(),h=g.innerHeight(),s=f-h,l=h-d,j=b.minHeight?b.minHeight:0,Sa=b.maxHeight?b.maxHeight:0,k=b.scrollableHeight?b.scrollableHeight:1E3,b=b.autosizeTrigger?b.autosizeTrigger:null,m=function(a){var c=0;e.browser.firefox&&(c=2*parseInt(g.css("padding-top"),10));Sa?setTimeout(function(){g.prop("scrollHeight")<Sa?(g.height(j-l-s),g.height(g.prop("scrollHeight")+c-l)):g.height(Sa-l-s)},100):(a||g.prop("scrollHeight")<k)&&setTimeout(function(){g.height(j-l-s);g.height(g.prop("scrollHeight")+
c-l)},100)};g.on("keydown",function(){m()});g.on("paste",function(){m()});b&&b.subscribe(function(a){m(a)},this);m()}};b.bindingHandlers.customBind={init:function(a,c,g,d){i(a);var c=c(),e=c.onKeydown?c.onKeydown:null,f=c.onKeyup?c.onKeyup:null,h=c.onPaste?c.onPaste:null,s=c.onInput?c.onInput:null,l=c.valueObserver?c.valueObserver:null;b.bindingHandlers.event.init(a,function(){return{keydown:function(c,g){e&&e.call(this,a,g,l);return!0},keyup:function(c,g){f&&f.call(this,a,g,l);return!0},paste:function(c,
g){h&&h.call(this,a,g,l);return!0},input:function(c,g){s&&s.call(this,a,g,l);return!0}}},g,d)}};b.bindingHandlers.fade={init:function(a,c){function g(a){var c;c=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,c,g,b){return c+c+g+g+b+b});c=(c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c))?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null;c="rgba("+c.r+","+c.g+","+c.b;d.isRTL?e.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a+"', endColorstr='"+
a+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+c+",1)), color-stop(100%,"+c+",0)))").css("background-image","-moz-linear-gradient(left, "+c+",1)0%, "+c+",0)100%)").css("background-image","-webkit-linear-gradient(left, "+c+"1)0%,"+c+",0)100%)").css("background-image","-o-linear-gradient(left, "+c+",1)0%,"+c+",0)100%)").css("background-image","-ms-linear-gradient(left, "+c+",1)0%,"+c+",0)100%)").css("background-image","linear-gradient(left, "+
c+",1)0%,"+c+",0)100%)"):e.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a+"', endColorstr='"+a+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+c+",0)), color-stop(100%,"+c+",1)))").css("background-image","-moz-linear-gradient(left, "+c+",0)0%, "+c+",1)100%)").css("background-image","-webkit-linear-gradient(left, "+c+",0)0%,"+c+",1)100%)").css("background-image","-o-linear-gradient(left, "+c+",0)0%,"+c+",1)100%)").css("background-image",
"-ms-linear-gradient(left, "+c+",0)0%,"+c+",1)100%)").css("background-image","linear-gradient(left, "+c+",0)0%,"+c+",1)100%)")}var b=i(a),e=i('<span class="faded"></span>'),f=c(),f=f.color?f.color:null;b.parent().addClass("fade");b.after(e);g(f());f.subscribe(function(a){g(a)},this)}};b.bindingHandlers.highlighter={init:function(a,c,g,t){function e(c){var g=0,g=n.text().split(kb),b=[];i.each(g,function(a,c){_.any(l,function(a){return a===c})?i.each(c,function(a,c){b.push(i(c.replace(/(.)/,'<span class="search_highlight">$&</span>')))}):
i.each(c,function(a,c){b.push(document.createTextNode(c))})});if(c)n.empty().append(b);else if(c=0,"undefined"!==typeof j.getSelection?(c=j.getSelection().getRangeAt(0),g=c.cloneRange(),g.selectNodeContents(a),g.setEnd(c.endContainer,c.endOffset),c=g.toString().length):"undefined"!==typeof document.selection&&"Control"!==document.selection.type&&(c=document.selection.createRange(),g=document.body.createTextRange(),g.moveToElementText(a),g.setEndPoint("EndToEnd",c),c=g.text.length),g=c,n.empty().append(b),
c=g,a)document.createRange?(g=document.createRange(),g.selectNodeContents(a),g.setStart(a,c),g.setEnd(a,c),c=j.getSelection(),c.removeAllRanges(),c.addRange(g)):a.createTextRange?(g=a.createTextRange(),g.collapse(!0),g.moveEnd(c),g.moveStart(c),g.select()):a.setSelectionRange&&a.setSelectionRange(c,c)}var n=i(a),h=c(),s=h.valueObserver?h.valueObserver:null,c=h.highlighterValueObserver?h.highlighterValueObserver:null,h=h.highlightTrigger?h.highlightTrigger:null,l=["from:","to:","subject:","text:"],
kb,k="";i.each(l,function(a,c){k=!a?k+"\\b"+c:k+"|\\b"+c});kb=RegExp("("+k+")","g");var m=-1;h.notifySubscribers();h.subscribe(function(){setTimeout(function(){e(!1)},0)},this);c.subscribe(function(){n.text(s())},this);b.bindingHandlers.event.init(a,function(){return{keydown:function(a,c){return c.keyCode!==f.Key.Enter},keyup:function(a,c){var g=-1!==d.inArray(c.keyCode,[f.Key.Left,f.Key.Right,f.Key.Home,f.Key.End]);c.keyCode===f.Key.Enter||(c.keyCode===f.Key.Ctrl||(c.ctrlKey||m===f.Key.Ctrl)&&c.keyCode===
f.Key.a||c.keyCode===f.Key.Shift||(c.shiftKey||m===f.Key.Shift)&&g)||(s(n.text()),e(!1));m=c.keyCode;return!0},paste:function(a,c){setTimeout(function(){s(c.target.innerText);e(!1)},0);return!0}}},g,t)}};Q.prototype.init=function(a){this.defaultScreen=a;pa.initialized.removeAll();pa.changed.removeAll();pa.initialized.add(this.parseRouting,this);pa.changed.add(this.parseRouting,this);pa.init();pa.initialized.removeAll()};Q.prototype.finalize=function(){pa.dispose();this.setHashFromString("")};Q.prototype.setHashFromString=
function(a){var c=location.hash===a;c||(location.hash=a);return c};Q.prototype.replaceHashFromString=function(a){location.hash!==a&&location.replace(a)};Q.prototype.setHash=function(a){return this.setHashFromString(this.buildHashFromArray(a))};Q.prototype.replaceHash=function(a){this.replaceHashFromString(this.buildHashFromArray(a))};Q.prototype.setLastMailboxHash=function(){this.setHashFromString(this.lastMailboxRouting)};Q.prototype.setPreviousHash=function(){location.hash=this.previousHash};Q.prototype.buildHashFromArray=
function(a){var c=0,g=0,g="";if(_.isArray(a))for(g=a.length;c<g;c++)a[c]=encodeURIComponent(a[c]);else a=[encodeURIComponent(a.toString())];g=a.join("/");""!==g&&(g="#"+g);return g};Q.prototype.getHashFromHref=function(){var a=location.href.indexOf("#"),c="";-1!==a&&(c=location.href.substr(a+1));return c};Q.prototype.isSingleMode=function(){var a=this.getHashFromHref().split("/"),a=decodeURIComponent(a.shift())||f.Screens.Mailbox;return a===f.Screens.SingleMessageView||a===f.Screens.SingleCompose||
a===f.Screens.SingleHelpdesk};Q.prototype.goDirectly=function(a,c){pa.stop();this.setHash(a);this.parseRouting(c);pa.init()};Q.prototype.parseRouting=function(a){var c=this.getHashFromHref(),g=c.split("/"),b=decodeURIComponent(g.shift())||this.defaultScreen,d=_.find(f.Screens,function(a){return a===b},this),n=0,A=g.length;b===f.Screens.Mailbox&&(this.lastMailboxRouting=c);this.previousHash=this.currentHash;for(this.currentHash=c;n<A;n++)g[n]=decodeURIComponent(g[n]);i.isArray(a)&&(g=_.union(g,a));
switch(b){case f.Screens.SingleMessageView:case f.Screens.SingleCompose:case f.Screens.SingleHelpdesk:h.SingleMode=!0;e.Screens.showCurrentScreen(b,g);break;default:d||(b=this.defaultScreen);h.SingleMode=!1;e.Screens.showNormalScreen(f.Screens.Header);e.Screens.showCurrentScreen(b,g);break;case f.Screens.Mailbox:h.SingleMode=!1,e.Screens.showNormalScreen(f.Screens.Header),h.User.Layout===f.MailboxLayout.Side?e.Screens.showCurrentScreen(f.Screens.Mailbox,g):e.Screens.showCurrentScreen(f.Screens.BottomMailbox,
g)}this.resizeAll()};qa.prototype.mailbox=function(a,c,g,b,e){var n=[f.Screens.Mailbox],c=d.isNormal(c)?d.pInt(c):1,g=d.isNormal(g)?d.pString(g):"",b=d.isNormal(b)?d.pString(b):"",e=d.isNormal(e)?d.pString(e):"";a&&""!==a&&(e&&""!==e?n.push("filter:"+e):n.push(a));1<c&&n.push("p"+c);g&&""!==g&&n.push("msg"+g);b&&""!==b&&n.push(b);return n};qa.prototype.inbox=function(){return this.mailbox()};qa.prototype.parseMailbox=function(a){var c="INBOX",g=1,b="",e="",n="",h="";if(0<a.length&&(d.isNormal(a[0])&&
(c=d.pString(a[0]),c==="filter:"+f.FolderFilter.Flagged&&(c="INBOX",n=f.FolderFilter.Flagged)),a[1]&&(h=d.pString(a[1]),this.isPageParam(h)?(g=d.pInt(h.substr(1)),0>=g&&(g=1)):this.isMsgParam(h)?b=h.substr(3):e=h),""===e))a[2]&&(h=d.pString(a[2]),this.isMsgParam(h)?b=h.substr(3):e=h),a[3]&&(e=d.pString(a[3]));return{Folder:c,Page:g,Uid:b,Search:e,Filters:n}};qa.prototype.isPageParam=function(a){return"p"===a.substr(0,1)&&/^[1-9][\d]*$/.test(a.substr(1))};qa.prototype.isMsgParam=function(a){return"msg"===
a.substr(0,3)&&/^[1-9][\d]*$/.test(a.substr(3))};qa.prototype.compose=function(){return[h.SingleMode?f.Screens.SingleCompose:f.Screens.Compose]};qa.prototype.composeFromMessage=function(a,c,g){return[h.SingleMode?f.Screens.SingleCompose:f.Screens.Compose,a,c,g]};qa.prototype.composeWithToField=function(a){return[h.SingleMode?f.Screens.SingleCompose:f.Screens.Compose,"to",a]};K.prototype.setReplyData=function(a,c){this.replyText(a);this.replyDraftUid(c)};K.prototype.send=function(a,c,g,b,f,h,A){var i=
"",l=e.MailCache.folderList().sentFolderFullName(),j=e.MailCache.folderList().draftsFolderFullName();c.Action=a;c.IsHtml="1";c.ShowReport=b;switch(a){case "MessageSend":i=d.i18n("COMPOSE/INFO_SENDING");g&&(c.SentFolder=l);""!==c.DraftUid&&(c.DraftFolder=j);break;case "MessageSave":i=d.i18n("COMPOSE/INFO_SAVING"),c.DraftFolder=j}b&&e.Api.showLoading(i);A?this.postponedMailData={Parameters:c,MessageSendResponseHandler:f,MessageSendResponseContext:h}:e.Ajax.send(c,f,h)};K.prototype.sendPostponedMail=
function(a){var c=this.postponedMailData,g=e.MailCache.folderList().draftsFolderFullName();""!==a&&(c.Parameters.DraftUid=a,c.Parameters.DraftFolder=g);this.postponedMailData&&(e.Ajax.send(c.Parameters,c.MessageSendResponseHandler,c.MessageSendResponseContext),this.postponedMailData=null)};K.prototype.sendReplyMessage=function(a,c,g,b,d){var n=null;e.MailCache.currentMessage()&&(n=this.getReplyDataFromMessage(e.MailCache.currentMessage(),f.ReplyType.ReplyAll,h.Accounts.currentId(),null,c,g),n.Bcc=
"",n.Importance=f.Importance.Normal,n.Sensivity=f.Sensivity.Nothing,n.ReadingConfirmation="0",n.IsQuickReply=!0,n.Attachments=this.convertAttachmentsForSending(n.Attachments),this.send(a,n,h.User.getSaveMailInSentItems(),!1,b,d))};K.prototype.convertAttachmentsForSending=function(a){var c={};_.each(a,function(a){c[a.tempName()]=[a.fileName(),a.cid(),a.inline()?"1":"0",a.linked()?"1":"0"]});return c};K.prototype.onMessageSendResponse=function(a,c){var g=h.SingleMode?j.opener.App:e,b=!!a.Result,v,n,
A;e.Api.hideLoading();switch(c.Action){case "MessageSave":b?(c.ShowReport&&e.Api.showReport(d.i18n("COMPOSE/REPORT_MESSAGE_SAVED")),a.Result.NewUid||(h.App.AutoSave=!1)):c.ShowReport&&e.Api.showErrorByCode(a.ErrorCode,d.i18n("COMPOSE/ERROR_MESSAGE_SAVING"));break;case "MessageSend":!b&&a.ErrorCode!==f.Errors.NotSavedInSentItems?e.Api.showErrorByCode(a.ErrorCode,d.i18n("COMPOSE/ERROR_MESSAGE_SENDING")):(!b&&a.ErrorCode===f.Errors.NotSavedInSentItems?e.Api.showError(d.i18n("WARNING/SENT_EMAIL_NOT_SAVED")):
c.IsQuickReply?e.Api.showReport(d.i18n("COMPOSE/REPORT_MESSAGE_SENT")):g.Api.showReport(d.i18n("COMPOSE/REPORT_MESSAGE_SENT")),_.isArray(c.DraftInfo)&&3===c.DraftInfo.length&&(A=c.DraftInfo[0],n=c.DraftInfo[1],v=c.DraftInfo[2],e.MailCache.markMessageReplied(c.AccountID,v,n,A))),c.SentFolder&&g.MailCache.removeMessagesFromCacheForFolder(c.SentFolder)}c.DraftFolder&&g.MailCache.removeMessagesFromCacheForFolder(c.DraftFolder);return{Action:c.Action,Result:b,NewUid:a.Result?a.Result.NewUid:""}};K.prototype.getReplyDataFromMessage=
function(a,c,g,b,e,h){var A={DraftInfo:[],DraftUid:"",To:"",Cc:"",Subject:"",Attachments:[],InReplyTo:a.messageId(),References:this.getReplyReferences(a)},i=a.oReplyTo.getFull();""===i&&(i=a.oFrom.getFull());if(!e||""===e)e=this.replyText(),this.replyText("");A.Text="forward"===c?e+this.getForwardMessageBody(a):e+this.getReplyMessageBody(a,g,b);h?A.DraftUid=h:(A.DraftUid=this.replyDraftUid(),this.replyDraftUid(""));switch(c){case f.ReplyType.Reply:A.DraftInfo=[f.ReplyType.Reply,a.uid(),a.folder()];
A.To=i;A.Subject=this.replySubjectAdd(d.i18n("COMPOSE/REPLY_PREFIX"),a.subject());A.Attachments=_.filter(a.attachments(),function(a){return a.linked()});break;case f.ReplyType.ReplyAll:A.DraftInfo=[f.ReplyType.ReplyAll,a.uid(),a.folder()];A.To=i;A.Cc=this.getReplyAllCcAddr(a,g,b);A.Subject=this.replySubjectAdd(d.i18n("COMPOSE/REPLY_PREFIX"),a.subject());A.Attachments=_.filter(a.attachments(),function(a){return a.linked()});break;case f.ReplyType.Forward:A.DraftInfo=[f.ReplyType.Forward,a.uid(),a.folder()],
A.Subject=this.replySubjectAdd(d.i18n("COMPOSE/FORWARD_PREFIX"),a.subject()),A.Attachments=a.attachments()}return A};K.prototype.getReplyReferences=function(a){var c=a.references(),a=a.messageId();-1===c.indexOf(a)&&(c+=" "+a);return c};K.prototype.getReplyMessageBody=function(a,c,g){var b=a.getDomText(),b=0<b.length?b.html():"",a=d.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{DATE:a.oDateModel.getDate(),TIME:a.oDateModel.getTime(),SENDER:d.encodeHtml(a.oFrom.getFull())});return"<br /><br />"+this.getSignatureText(c,
g)+"<br /><br />"+a+"<blockquote>"+b+"</blockquote>"};K.prototype.getSignatureText=function(a,c){var g=h.Accounts.getAccount(a).signature(),g=g&&g.options()?'<div data-anchor="signature">'+g.signature()+"</div>":"";c&&(c.idAccount()===a&&null!==c.signature())&&(g='<div data-anchor="signature">'+c.signature()+"</div>");return g};K.prototype.getFetcherByRecipients=function(a,c){var g=h.Accounts.getDefault(),b=null;g&&(c===g.id()&&g.fetchers())&&(b=_.find(g.fetchers().collection(),function(c){return!!_.find(a,
function(a){return a.sEmail===c.email()})}));return b};K.prototype.getForwardMessageBody=function(a){var c=a.getDomText(),c=0<c.length?c.html():"",g=d.encodeHtml(a.oCc.getFull()),g=""!==g?d.i18n("COMPOSE/FORWARD_MESSAGE_BODY_CC",{CCADDR:g}):"";return"<br /><br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TITLE",{FROMADDR:d.encodeHtml(a.oFrom.getFull()),TOADDR:d.encodeHtml(a.oTo.getFull()),CCPART:g,FULLDATE:a.oDateModel.getFullDate(),SUBJECT:a.subject()})+"<br /><br />"+c};K.prototype.getReplyAllCcAddr=function(a,
c,g){var b=new S,d=_.union(a.oTo.aCollection,a.oCc.aCollection,a.oBcc.aCollection),e=_.find(h.Accounts.collection(),function(a){return a.id()===c},this),f=new ua,i=new ua;f.sEmail=e.email();i.sEmail=g?g.email():"";b.addCollection(d);b.excludeCollection(_.union(a.oFrom.aCollection,[f,i]));return b.getFull()};K.prototype.replySubjectAdd=function(a,c){var g=null,b=d.trim(c);null!==(g=(new j.RegExp("^"+a+"[\\s]?\\:(.*)$","gi")).exec(c))&&!d.isUnd(g[1])?b=a+"[2]: "+g[1]:null!==(g=(new j.RegExp("^("+a+
"[\\s]?[\\[\\(]?)([\\d]+)([\\]\\)]?[\\s]?\\:.*)$","gi")).exec(c))&&!d.isUnd(g[1])&&!d.isUnd(g[2])&&!d.isUnd(g[3])?(d.pInt(g[2]),b=g[1]+(d.pInt(g[2])+1)+g[3]):b=a+": "+c;return b};K.prototype.getHtmlFromText=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")};ra.prototype.init=function(){setInterval(_.bind(function(){this.prefetchStarted(!1);this.start()},this),2E3)};ra.prototype.start=function(){var a=e.MailCache.folderList();
!h.SingleMode&&(!e.Ajax.hasOpenedRequests&&!this.prefetchStarted())&&(a&&a.inboxFolder()&&e.MailCache.requestMessageList(a.inboxFolder().fullName(),1,"",f.FolderFilter.Flagged,!1,!1),h.App.AllowPrefetch&&(this.startMessagesPrefetch(),this.startOtherPagesPrefetch(),this.startOtherFoldersPrefetch()))};ra.prototype.startOtherPagesPrefetch=function(){var a=e.MailCache.folderList().currentFolder();this.startPagePrefetch(a,e.MailCache.page()+1);this.startPagePrefetch(a,e.MailCache.page()-1)};ra.prototype.startPagePrefetch=
function(a,c){if(!this.prefetchStarted()&&a){var g=e.MailCache.uidList(),b=(c-1)*h.User.MailsPerPage,b=0<c&&b<g.resultCount(),g={folder:a.fullName(),page:c,search:g.search()},d=null;b&&!a.hasListBeenRequested(g)&&(d=e.MailCache.requestMessageList(g.folder,g.page,g.search,"",!1,!1))&&d.RequestStarted&&this.prefetchStarted(!0)}};ra.prototype.startOtherFoldersPrefetch=function(){if(!this.prefetchStarted()){var a=e.MailCache.folderList().sentFolder(),c=e.MailCache.folderList().draftsFolder(),g=e.MailCache.folderList().inboxFolder(),
b=g?g.subfolders():[],d=_.filter(e.MailCache.folderList().collection(),function(a){return!a.isSystem()},this),f=_.union(b,d),b=0<f.length?f[0]:null,d=1<f.length?f[1]:null,f=2<f.length?f[2]:null;this.startFolderPrefetch(g);this.startFolderPrefetch(a);this.startFolderPrefetch(c);this.startFolderPrefetch(b);this.startFolderPrefetch(d);this.startFolderPrefetch(f)}};ra.prototype.startFolderPrefetch=function(a){if(!this.prefetchStarted()&&a){var c={folder:a.fullName(),page:1,search:""},g=null;a.hasListBeenRequested(c)||
(g=e.MailCache.requestMessageList(c.folder,c.page,c.search,"",!1,!1))&&g.RequestStarted&&this.prefetchStarted(!0)}};ra.prototype.startMessagesPrefetch=function(){var a=e.MailCache.currentAccountId(),c=e.MailCache.getCurrentFolder(),g=0,b=h.App.MaxPrefetchBodiesSize,d=[],f=null,f=function(a){var e=!a.deleted()&&!a.completelyFilled(),f=!_.find(d,function(c){return c===a.uid()},this),h=!c.hasUidBeenRequested(a.uid());g+a.textSize()+2048<b&&(e&&f&&h)&&(d.push(a.uid()),g+=a.textSize()+2048)};c&&(c.selected()&&
!this.prefetchStarted())&&(_.each(e.MailCache.messages(),f),_.each(c.oMessages,f),0<d.length&&(c.addRequestedUids(d),f={AccountID:a,Action:"Messages",Folder:c.fullName(),Uids:d},e.Ajax.send(f,this.onPrefetchResponse,this),this.prefetchStarted(!0)))};ra.prototype.onPrefetchResponse=function(a,c){var g=e.MailCache.getFolderByFullName(c.AccountID,c.Folder);_.isArray(a.Result)&&_.each(a.Result,function(c){var b=c.Uid.toString(),d=g.oMessages[b]||new F;d.parse(c,a.AccountID,d.threadPart());g.oMessages[b]=
d})};d.inArray=i.inArray;d.isFunc=i.isFunction;d.trim=i.trim;d.emptyFunction=function(){};d.isUnd=function(a){return void 0===a};d.isNull=function(a){return null===a};d.isNormal=function(a){return!d.isUnd(a)&&!d.isNull(a)};d.isNumeric=function(a){return d.isNormal(a)?/^[1-9]+[0-9]*$/.test(a.toString()):!1};d.pInt=function(a){return d.isNormal(a)&&""!==a?j.parseInt(a,10):0};d.pString=function(a){return d.isNormal(a)?a.toString():""};d.isNonEmptyArray=function(a){return _.isArray(a)&&0<a.length};d.pImport=
function(a,c,g){a[c]=g};d.pExport=function(a,c,g){return d.isUnd(a[c])?g:a[c]};d.encodeHtml=function(a){return a?a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""};d.i18n=function(a,c,g,b){var e="",a=d.isUnd(rb[a])?d.isNormal(g)?g:a:rb[a];d.isUnd(b)||(b=d.getPlural(h.User.DefaultLanguage,b),a=(g=a.split("|"))&&g[b]?g[b]:g&&g[0]?g[0]:a);if(d.isNormal(c))for(e in c)c.hasOwnProperty(e)&&(a=a.replace("%"+e+"%",c[e]));return a};
d.roundNumber=function(a,c){return Math.round(a*Math.pow(10,c))/Math.pow(10,c)};d.friendlySize=function(a){a=d.pInt(a);return 1073741824<=a?d.roundNumber(a/1073741824,1)+d.i18n("MAIN/GIGABYTES"):1048576<=a?d.roundNumber(a/1048576,1)+d.i18n("MAIN/MEGABYTES"):1024<=a?d.roundNumber(a/1024,0)+d.i18n("MAIN/KILOBYTES"):a+d.i18n("MAIN/BYTES")};var gb={};d.timeOutAction=function(a,c,g){d.isUnd(gb[a])&&(gb[a]=0);j.clearTimeout(gb[a]);gb[a]=j.setTimeout(c,g)};d.log=function(){};d.getEmailParts=function(a){for(var c=
a.indexOf('"'),g=a.indexOf('"',c+1),b=a.indexOf("<",g),d=-1,e=-1,f="",e="";-1!==b;)d=b,b=a.indexOf("<",b+1);b=d;e=a.indexOf(">",b+1);-1===b?e=i.trim(a):(f=-1===c?i.trim(a.substring(0,b)):i.trim(a.substring(c+1,g)),e=i.trim(a.substring(b+1,e)));return{name:f,email:e,FullEmail:a}};d.isCorrectEmail=function(a){return!!a.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)};d.getIncorrectEmailsFromAddressString=function(a){for(var a=a.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),c=[],g=
0,b=a.length,e="",e=null;g<b;g++)e=i.trim(a[g]),0<e.length&&(e=d.getEmailParts(i.trim(a[g])),d.isCorrectEmail(e.email)||c.push(e.email));return c};d.getImportContactsLink=function(){return"?/ImportContacts/"};d.getExportContactsLink=function(){return"?/Raw/Contacts/"};d.getExportCalendarLinkByHash=function(a,c){return"?/Raw/Calendar/"+a+"/"+c};d.getDownloadLinkByHash=function(a,c,g,b){g=d.isUnd(g)?!1:!!g;b=d.isUnd(b)?"":b;return"?/Raw/Download/"+a+"/"+c+"/"+(g?"1":"0")+(""===b?"":"/"+b)};d.getViewLinkByHash=
function(a,c,g,b){g=d.isUnd(g)?!1:!!g;b=d.isUnd(b)?"":b;return"?/Raw/View/"+a+"/"+c+"/"+(g?"1":"0")+(""===b?"":"/"+b)};d.getViewThumbnailLinkByHash=function(a,c){return"?/Raw/Thumbnail/"+a+"/"+c};d.getFilestorageDownloadLinkByHash=function(a,c){return"?/Raw/FilesDownload/"+a+"/"+c};d.getFilestorageViewLinkByHash=function(a,c){return"?/Raw/FilesView/"+a+"/"+c};d.getFilestoragePublicViewLinkByHash=function(a){return"?/Window/Files/0/"+a};d.getFilestoragePublicDownloadLinkByHash=function(a){return"?/Raw/FilesPub/0/"+
a};d.daysInMonth=function(a,c){return 0<a&&13>a&&0<c?(new Date(c,a,0)).getDate():31};d.getAppPath=function(){return j.location.protocol+"//"+j.location.host+j.location.pathname};d.WindowOpener={_iDefaultRatio:0.8,_aOpenedWins:[],openMessage:function(a,c){if(a){var g=a.folder(),b=a.uid(),d="",d=c?e.Routing.buildHashFromArray([f.Screens.SingleCompose,"drafts",g,b]):e.Routing.buildHashFromArray([f.Screens.SingleMessageView,g,"msg"+b]);this.openTab(d)}},openTab:function(a){var c=null,c=j.open(a,"_blank");
c.focus();c.name=h.Accounts.currentId();this._aOpenedWins.push(c);return c},open:function(a,c,g){var g="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+(g?",menubar=yes":",menubar=no"),b=null,c=c.replace(/\W/g,""),g=g+this._getSizeParameters(),b=j.open(a,c,g);b.focus();b.name=h.Accounts.currentId();this._aOpenedWins.push(b);return b},closeAll:function(){for(var a=this._aOpenedWins.length,c=0,g=null;c<a;c++)g=this._aOpenedWins[c],g.closed||g.close();this._aOpenedWins=[]},_getSizeParameters:function(){var a=
j.screen.width,c=Math.ceil(a*this._iDefaultRatio),a=Math.ceil((a-c)/2),g=j.screen.height,b=Math.ceil(g*this._iDefaultRatio),g=Math.ceil((g-b)/2);return",width="+c+",height="+b+",top="+g+",left="+a}};d.moveCaretToEnd=function(a){var c;a.createTextRange?(a=a.createTextRange(),a.collapse(!1),a.select()):a.setSelectionRange&&(c=2*a.value.length,a.setSelectionRange(c,c))};d.delegateRun=function(a,c,g){a&&a[c]&&a[c].apply(a,_.isArray(g)?g:[])};d.strRepeat=function(a,c){return Array(c+1).join(a)};d.deferredUpdate=
function(a,c,g,b){!a.__interval&&c?(a.__state=!0,b(a,!0),a.__interval=j.setInterval(function(){a.__state||(b(a,!1),j.clearInterval(a.__interval),a.__interval=null)},g)):c||(a.__state=!1)};d.draggableMessages=function(){return i('<div class="draggable draggableMessages"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")};d.draggableContacts=function(){return i('<div class="draggable draggableContacts"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")};
d.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var a=i(document.activeElement);(a.is("input")||a.is("textarea"))&&document.activeElement.blur()}};d.uiDropHelperAnim=function(a,c){var g=c.helper.clone().appendTo("#pSevenHidden"),b=i(a.target).find(".animGoal"),b=b[0]?b.offset():i(a.target).offset();g.animate({left:b.left+"px",top:b.top+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){i(this).remove()})};d.inFocus=function(){var a=document&&
document.activeElement?document.activeElement.tagName:null,c=document&&document.activeElement?document.activeElement.contentEditable:null;return"INPUT"===a||"TEXTAREA"===a||"IFRAME"===a||"true"===c};d.removeSelection=function(){j.getSelection?j.getSelection().removeAllRanges():document.selection&&document.selection.empty()};d.getMonthNamesArray=function(){for(var a=d.i18n("DATETIME/MONTH_NAMES").split(" "),c=a.length;12>c;c++)a[c]="";return a};d.getPlural=function(a,c){var g=0,c=d.pInt(c);switch(a){case "Arabic":g=
0===c?0:1===c?1:2===c?2:3<=c%100&&10>=c%100?3:11<=c%100?4:5;break;case "Bulgarian":g=1===c?0:1;break;case "Chinese-Simplified":g=0;break;case "Chinese-Traditional":g=1===c?0:1;break;case "Czech":g=1===c?0:2<=c&&4>=c?1:2;break;case "Danish":g=1===c?0:1;break;case "Dutch":g=1===c?0:1;break;case "English":g=1===c?0:1;break;case "Estonian":g=1===c?0:1;break;case "Finish":g=1===c?0:1;break;case "French":g=1===c?0:1;break;case "German":g=1===c?0:1;break;case "Greek":g=1===c?0:1;break;case "Hebrew":g=1===
c?0:1;break;case "Hungarian":g=1===c?0:1;break;case "Italian":g=1===c?0:1;break;case "Japanese":g=0;break;case "Korean":g=0;break;case "Latvian":g=1===c%10&&11!==c%100?0:0!==c?1:2;break;case "Lithuanian":g=1===c%10&&11!==c%100?0:2<=c%10&&(10>c%100||20<=c%100)?1:2;break;case "Norwegian":g=1===c?0:1;break;case "Persian":g=0;break;case "Polish":g=1===c?0:2<=c%10&&4>=c%10&&(10>c%100||20<=c%100)?1:2;break;case "Portuguese-Brazil":g=1===c?0:1;break;case "Romanian":g=1===c?0:0===c||0<c%100&&20>c%100?1:2;
break;case "Russian":g=1===c%10&&11!==c%100?0:2<=c%10&&4>=c%10&&(10>c%100||20<=c%100)?1:2;break;case "Serbian":g=1===c%10&&11!==c%100?0:2<=c%10&&4>=c%10&&(10>c%100||20<=c%100)?1:2;break;case "Spanish":g=1===c?0:1;break;case "Swedish":g=1===c?0:1;break;case "Thai":g=0;break;case "Turkish":g=1===c?0:1;break;case "Ukrainian":g=1===c%10&&11!==c%100?0:2<=c%10&&4>=c%10&&(10>c%100||20<=c%100)?1:2;break;default:g=0}return g};d.getFileExtension=function(a){var c="",g=a.lastIndexOf(".");-1<g&&(c=a.substr(g+
1));return c};d.getFileNameWithoutExtension=function(a){var c=a,g=a.lastIndexOf(".");-1<g&&(c=a.substr(0,g));return c};d.defaultOptionsAfterRender=function(a,c){c&&(d.isUnd(c.disable)||b.applyBindingsToNode(a,{disable:c.disable},c))};d.getDateFormatForMoment=function(a){var c="MM/DD/YYYY";switch(a){case "MM/DD/YYYY":c="MM/DD/YYYY";break;case "DD/MM/YYYY":c="DD/MM/YYYY";break;case "DD Month YYYY":c="DD MMMM YYYY"}return c};d.getDateFormatForDatePicker=function(a){var c="mm/dd/yy";switch(a){case "MM/DD/YYYY":c=
"mm/dd/yy";break;case "DD/MM/YYYY":c="dd/mm/yy";break;case "DD Month YYYY":c="dd MM yy"}return c};d.getDateFormatsForSelector=function(){return _.map(h.App.DateFormats,function(a){switch(a){case "MM/DD/YYYY":return{name:d.i18n("DATETIME/DATEFORMAT_MMDDYYYY"),value:a};case "DD/MM/YYYY":return{name:d.i18n("DATETIME/DATEFORMAT_DDMMYYYY"),value:a};case "DD Month YYYY":return{name:d.i18n("DATETIME/DATEFORMAT_DDMONTHYYYY"),value:a};default:return{name:a,value:a}}})};d.getTitleForEvent=function(a){var a=
d.trim(a.replace(/[\n\r]/," ")),c=a.indexOf(" ",180);0<=c&&(a=a.substring(0,c)+"...");200<a.length&&(a=a.substring(0,200)+"...");return a};d.getFormattedPhone=function(a){var c={"+7":"8"},g=/#/g.test(a)?a.split("#")[1]:a.replace(/[()\s_\-]/g,""),b=(a+"").slice(0,2);return _.any(c,function(a,c){return c===b},this)?g.replace(b,c[b]):g.replace(/[+]/g,"")};var ia,tb=0;d.desktopNotify=function(a,c,g,b,d,e){if("show"===a){var a=null,h,g={body:g,icon:{phone:"skins/Default/images/logo.png"}[b]||!1};if(j.Notification&&
j.Notification.permission)switch(a=j.Notification,j.Notification.permission.toLowerCase()){case "granted":h=f.DesktopNotifications.Allowed;break;case "denied":h=f.DesktopNotifications.Denied;break;case "default":h=f.DesktopNotifications.NotAllowed}else j.webkitNotifications&&j.webkitNotifications.checkPermission&&(a=j.webkitNotifications,h=j.webkitNotifications.checkPermission());a&&h===f.DesktopNotifications.Allowed&&(ia&&ia.close(),ia=new j.Notification(c,g),ia.onclick=function(){d&&d();ia.close()},
ia.onshow=function(){},ia.onclose=function(){},ia.onerror=function(){},clearTimeout(tb),e&&(tb=setTimeout(function(){ia.close()},e)))}else"hide"===a&&ia&&ia.close()};d.isRTL=function(){return fa.hasClass("rtl")};E.prototype.iTimer=0;E.prototype.bResetCheckedOnClick=!1;E.prototype.bCheckOnSelect=!1;E.prototype.bUnselectOnCtrl=!1;E.prototype.bDisableMultiplySelection=!1;E.prototype.setBeforeSelectCallback=function(a){this.fBeforeSelectCallback=a||null};E.prototype.initOnApplyBindings=function(a,c,g,
d,e){i(document).on("keydown",this.onKeydownBinded);this.oListScope=d;this.oScrollScope=e;this.sActionSelector=a;this.sSelectabelSelector=c;this.sCheckboxSelector=g;var f=this,h=function(a,c){var g=0,b=0,d=null,e=!1,t=!1,v=[],h=!1,a=a?a:null;if(c&&c.shiftKey&&null!==a&&null!==f.oLast&&a!==f.oLast){v=f.list();h=a.checked();g=0;for(b=v.length;g<b;g++){d=v[g];e=!1;if(d===f.oLast||d===a)e=!0;e&&(t=!t);(t||e)&&d.checked(h)}}a&&(f.oLast=a)};i(this.oListScope).on("dblclick",a,function(a){var c=b.dataFor(this);
if(c&&a&&!a.ctrlKey&&!a.altKey&&!a.shiftKey)f.onDblClick(c)});if(qb)i(this.oListScope).on("touchstart",a,function(a){if(a){var c=a.timeStamp,g=i(this).data("lastTouch")||c,g=c-g,b=a.originalEvent&&a.originalEvent.touches?a.originalEvent.touches.length:0;i(this).data("lastTouch",c);if(g&&!(250<g||1<b))a.preventDefault(),i(this).trigger("dblclick")}});i(this.oListScope).on("click",a,function(a){var c=!0,g=null,d=b.dataFor(this);if(d&&a&&(a.shiftKey?(c=!1,f.bDisableMultiplySelection||(null===f.oLast&&
(f.oLast=d),d.checked(!d.checked()),h(d,a))):a.ctrlKey&&(c=!1,f.bDisableMultiplySelection||(f.oLast=d,(g=f.itemSelected())&&(!g.checked()&&!d.checked())&&g.checked(!0),f.bUnselectOnCtrl&&d===f.itemSelected()?(d.checked(!d.selected()),f.itemSelected(null)):d.checked(!d.checked()))),c))f.onSelect(d)});i(this.oListScope).on("click",g,function(a){var c=b.dataFor(this);c&&(a&&!f.bDisableMultiplySelection)&&(a.shiftKey?(null===f.oLast&&(f.oLast=c),h(c,a)):f.oLast=c);a&&a.stopPropagation&&a.stopPropagation()});
i(this.oListScope).on("dblclick",g,function(a){a&&a.stopPropagation&&a.stopPropagation()})};E.prototype.getResultSelection=function(a,c){var g=this,b=!1,e=!1,h=null,i=this.iFactor,j=!!this.multiplyLineFactor,l=0,k=0,m=[];if(!a&&-1<d.inArray(c,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,f.Key.PageUp,f.Key.PageDown,f.Key.Home,f.Key.End]))(m=this.list())&&0<m.length&&(-1<d.inArray(c,[this.KeyDown,this.KeyRight,f.Key.PageUp,f.Key.Home])?h=m[0]:-1<d.inArray(c,[this.KeyUp,this.KeyLeft,f.Key.PageDown,
f.Key.End])&&(h=m[m.length-1]));else if(a&&(k=(m=this.list())?m.length:0,0<k))if(f.Key.Home===c||f.Key.PageUp===c||f.Key.End===c||f.Key.PageDown===c||j&&(f.Key.Left===c||f.Key.Right===c)||!j&&(f.Key.Up===c||f.Key.Down===c))_.each(m,function(d){if(!b)switch(c){case g.KeyUp:case g.KeyLeft:a===d?b=!0:h=d;break;case f.Key.Home:case f.Key.PageUp:h=d;b=!0;break;case g.KeyDown:case g.KeyRight:e?(h=d,b=!0):a===d&&(e=!0);break;case f.Key.End:case f.Key.PageDown:h=d}});else if(j&&this.KeyDown===c)for(;l<k;l++){if(a===
m[l]){l+=i;k-1<l&&(l-=i);h=m[l];break}}else if(j&&this.KeyUp===c)for(l=k;0<=l;l--)if(a===m[l]){l-=i;0>l&&(l+=i);h=m[l];break}return h};E.prototype.shiftClickResult=function(a,c,g){if(c){var b=!!this.multiplyLineFactor,e=!1,h=!1;if(-1<d.inArray(g,b?[f.Key.Left,f.Key.Right]:[f.Key.Up,f.Key.Down]))c.checked(!c.checked());else if(-1<d.inArray(g,b?[f.Key.Up,f.Key.Down,f.Key.PageUp,f.Key.PageDown,f.Key.Home,f.Key.End]:[f.Key.Left,f.Key.Right,f.Key.PageUp,f.Key.PageDown,f.Key.Home,f.Key.End]))h=!c.checked(),
_.each(this.list(),function(g){var b=!1;if(g===a||c===g)e=!e,b=!0;(e||b)&&g.checked(h)}),b&&(a&&(g===f.Key.Up||g===f.Key.Down))&&a.checked(!a.checked())}};E.prototype.clickNewSelectPosition=function(a,c){var g=this,b=0,e=null,h=this.itemSelected();(e=this.getResultSelection(h,a))?(c&&this.shiftClickResult(e,h,a),e&&this.fBeforeSelectCallback?this.fBeforeSelectCallback(e,function(a){a&&(g.itemSelected(e),b=0===g.iTimer?50:150,0!==g.iTimer&&j.clearTimeout(g.iTimer),g.iTimer=j.setTimeout(function(){g.iTimer=
0;g.onSelect(e,!1)},b))}):(this.itemSelected(e),b=0===this.iTimer?50:150,0!==this.iTimer&&j.clearTimeout(this.iTimer),this.iTimer=j.setTimeout(function(){g.iTimer=0;g.onSelect(e)},b)),this.scrollToSelected()):h&&c&&-1<d.inArray(a,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,f.Key.PageUp,f.Key.PageDown,f.Key.Home,f.Key.End])&&h.checked(!h.checked())};E.prototype.onKeydown=function(a){var c=!0,g=0;this.useKeyboardKeys()&&(a&&!d.inFocus())&&(g=a.keyCode,!a.ctrlKey&&(this.KeyUp===g||this.KeyDown===
g||this.KeyLeft===g||this.KeyRight===g||f.Key.PageUp===g||f.Key.PageDown===g||f.Key.Home===g||f.Key.End===g)?(this.clickNewSelectPosition(g,a.shiftKey),c=!1):f.Key.Del===g&&!a.ctrlKey&&!a.shiftKey?0<this.list().length&&(this.onDelete(),c=!1):f.Key.Enter===g?0<this.list().length&&(this.onEnter(this.itemSelected()),c=!1):a.ctrlKey&&f.Key.a===g&&(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),c=!1));return c};E.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected());
this.itemSelected(null);this.listChecked(!1)};E.prototype.onEnter=function(a){var c=this;a&&this.fBeforeSelectCallback?this.fBeforeSelectCallback(a,function(g){g&&(c.itemSelected(a),c.fEnterCallback.call(this,a))}):(this.itemSelected(a),this.fEnterCallback.call(this,a))};E.prototype.selectionFunc=function(a){this.itemSelected(null);this.bResetCheckedOnClick&&this.listChecked(!1);this.itemSelected(a);this.fSelectCallback.call(this,a)};E.prototype.onSelect=function(a,c){c=d.isUnd(c)?!0:!!c;if(this.fBeforeSelectCallback&&
c){var g=this;this.fBeforeSelectCallback(a,function(c){c&&g.selectionFunc(a)})}else this.selectionFunc(a)};E.prototype.onDblClick=function(a){this.fDblClickCallback.call(this,a)};E.prototype.koCheckAll=function(){return b.computed({read:this.checkAll,write:this.checkAll,owner:this})};E.prototype.koCheckAllIncomplete=function(){return b.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})};E.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;
var a=i(this.sSelectabelSelector,this.oScrollScope),c=a.position(),g=this.oListScope.height(),a=a.outerHeight();return c&&(0>c.top||c.top+a>g)?(0>c.top?this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+c.top-20):this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+c.top-g+a+20),!0):!1};var aa=jQuery;aa.fn.splitter=function(a){a=a||{};return this.each(function(){var c=!1,g=a.name,b=function(c){h((q?l._overallWidth-c[s.eventPos]:c[s.eventPos])+s._posSplit);d.isFunc(a.resizeFunc)&&a.resizeFunc()},
f=function xb(){m.removeClass(s.activeClass);aa("body").attr({unselectable:"off"}).removeClass("unselectable");g&&e.Storage.setData(g+"ResizerWidth",k.get(0)[s.pxSplit]);aa(document).unbind("mousemove",b).unbind("mouseup",xb);d.isFunc(a.resizeFunc)&&a.resizeFunc()},h=function(a){a=j.Math.max(k.get(0)._min,l._overallWidth-k.get(1)._max,j.Math.min(a,k.get(0)._max,l._overallWidth-k.get(1)._min));k.get(0).$.css(s.split,a);k.get(1).$.css(s.split,l._overallWidth-a);e.browser.ie8AndBelow||k.trigger("resize")},
i=function(a,c){for(var g=0,b=1;b<arguments.length;b++)g+=j.Math.max(j.parseInt(a.css(arguments[b]),10)||0,0);return g},s=aa.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",
side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[(a.splitHorizontal?"h":a.splitVertical?"v":a.type)||"v"],a),l=aa(this).css({position:"relative"}),k=aa(">*:not(css3pie)",l).each(function(){this.$=aa(this)}),m=aa(".resize_handler",k.get(0)).attr({unselectable:"on"}).bind("mousedown",function(a){c=!0;m.addClass(s.activeClass);s._posSplit=-((q?l._overallWidth-a[s.eventPos]:a[s.eventPos])-k.get(0)[s.pxSplit]);aa("body").attr({unselectable:"on"}).addClass("unselectable");
aa(document).bind("mousemove",b).bind("mouseup",f)}),q="rtl"===l.css("direction");k.get(0)._paneName=s.side1;k.get(1)._paneName=s.side2;k.each(function(){this._min=s["min"+this._paneName]||i(this.$,"min-"+s.split);this._max=s["max"+this._paneName]||i(this.$,"max-"+s.split)||9999;this._init=!0===s["size"+this._paneName]?j.parseInt(aa.css(this,s.split),10):s["size"+this._paneName]});var o=0,o=g?e.Storage.getData(g+"ResizerWidth")||k.get(0)._init:k.get(0)._init;isNaN(k.get(1)._init)||(o=l[0][s.pxSplit]-
k.get(1)._init);isNaN(o)&&(o=l[0][s.pxSplit],o=j.Math.round(o/k.length));s.resizeToWidth&&!e.browser.ie8AndBelow&&aa(j).bind("resize",function(a){a.target===this&&l.trigger("resize")});var p=0,r={},u={};l.bind("resize",function(a,g,b){var d=a.target.className+"_"+b;c&&(r={});if(a.target===this){l._overallWidth=l[0][s.pxSplit];if(!(l._overallWidth<=0)){p=!s.sizeRight&&!s.sizeBottom?k.get(0)[s.pxSplit]:l._overallWidth-k.get(1)[s.pxSplit];if(isNaN(g))g=p;else if(b){c=false;if(r[d]){g=r[d];r[d]=null}else{if(g===
p){r[d]=null;g=u[d]}else r[d]=u[d]=p;_.each(r,function(a,c){c!==d&&(r[c]=null)})}}h(g)}}}).trigger("resize",[o])})};xa.prototype.openComposeMessage=function(a){e.Routing.setHash(e.Links.composeWithToField(a))};xa.prototype.showLoading=function(a){e.Screens.showLoading(a)};xa.prototype.hideLoading=function(){e.Screens.hideLoading()};xa.prototype.showReport=function(a,c){e.Screens.showReport(a,c)};xa.prototype.showError=function(a,c,g){e.Screens.showError(a,c,g)};xa.prototype.hideError=function(){e.Screens.hideError()};
xa.prototype.showErrorByCode=function(a,c){switch(a){case f.Errors.AuthError:this.showError(d.i18n("WARNING/LOGIN_PASS_INCORRECT"));break;case f.Errors.DemoLimitations:this.showError(d.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED"));break;case f.Errors.Recaptcha:this.showError(d.i18n("WARNING/CAPTCHA_IS_INCORRECT"));break;case f.Errors.CanNotGetMessage:this.showError(d.i18n("MESSAGE/ERROR_MESSAGE_DELETED"));break;case f.Errors.CanNotChangePassword:this.showError(d.i18n("WARNING/UNABLE_CHANGE_PASSWORD"));
break;case f.Errors.AccountOldPasswordNotCorrect:this.showError(d.i18n("WARNING/CURRENT_PASSWORD_NOT_CORRECT"));break;case f.Errors.FetcherIncServerNotAvailable:this.showError(d.i18n("WARNING/FETCHER_SAVE_ERROR"));break;case f.Errors.FetcherLoginNotCorrect:this.showError(d.i18n("WARNING/FETCHER_SAVE_ERROR"));break;case f.Errors.HelpdeskUserNotExists:this.showError(d.i18n("HELPDESK/ERROR_FORGOT_NO_ACCOUNT"));break;case f.Errors.MailServerError:this.showError(d.i18n("WARNING/CANT_CONNECT_TO_SERVER"));
break;case f.Errors.DataTransferFailed:this.showError(d.i18n("WARNING/DATA_TRANSFER_FAILED"));break;case f.Errors.NotDisplayedError:break;default:c&&0<c.length&&this.showError(c)}};ma.addScreenToHeader=function(a,c,g,b,d){e.addScreenToHeader(a,c,g,b,d)};ma.aSettingsTabs=[];ma.addSettingsTab=function(a){f.SettingsTab[a.TabName]=a.TabName;ma.aSettingsTabs.push(a)};ma.getPluginsSettingsTabs=function(){return ma.aSettingsTabs};Ta.prototype.setData=function(a,c){Data.setVar(a,c)};Ta.prototype.removeData=
function(a){Data.setVar(a,"")};Ta.prototype.getData=function(a){return Data.getVar(a)};Ta.prototype.hasData=function(a){return Data.hasVar(a)};N.prototype.init=function(){var a=this;i.ajaxSettings.cache=!0;this.provider=new ya(function(c){a.voiceApp(c)})};N.prototype.log=function(a){j.console&&j.console.log&&j.console.log("*************************************************** "+a)};N.prototype.call=function(a){this.provider.call(a)};N.prototype.answer=function(){this.provider.answer();this.hideAll()};
N.prototype.hangup=function(){this.provider.hangup();this.hideAll()};N.prototype.hideAll=function(){e.Screens.hidePopup(ta);e.desktopNotify("hide")};N.prototype.reconnect=function(a,c){var g=this,b=a;clearInterval(this.interval);this.interval=setInterval(function(){0<b?g.phoneReport(d.i18n("Reconnect in "+b+" seconds")):0>=b&&(g.phoneReport(d.i18n("Connecting...")),g.reconnectStop(),b=a,c());b--},1E3)};N.prototype.reconnectStop=function(){clearInterval(this.interval)};N.prototype.timer=function(){clearInterval(this.interval)};
N.prototype.timerStop=function(){clearInterval(this.interval)};N.prototype.showError=function(a){1===d.pInt(a)&&(this.notShowErrorMore(!0),e.Api.showError(d.i18n("PHONE/ERROR_SERVER_UNAVAILABLE"),!1,!0))};N.prototype.hideError=function(){e.Api.hideError();this.notShowErrorMore(!1)};N.prototype.showPopup=function(a){e.Screens.showPopup(ta,[a])};N.prototype.hidePopup=function(){e.Screens.hidePopup(ta)};ja.prototype.init=function(){var a=this;i.getScript("static/js/sipml.js",function(c,g){"success"===
g&&(a.voiceApp(!0),SIPml.setDebugLevel("fatal"),SIPml.init(a.createStackBinded,a.createStackErrorBinded))})};ja.prototype.setConfigs=function(){this.stackConf({realm:h.User.VoiceRealm,impi:h.User.VoiceImpi,impu:"sip:"+h.User.VoiceImpi+"@"+h.User.VoiceRealm,password:h.User.VoicePassword,enable_rtcweb_breaker:!0,websocket_proxy_url:h.User.VoiceWebsocketProxyUrl,events_listener:{events:"*",listener:this.eventSessionBinded}});this.registerConf({audio_remote:this.audioRemote,expires:3600,events_listener:{events:"*",
listener:this.eventSessionBinded},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null},{name:"language",value:'"en,fr"'}]});this.hangupConf({events_listener:{events:"*",listener:this.eventSessionBinded}})};ja.prototype.createStackError=function(){this.log("Failed to initialize the engine")};ja.prototype.log=function(a){j.console&&j.console.log&&j.console.log("*************************************************** "+a)};ja.prototype.createStack=function(){this.stack(new SIPml.Stack(this.stackConf()));
this.stack().start()};ja.prototype.register=function(){this.registerSession(this.stack().newSession("register",this.registerConf()));this.registerSession().register()};ja.prototype.call=function(a){this.isStarted()?(this.action("outgoing"),this.callSession(this.stack().newSession("call-audio",this.registerConf())),this.callSession().call(a),this.log(this.callSession().getRemoteFriendlyName())):(this.hasFatalError(!1),this.createStack())};ja.prototype.answer=function(){this.callSession()&&this.callSession().accept(this.registerConf())};
ja.prototype.hangup=function(){this.callSession()&&this.callSession().hangup(this.hangupConf())};ja.prototype.eventSession=function(a){this.log(a.type+" ("+a.description+")");switch(a.type){case "started":this.phone.hideError();this.isStarted(!0);this.register();break;case "stopping":case "stopped":this.isStarted(!1);this.createStack();break;case "failed_to_start":this.isStarted(!1);this.phone.reconnect(30,this.createStack.bind(this));break;case "connected":this.phoneReport(d.i18n("PHONE/CONNECTED"));
"In call"===a.description&&e.desktopNotify("hide");break;case "terminating":this.phoneReport(d.i18n("PHONE/CALL_TERMINATING"));_.delay(_.bind(function(){this.action("")},this),1500);break;case "terminated":this.phoneReport(d.i18n("PHONE/TERMINATED"));"Disconnected"===a.description&&this.createStack();break;case "i_ao_request":this.phoneReport(d.i18n("PHONE/RINGING"));break;case "i_new_call":this.callSession(a.newSession);this.action("incoming");this.phone.showPopup({Action:f.PhoneAction.Incoming,
PhoneNumber:this.callSession().getRemoteFriendlyName()});break;case "m_permission_accepted":"incoming"===this.action()?this.phoneReport(d.i18n("PHONE/INCOMING_CALL_FROM")+" "+this.callSession().getRemoteFriendlyName()):this.phoneReport(d.i18n("PHONE/CALL_IN_PROGRESS"))}};V.prototype.init=function(){var a=this;i.getScript("static/js/swfobject.js",function(c,g){"success"===g&&(a.voiceApp(!0),swfobject.embedSWF("static/freeswitch.swf","flash","214","137","9.0.0","expressInstall.swf",{rtmp_url:"rtmp://217.199.220.26/phone"},
{allowScriptAccess:"always",bgcolor:"#ece9e0"},[],!1),a.callbacks())})};V.prototype.log=function(a){j.console&&j.console.log&&j.console.log(a)};V.prototype.showPrivacy=function(){this.phone.showPopup({Action:f.PhoneAction.Settings,Callback:this.launchFlash.bind(this)});var a=i("#fake_flash"),c=a.offset(),a=a.width();this.jqFlash.css("left",c.left+a/2-107);this.jqFlash.css("top",c.top);this.jqFlash.css("visibility","visible");this.flash.showPrivacy()};V.prototype.checkMic=function(){return this.flash.isMuted()};
V.prototype.login=function(a,c){this.flash.login(a,c)};V.prototype.newCall=function(){};V.prototype.call=function(){this.flash.makeCall("sip:7002@217.199.220.24","7003@217.199.220.26",[])};V.prototype.answer=function(a){this.flash.answer(a)};V.prototype.hangup=function(a){this.flash.hangup(a)};V.prototype.addCall=function(){};V.prototype.launchFlash=function(){this.jqFlash.css("top","-200px")};V.prototype.callbacks=function(){var a=this;j.onInit=function(){a.log("**************** onInit");a.initStatus(!0)};
j.onConnected=function(c){a.log("**************** onConnected ("+c+")");a.connectStatus(!0);a.sessionid(c);a.jqFlash=i("#flash");a.flash=a.jqFlash[0];a.checkMic()&&a.showPrivacy();a.login("7003@217.199.220.26","7003voippassword")};j.onDisconnected=function(){a.log("**************** onDisconnected")};j.onEvent=function(c){a.log("**************** onEvent ("+c+")")};j.onLogin=function(c,g,b){a.log("**************** onLogin ("+c+", "+g+", "+b+")")};j.onLogout=function(c,g){a.log("**************** onLogout ("+
c+", "+g+")")};j.onMakeCall=function(c,g,b){a.log("**************** onMakeCall ("+c+", "+g+", "+b+")")};j.onHangup=function(c,g){a.log("**************** onHangup ("+c+", "+g+")")};j.onIncomingCall=function(c,g,b,d,e){a.log("**************** onIncomingCall ("+c+", "+g+", "+b+", "+d+", "+e+")");a.addCall(c,g,b)};j.onDisplayUpdate=function(c,g,b){a.log("**************** onDisplayUpdate ("+c+", "+g+", "+b+")")};j.onCallState=function(c,g){a.log("**************** onCallState ("+c+", "+g+")");a.callState(g)};
j.onDebug=function(c){a.log("**************** onDebug ("+c+")")};j.onAttach=function(c){a.log("**************** onAttach ("+c+")")}};ya.prototype.init=function(){e.Ajax.send({Action:"GetTwilioToken"},this.onTokenResponse,this)};ya.prototype.log=function(){};ya.prototype.onTokenResponse=function(a){var c=this;a&&a.Result&&(i.ajaxSettings.cache=!0,i.getScript("//static.twilio.com/libs/twiliojs/1.1/twilio.min.js",function(g,b){"success"===b&&c.setupDevice(a.Result)}))};ya.prototype.setupDevice=function(a){var c=
this;this.device=Twilio.Device;this.device.setup(a,{});this.device.ready(function(a){c.log("**************** ready ",a);c.fCallback(!0);e.Api.showReport(d.i18n("Twilio ready"));c.phone.action("standby")});this.device.offline(function(a){c.log("**************** offline ",a);c.phone.action("offline");e.Api.showReport("Offline")});this.device.error(function(a){c.log("**************** error ",a);e.Api.showError(a.message,!1,!0)});this.device.connect(function(a){c.log("**************** connect ",a);c.phone.action("outgoing");
e.Api.showReport(d.i18n("Connected"))});this.device.disconnect(function(a){c.log("**************** disconnect ",a);c.phone.action("connection_end");e.Api.showReport("Call ended")});this.device.incoming(function(a){c.log("**************** incoming ",a);c.phone.action("incoming");c.connection=a;c.phoneReport(d.i18n("PHONE/INCOMING_CALL_FROM")+" "+a.parameters.From);c.phone.showPopup({Action:f.PhoneAction.Incoming,PhoneNumber:a.parameters.From})});this.device.cancel(function(a){c.log("**************** cancel ",
a)});this.device.presence(function(a){c.log("**************** presence ",a)})};ya.prototype.call=function(a){var c=this;this.connection=this.device.connect({PhoneNumber:a});_.delay(function(){c.connection.disconnect()},1E4)};ya.prototype.answer=function(){this.phone.action("connection_in");this.phoneReport("Incoming: "+this.connection.parameters.From);this.connection.accept()};ya.prototype.hangup=function(){"pending"===this.connection.status()?this.connection.reject():this.connection.disconnect()};
R.prototype.onShow=function(a,c,g,b){this.alertDesc(a);this.closeCallback=c||null;this.title(g||"");this.okButtonText(b||d.i18n("MAIN/BUTTON_OK"))};R.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"};R.prototype.onEnterHandler=function(){this.close()};R.prototype.close=function(){d.isFunc(this.closeCallback)&&this.closeCallback();this.closeCommand()};G.prototype.onShow=function(a,c,g,b,e){this.title(g||"");this.okButtonText(b||d.i18n("MAIN/BUTTON_OK"));this.cancelButtonText(e||
d.i18n("MAIN/BUTTON_CANCEL"));d.isFunc(c)&&(this.fConfirmCallback=c,this.confirmDesc(a))};G.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"};G.prototype.onEnterHandler=function(){this.yesClick()};G.prototype.yesClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!0);this.closeCommand()};G.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1);this.closeCommand()};Da.prototype.onShow=function(){this.friendlyNameFocus(!0);this.init()};Da.prototype.popupTemplate=
function(){return"Popups_AccountCreatePopupViewModel"};Da.prototype.init=function(){this.friendlyName("");this.email("");this.incomingMailLogin("");this.incLoginFocused(!1);this.incomingMailPassword("");this.incomingMailPort(143);this.incomingMailServer("");this.outgoingMailLogin("");this.outgoingMailPassword("");this.outgoingMailPort(25);this.outgoingMailServer("");this.outServerFocused(!1);this.useSmtpAuthentication(!0)};Da.prototype.onResponseAddAccount=function(a,c){this.loading(!1);if(a.Result){var g=
new U,b=parseInt(a.Result,10);g.init(b,c.Email,c.FriendlyName);g.updateExtended(c);h.Accounts.addAccount(g);h.Accounts.changeEditedAccount(b);this.closeCommand();this.init()}else e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/CREATING_ACCOUNT_ERROR"))};Da.prototype.onSaveClick=function(){var a={Action:"AccountCreate",AccountID:this.editedAccountId(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:this.incomingMailPassword(),IncomingMailServer:this.incomingMailServer(),
IncomingMailPort:parseInt(this.incomingMailPort(),10),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPassword:this.outgoingMailPassword(),OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.useSmtpAuthentication()?2:0};this.loading(!0);e.Ajax.send(a,this.onResponseAddAccount,this)};Da.prototype.onCancelClick=function(){this.closeCommand()};za.prototype.popupTemplate=function(){return"Popups_FetcherAddPopupViewModel"};za.prototype.init=
function(){this.incomingMailServer("");this.incomingMailPort(110);this.incomingMailLogin("");this.incomingMailPassword("");this.folder("");this.outgoingMailServer("");this.outgoingMailPort(25);this.leaveMessagesOnServer(!0)};za.prototype.onSaveClick=function(){if(this.isEmptyRequiredFields())e.Api.showErrorByCode(0,d.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherCreate",AccountID:this.defaultAccountId(),Folder:this.folder(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:parseInt(this.incomingMailPort(),
10),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:""===this.incomingMailPassword()?"******":this.incomingMailPassword(),LeaveMessagesOnServer:this.leaveMessagesOnServer()?1:0};this.loading(!0);e.Ajax.send(a,this.onAddFetcherResponse,this)}};za.prototype.onAddFetcherResponse=function(a){this.loading(!1);a.Result?(e.populateFetchers(),this.closeCommand()):e.Api.showErrorByCode(a.ErrorCode)};za.prototype.onCancelClick=function(){this.closeCommand()};za.prototype.onShow=function(){this.init()};
za.prototype.isEmptyRequiredFields=function(){switch(""){case this.incomingMailServer():return this.serverIsSelected(!0),!0;case this.incomingMailLogin():return this.loginIsSelected(!0),!0;case this.incomingMailPassword():return this.passwordIsSelected(!0),!0;default:return!1}};Ma.prototype.onShow=function(){var a=e.MailCache.editedFolderList();this.sSentFolderOld=a.sentFolderFullName();this.sDraftFolderOld=a.draftsFolderFullName();this.sSpamFolderOld=a.spamFolderFullName();this.sTrashFolderOld=a.trashFolderFullName();
this.sentFolderFullName(this.sSentFolderOld);this.draftsFolderFullName(this.sDraftFolderOld);this.spamFolderFullName(this.sSpamFolderOld);this.trashFolderFullName(this.sTrashFolderOld);this.folders(a)};Ma.prototype.popupTemplate=function(){return"Popups_FolderSystemPopupViewModel"};Ma.prototype.onResponseSetupSystemFolders=function(a){a&&!1!==a.Result&&e.MailCache.getFolderList(h.Accounts.editedId())};Ma.prototype.onOKClick=function(){var a=this.folders(),a={Action:"SetupSystemFolders",AccountID:h.Accounts.editedId(),
Sent:a.sentFolderFullName(),Drafts:a.draftsFolderFullName(),Trash:a.trashFolderFullName(),Spam:a.spamFolderFullName()};e.Ajax.send(a,this.onResponseSetupSystemFolders,this);this.closeCommand()};Ma.prototype.onCancelClick=function(){var a=this.folders();a.sentFolderFullName(this.sSentFolderOld);a.draftsFolderFullName(this.sDraftFolderOld);a.spamFolderFullName(this.sSpamFolderOld);a.trashFolderFullName(this.sTrashFolderOld);this.closeCommand()};Na.prototype.onShow=function(){this.folderNameFocus(!0)};
Na.prototype.popupTemplate=function(){return"Popups_FolderCreatePopupViewModel"};Na.prototype.onResponseFolderCreate=function(a){this.loading(!1);a.Result?(this.folderName(""),this.parentFolder(""),e.MailCache.getFolderList(h.Accounts.editedId()),this.closeCommand()):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ACCOUNT_FOLDERS_CANT_CREATE_FOLDER"))};Na.prototype.onOKClick=function(){var a=""===this.parentFolder()?this.namespace():this.parentFolder(),a={Action:"FolderCreate",AccountID:h.Accounts.editedId(),
FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:a,Delimiter:this.folders().delimiter()};this.loading(!0);e.Ajax.send(a,this.onResponseFolderCreate,this)};Na.prototype.onCancelClick=function(){this.closeCommand()};Ea.prototype.onShow=function(a){this.isHelpdesk(a);this.init()};Ea.prototype.popupTemplate=function(){return"Popups_ChangePasswordPopupViewModel"};Ea.prototype.init=function(){this.currentPassword("");this.newPassword("");this.confirmPassword("")};Ea.prototype.onResponse=function(a){!1===
a.Result?e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ACCOUNT_PROPERTIES_NEW_PASSWORD_UPDATE_ERROR")):(e.Api.showReport(d.i18n("SETTINGS/ACCOUNT_PROPERTIES_CHANGE_PASSWORD_SUCCESS")),this.closeCommand(),this.init())};Ea.prototype.onOKClick=function(){var a=null;this.confirmPassword()!==this.newPassword()?e.Api.showError(d.i18n("WARNING/PASSWORDS_DO_NOT_MATCH")):this.isHelpdesk()?(a={Action:"HelpdeskUpdateUserPassword",CurrentPassword:this.currentPassword(),NewPassword:this.newPassword()},e.Ajax.sendExt(a,
this.onResponse,this)):(a={Action:"UpdateAccountPassword",AccountID:h.Accounts.editedId(),CurrentIncomingMailPassword:this.currentPassword(),NewIncomingMailPassword:this.newPassword()},e.Ajax.send(a,this.onResponse,this))};Ea.prototype.onCancelClick=function(){this.closeCommand()};Ua.prototype.onShow=function(a){this.folderNameFocus(!0);d.isFunc(a)&&(this.fCallback=a)};Ua.prototype.popupTemplate=function(){return"Popups_FileStorageFolderCreatePopupViewModel"};Ua.prototype.onOKClick=function(){this.fCallback&&
(this.fCallback(this.folderName()),this.folderName(""));this.closeCommand()};Ua.prototype.onCancelClick=function(){this.closeCommand()};Va.prototype.onShow=function(a,c){this.item=a;this.name=this.item.nameForEdit;this.nameFocus(!0);d.isFunc(c)&&(this.fCallback=c)};Va.prototype.popupTemplate=function(){return"Popups_FileStorageRenamePopupViewModel"};Va.prototype.onOKClick=function(){this.fCallback&&this.fCallback(this.item);this.closeCommand()};Va.prototype.onCancelClick=function(){this.closeCommand()};
Aa.prototype.onShow=function(a){this.item=a;this.pub("");e.Ajax.send({Action:"FilesMin",Account:h.Accounts.defaultId(),Type:a.storageType(),Path:a.path(),Name:a.name(),Size:a.size()},this.onFilesMinResponse,this)};Aa.prototype.onFilesMinResponse=function(a){if(a.Result){var c=h.App.ServerUseUrlRewrite?"share/":"?/Min/Share/";this.pub(d.getAppPath()+c+a.Result);this.pubFocus(!0);this.item.shared(!0)}};Aa.prototype.popupTemplate=function(){return"Popups_FileStorageSharePopupViewModel"};Aa.prototype.onOKClick=
function(){this.closeCommand()};Aa.prototype.onFilesMinDeleteResponse=function(){this.closeCommand()};Aa.prototype.onCancelSharingClick=function(){this.item&&(e.Ajax.send({Action:"FilesMinDelete",Account:h.Accounts.defaultId(),Type:this.item.storageType(),Path:this.item.path(),Name:this.item.name()},this.onFilesMinDeleteResponse,this),this.item.shared(!1))};Fa.prototype.clearFields=function(){this.calendarName("");this.calendarDescription("");this.selectedColor(this.colors[0]);this.calendarId(null)};
Fa.prototype.onShow=function(a,c,g){this.clearFields();d.isFunc(a)&&(this.fCallback=a);d.isUnd(c)||(this.colors(c),this.selectedColor(c[0]));d.isUnd(g)||(this.calendarName(g.name?g.name():""),this.calendarDescription(g.description?g.description():""),this.selectedColor(g.color?g.color():""),this.calendarId(g.id?g.id:null))};Fa.prototype.popupTemplate=function(){return"Popups_CalendarCreatePopupViewModel"};Fa.prototype.onSaveClick=function(){""===this.calendarName()?e.Screens.showPopup(R,[d.i18n("CALENDAR/WARNING_BLANK_CALENDAR_NAME")]):
(this.fCallback&&(this.fCallback(this.calendarName(),this.calendarDescription(),this.selectedColor(),this.calendarId()),this.clearFields()),this.closeCommand())};Fa.prototype.onCancelClick=function(){this.closeCommand()};ba.prototype.onShow=function(a,c){d.isFunc(a)&&(this.fCallback=a);d.isUnd(c)||(this.selectedColor(c.color()),this.calendarId(c.id),this.calendarUrl(c.davUrl()+c.url()),this.exportUrl(c.exportUrl()),this.icsLink(c.davUrl()+c.url()+"?export"),this.isPublic(c.isPublic()),this.shares(c.shares().slice(0)),
this.oldShares(c.shares().slice(0)),this.owner(c.owner()))};ba.prototype.popupTemplate=function(){return"Popups_CalendarSharePopupViewModel"};ba.prototype.onSaveClick=function(){this.fCallback&&(this.addShare(),this.fCallback(this.calendarId(),this.isPublic(),this.shares()));this.closePopup()};ba.prototype.onCancelClick=function(){this.shares(this.oldShares());this.closePopup()};ba.prototype.closePopup=function(){this.cleanAll();this.closeCommand()};ba.prototype.cleanAll=function(){this.newShare("");
this.newShareAccess(2);this.shareAutocompleteItem(null);this.canAdd(!1)};ba.prototype.addShare=function(){var a=this.shareAutocompleteItem()?this.shareAutocompleteItem().email:this.newShare();this.canAdd()?(this.shares.push({name:this.shareAutocompleteItem()?this.shareAutocompleteItem().name:"",email:a,access:this.newShareAccess()}),this.cleanAll()):(this.whomAnimate(a),this.recivedAnim(!0))};ba.prototype.removeShare=function(a){this.shares.remove(a)};ba.prototype.autocompleteCallback=function(a,
c){var g={Action:"ContactSuggestions",Search:a,GlobalOnly:"1"};this.shareAutocompleteItem(null);a=d.trim(a);""!==a?e.Ajax.send(g,function(a){var g=[];a&&(a.Result&&a.Result&&a.Result.List)&&(g=_.map(a.Result.List,function(a){return a&&a.Email&&a.Email!==this.owner()?a.Name&&0<d.trim(a.Name).length?{value:'"'+a.Name+'" <'+a.Email+">",name:a.Name,email:a.Email}:{value:a.Email,name:"",email:a.Email}:null},this),g=_.compact(g),this.newShareList(g),this.setGlobal(this.newShare(),g));c(g)},this):c([])};
ba.prototype.setGlobal=function(a,c){var g=_.any(c,function(c){return c.email===a},this),b=_.any(this.shares(),function(c){return c.email===a},this);this.canAdd(g&&!b)};$a.prototype.onShow=function(a,c){d.isFunc(a)&&(this.fCallback=a);d.isUnd(c)||(this.selectedColor(c.color()),this.calendarId(c.id),this.calendarUrl(c.davUrl()+c.url()),this.exportUrl(c.exportUrl()),this.icsLink(c.davUrl()+c.url()+"?export"),this.isPublic(c.isPublic()),this.pubUrl(c.pubUrl()),this.exportUrl(c.exportUrl()))};$a.prototype.popupTemplate=
function(){return"Popups_CalendarGetLinkPopupViewModel"};$a.prototype.onCancelClick=function(){this.fCallback&&this.fCallback(this.calendarId(),this.isPublic());this.closeCommand()};o.prototype.createDatePickerObject=function(a,c){i(a).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:d.getMonthNamesArray(),dayNamesMin:d.i18n("DATETIME/DAY_NAMES_MIN").split(" "),firstDay:h.User.CalendarWeekStartsOn,showOn:"both",buttonText:"",buttonImage:"skins/Default/images/calendar-icon.png",buttonImageOnly:!0,
dateFormat:this.dateFormatDatePicker,onSelect:c});i(a).mousedown(function(){i("#ui-datepicker-div").toggle()})};o.prototype.initializeDatePickers=function(){this.createDatePickerObject(this.startDom(),this.selectStartDate.bind(this));this.createDatePickerObject(this.endDom(),this.selectEndDate.bind(this));this.createDatePickerObject(this.repeatEndDom(),d.emptyFunction())};o.prototype.onShow=function(a){var c=this.defaultAccount,g=c?c.email():"",c=c?c.friendlyName():"";this.isMyEvent(g===(a.Owner||
g));this.callbackSave=a.CallbackSave;this.callbackDelete=a.CallbackDelete;this.callbackAttendeeActionDecline=a.CallbackAttendeeActionDecline;this.timeFormatMoment=a.TimeFormat;this.dateFormatMoment=d.getDateFormatForMoment(a.DateFormat);this.dateFormatDatePicker=d.getDateFormatForDatePicker(a.DateFormat);this.initializeDatePickers();this.startDate(a.StartMoment.format(this.dateFormatMoment));this.startDom().datepicker("setDate",a.StartMoment.toDate());this.startTime(a.StartMoment.format(this.timeFormatMoment));
this.endDate(a.EndMoment?a.EndMoment.format(this.dateFormatMoment):this.startDate());this.endDom().datepicker("setDate",a.EndMoment?a.EndMoment.toDate():a.StartMoment.toDate());this.endTime(a.EndMoment?a.EndMoment.format(this.timeFormatMoment):this.startTime());this.allDay(a.AllDay);(this.calendars=a.Calendars)&&this.calendarsList(this.calendars.collection);this.selectedCalendar(a.SelectedCalendar);this.calendarId(this.selectedCalendar());this.editableSwitch(this.selectedCalendarIsShared(),this.selectedCalendarIsEditable(),
this.isMyEvent());this.changeCalendarColor(this.selectedCalendar());this.id(a.ID||null);this.uid(a.Uid||null);this.recurrenceId(a.RecurrenceId||null);this.subject(a.Subject||"");this.location(a.Location||"");this.description(a.Description||"");this.allEvents(a.AllEvents||f.CalendarEditRecurrenceEvent.AllEvents);this.displayedAlarms(this.getDisplayedAlarms(a.Alarms||[]));this.appointment(a.Appointment);this.attendees(a.Attendees||[]);this.setCurrentAttenderStatus(g,a.Attendees||[]);this.owner(a.Owner||
g);this.ownerName(a.OwnerName||c);this.guestAutocomplete("");this.excluded(a.Excluded||!1);this.repeatRuleParse(a.RRule||null);null===this.id()&&this.subjectFocus(!0);this.selectStartDate();this.selectEndDate();this.autosizeTrigger.notifySubscribers(!0);this.modified=!1};o.prototype.popupTemplate=function(){return"Popups_CalendarCreateEventPopupViewModel"};o.prototype.changeCalendarColor=function(a){if(d.isFunc(this.calendars.getCalendarById)&&(a=this.calendars.getCalendarById(a)))this.calendarColor(""),
this.calendarColor(a.color())};o.prototype.isVisibleCalendarListItem=function(a){var c=!1,g=this.calendars.getCalendarById(a);g&&(c=this.selectedCalendar()!==a&&g.isEditable());return c};o.prototype.onSaveClick=function(){if(""===this.subject())e.Screens.showPopup(R,[d.i18n("CALENDAR/WARNING_EVENT_BLANK_SUBJECT"),_.bind(function(){this.subjectFocus(!0)},this)]);else{if(this.callbackSave){var a=this.repeatPeriod(),c="",c=null,g=0,b={calendarId:this.calendarId(),newCalendarId:this.selectedCalendar(),
id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:d.getTitleForEvent(this.subject()),start:this.getDateFromStr(this.startDate(),this.startTime()),end:this.getDateFromStr(this.endDate(),this.endTime()),allDay:this.allDay(),location:this.location(),description:this.description(),alarms:this.getAlarmsArray(this.displayedAlarms()),attendees:this.attendees(),owner:this.owner(),modified:this.modified};a&&(c=(c=this.repeatEndDom().datepicker("getDate"))?
this.getUnixTimestamp(c):null,g=this.repeatInterval(),this.repeatWeekNum(),this.repeatEnd(),a===f.CalendarRepeatPeriod.Daily?b.rrule={byDays:[],count:null,end:2,interval:1,period:a,until:c,weekNum:null}:a===f.CalendarRepeatPeriod.Weekly?b.rrule={byDays:this.getDays(),count:null,end:0,interval:g,period:a,until:null,weekNum:null}:a===f.CalendarRepeatPeriod.Monthly?b.rrule={byDays:[],count:null,end:0,interval:1,period:a,until:null,weekNum:null}:a===f.CalendarRepeatPeriod.Yearly&&(b.rrule={byDays:[],
count:null,end:0,interval:1,period:a,until:null,weekNum:null}));this.callbackSave(b)}this.closePopup()}};o.prototype.closePopup=function(){this.hideAll();this.cleanAll();this.closeCommand()};o.prototype.hideAll=function(){this.dateEdit(!1);this.repeatEdit(!1);this.guestsEdit(!1)};o.prototype.cleanAll=function(){this.repeatPeriod(0);this.repeatInterval(1);this.repeatEnd(0);this.repeatCount(null);this.repeatWeekNum(null);this.weekDays(!1);this.weekMO(!1);this.weekTU(!1);this.weekWE(!1);this.weekTH(!1);
this.weekFR(!1);this.weekSA(!1);this.weekSU(!1);this.attendees([])};o.prototype.onDeleteClick=function(){if(this.callbackDelete){var a={calendarId:this.selectedCalendar(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:d.getTitleForEvent(this.subject()),start:this.getDateFromStr(this.startDate(),this.startTime()),end:this.getDateFromStr(this.endDate(),this.endTime()),allDay:this.allDay(),location:this.location(),description:this.description()};
this.callbackDelete(a)}this.closePopup()};o.prototype.showDates=function(a,c){c.stopPropagation();this.dateEdit(!this.dateEdit())};o.prototype.showGuests=function(){if(0<this.attendees().length){var a=d.i18n("CALENDAR/CONFIRM_CLOSE_ATTENDEERS"),c=_.bind(function(a){a&&(this.guestsEdit(!1),this.guestEmailFocus(!1),this.attendees([]))},this);e.Screens.showPopup(G,[a,c])}else this.guestsEdit(!this.guestsEdit()),this.guestEmailFocus(!this.guestEmailFocus())};o.prototype.onAddGuestClick=function(){var a=
this.guestAutocompleteItem(),c=this.guestAutocomplete(),g=a||{name:"",email:c},a=_.any(this.attendees(),function(a){return a.email===g.email});""===g.email?e.Api.showErrorByCode(0,d.i18n("CALENDAR/EVENT_ERROR_ENTER_EMAIL")):g.email===this.owner()?this.recivedAnim(!0):a?this.recivedAnim(!0):this.attendees.push({status:0,name:g.name,email:g.email});this.whomAnimate(g.email);this.guestAutocomplete("")};o.prototype.getDisplayedAlarms=function(a){var c,g,e=[];_.each(a,function(a){c=this["alarm"+a]=b.observable(a);
c.subscribe(function(){this.disableAlarms()},this);g=0<a&&60>a?d.i18n("CALENDAR/ALARM_MINUTES_PLURAL",{COUNT:a},null,a):60<=a&&1440>a?d.i18n("CALENDAR/ALARM_HOURS_PLURAL",{COUNT:a/60},null,a/60):1440<=a&&10080>a?d.i18n("CALENDAR/ALARM_DAYS_PLURAL",{COUNT:a/1440},null,a/1440):d.i18n("CALENDAR/ALARM_WEEKS_PLURAL",{COUNT:a/10080},null,a/10080);e.push({value:a,alarm:c,text:g,isDisabled:!1})},this);return e};o.prototype.getDisplayedPeriods=function(){return[{label:d.i18n("CALENDAR/EVENT_REPEAT_NEVER"),
value:0},{label:d.i18n("CALENDAR/EVENT_REPEAT_DAILY"),value:1},{label:d.i18n("CALENDAR/EVENT_REPEAT_WEEKLY"),value:2},{label:d.i18n("CALENDAR/EVENT_REPEAT_MONTHLY"),value:3},{label:d.i18n("CALENDAR/EVENT_REPEAT_YEARLY"),value:4}]};o.prototype.getDisplayedIntervals=function(){for(var a=1,c=[];30>=a;a++)c.push({label:a+d.i18n("th"),value:a});return c};o.prototype.getDisplayedTimes=function(a){var c=[];switch(a){case "HH:mm":c=[{value:"12:00",text:"12:00"},{value:"12:30",text:"12:30"},{value:"13:00",
text:"13:00"},{value:"13:30",text:"13:30"},{value:"14:00",text:"14:00"},{value:"14:30",text:"14:30"},{value:"15:00",text:"15:00"},{value:"15:30",text:"15:30"},{value:"16:00",text:"16:00"},{value:"16:30",text:"16:30"},{value:"17:00",text:"17:00"},{value:"17:30",text:"17:30"},{value:"18:00",text:"18:00"},{value:"18:30",text:"18:30"},{value:"19:00",text:"19:00"},{value:"19:30",text:"19:30"},{value:"20:00",text:"20:00"},{value:"20:30",text:"20:30"},{value:"21:00",text:"21:00"},{value:"21:30",text:"21:30"},
{value:"22:00",text:"22:00"},{value:"22:30",text:"22:30"},{value:"23:00",text:"23:00"},{value:"23:30",text:"23:30"},{value:"00:00",text:"00:00"},{value:"00:30",text:"00:30"},{value:"01:00",text:"01:00"},{value:"01:30",text:"01:30"},{value:"02:00",text:"02:00"},{value:"02:30",text:"02:30"},{value:"03:00",text:"03:00"},{value:"03:30",text:"03:30"},{value:"04:00",text:"04:00"},{value:"04:30",text:"04:30"},{value:"05:00",text:"05:00"},{value:"05:30",text:"05:30"},{value:"06:00",text:"06:00"},{value:"06:30",
text:"06:30"},{value:"07:00",text:"07:00"},{value:"07:30",text:"07:30"},{value:"08:00",text:"08:00"},{value:"08:30",text:"08:30"},{value:"09:00",text:"09:00"},{value:"09:30",text:"09:30"},{value:"10:00",text:"10:00"},{value:"10:30",text:"10:30"},{value:"11:00",text:"11:00"},{value:"11:30",text:"11:30"}];break;case "hh:mm A":c=[{value:"12:00 AM",text:"12:00 AM"},{value:"12:30 AM",text:"12:30 AM"},{value:"01:00 AM",text:"01:00 AM"},{value:"01:30 AM",text:"01:30 AM"},{value:"02:00 AM",text:"02:00 AM"},
{value:"02:30 AM",text:"02:30 AM"},{value:"03:00 AM",text:"03:00 AM"},{value:"03:30 AM",text:"03:30 AM"},{value:"04:00 AM",text:"04:00 AM"},{value:"04:30 AM",text:"04:30 AM"},{value:"05:00 AM",text:"05:00 AM"},{value:"05:30 AM",text:"05:30 AM"},{value:"06:00 AM",text:"06:00 AM"},{value:"06:30 AM",text:"06:30 AM"},{value:"07:00 AM",text:"07:00 AM"},{value:"07:30 AM",text:"07:30 AM"},{value:"08:00 AM",text:"08:00 AM"},{value:"08:30 AM",text:"08:30 AM"},{value:"09:00 AM",text:"09:00 AM"},{value:"09:30 AM",
text:"09:30 AM"},{value:"10:00 AM",text:"10:00 AM"},{value:"10:30 AM",text:"10:30 AM"},{value:"11:00 AM",text:"11:00 AM"},{value:"11:30 AM",text:"11:30 AM"},{value:"12:00 PM",text:"12:00 PM"},{value:"12:30 PM",text:"12:30 PM"},{value:"01:00 PM",text:"01:00 PM"},{value:"01:30 PM",text:"01:30 PM"},{value:"02:00 PM",text:"02:00 PM"},{value:"02:30 PM",text:"02:30 PM"},{value:"03:00 PM",text:"03:00 PM"},{value:"03:30 PM",text:"03:30 PM"},{value:"04:00 PM",text:"04:00 PM"},{value:"04:30 PM",text:"04:30 PM"},
{value:"05:00 PM",text:"05:00 PM"},{value:"05:30 PM",text:"05:30 PM"},{value:"06:00 PM",text:"06:00 PM"},{value:"06:30 PM",text:"06:30 PM"},{value:"07:00 PM",text:"07:00 PM"},{value:"07:30 PM",text:"07:30 PM"},{value:"08:00 PM",text:"08:00 PM"},{value:"08:30 PM",text:"08:30 PM"},{value:"09:00 PM",text:"09:00 PM"},{value:"09:30 PM",text:"09:30 PM"},{value:"10:00 PM",text:"10:00 PM"},{value:"10:30 PM",text:"10:30 PM"},{value:"11:00 PM",text:"11:00 PM"},{value:"11:30 PM",text:"11:30 PM"}]}return c};
o.prototype.getAlarmsArray=function(a){var c=[];_.each(a,function(a){c.push(a.alarm())},this);return _.sortBy(c,function(a){return-a})};o.prototype.addFirstAlarm=function(){if(this.displayedAlarms().length){var a=d.i18n("CALENDAR/CONFIRM_CLOSE_ALARMS"),c=_.bind(function(a){a&&this.displayedAlarms.removeAll()},this);e.Screens.showPopup(G,[a,c])}else this.displayedAlarms(this.getDisplayedAlarms([this.alarmOptions()[0].value]))};o.prototype.addAlarm=function(){var a,c=0;a=_.sortBy(this.displayedAlarms(),
function(a){return a.alarm()});_.each(a,function(a){a=a.alarm();5!==a&&5>=c?c=5:10!==a&&10>=c?c=10:15!==a&&15>=c?c=15:30!==a&&30>=c?c=30:1440!==a&&1440>=c&&(c=1440)});a=this.getDisplayedAlarms([c])[0];this["alarm"+c]=b.observable(c);this.displayedAlarms.push(a)};o.prototype.removeAlarm=function(a){this.displayedAlarms.remove(a)};o.prototype.removeGuest=function(a){this.attendees.remove(a)};o.prototype.disableAlarms=function(){_.each(this.alarmOptions(),function(a){a.isDisabled=_.any(this.displayedAlarms(),
function(c){return c.alarm()===a.value})},this);this.alarmOptions.valueHasMutated()};o.prototype.autocompleteCallback=function(a,c){var g={Action:"ContactSuggestions",Search:a,GlobalOnly:"0"};this.guestAutocompleteItem(null);a=d.trim(a);""!==a?e.Ajax.send(g,function(a){var g=[];a&&(a.Result&&a.Result&&a.Result.List)&&(g=_.map(a.Result.List,function(a){return a&&a.Email&&a.Email!==this.owner()?a.Name&&0<d.trim(a.Name).length?{value:'"'+a.Name+'" <'+a.Email+">",name:a.Name,email:a.Email}:{value:a.Email,
name:"",email:a.Email}:null},this),g=_.compact(g));c(g)},this):c([])};o.prototype.repeatRuleParse=function(a){var c=this.allEvents();this.repeatEndDom().datepicker("option","minDate",this.datepickerGetDate(this.endDom()));a&&c===f.CalendarEditRecurrenceEvent.AllEvents&&(this.repeatPeriod(a.period),this.repeatInterval(a.interval),this.repeatEnd(a.end),this.repeatCount(a.count),this.repeatWeekNum(a.weekNum),a.until&&this.datepickerSetDate(this.repeatEndDom(),new Date(1E3*a.until)),a.byDays.length&&
(this.weekDays(!0),_.each(a.byDays,function(a){this["week"+a](!0)},this)))};o.prototype.getDays=function(){var a=[];this.weekMO()&&a.push("MO");this.weekTU()&&a.push("TU");this.weekWE()&&a.push("WE");this.weekTH()&&a.push("TH");this.weekFR()&&a.push("FR");this.weekSA()&&a.push("SA");this.weekSU()&&a.push("SU");return a};o.prototype.onMainPanelClick=function(){this.dateEdit()&&this.dateEdit(!1)};o.prototype.onKeydown=function(a,c){c.keyCode===f.Key.Enter&&c.preventDefault()};o.prototype.onKeyup=function(a,
c){if(("event_subject"===c.target.id||"event_location"===c.target.id)&&c.keyCode===f.Key.Enter)this.onSaveClick()};o.prototype.onPaste=function(a,c,g){a=g().replace(/[\r\n\t]+/gm," ");g(a)};o.prototype.selectStartDate=function(){if(this.startDate()&&this.endDate()){var a=this.dateFormatMoment,c=this.timeFormatMoment,g=this.datepickerGetDate(this.startDom()),g=moment(this.getDateFromStr(moment(g).format(a),this.startTime())).toDate(),b=this.datepickerGetDate(this.endDom()),d=moment(this.getDateFromStr(moment(b).format(a),
this.endTime())).toDate(),b=this.getUnixTimestamp(g),e=this.getUnixTimestamp(d),f=moment(g),h=moment(d),d=f.format(a),i=f.format(c),a=h.format(a),c=h.format(c);this.isEvOneDay(d===a);this.isEvOneTime(i===c);b>e&&(this.datepickerSetDate(this.endDom(),g),this.endDate(d),this.endTime(i),this.isEvOneDay(!0),this.isEvOneTime(!0));this.startDate(d);this.startTime(i);this.yearlyDate(f.format(this.getPartOfDate(this.dateFormatMoment.slice(0,-5))));this.monthlyDate(f.format(this.getPartOfDate(this.dateFormatMoment.slice(0,
2))))}};o.prototype.selectEndDate=function(){if(this.endDate()&&this.startDate()){var a=this.dateFormatMoment,c=this.timeFormatMoment,g=this.datepickerGetDate(this.endDom()),g=moment(this.getDateFromStr(moment(g).format(a),this.endTime())).toDate(),b=this.datepickerGetDate(this.startDom()),d=moment(this.getDateFromStr(moment(b).format(a),this.startTime())).toDate(),b=this.getUnixTimestamp(g),e=this.getUnixTimestamp(d),f=moment(g),h=moment(d),d=f.format(a),i=f.format(c),a=h.format(a),c=h.format(c);
this.isEvOneDay(d===a);this.isEvOneTime(i===c);b<e&&(this.datepickerSetDate(this.startDom(),g),this.startDate(d),this.startTime(i),this.isEvOneDay(!0),this.isEvOneTime(!0));this.endDate(d);this.endTime(i);this.repeatEndDom().datepicker("option","minDate",g);this.isRepeat()||this.datepickerSetDate(this.repeatEndDom(),f.add("days",7).toDate())}};o.prototype.getUnixTimestamp=function(a){return Number(moment(a).format("X"))};o.prototype.datepickerGetDate=function(a){return a.datepicker("getDate")};o.prototype.datepickerSetDate=
function(a,c){a.datepicker("setDate",c)};o.prototype.getDateFromStr=function(a,c){return moment(a+" "+c,this.dateFormatMoment+" "+this.timeFormatMoment).toDate()};o.prototype.getPartOfDate=function(a){var c="MM/DD";switch(a){case "MM/DD":c="MM/DD";break;case "DD/MM":c="DD/MM";break;case "DD MMMM":c="DD MMMM";break;case "DD":c="DD"}return c};o.prototype.setActualTime=function(){var a=moment();30<a.minutes()?a.minutes(60):a.minutes(30);a.seconds(0);a.milliseconds(0);this.startTime(a.format(this.timeFormatMoment));
this.endTime(a.add("minutes",30).format(this.timeFormatMoment))};o.prototype.onProcessAppointmentResponse=function(a){a.Result||e.Api.showErrorByCode(0,d.i18n("WARNING/UNKNOWN_ERROR"))};o.prototype.doProcessAppointment=function(a){var c={Action:"EventUpdateAppointment",actionAppointment:a,calendarId:this.selectedCalendar(),uid:this.uid},g=this.attendees(),b=this.defaultAccount?this.defaultAccount.email():"",h=_.find(this.attendees(),function(a){return a.email===b},this),n=this.calendars.getCalendarById(this.selectedCalendar());
h&&(e.Ajax.send(c,this.onProcessAppointmentResponse,this),h.status=a,this.attendees([]),this.attendees(g),this.setCurrentAttenderStatus(h.email,this.attendees()),a===f.IcalConfigInt.Declined&&(n&&this.callbackAttendeeActionDecline&&d.isFunc(this.callbackAttendeeActionDecline))&&(this.callbackAttendeeActionDecline(n,this.id()),this.closePopup()))};o.prototype.editableSwitch=function(a,c,g){this.isEditable(!a&&c&&g||a&&c&&!g)};o.prototype.setCurrentAttenderStatus=function(a,c){var g=_.find(c,function(c){return c.email===
a});this.attenderStatus(g?g.status:0)};o.prototype.getAttenderTextStatus=function(a){switch(a){case 0:a="pending";break;case 1:a="accepted";break;case 2:a="declined";break;case 3:a="tentative"}return a};Ga.prototype.onShow=function(a){d.isFunc(a)&&(this.fCallback=a)};Ga.prototype.popupTemplate=function(){return"Popups_CalendarEditRecurrenceEventPopupViewModel"};Ga.prototype.onlyThisInstanceButtonClick=function(){this.fCallback&&this.fCallback(f.CalendarEditRecurrenceEvent.OnlyThisInstance);this.closeCommand()};
Ga.prototype.allEventsButtonClick=function(){this.fCallback&&this.fCallback(f.CalendarEditRecurrenceEvent.AllEvents);this.closeCommand()};Ga.prototype.cancelButtonClick=function(){this.fCallback&&this.fCallback(f.CalendarEditRecurrenceEvent.None);this.closeCommand()};ta.prototype.popupTemplate=function(){return"Popups_PhonePopupViewModel"};ta.prototype.onShow=function(a){this.action(a.Action||"");this.phoneNumber(a.PhoneNumber||"");this.callback=a.Callback||null;this.action()===f.PhoneAction.Incoming&&
e.desktopNotify("show",this.phoneNumber()+" calling...","Click here to answer.\r\n To drop the call, click End in the web interface.",this.phone.answer)};ta.prototype.onCancelClick=function(){this.phone.hidePopup()};ta.prototype.onOKClick=function(){this.phone.hidePopup();this.callback&&this.callback()};ta.prototype.answer=function(){this.phone.answer()};ta.prototype.hangup=function(){this.phone.hangup()};lb.prototype.parse=function(a){this.AllowUsersChangeInterfaceSettings=!!a.AllowUsersChangeInterfaceSettings;
this.AllowUsersChangeEmailSettings=!!a.AllowUsersChangeEmailSettings;this.AllowUsersAddNewAccounts=d.isUnd(a.AllowUsersAddNewAccounts)?this.AllowUsersChangeEmailSettings:!!a.AllowUsersAddNewAccounts;this.SiteName=a.SiteName;this.Languages=a.Languages;this.Themes=a.Themes;this.DateFormats=a.DateFormats;this.AttachmentSizeLimit=d.pInt(a.AttachmentSizeLimit);this.ImageUploadSizeLimit=d.pInt(a.ImageUploadSizeLimit);this.AllowFirstCharacterSearch=!!a.AllowFirstCharacterSearch;this.AllowIdentities=!!a.AllowIdentities;
this.AutoSave=!!a.AutoSave;this.IdleSessionTimeout=d.pInt(a.IdleSessionTimeout);this.AllowInsertImage=!!a.AllowInsertImage;this.AllowBodySize=!!a.AllowBodySize;this.MaxBodySize=d.pInt(a.MaxBodySize);this.MaxSubjectSize=d.pInt(a.MaxSubjectSize);this.AllowPrefetch=!!a.AllowPrefetch;this.AllowFetcher=!!a.AllowFetcher;this.LoginFormType=d.pInt(a.LoginFormType);this.LoginSignMeType=d.pInt(a.LoginSignMeType);this.LoginAtDomainValue=a.LoginAtDomainValue;this.DemoWebMail=!!a.DemoWebMail;this.DemoWebMailLogin=
a.DemoWebMailLogin;this.DemoWebMailPassword=a.DemoWebMailPassword;this.GoogleAnalyticsAccount=a.GoogleAnalyticsAccount;this.ShowQuotaBar=!!a.ShowQuotaBar;this.ServerUseUrlRewrite=!!a.ServerUseUrlRewrite;this.AllowLanguageOnLogin=!!a.AllowLanguageOnLogin;this.FlagsLangSelect=!!a.FlagsLangSelect;this.DefaultLanguage=a.DefaultLanguage;this.LoginDescription=a.LoginDescription;this.CustomLoginUrl=a.CustomLoginUrl;this.CustomLogoutUrl=a.CustomLogoutUrl;this.IosDetectOnLogin=a.IosDetectOnLogin;this.UseReCaptcha=
a.UseReCaptcha;this.ReCaptchaPublicKey=a.ReCaptchaPublicKey;""!==a.DefaultLanguageShort&&(this.DefaultLanguageShort=a.DefaultLanguageShort)};ca.prototype.changeAutoCheckMailInterval=function(){clearInterval(this.iInterval);!h.SingleMode&&0<this.autoCheckMailInterval()&&(this.iInterval=setInterval(function(){e.MailCache.executeCheckMail()},6E4*this.autoCheckMailInterval()))};ca.prototype.getSaveMailInSentItems=function(){var a=!0;switch(this.SaveMail){case f.SaveMail.Unchecked:a=!1;break;case f.SaveMail.Checked:case f.SaveMail.Hidden:a=
!0}return a};ca.prototype.getUseSaveMailInSentItems=function(){var a=!1;switch(this.SaveMail){case f.SaveMail.Unchecked:case f.SaveMail.Checked:a=!0;break;case f.SaveMail.Hidden:a=!1}return a};ca.prototype.parse=function(a){var c=null;if(null!==a&&(this.IdUser=d.pInt(a.IdUser),this.MailsPerPage=d.pInt(a.MailsPerPage),this.ContactsPerPage=d.pInt(a.ContactsPerPage),this.autoCheckMailInterval(d.pInt(a.AutoCheckMailInterval)),this.DefaultEditor=d.pInt(a.DefaultEditor),this.Layout=d.pInt(a.Layout),this.DefaultTheme=
a.DefaultTheme.toString(),this.DefaultLanguage=a.DefaultLanguage.toString(),this.DefaultDateFormat=a.DefaultDateFormat.toString(),this.defaultTimeFormat(d.pInt(a.DefaultTimeFormat)),this.ThreadsEnabled=!!a.ThreadsEnabled,this.useThreads(!!a.UseThreads),this.AllowCompose=!!a.AllowCompose,this.AllowReply=!!a.AllowReply,this.AllowForward=!!a.AllowForward,this.SaveMail=d.pInt(a.SaveMail),this.OutlookSyncEnable=!!a.OutlookSyncEnable,this.MobileSyncEnable=!!a.MobileSyncEnable,this.ShowPersonalContacts=
!!a.ShowPersonalContacts,this.ShowGlobalContacts=!!a.ShowGlobalContacts,this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.IsFilesSupported=!!a.IsFilesSupported,this.IsHelpdeskSupported=!!a.IsHelpdeskSupported,this.IsHelpdeskAgent=!!a.IsHelpdeskAgent,this.LastLogin=d.pInt(a.LastLogin),this.AllowCalendar=!!a.AllowCalendar,this.CalendarSharing=!!a.CalendarSharing,this.CalendarAppointments=!!a.CalendarAppointments,this.IsDemo=!!a.IsDemo,this.AllowVoice=!!a.AllowVoice,this.VoiceRealm=
a.VoiceRealm,this.VoiceWebsocketProxyUrl=a.VoiceWebsocketProxyUrl,this.VoiceOutboundProxyUrl=a.VoiceOutboundProxyUrl,this.VoiceCallerID=a.VoiceCallerID,this.VoiceImpi=a.VoiceImpi,this.VoiceImpu=a.VoiceImpu,this.VoicePassword=a.VoicePassword,this.VoiceProvider=a.VoiceRealm,this.AllowHelpdeskNotifications=a.AllowHelpdeskNotifications,c=a.Calendar))this.CalendarShowWeekEnds=!!c.ShowWeekEnds,this.CalendarShowWorkDay=!!c.ShowWorkDay,this.CalendarWorkDayStarts=d.pInt(c.WorkDayStarts),this.CalendarWorkDayEnds=
d.pInt(c.WorkDayEnds),this.CalendarWeekStartsOn=d.pInt(c.WeekStartsOn),this.CalendarDefaultTab=d.pInt(c.DefaultTab)};ca.prototype.updateCommonSettings=function(a,c,g,b,d,e,f,h,i,j){(this.DefaultTheme!==e||this.DefaultLanguage!==f||this.DefaultDateFormat!==h||this.defaultTimeFormat()!==i)&&this.needToReloadCalendar(!0);this.MailsPerPage=a;this.ContactsPerPage=c;this.autoCheckMailInterval(g);this.DefaultEditor=b;this.Layout=d;this.DefaultTheme=e;this.DefaultLanguage=f;this.DefaultDateFormat=h;this.defaultTimeFormat(i);
this.useThreads("1"===j)};ca.prototype.updateCalendarSettings=function(a,c,g,b,d,e){(this.CalendarShowWeekEnds!==a||this.CalendarShowWorkDay!==c||this.CalendarWorkDayStarts!==g||this.CalendarWorkDayEnds!==b||this.CalendarWeekStartsOn!==d||this.CalendarDefaultTab!==e)&&this.needToReloadCalendar(!0);this.CalendarShowWeekEnds=a;this.CalendarShowWorkDay=c;this.CalendarWorkDayStarts=g;this.CalendarWorkDayEnds=b;this.CalendarWeekStartsOn=d;this.CalendarDefaultTab=e};ca.prototype.updateHelpdeskSettings=
function(a){this.AllowHelpdeskNotifications=a};ca.prototype.isNeedToReloadCalendar=function(){var a=this.needToReloadCalendar();this.needToReloadCalendar(!1);return a};ca.prototype.onSyncSettingsResponse=function(a){a.Result?(this.mobileSync(a.Result.Mobile),this.outlookSync(a.Result.Outlook)):e.Api.showErrorByCode(a.ErrorCode)};ca.prototype.requestSyncSettings=function(){(null===this.mobileSync()||null===this.outlookSync())&&e.Ajax.send({Action:"SyncSettings"},this.onSyncSettingsResponse,this)};
U.prototype.init=function(a,c,g){this.id(a);this.email(c);this.friendlyName(g)};U.prototype.onQuotaParamsResponse=function(a){a&&(a.Result&&_.isArray(a.Result)&&2===a.Result.length)&&(this.quota(d.pInt(a.Result[1])),this.usedSpace(d.pInt(a.Result[0])),e.MailCache.quotaChangeTrigger(!e.MailCache.quotaChangeTrigger()))};U.prototype.updateQuotaParams=function(){var a={Action:"Quota",AccountID:this.id()};h.App&&h.App.ShowQuotaBar&&e.Ajax.send(a,this.onQuotaParamsResponse,this)};U.prototype.parse=function(a,
c){var g=new hb;this.init(parseInt(a.AccountID,10),a.Email.toString(),a.FriendlyName.toString());g.parse(this.id(),a.Signature);this.signature(g);this.isCurrent(c===this.id());this.isEdited(c===this.id())};U.prototype.requestExtensions=function(){if(!this.extensionsRequested&&e.Ajax){var a=j.jstz?j.jstz.determine():null;e.Ajax.send({AccountID:this.id(),Action:"IsAuth",ClientTimeZone:a?a.name():""},this.onIsAuthResponse,this);this.extensionsRequested=!0}};U.prototype.onIsAuthResponse=function(a){var c=
!!a.Result,a=c?a.Result.Extensions:[];c&&this.setExtensions(a)};U.prototype.setExtensions=function(a){_.isArray(a)&&this.extensions(a)};U.prototype.extensionExists=function(a){return-1===_.indexOf(this.extensions(),a)?!1:!0};U.prototype.updateExtended=function(a){a&&(this.isExtended(!0),a.FriendlyName&&this.friendlyName(a.FriendlyName),a.IncomingMailLogin&&this.incomingMailLogin(a.IncomingMailLogin),a.IncomingMailPort&&this.incomingMailPort(a.IncomingMailPort),a.IncomingMailServer&&this.incomingMailServer(a.IncomingMailServer),
a.IsInternal&&this.isInternal(a.IsInternal),a.IsLinked&&this.isLinked(a.IsLinked),a.IsDefault&&this.isDefault(a.IsDefault),a.OutgoingMailAuth&&this.outgoingMailAuth(a.OutgoingMailAuth),a.OutgoingMailLogin&&this.outgoingMailLogin(a.OutgoingMailLogin),a.OutgoingMailPort&&this.outgoingMailPort(a.OutgoingMailPort),a.OutgoingMailServer&&this.outgoingMailServer(a.OutgoingMailServer),this.setExtensions(a.Extensions))};U.prototype.changeAccount=function(){h.Accounts.changeCurrentAccount(this.id())};U.prototype.getFetcherByEmail=
function(a){var c=this.fetchers()?this.fetchers().collection():[];return _.find(c,function(c){return c.email()===a})};W.prototype.changeCurrentAccount=function(a){var c=this.getCurrent(),g=this.getAccount(a);g&&this.currentId()!==a&&(c.isCurrent(!1),this.currentId(a),g.isCurrent(!0),e.Routing.setHash(e.Links.inbox()))};W.prototype.changeEditedAccount=function(a){var c=this.getEdited(),g=this.getAccount(a);g&&this.editedId()!==a&&(c.isEdited(!1),this.editedId(a),g.isEdited(!0))};W.prototype.parse=
function(a,c){var g=null,b=!1;_.isArray(c)&&this.collection(_.map(c,function(c){var g=new U;g.parse(c,a);g.id()===a&&(b=!0);return g}));!b&&0<this.collection.length&&(g=this.collection()[0],a=g.id(),b=!0);b&&(this.defaultId(a),this.currentId(a),this.editedId(a))};W.prototype.getAccount=function(a){return _.find(this.collection(),function(c){return c.id()===a},this)};W.prototype.getCurrent=function(){return _.find(this.collection(),function(a){return a.id()===this.currentId()},this)};W.prototype.getDefault=
function(){return _.find(this.collection(),function(a){return a.id()===this.defaultId()},this)};W.prototype.getEmail=function(){var a="",c=h.Accounts.getCurrent();c&&(a=c.email());return a};W.prototype.getEdited=function(){return _.find(this.collection(),function(a){return a.id()===this.editedId()},this)};W.prototype.addAccount=function(a){this.collection.push(a)};W.prototype.deleteAccount=function(a){this.currentId()===a&&this.changeCurrentAccount(this.defaultId());this.editedId()===a&&this.changeEditedAccount(this.defaultId());
this.collection.remove(function(c){return c.id()===a})};W.prototype.hasAccountWithId=function(a){return!!_.find(this.collection(),function(c){return c.id()===a},this)};ua.prototype.parse=function(a){if(null!==a&&(this.sName=a.DisplayName,"string"!==typeof this.sName&&(this.sName=""),this.sEmail=a.Email,"string"!==typeof this.sEmail))this.sEmail=""};ua.prototype.getEmail=function(){return this.sEmail};ua.prototype.getName=function(){return this.sName};ua.prototype.getDisplay=function(){return 0<this.sName.length?
this.sName:this.sEmail};ua.prototype.getFull=function(){var a="";return a=0<this.sEmail.length?0<this.sName.length?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail:this.sName};S.prototype.parse=function(a){this.aCollection=_.map(a,function(a){var g=new ua;g.parse(a);return g})};S.prototype.addCollection=function(a){_.each(a,function(a){_.find(this.aCollection,function(g){return a.sEmail===g.sEmail})||this.aCollection.push(a)},this)};S.prototype.excludeCollection=function(a){_.each(a,function(a){this.aCollection=
_.filter(this.aCollection,function(g){return a.sEmail!==g.sEmail})},this)};S.prototype.getFirstEmail=function(){return 0<this.aCollection.length?this.aCollection[0].getEmail():""};S.prototype.getFirstName=function(){return 0<this.aCollection.length?this.aCollection[0].getName():""};S.prototype.getDisplay=function(){return _.map(this.aCollection,function(a){return a.getDisplay()}).join(", ")};S.prototype.getFull=function(){return _.map(this.aCollection,function(a){return a.getFull()}).join(", ")};
T.prototype.parse=function(a){this.oMoment=moment.unix(a)};T.prototype.setDate=function(a,c,g){this.oMoment=moment([a,c,g])};T.prototype.getTimeFormat=function(){return h.User.defaultTimeFormat()===f.TimeFormat.F24?"HH:mm":"hh:mm A"};T.prototype.getFullDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY, "+this.getTimeFormat()):""};T.prototype.getMidDate=function(){return this.getShortDate(!0)};T.prototype.getShortDate=function(a){var c="",g=null;if(this.oMoment)if(g=moment(),
g.format("L")===this.oMoment.format("L"))c=this.oMoment.format(this.getTimeFormat());else if(c=g.clone().subtract("days",1).format("L")===this.oMoment.format("L")?d.i18n("DATETIME/YESTERDAY"):g.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),d.isUnd(a)?0:a)c+=", "+this.oMoment.format(this.getTimeFormat());return c};T.prototype.getDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY"):""};T.prototype.getTime=function(){return this.oMoment?
this.oMoment.format(this.getTimeFormat()):""};T.prototype.convertDate=function(a){var c=d.getDateFormatForMoment(h.User.DefaultDateFormat)+" "+this.getTimeFormat();return moment(1E3*a).format(c)};J.prototype.parse=function(a,c){"Object/CApiMailAttachment"===a["@Object"]&&(a.FileName&&this.fileName(a.FileName.toString()),a.TempName?this.tempName(a.TempName.toString()):this.tempName(this.fileName()),this.mimePartIndex(a.MimePartIndex.toString()),this.type(a.MimeType.toString()),this.size(parseInt(a.EstimatedSize,
10)),this.cid(a.CID.toString()),this.inline(!!a.IsInline),this.linked(!!a.IsLinked),this.thumb(!!a.Thumb),this.hash(a.Hash),this.accountId(c),this.uploadUid(this.hash()),this.uploaded(!0))};J.prototype.parseFromContact=function(a,c){this.fileName(a.Name.toString());this.tempName(a.TempName?a.TempName.toString():this.fileName());this.type(a.MimeType.toString());this.size(parseInt(a.Size,10));this.hash(a.Hash);this.accountId(c);this.uploadUid(this.hash());this.uploaded(!0);this.uploadStarted(!1)};J.prototype.errorFromContact=
function(){this.uploaded(!0);this.uploadError(!0);this.uploadStarted(!1);this.statusText(d.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"))};J.prototype.onUploadSelect=function(a,c){this.fileName(c.FileName);this.type(c.Type);this.size(d.pInt(c.Size));this.uploadUid(a);this.uploaded(!1);this.visibleSpinner(!1);this.statusText("");this.progressPercent(0);this.visibleProgress(!1)};J.prototype.onUploadStart=function(){this.visibleSpinner(!0);this.visibleProgress(!0)};J.prototype.onUploadProgress=function(a,c){0<
c&&(this.progressPercent(Math.ceil(100*(a/c))),this.visibleProgress(!0))};J.prototype.onUploadComplete=function(a,c,g){var c=!c||!g||g.Error,b=g&&"size"===g.Error?d.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):d.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN");if(!c&&(!g||!g.AccountID))c=!0;this.visibleSpinner(!1);this.progressPercent(0);this.visibleProgress(!1);if(c)this.uploaded(!0),this.uploadError(!0),this.statusText(b);else{this.cid(a);this.tempName(g.Result.Attachment.TempName);this.uploadError(!1);this.uploaded(!0);
this.statusText(d.i18n("COMPOSE/UPLOAD_COMPLETE"));this.type(g.Result.Attachment.MimeType);this.size(g.Result.Attachment.Size);this.hash(g.Result.Attachment.Hash);this.accountId(g.AccountID);var e=this;setTimeout(function(){e.statusText("")},3E3)}};J.prototype.onMessageResponse=function(a){var c=a.Result,g=new F;c&&this.oNewWindow&&(g.parse(c,a.AccountID,!1,!0),this.messagePart(g),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)};J.prototype.viewAttachment=function(){var a=
null,c='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+d.i18n("MAIN/LOADING")+"</div>",a=d.getAppPath()+this.viewLink();if(this.isMessageType()){if(a=d.WindowOpener.open("",this.fileName())){if(this.messagePart())this.messagePart().viewMessage(a);else{var g={Action:"Message",Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()};i(a.document.body).html(c);this.oNewWindow=a;e.Ajax.send(g,this.onMessageResponse,this)}a.focus()}}else this.visibleViewLink()&&
(0<this.viewLink().length&&"#"!==this.viewLink())&&(a=d.getAppPath()+this.viewLink(),(a=d.WindowOpener.open(a,a,!1))&&a.focus())};J.prototype.downloadAttachment=function(){0<this.download().length&&"#"!==this.download()&&e.downloadByUrl(this.download())};J.prototype.eventDragStart=function(a,c){var g=c.originalEvent||c;a&&(g&&g.dataTransfer&&g.dataTransfer.setData)&&g.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl());return!0};J.prototype.generateTransferDownloadUrl=function(){var a=
this.download();"http"!==a.substr(0,4)&&(a=j.location.protocol+"//"+j.location.host+j.location.pathname+a);return this.type()+":"+this.fileName()+":"+a};y.prototype.hideThreadMessages=function(a){_.each(a.threadUids(),function(a){if((a=this.oMessages[a])&&!a.deleted())a.threadShowAnimation(!1),a.threadHideAnimation(!0)},this)};y.prototype.getThreadMessages=function(a){var c=[],g=[],b=[],d=0,e=null;_.each(a.threadUids(),function(f){if(d<a.threadCountForLoad()){var h=this.oMessages[f];h?h.deleted()||
(h.markAsThreadPart(50),c.push(h),b.push(h.uid()),d++,e=h):(g.push(f),b.push(f),d++)}else b.push(f)},this);a.threadLoading()||this.loadThreadMessages(g);a.changeThreadUids(b,c.length);e&&c.length<a.threadUids().length&&e.showNextLoadingLink(_.bind(a.increaseThreadCountForLoad,a));this.addThreadUidsToUidLists(a.uid(),a.threadUids());return c};y.prototype.addThreadUidsToUidLists=function(a,c){_.each(this.oUids,function(g){_.each(g,function(g){g.addThreadUids(a,c)})})};y.prototype.loadThreadMessages=
function(a){0<a.length&&(a={Action:"MessageListByUids",Folder:this.fullName(),Uids:a},e.Ajax.send(a,this.onMessageListByUidsResponse,this))};y.prototype.getUidsWithThread=function(a){var c=[];_.each(a,function(a){(a=this.oMessages[a])&&!a.threadOpened()&&(c=_.union(c,a.threadUids()))},this);return _.union(a,c)};y.prototype.onMessageListByUidsResponse=function(a){if((a=a.Result)&&"Collection/MessageCollection"===a["@Object"])_.each(a["@Collection"],function(a){var g=new F;g.parse(a,this.iAccountId,
!0,!0);this.oMessages[g.uid()]=g},this),e.MailCache.showOpenedThreads(this.fullName())};y.prototype.addRequestedUids=function(a){this.aRequestedUids=_.union(this.aRequestedUids,a)};y.prototype.hasUidBeenRequested=function(a){return-1!==_.indexOf(this.aRequestedUids,a)};y.prototype.hasListBeenRequested=function(a){var c=0<_.where(this.requestedLists,a).length;c||this.requestedLists.push(a);return c};y.prototype.markMessageReplied=function(a,c){var g=this.oMessages[a];if(g)switch(c){case f.ReplyType.Reply:case f.ReplyType.ReplyAll:g.answered(!0);
break;case f.ReplyType.Forward:g.forwarded(!0)}};y.prototype.removeAllMessages=function(){var a=null;this.oMessages={};this.oUids={};this.messageCount(0);this.unseenMessageCount(0);a=this.getUidList("","");a.resultCount(0)};y.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.hasChanges(!1))};y.prototype.removeFlaggedMessageListsFromCache=function(){_.each(this.oUids,function(a,c){delete this.oUids[c][f.FolderFilter.Flagged]},
this)};y.prototype.setRelevantInformation=function(a,c,g,b){var d=this.hasExtendedInfo()&&(this.hash()!==c||this.unseenMessageCount()!==b);this.uidNext(a);this.hash(c);this.messageCount(g);this.unseenMessageCount(b);this.hasExtendedInfo(!0);d&&this.markHasChanges();return d};y.prototype.markHasChanges=function(){this.hasChanges(!0)};y.prototype.addMessagesCountsDiff=function(a,c){var g=this.messageCount()+a,b=this.unseenMessageCount()+c;0>g&&(g=0);this.messageCount(g);0>b&&(b=0);b>g&&(b=g);this.unseenMessageCount(b)};
y.prototype.markDeletedByUids=function(a){var c=0,g=0;_.each(a,function(a){if(a=this.oMessages[a])c++,a.seen()||g++,a.deleted(!0)},this);this.addMessagesCountsDiff(-c,-g);return{MinusDiff:c,UnseenMinusDiff:g}};y.prototype.revertDeleted=function(a){var c=0,g=0;_.each(a,function(a){if((a=this.oMessages[a])&&a.deleted())c++,a.seen()||g++,a.deleted(!1)},this);this.addMessagesCountsDiff(c,g);return{PlusDiff:c,UnseenPlusDiff:g}};y.prototype.commitDeleted=function(a){_.each(this.oUids,function(c){_.each(c,
function(c){c.deleteUids(a)})})};y.prototype.getUidList=function(a,c){var g=null;void 0===this.oUids[a]&&(this.oUids[a]={});void 0===this.oUids[a][c]&&(g=new Ha,g.search(a),g.filters(c),this.oUids[a][c]=g);return this.oUids[a][c]};y.prototype.parse=function(a){return"Object/Folder"===a["@Object"]?(this.name(a.Name),this.nameForEdit(a.Name),this.fullName(a.FullNameRaw),this.fullNameHash(a.FullNameHash),this.routingHash(e.Routing.buildHashFromArray([f.Screens.Mailbox,this.fullName()])),this.delimiter(a.Delimiter),
this.type(a.Type),this.subscribed(a.IsSubscribed),this.selectable(a.IsSelectable),this.existen(a.IsExisten),a.Extended&&this.setRelevantInformation(a.Extended.UidNext.toString(),a.Extended.Hash,a.Extended.MessageCount,a.Extended.MessageUnseenCount),a.SubFolders):null};y.prototype.onMessageResponse=function(a,c){var g=a.Result,b=null,f=g?g.Uid.toString():c.Uid.toString(),h=this.oMessages[f]?this.oMessages[f]:new F,b=h.selected();g?(h.parse(g,a.AccountID,h.threadPart(),!0),h&&(h.ical()&&h.ical().isReplyType()&&
e.CalendarCache)&&e.CalendarCache.calendarChanged(!0),this.oMessages[f]=h):(b&&e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/UNKNOWN_ERROR")),h=null);if(b=this.aResponseHandlers[f])b.handler.call(b.context,h,f),delete this.aResponseHandlers[f]};y.prototype.getCompletelyFilledMessage=function(a,c,g){var b=this.oMessages[a],d={Action:"Message",Folder:this.fullName(),Uid:a};0<a.length&&(!b||!b.completelyFilled()?(c&&g&&(this.aResponseHandlers[a]={handler:c,context:g}),e.Ajax.send(d,this.onMessageResponse,
this)):c&&g&&c.call(g,b,a))};y.prototype.showExternalPictures=function(a){a=this.oMessages[a];void 0!==a&&a.showExternalPictures()};y.prototype.alwaysShowExternalPicturesForSender=function(a){_.each(this.oMessages,function(c){var g=c.oFrom.aCollection;0<g.length&&g[0].sEmail===a&&c.alwaysShowExternalPicturesForSender()},this)};y.prototype.executeGroupOperation=function(a,c,g){var b=0;_.each(this.oMessages,function(d){if(0<c.length)_.each(c,function(c){d&&(d.uid()===c&&d[a]()!==g)&&(d[a](g),b++)});
else d[a](g)});0===c.length&&(b=g?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount());"seen"===a&&0<b&&(g?this.addMessagesCountsDiff(0,-b):this.addMessagesCountsDiff(0,b))};y.prototype.emptyFolder=function(){var a=d.i18n("MAILBOX/CONFIRM_EMPTY_FOLDER"),c=_.bind(this.clearFolder,this);this.enableEmptyFolder()&&e.Screens.showPopup(G,[a,c])};y.prototype.clearFolder=function(a){var c={Action:"FolderClear",Folder:this.fullName()};this.enableEmptyFolder()&&a&&(e.Ajax.send(c),this.removeAllMessages(),
e.MailCache.onClearFolder(this))};y.prototype.getNameWhithLevel=function(){var a=this.level();!this.isNamespace()&&0<a&&a--;return d.strRepeat("\u00a0",3*a)+this.name()};L.prototype.getFoldersWithoutCountInfo=function(){return _.compact(_.map(this.oNamedCollection,function(a,c){return a.canBeSelected()&&!a.hasExtendedInfo()?c:null}))};L.prototype.getInboxAndCurrentFoldersArray=function(){var a=[this.inboxFolderFullName()];this.currentFolderType()!==f.FolderTypes.Inbox&&a.push(this.currentFolderFullName());
return _.compact(a)};L.prototype.setCurrentFolder=function(a,c){var g=this.getFolderByFullName(a);null===g&&(g=this.inboxFolder());null!==g&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(g),c===f.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))};L.prototype.getFolderByType=function(a){switch(a){case f.FolderTypes.Inbox:return this.inboxFolder();case f.FolderTypes.Sent:return this.sentFolder();
case f.FolderTypes.Drafts:return this.draftsFolder();case f.FolderTypes.Trash:return this.trashFolder();case f.FolderTypes.Spam:return this.spamFolder()}return null};L.prototype.getFolderByFullName=function(a){return(a=this.oNamedCollection[a])?a:null};L.prototype.parse=function(a,c){this.iAccountId=a;this.sNamespace=d.pExport(c,"Namespace",this.sNamespace);this.bInitialized(!0);this.sNamespaceFolder=0<this.sNamespace.length?this.sNamespace.substring(0,this.sNamespace.length-1):this.sNamespace;this.collection(this.parseRecursively(c["@Collection"]))};
L.prototype.parseRecursively=function(a,c){var g=[],b=0,e=0,n=null,i=null,j=[],j=!1,l=h.Accounts.getAccount(this.iAccountId);d.isUnd(c)&&(c=-1);c++;if(_.isArray(a))for(e=a.length;b<e;b++){n=new y;n.iAccountId=this.iAccountId;i=n.parse(a[b]);j=this.sNamespace===n.fullName()+n.delimiter();n.isNamespace(j);null!==i&&(j=this.parseRecursively(i["@Collection"],c),n.type()===f.FolderTypes.Inbox&&(this.createStarredFolder(c+1),this.oStarredFolder&&j.unshift(this.oStarredFolder)),n.subfolders(j));n.level(c);
this.oNamedCollection[n.fullName()]=n;switch(n.type()){case f.FolderTypes.Inbox:this.inboxFolder(n);break;case f.FolderTypes.Sent:this.sentFolder(n);break;case f.FolderTypes.Drafts:this.draftsFolder(n);break;case f.FolderTypes.Trash:this.trashFolder(n);break;case f.FolderTypes.Spam:l.extensionExists("AllowSpamFolderExtension")?this.spamFolder(n):n.type(f.FolderTypes.User)}g.push(n);null===i&&n.type()===f.FolderTypes.Inbox&&(this.createStarredFolder(c),this.oStarredFolder&&g.push(this.oStarredFolder))}return g};
L.prototype.createStarredFolder=function(a){var c=new y;c.iAccountId=this.iAccountId;c.virtual(!0);c.level(a);c.fullName("filter:"+f.FolderFilter.Flagged);c.name(d.i18n("MAIN/FOLDER_STARRED"));c.type(f.FolderTypes.Starred);c.routingHash(e.Routing.buildHashFromArray([f.Screens.Mailbox,c.fullName()]));this.oStarredFolder=c};L.prototype.getOptions=function(a,c,b,e){var h=function(a){var n=0,i=0,j=null,k=[];d.isUnd(c)&&(c=!1);d.isUnd(b)&&(b=!1);d.isUnd(e)&&(e=!1);n=0;for(i=a.length;n<i;n++){j=a[n];if(!j.virtual()&&
(j.type()!==f.FolderTypes.Inbox&&b||!b))k.push({id:j.fullName(),name:Array(j.level()+1).join("\u00a0\u00a0\u00a0\u00a0")+j.name(),displayName:Array(j.level()+1).join("\u00a0\u00a0\u00a0\u00a0")+j.displayName(),disable:j.isSystem()&&!c||!e&&!j.canBeSelected()});k=k.concat(h(j.subfolders()))}return k},n=h(this.collection());d.isUnd(a)||n.unshift({id:"",name:a,displayName:a,disable:!1});return n};L.prototype.getRecursivelyMessageCount=function(a){for(var c=0,b=0,d=null,e=0,c=0,b=a.length;c<b;c++)d=a[c],
d.virtual()||(e+=d.messageCount()+this.getRecursivelyMessageCount(d.subfolders()));return e};L.prototype.deleteFolder=function(a){var c=function(b){if(a&&a.fullName()===b.fullName())return!0;b.subfolders.remove(c);return!1};this.collection.remove(c)};F.prototype.viewMessage=function(a){var c=this.getDomText(d.getAppPath()),b="";this.textBodyForNewWindow(c.html());b=i(this.domMessageForPrint()).html();a&&(i(a.document.body).html(b),a.focus(),_.each(this.attachments(),function(c){var b=i(a.document.body).find("[data-hash='download-"+
c.hash()+"']");b.on("click",_.bind(c.downloadAttachment,c));b=i(a.document.body).find("[data-hash='view-"+c.hash()+"']");b.on("click",_.bind(c.viewAttachment,c))},this))};F.prototype.fillFromOrToText=function(){var a=e.MailCache.getFolderByFullName(this.accountId(),this.folder());a.type()===f.FolderTypes.Drafts||a.type()===f.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay()):this.fromOrToText(this.oFrom.getDisplay())};F.prototype.changeThreadUids=function(a,c){this.threadUids(a);this.threadLoading(c<
Math.min(this.threadUids().length,this.threadCountForLoad()))};F.prototype.showNextLoadingLink=function(a){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=a)};F.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5);e.MailCache.showOpenedThreads(this.folder())};F.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=
null)};F.prototype.markAsThreadPart=function(a){var c=this;this.threadPart(!0);this.threadUids([]);this.threadNextLoadingVisible(!1);this.threadNextLoadingLinkVisible(!0);this.threadFunctionLoadNext=null;this.threadHideAnimation(!1);setTimeout(function(){c.threadShowAnimation(!0)},a)};F.prototype.parse=function(a,c,b,d){var e=null,e=null;d&&this.threadPart(b);"Object/MessageListItem"===a["@Object"]&&(this.seen(!!a.IsSeen),this.flagged(!!a.IsFlagged),this.answered(!!a.IsAnswered),this.forwarded(!!a.IsForwarded));
if("Object/Message"===a["@Object"]||"Object/MessageListItem"===a["@Object"])if(this.accountId(c),this.folder(a.Folder),this.uid(a.Uid.toString()),this.subject(a.Subject),this.messageId(a.MessageId),this.size(a.Size),this.textSize(a.TextSize),this.oDateModel.parse(a.TimeStampInUTC),this.oFrom.parse(a.From),this.oTo.parse(a.To),this.fillFromOrToText(),this.oCc.parse(a.Cc),this.oBcc.parse(a.Bcc),this.oSender.parse(a.Sender),this.oReplyTo.parse(a.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),
this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!a.HasAttachments),"Object/MessageListItem"===a["@Object"]&&d&&this.threadUids(_.map(a.Threads,function(a){return a.toString()},this)),this.importance(a.Priority),_.isArray(a.DraftInfo)&&this.draftInfo(a.DraftInfo),this.sensitivity(a.Sensitivity),this.hash(a.Hash),"Object/Message"===a["@Object"])this.inReplyTo(a.InReplyTo),this.references(a.References),this.readingConfirmation(a.ReadingConfirmation),
""!==a.Html?(this.text(a.Html),this.isPlain(!1)):(this.text(""!==a.Plain?"<div>"+a.Plain+"</div>":""),this.isPlain(!0)),this.rtl(a.Rtl),this.hasExternals(!!a.HasExternals),this.foundedCids(a.FoundedCIDs),this.parseAttachments(a.Attachments,c),this.safety(a.Safety),null!==a.ICAL&&(e=new M,e.parse(a.ICAL),this.ical(e)),null!==a.VCARD&&(e=new bb,e.parse(a.VCARD),this.vcard(e)),this.completelyFilled(!0)};F.prototype.getDomText=function(a){var c=this.$text,a=a||"";if(null===this.$text||""!==a)this.completelyFilled()?
(this.$text=i(this.text()),this.showInlinePictures(a),!0===this.safety()&&this.alwaysShowExternalPicturesForSender(),c=this.$text):c=i("");return c.clone()};F.prototype.parseAttachments=function(a,c){_.isArray(a)&&this.attachments(_.map(a,function(a){var b=new J(this.folder(),this.uid());b.parse(a,c);return b},this))};F.prototype.parseAddressArray=function(a){var c=[];_.isArray(a)&&(c=_.map(a,function(a){var c=new ua;c.parse(a);return c}));return c};F.prototype.findAttachmentByCid=function(a){a="<"+
a+">";return _.find(this.attachments(),function(c){return c.cid()===a})};F.prototype.showInlinePictures=function(a){var c=this;0<this.foundedCids().length&&(i("[data-x-src-cid]",this.$text).each(function(){var b=i(this).attr("data-x-src-cid");(b=c.findAttachmentByCid(b))&&0<b.viewLink().length&&i(this).attr("src",a+b.viewLink())}),i("[data-x-style-cid]",this.$text).each(function(){var a="",b=i(this).attr("data-x-style-cid-name"),a=i(this).attr("data-x-style-cid"),e=c.findAttachmentByCid(a);e&&(0<
e.viewLink().length&&""!==b)&&(a=d.trim(i(this).attr("style")),a=""===a?"":";"===a.substr(-1)?a+" ":a+"; ",i(this).attr("style",a+b+": url('"+e.viewLink()+"')"))}))};F.prototype.showExternalPictures=function(){i("[data-x-src]",this.$text).each(function(){i(this).attr("src",i(this).attr("data-x-src")).removeAttr("data-x-src")});i("[data-x-style-url]",this.$text).each(function(){var a=d.trim(i(this).attr("style")),a=""===a?"":";"===a.substr(-1)?a+" ":a+"; ";i(this).attr("style",a+i(this).attr("data-x-style-url")).removeAttr("data-x-style-url")});
this.isExternalsShown(!0)};F.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())};F.prototype.openThread=function(){if(this.threadCountVisible()){var a=this.folder();this.threadOpened(!this.threadOpened());this.threadOpened()?e.MailCache.showOpenedThreads(a):(e.MailCache.hideThreads(this),setTimeout(function(){e.MailCache.showOpenedThreads(a)},500))}};Ha.prototype.addThreadUids=function(a,
c){-1!==_.indexOf(this.collection(),a)&&(this.threadUids[a]=c)};Ha.prototype.setUidsAndCount=function(a){"Collection/MessageCollection"===a["@Object"]&&(_.each(a.Uids,function(c,b){this.collection()[b+a.Offset]=c.toString()},this),this.resultCount(a.MessageResultCount))};Ha.prototype.getUidsForOffset=function(a,c){for(var b=0,d=this.collection().length,e="",f=0,i=[],j=null;b<d;b++)if(b>=a&&f<h.User.MailsPerPage&&(e=this.collection()[b],(j=c[e])&&!j.deleted()||void 0===e))f++,void 0!==e&&i.push(e);
return i};Ha.prototype.deleteUids=function(a){for(var c=0,b=this.collection().length,d="",e=[],f=0;c<b;c++)d=this.collection()[c],-1===_.indexOf(a,d)?e.push(d):f++;this.collection(e);this.resultCount(this.resultCount()-f)};M.prototype.fillDecisions=function(){var a=h.Accounts.getCurrent(),a=a?a.email():"";this.cancelDecision(d.i18n("MESSAGE/APPOINTMENT_CANCELED",{SENDER:a}));switch(this.icalConfig()){case f.IcalConfig.Accepted:this.replyDecision(d.i18n("MESSAGE/APPOINTMENT_ACCEPTED",{SENDER:a}));
break;case f.IcalConfig.Declined:this.replyDecision(d.i18n("MESSAGE/APPOINTMENT_DECLINED",{SENDER:a}));break;case f.IcalConfig.Tentative:this.replyDecision(d.i18n("MESSAGE/APPOINTMENT_TENTATIVELY_ACCEPTED",{SENDER:a}))}};M.prototype.parse=function(a){a&&"Object/CApiMailIcs"===a["@Object"]&&(this.uid(a.Uid.toString()),this.file(a.File),this.type(a.Type),this.location(a.Location),this.description(a.Description.replace(/\r/g,"").replace(/\n/g,"<br />")),this.when(a.When),this.calendarId(a.CalendarId),
this.selectedCalendar(a.CalendarId))};M.prototype.acceptAppointment=function(){this.calendarId(this.selectedCalendar());this.changeAndSaveConfig(f.IcalConfig.Accepted)};M.prototype.tentativeAppointment=function(){this.calendarId(this.selectedCalendar());this.changeAndSaveConfig(f.IcalConfig.Tentative)};M.prototype.declineAppointment=function(){this.calendarId("");this.selectedCalendar("");this.changeAndSaveConfig(f.IcalConfig.Declined)};M.prototype.changeAndSaveConfig=function(a){this.icalConfig()!==
a&&(a!==f.IcalConfig.Declined||this.icalConfig()!==f.IcalConfig.NeedsAction)&&e.CalendarCache.recivedAnim(!0);this.changeConfig(a);this.doProcessAppointment()};M.prototype.changeConfig=function(a){this.type(this.icalType()+"-"+a)};M.prototype.onProcessAppointmentResponse=function(a){a.Result?e.CalendarCache&&e.CalendarCache.calendarChanged(!0):e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/UNKNOWN_ERROR"))};M.prototype.doProcessAppointment=function(){var a={Action:"ProcessAppointment",AppointmentAction:this.icalConfig(),
CalendarId:this.selectedCalendar(),File:this.file()};e.Ajax.send(a,this.onProcessAppointmentResponse,this)};M.prototype.onAddEventResponse=function(a){a.Result?a.Result.Uid&&this.uid(a.Result.Uid):e.Api.showErrorByCode(a.ErrorCode)};M.prototype.addEvent=function(){var a={Action:"SaveIcs",CalendarId:this.selectedCalendar(),File:this.file()};e.Ajax.send(a,this.onAddEventResponse,this);this.isJustSaved(!0);this.calendarId(this.selectedCalendar());setTimeout(_.bind(function(){this.isJustSaved(!1)},this),
2E4);e.CalendarCache.recivedAnim(!0)};M.prototype.onEventDelete=function(){this.calendarId("");this.selectedCalendar("");this.changeConfig(f.IcalConfig.NeedsAction)};M.prototype.onEventTentative=function(){this.changeConfig(f.IcalConfig.Tentative)};M.prototype.onEventAccept=function(){this.changeConfig(f.IcalConfig.Accepted)};M.prototype.firstCalendarName=function(){return this.calendars()[0]?this.calendars()[0].name:""};bb.prototype.parse=function(a){a&&"Object/CApiMailVcard"===a["@Object"]&&(this.uid(a.Uid.toString()),
this.file(a.File),this.name(a.Name),this.email(a.Email),this.isExists(a.Exists))};bb.prototype.onAddContactResponse=function(a){a&&(a.Result&&a.Result.Uid)&&this.uid(a.Result.Uid)};bb.prototype.addContact=function(){var a={Action:"SaveVcf",File:this.file()};e.Ajax.send(a,this.onAddContactResponse,this);this.isJustSaved(!0);this.isExists(!0);setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2E4);e.ContactsCache.recivedAnim(!0)};w.birthdayMonths=d.getMonthNamesArray();w.birthdayMonthSelect=[{text:d.i18n("DATETIME/MONTH"),
value:"0"},{text:w.birthdayMonths[0],value:"1"},{text:w.birthdayMonths[1],value:"2"},{text:w.birthdayMonths[2],value:"3"},{text:w.birthdayMonths[3],value:"4"},{text:w.birthdayMonths[4],value:"5"},{text:w.birthdayMonths[5],value:"6"},{text:w.birthdayMonths[6],value:"7"},{text:w.birthdayMonths[7],value:"8"},{text:w.birthdayMonths[8],value:"9"},{text:w.birthdayMonths[9],value:"10"},{text:w.birthdayMonths[10],value:"11"},{text:w.birthdayMonths[11],value:"12"}];w.birthdayYearSelect=[{text:d.i18n("DATETIME/YEAR"),
value:"0"}];w.prototype.getSendMailLink=function(a){a=e.Links.composeWithToField(a);return e.Routing.buildHashFromArray(a)};w.prototype.clear=function(){this.isNew(!1);this.readOnly(!1);this.idContact("");this.idUser("");this.global(!1);this.itsMe(!1);this.edited(!1);this.extented(!1);this.personalCollapsed(!1);this.businessCollapsed(!1);this.otherCollapsed(!1);this.groupsCollapsed(!1);this.displayName("");this.firstName("");this.lastName("");this.nickName("");this.skype("");this.facebook("");this.primaryEmail(this.sEmailDefaultType);
this.primaryPhone(this.sPhoneDefaultType);this.primaryAddress(this.sAddressDefaultType);this.personalEmail("");this.personalStreetAddress("");this.personalCity("");this.personalState("");this.personalZipCode("");this.personalCountry("");this.personalWeb("");this.personalFax("");this.personalPhone("");this.personalMobile("");this.businessEmail("");this.businessCompany("");this.businessDepartment("");this.businessJob("");this.businessOffice("");this.businessStreetAddress("");this.businessCity("");this.businessState("");
this.businessZipCode("");this.businessCountry("");this.businessWeb("");this.businessFax("");this.businessPhone("");this.otherEmail("");this.otherBirthdayMonth("0");this.otherBirthdayDay("0");this.otherBirthdayYear("0");this.otherNotes("");this.etag("");this.groups([])};w.prototype.switchToNew=function(){this.clear();this.edited(!0);this.extented(!1);this.isNew(!0);this.displayNameFocused(!0)};w.prototype.switchToView=function(){this.edited(!1);this.extented(!1)};w.prototype.toObject=function(){return{ContactId:this.idContact(),
PrimaryEmail:this.primaryEmail(),PrimaryPhone:this.primaryPhone(),PrimaryAddress:this.primaryAddress(),UseFriendlyName:"1",Title:"",FullName:this.displayName(),FirstName:this.firstName(),LastName:this.lastName(),NickName:this.nickName(),Global:this.global()?"1":"0",ItsMe:this.itsMe()?"1":"0",Skype:this.skype(),Facebook:this.facebook(),HomeEmail:this.personalEmail(),HomeStreet:this.personalStreetAddress(),HomeCity:this.personalCity(),HomeState:this.personalState(),HomeZip:this.personalZipCode(),HomeCountry:this.personalCountry(),
HomeFax:this.personalFax(),HomePhone:this.personalPhone(),HomeMobile:this.personalMobile(),HomeWeb:this.personalWeb(),BusinessEmail:this.businessEmail(),BusinessCompany:this.businessCompany(),BusinessJobTitle:this.businessJob(),BusinessDepartment:this.businessDepartment(),BusinessOffice:this.businessOffice(),BusinessStreet:this.businessStreetAddress(),BusinessCity:this.businessCity(),BusinessState:this.businessState(),BusinessZip:this.businessZipCode(),BusinessCountry:this.businessCountry(),BusinessFax:this.businessFax(),
BusinessPhone:this.businessPhone(),BusinessWeb:this.businessWeb(),OtherEmail:this.otherEmail(),Notes:this.otherNotes(),ETag:this.etag(),BirthdayDay:this.otherBirthdayDay(),BirthdayMonth:this.otherBirthdayMonth(),BirthdayYear:this.otherBirthdayYear(),GroupsIds:this.groups()}};w.prototype.parse=function(a){if(a&&"Object/CContact"===a["@Object"]){this.idContact(d.pExport(a,"IdContact","").toString());this.idUser(d.pExport(a,"IdUser","").toString());this.global(!!d.pExport(a,"Global",!1));this.itsMe(!!d.pExport(a,
"ItsMe",!1));this.readOnly(!!d.pExport(a,"ReadOnly",!1));this.displayName(d.pExport(a,"FullName",""));this.firstName(d.pExport(a,"FirstName",""));this.lastName(d.pExport(a,"LastName",""));this.nickName(d.pExport(a,"NickName",""));this.skype(d.pExport(a,"Skype",""));this.facebook(d.pExport(a,"Facebook",""));var c=d.pInt(d.pExport(a,"PrimaryEmail",0));switch(c){case 1:c=f.ContactEmailType.Business;break;case 2:c=f.ContactEmailType.Other;break;default:case 0:c=f.ContactEmailType.Personal}this.primaryEmail(c);
c=d.pInt(d.pExport(a,"PrimaryPhone",0));switch(c){case 2:c=f.ContactPhoneType.Business;break;case 1:c=f.ContactPhoneType.Personal;break;default:case 0:c=f.ContactPhoneType.Mobile}this.primaryPhone(c);c=d.pInt(d.pExport(a,"PrimaryAddress",0));switch(c){case 1:c=f.ContactAddressType.Business;break;default:case 0:c=f.ContactAddressType.Personal}this.primaryAddress(c);this.personalEmail(d.pExport(a,"HomeEmail",""));this.personalStreetAddress(d.pExport(a,"HomeStreet",""));this.personalCity(d.pExport(a,
"HomeCity",""));this.personalState(d.pExport(a,"HomeState",""));this.personalZipCode(d.pExport(a,"HomeZip",""));this.personalCountry(d.pExport(a,"HomeCountry",""));this.personalWeb(d.pExport(a,"HomeWeb",""));this.personalFax(d.pExport(a,"HomeFax",""));this.personalPhone(d.pExport(a,"HomePhone",""));this.personalMobile(d.pExport(a,"HomeMobile",""));this.businessEmail(d.pExport(a,"BusinessEmail",""));this.businessCompany(d.pExport(a,"BusinessCompany",""));this.businessDepartment(d.pExport(a,"BusinessDepartment",
""));this.businessJob(d.pExport(a,"BusinessJobTitle",""));this.businessOffice(d.pExport(a,"BusinessOffice",""));this.businessStreetAddress(d.pExport(a,"BusinessStreet",""));this.businessCity(d.pExport(a,"BusinessCity",""));this.businessState(d.pExport(a,"BusinessState",""));this.businessZipCode(d.pExport(a,"BusinessZip",""));this.businessCountry(d.pExport(a,"BusinessCountry",""));this.businessWeb(d.pExport(a,"BusinessWeb",""));this.businessFax(d.pExport(a,"BusinessFax",""));this.businessPhone(d.pExport(a,
"BusinessPhone",""));this.otherEmail(d.pExport(a,"OtherEmail",""));this.otherBirthdayMonth(d.pExport(a,"BirthdayMonth","0").toString());this.otherBirthdayDay(d.pExport(a,"BirthdayDay","0").toString());this.otherBirthdayYear(d.pExport(a,"BirthdayYear","0").toString());this.otherNotes(d.pExport(a,"Notes",""));this.etag(d.pExport(a,"ETag",""));a=d.pExport(a,"GroupsIds",[]);_.isArray(a)&&this.groups(a)}};w.prototype.getFullEmail=function(a){var c=a;""!==this.displayName()&&(c=""!==a?'"'+this.displayName()+
'" <'+a+">":this.displayName());return c};w.prototype.viewAllMails=function(){e.MailCache.searchMessagesInInbox("email:"+this.email())};w.prototype.sendThisContact=function(){e.Routing.goDirectly(e.Links.compose(),["vcard",this])};w.prototype.isStrLink=function(a){return/^http/.test(a)};w.prototype.onCallClick=function(a){e.Phone.call(d.getFormattedPhone(a))};Ba.prototype.clear=function(){this.isNew(!1);this.idGroup("");this.idUser("");this.name("");this.nameFocused(!1);this.edited(!1)};Ba.prototype.switchToNew=
function(){this.clear();this.edited(!0);this.isNew(!0);this.nameFocused(!0)};Ba.prototype.switchToView=function(){this.edited(!1)};Ba.prototype.toObject=function(){return{GroupId:this.idGroup(),Name:this.name()}};X.prototype.parse=function(a,c){a&&"Object/CContactListItem"===d.pExport(a,"@Object","")&&(this.sId=a.Id.toString(),this.sName=a.Name.toString(),this.sEmail=a.Email.toString(),this.bIsGroup=!!a.IsGroup,this.bReadOnly=!!a.ReadOnly,this.bItsMe=!!a.ItsMe,this.bGlobal=d.isUnd(c)?!1:!!c)};X.prototype.IsGroup=
function(){return this.bIsGroup};X.prototype.Global=function(){return this.bGlobal};X.prototype.ReadOnly=function(){return this.bReadOnly};X.prototype.ItsMe=function(){return this.bItsMe};X.prototype.Id=function(){return this.sId};X.prototype.Name=function(){return this.sName};X.prototype.Email=function(){return this.sEmail};X.prototype.EmailAndName=function(){return this.sName&&this.sEmail&&0<this.sName.length&&0<this.sEmail.length?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail};va.prototype.parse=
function(a){this.id=a.Id;this.name(a.Name);this.description(a.Description||"");this.owner(a.Owner||"");var c=e.Storage.hasData(a.Id)?e.Storage.getData(a.Id):!0;this.active(c);this.isDefault=a.IsDefault;this.access=a.Access;this.isShared=a.Shared;this.isPublic(a.IsPublic);this.color(a.Color);this.url(a.Url);this.davUrl(a.ServerUrl);this.exportUrl(d.getAppPath()+"?/Raw/Calendars/0/"+a.ExportHash);this.pubUrl(d.getAppPath()+"?calendar-pub="+a.PubHash);this.shares(a.Shares||[]);_.each(a.Events,function(a){this.addEvent(a)},
this)};va.prototype.eventExists=function(a){return _.find(this.events,function(c){return a===c.id})};va.prototype.addEvent=function(a){a&&!this.eventExists(a.id)&&(a.backgroundColor=this.color(),a.borderColor=this.color(),a.title=d.getTitleForEvent(a.subject),this.events.push(a))};va.prototype.removeEvent=function(a){this.events=_.filter(this.events,function(c){return c.id!==a},this)};va.prototype.removeEventByUid=function(a,c){d.isUnd(c)&&(c=!1);this.events=_.filter(this.events,function(b){return b.uid!==
a&&(!c||!b.excluded)},this)};va.prototype.removeEvents=function(){this.events=[]};va.prototype.isEditable=function(){return this.access!==f.CalendarAccess.Read};ka.prototype.pickCurrentCalendar=function(a){var c=_.find(this.collection(),function(a){return a.active()},this);if(!this.currentCal()||!this.currentCal().active())a&&a.active()?this.currentCal(a):this.defaultCal()&&(this.defaultCal().active()||!c)?this.currentCal(this.defaultCal()):c&&this.currentCal(c)};ka.prototype.hideOtherCalendars=function(a){_.each(this.collection(),
function(c){c.active(c.id===a)},this)};ka.prototype.getCalendarById=function(a){return _.find(this.collection(),function(c){return c.id===a},this)};ka.prototype.getEvents=function(){var a=[];_.each(this.collection(),function(c){c.active()&&(a=_.union(a,c.events))},this);return a};ka.prototype.parseAndAddCalendar=function(a){var c=new va;c.parse(a);c.active.subscribe(function(a){this.parentOnCalendarActiveChange(c);var b=c.active()?c:this.defaultCal();this.pickCurrentCalendar(b);e.Storage.setData(c.id,
a)},this);c.isDefault&&this.defaultCal(c);(a=this.calendarExists(c.id))||0===a?this.collection.splice(a,1,c):this.collection.push(c);return c};ka.prototype.calendarExists=function(a){a=_.indexOf(_.map(this.collection(),function(a){return a.id}),a);return 0>a?!1:a};ka.prototype.removeCalendar=function(a){this.collection(_.filter(this.collection(),function(c){return c.id!==a},this))};ka.prototype.clearCollection=function(){this.collection.removeAll()};ka.prototype.getColors=function(){return _.map(this.collection(),
function(a){return a.color()},this)};Y.prototype.onDownloadClick=function(){e.downloadByUrl(this.download())};Y.prototype.onViewClick=function(){var a=null,a=d.getAppPath()+this.view();(a=d.WindowOpener.open(a,a,!1))&&a.focus()};Y.prototype.eventDragStart=function(a,c){var b=c.originalEvent||c;a&&(b&&b.dataTransfer&&b.dataTransfer.setData)&&b.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl());return!0};Y.prototype.generateTransferDownloadUrl=function(){var a=this.download();"http"!==
a.substr(0,4)&&(a=j.location.protocol+"//"+j.location.host+j.location.pathname+a);return this.storageType()+":"+this.name()+":"+a};mb.prototype.parse=function(a){this.Id=a.IdHelpdeskPost;this.IdThread=a.IdHelpdeskThread;this.IdOwner=a.IdOwner;this.bThreadOwner=a.IsThreadOwner;this.sFrom=d.isNonEmptyArray(a.Owner)?a.Owner[1]||a.Owner[0]||"":"";this.sDate=T.prototype.convertDate(a.Created);this.iType=a.Type;this.bSysType=a.SystemType;this.sText=a.Text.toString();this.itsMe(a.ItsMe);if(a.Attachments){for(var c=
0,b=0,e=null,f=[],b=a.Attachments.length;c<b;c++)a.Attachments[c]&&"Object/CHelpdeskAttachment"===d.pExport(a.Attachments[c],"@Object","")&&(e=new wa,e.parse(a.Attachments[c]),f.push(e));this.attachments(f)}};Wa.prototype.parse=function(a){this.Id=a.IdHelpdeskThread;this.ThreadHash=a.ThreadHash;this.IdOwner=a.IdOwner;this.ItsMe=!!a.ItsMe;this.sSubject=a.Subject.toString();this.sDate=moment(1E3*a.Updated).fromNow(!1);this.aOwner=d.isNonEmptyArray(a.Owner)?a.Owner:["",""];this.sEmail=this.aOwner[0]||
"";this.sFrom=(this.sName=this.aOwner[1]||"")||this.sEmail;this.sFromFull=d.trim(""===this.sName?this.sEmail:this.sName+(""!==this.sEmail?" ("+this.sEmail+")":""));this.postsCount(a.PostCount);this.state(a.Type);this.unseen(!a.IsRead)};Wa.prototype.Name=function(){return this.sName};Wa.prototype.Email=function(){return this.sEmail};wa.prototype.parse=function(a){a&&(this.type(a.MimeType.toString()),this.fileName(a.FileName.toString()),this.size(d.pInt(a.SizeInBytes)),this.hash(a.Hash),this.uploaded(!0))};
wa.prototype.onUploadSelect=function(a,c){this.fileName(c.FileName);this.type(c.Type);this.size(d.pInt(c.Size));this.uploadUID(a);this.uploaded(!1);this.visibleSpinner(!1);this.statusText("");this.progressPercent(0);this.visibleProgress(!1)};wa.prototype.onUploadStart=function(){this.visibleSpinner(!0);this.visibleProgress(!0)};wa.prototype.onUploadProgress=function(a,c){0<c&&(this.progressPercent(Math.ceil(100*(a/c))),this.visibleProgress(!0))};wa.prototype.onUploadComplete=function(a,c,b){var e=
this,a=!c||!b||b.Error||!1,c=b&&"size"===b.Error?d.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):d.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN");this.visibleSpinner(!1);this.progressPercent(0);this.visibleProgress(!1);a?(this.uploaded(!0),this.uploadError(!0),this.statusText(c)):(this.tempName(b.Result.HelpdeskFile.TempName),this.uploadError(!1),this.uploaded(!0),this.type(b.Result.HelpdeskFile.MimeType),this.hash(b.Result.HelpdeskFile.Hash),this.statusText(d.i18n("COMPOSE/UPLOAD_COMPLETE")),j.setTimeout(function(){e.statusText("")},
3E3))};wa.prototype.viewAttachment=function(){var a=null,a="";this.visibleViewLink()&&(0<this.viewLink().length&&"#"!==this.viewLink())&&(a=d.getAppPath()+this.viewLink(),(a=d.WindowOpener.open(a,a,!1))&&a.focus())};wa.prototype.downloadAttachment=function(){0<this.downloadLink().length&&"#"!==this.downloadLink()&&e.downloadByUrl(this.downloadLink())};hb.prototype.parse=function(a,c){this.iAccountId=a;this.options(parseInt(c.Options,10));this.signature(c.Signature)};nb.prototype.parse=function(a,
c){this.iAccountId=a;this.enable=!!c.Enable;this.subject=d.pString(c.Subject);this.message=d.pString(c.Message)};ib.prototype.parse=function(a,c){this.idAccount=a;var b=[],d=0,e=0,f=null,h=null;if(_.isArray(c))for(e=c.length;d<e;d++)h=c[d],f=new ub,f.idFetcher(h.IdFetcher),f.idAccount(h.IdAccount),f.isEnabled(h.IsEnabled),f.isLocked(h.IsLocked),f.email(h.Email),f.userName(h.Name),f.folder(h.Folder),f.signature(h.Signature),f.incomingMailServer(h.IncomingMailServer),f.incomingMailPort(h.IncomingMailPort),
f.incomingMailLogin(h.IncomingMailLogin),f.leaveMessagesOnServer(h.LeaveMessagesOnServer),f.isOutgoingEnabled(h.IsOutgoingEnabled),f.outgoingMailServer(h.OutgoingMailServer),f.outgoingMailPort(h.OutgoingMailPort),f.outgoingMailAuth(h.OutgoingMailAuth),b.push(f);this.collection(b)};ib.prototype.getFetcher=function(a){for(var c=null,b=0,d=0,e=this.collection(),d=e.length;b<d;b++)e[b].idFetcher()===a&&(c=e[b]);return c};ob.prototype.parse=function(a,c){this.iAccountId=a;this.enable=!!c.Enable;this.email=
d.pString(c.Email)};pb.prototype.parse=function(a,c){var b=0,d=c.length,e=null;this.iAccountId=a;if(_.isArray(c))for(d=c.length;b<d;b++)e=new cb(a),e.parse(c[b]),this.collection.push(e)};cb.prototype.parse=function(a){this.enable(!!a.Enable);this.field(d.pInt(a.Field));this.condition(d.pInt(a.Condition));this.filter(d.pString(a.Filter));this.action(d.pInt(a.Action));this.folder(d.pString(a.FolderFullName))};cb.prototype.toString=function(){return[this.enable(),this.field(),this.condition(),this.filter(),
this.action(),this.folder()].join(":")};Oa.prototype.showLoading=function(a){a&&""!==a?this.loadingMessage(a):this.loadingMessage(d.i18n("MAIN/LOADING"));this.loadingVisible(!0)};Oa.prototype.hideLoading=function(){this.loadingVisible(!1)};Oa.prototype.showReport=function(a,c){var b=this,c=c||5E3;a&&""!==a?(this.reportMessage(a),this.reportVisible(!0),isNaN(this.iReportTimeout)||clearTimeout(this.iReportTimeout),this.iReportTimeout=setTimeout(function(){b.reportVisible(!1)},c)):this.reportVisible(!1)};
Oa.prototype.showError=function(a,c,b){var d=this;a&&""!==a?(this.errorNotHide(!!b),this.errorMessage(a),this.errorVisible(!0),this.isHtmlError(c),clearTimeout(this.iErrorTimeout),b||(this.iErrorTimeout=setTimeout(function(){d.errorVisible(!1)},5E3))):this.errorVisible(!1)};Oa.prototype.hideError=function(){this.errorVisible(!1)};Xa.prototype.gotoMailbox=function(){e.Routing.setLastMailboxHash();return!1};Xa.prototype.onRoute=function(){this.changeCurrentAccount()};Xa.prototype.changeCurrentAccount=
function(){this.email(h.Accounts.getEmail())};Xa.prototype.logout=function(){e.logout()};da.prototype.clear=function(){this.currentPage(1);this.count(0)};da.prototype.setCount=function(a){this.count(a);this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())};da.prototype.setPage=function(a,c){this.perPage(c);a>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(a)};da.prototype.clickPage=function(a){a=a.number;1>a&&(a=1);a>this.pagesCount()&&(a=this.pagesCount());
this.currentPage(a)};da.prototype.clickFirstPage=function(){this.currentPage(1)};da.prototype.clickPreviousPage=function(){var a=this.firstPage()-1;1>a&&(a=1);this.currentPage(a)};da.prototype.clickNextPage=function(){var a=this.lastPage()+1;a>this.pagesCount()&&(a=this.pagesCount());this.currentPage(a)};da.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())};r.prototype.init=function(){i(document.body).on("click",_.bind(function(){this.closeAllPopups()},this));i(this.colorPickerDropdownDom()).on("click",
function(a){a.stopPropagation()});i(this.insertLinkDropdownDom()).on("click",function(a){a.stopPropagation()});i(this.insertImageDropdownDom()).on("click",function(a){a.stopPropagation()});this.initEditorUploader()};r.prototype.showLinkPopup=function(a){var c=i(this.workareaDom()).position(),b=a.position(),d=a.height();this.linkHref(a.attr("href"));this.linkPopupLeft(Math.round(b.left+c.left));this.linkPopupTop(Math.round(b.top+d+c.top));this.visibleLinkPopup(!0)};r.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)};
r.prototype.showChangeLink=function(){this.visibleLinkHref(!0);this.hideLinkPopup()};r.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref());this.hideChangeLink()};r.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)};r.prototype.showImagePopup=function(a,c){var b=i(this.workareaDom()),d=b.position(),b=b.offset();this.imagePopupLeft(Math.round(c.pageX+d.left-b.left));this.imagePopupTop(Math.round(c.pageY+d.top-b.top));this.visibleImagePopup(!0)};r.prototype.hideImagePopup=
function(){this.visibleImagePopup(!1)};r.prototype.resizeImage=function(a){var c={width:"auto"};switch(a){case f.HtmlEditorImageSizes.Small:c.width="100px";break;case f.HtmlEditorImageSizes.Medium:c.width="300px";break;case f.HtmlEditorImageSizes.Large:c.width="600px";break;case f.HtmlEditorImageSizes.Original:c.width="auto"}this.oCrea.changeCurrentImage(c);this.visibleImagePopup(!1)};r.prototype.initCrea=function(a,c){this.oCrea?(this.setText(a),this.oCrea.setTabIndex(c)):(this.init(),this.oCrea=
new Crea({creaId:this.creaId,tabindex:c,text:a,fontNameArray:this.aFonts,defaultFontName:this.iDefaultFont,defaultFontSize:this.iDefaultSize,enableDrop:!1,onCursorMove:_.bind(this.setFontValuesFromText,this),onFocus:_.bind(this.onCreaFocus,this),onUrlIn:_.bind(this.showLinkPopup,this),onUrlOut:_.bind(this.hideLinkPopup,this),onImageIn:_.bind(this.showImagePopup,this),onImageOut:_.bind(this.hideImagePopup,this)}))};r.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)};r.prototype.changeSignatureContent=
function(a){this.oCrea&&this.oCrea.changeSignatureContent(a)};r.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0);this.selectedFont(this.oCrea.getFontName());this.selectedSize(this.oCrea.getFontSize());this.lockFontSubscribing(!1)};r.prototype.getText=function(a){return this.oCrea?this.oCrea.getText(a):""};r.prototype.setText=function(a){this.oCrea&&(this.oCrea.setText(a),this.inactive.valueHasMutated())};r.prototype.removeAllTags=function(a){return a.replace(/<style>.*<\/style>/g,
"").replace(/<[^>]*>/g,"")};r.prototype.setActivitySource=function(a){this.activitySource=a;this.activitySource.subscribe(function(){this.inactive(0===d.pInt(this.activitySource()))},this);this.inactive(0===d.pInt(this.activitySource()))};r.prototype.onCreaFocus=function(){this.isEnable()&&this.oCrea?(this.oCrea.$editableArea.attr("contenteditable",!0),this.closeAllPopups(),this.activitySource(1)):this.oCrea&&this.oCrea.$editableArea.attr("contenteditable",!1)};r.prototype.closeAllPopups=function(){this.visibleInsertLinkPopup(!1);
this.visibleInsertImagePopup(!1);this.visibleFontColorPopup(!1)};r.prototype.insertLink=function(){this.visibleInsertLinkPopup()||(this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))};r.prototype.insertLinkFromPopup=function(a,c){0<this.linkForInsert().length&&this.oCrea.insertLink(this.linkForInsert());this.closeInsertLinkPopup(a,c)};r.prototype.closeInsertLinkPopup=function(a,c){this.visibleInsertLinkPopup(!1);c&&c.stopPropagation()};
r.prototype.textColor=function(){this.closeAllPopups();this.visibleFontColorPopup(!0);this.oFontColorPicker.onShow();this.oBackColorPicker.onShow()};r.prototype.colorToHex=function(a){if("#"===a.substr(0,1))return a;for(var a=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a),c=parseInt(a[2],10),b=parseInt(a[3],10),c=(parseInt(a[4],10)|b<<8|c<<16).toString(16);6>c.length;)c="0"+c;return a[1]+"#"+c};r.prototype.setTextColorFromPopup=function(a){this.oCrea.textColor(this.colorToHex(a));this.visibleFontColorPopup(!1)};
r.prototype.setBackColorFromPopup=function(a){this.oCrea.backgroundColor(this.colorToHex(a));this.visibleFontColorPopup(!1)};r.prototype.insertImage=function(){this.allowInsertImage()&&!this.visibleInsertImagePopup()&&(this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader());return!0};r.prototype.insertWebImageFromPopup=function(a,c){this.allowInsertImage()&&0<this.imagePathFromWeb().length&&this.oCrea.insertImage(this.imagePathFromWeb());this.closeInsertImagePopup(a,
c)};r.prototype.clearImages=function(){this.uploadedImagePathes([])};r.prototype.insertComputerImageFromPopup=function(a,c){var b=d.getViewLinkByHash(h.Accounts.currentId(),c.Hash),e=!1;if(this.allowInsertImage()&&0<b.length&&(e=this.oCrea.insertImage(b)))i(this.oCrea.$editableArea).find('img[src="'+b+'"]').attr("data-x-src-cid",a),c.CID=a,this.uploadedImagePathes.push(c);this.closeInsertImagePopup()};r.prototype.closeInsertImagePopup=function(a,c){this.visibleInsertImagePopup(!1);c&&c.stopPropagation()};
r.prototype.initUploader=function(){this.imageUploaderButton()&&!this.oJua&&(this.oJua=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:{Token:function(){return h.Token},AccountID:function(){return h.Accounts.currentId()}},onSelect:_.bind(this.onFileUploadSelect,this),onComplete:_.bind(this.onFileUploadComplete,this)}))};r.prototype.initEditorUploader=function(){if(this.uploaderAreaDom()&&
!this.editorUploader){var a=h.App.AllowInsertImage?_.bind(this.editorUploaderBodyDragOver,this,!0):function(){},c=h.App.AllowInsertImage?_.bind(this.editorUploaderBodyDragOver,this,!1):function(){};this.editorUploader=new Jua({queueSize:1,dragAndDropElement:this.uploaderAreaDom(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!1,onBodyDragEnter:a,onBodyDragLeave:c,onSelect:_.bind(this.onEditorDrop,this)})}};r.prototype.onEditorDrop=function(a,c){var b=null,f=null,v=this,i=!1,A=Math.random().toString();
h.App.AllowInsertImage&&(c&&c.File.type&&0===c.File.type.indexOf("image/"))&&(f=c.File,0<h.App.ImageUploadSizeLimit&&f.size>h.App.ImageUploadSizeLimit?e.Screens.showPopup(R,[d.i18n("COMPOSE/UPLOAD_ERROR_SIZE")]):(b=new j.FileReader,(i=this.oCrea.bFocused)||this.oCrea.setFocus(!0),this.oCrea.insertHtml('<img id="'+f.name+"_"+A+'" src="skins/Default/images/wait.gif" />'),i||this.oCrea.fixFirefoxCursorBug(),b.onload=function(a){v.oCrea.$editableArea.find('img[id="'+f.name+"_"+A+'"]').attr("src",a.target.result)},
b.readAsDataURL(f)));return!1};r.prototype.isFileImage=function(a){if("string"===typeof a.Type)return-1!==a.Type.indexOf("image");var c=a.FileName.lastIndexOf("."),a=a.FileName.substr(c+1);return-1!==i.inArray(a,"jpg jpeg gif tif tiff png".split(" "))};r.prototype.onFileUploadSelect=function(a,c){if(!this.isFileImage(c))return e.Screens.showPopup(R,[d.i18n("HTMLEDITOR/UPLOAD_ERROR_NOT_IMAGE")]),!1;this.closeInsertImagePopup();return!0};r.prototype.onFileUploadComplete=function(a,c,b){c="";b&&b.Result?
b.Result.Error?(c="size"===b.Result.Error?d.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):d.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"),e.Screens.showPopup(R,[c])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(a,b.Result.Attachment)):e.Screens.showPopup(R,[d.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN")])};r.prototype.stateSwitcher=function(a){this.isEnable(a)};db.prototype.onShow=function(){i(this.colorPickerDom()).find("span.color-item").on("click",function(a){return function(){a.setColorFromPopup(i(this).data("color"))}}(this))};
db.prototype.setColorFromPopup=function(a){this.pickHandler.call(this.pickContext,a)};Pa.prototype.hangup=function(){this.action("");this.phone.hangup()};Pa.prototype.call=function(){e.Phone.call(d.getFormattedPhone(this.input()))};Pa.prototype.answer=function(){this.phone.answer()};Pa.prototype.end=function(){this.action("");this.phone.reconnectStop()};Pa.prototype.multiAction=function(){var a=this;if("standby"===this.action())this.action("ready"),_.delay(function(){a.inputFocus(!0)},500);else if("ready"===
this.action()&&0<this.input().length)this.call();else if("ready"===this.action()&&0===this.input().length)this.action("standby");else if("connection_in"===this.action()||"connection_out"===this.action()||"outgoing"===this.action()||"incoming"===this.action())this.hangup(),this.input("")};Ca.prototype.onApplyBindings=function(){h.App.UseReCaptcha&&this.startRecaptcha()};Ca.prototype.startRecaptcha=function(){i.getScript("//www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){j.Recaptcha&&
j.Recaptcha.create(h.App.ReCaptchaPublicKey,"recaptcha-place",{theme:"white",lang:h.App.DefaultLanguageShort})})};Ca.prototype.onShow=function(){this.emailVisible()?this.emailFocus(!0):this.loginFocus(!0);fa.toggleClass("screen-login-langblock",!this.viewLanguagesAsDropdown());fa.toggleClass("screen-login-description",""!==this.loginDescription())};Ca.prototype.signIn=function(){this.sendRequest()};Ca.prototype.onResponse=function(a){!1===a.Result?(this.loading(!1),j.Recaptcha&&j.Recaptcha.reload(),
e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/LOGIN_PASS_INCORRECT")),!0===a.Captcha&&this.startRecaptcha()):j.location.reload()};Ca.prototype.sendRequest=function(){var a={Action:"Login",Email:this.email(),IncLogin:this.login(),IncPassword:this.password(),SignMe:this.signMe()?"1":"0"};j.Recaptcha&&(a.ReCaptchaChallengeField=j.Recaptcha.get_challenge(),a.ReCaptchaResponseField=j.Recaptcha.get_response());this.loading(!0);e.Ajax.send(a,this.onResponse,this)};Ca.prototype.changeLanguage=function(a){a&&
this.allowLanguages()&&(this.currentLanguage(a),e.Ajax.send({Action:"LoginLanguageUpdate",Language:a},function(){j.location.reload()},this))};B.prototype.changeRoutingForMessageList=function(a,c,b,d,f){e.Routing.setHash(e.Links.mailbox(a,c,b,d,f))};B.prototype.onEnterPress=function(a){a.openThread()};B.prototype.onMessageDblClick=function(a){this.folderList().getFolderByFullName(a.folder()).type()===f.FolderTypes.Drafts?e.Routing.setHash(e.Links.composeFromMessage("drafts",a.folder(),a.uid())):d.WindowOpener.openMessage(a)};
B.prototype.onFolderListSubscribe=function(){this.setCurrentFolder();this.requestMessageList()};B.prototype.onRoute=function(a){a=e.Links.parseMailbox(a);this.pageSwitcherLocked(!0);this.folderFullName()!==a.Folder||this.search()!==a.Search||this.filters()!==a.Filters?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(a.Page,h.User.MailsPerPage);this.pageSwitcherLocked(!1);a.Page!==this.oPageSwitcher.currentPage()&&e.Routing.replaceHash(e.Links.mailbox(a.Folder,this.oPageSwitcher.currentPage(),
a.Uid,a.Search,a.Filters));this.folderFullName(a.Folder);this.filters(a.Filters);this.search(a.Search);this.searchInput(this.search());this.searchSpan.notifySubscribers();this.setCurrentFolder();this.requestMessageList()};B.prototype.setCurrentFolder=function(){this.folderList().setCurrentFolder(this.folderFullName(),this.filters())};B.prototype.requestMessageList=function(){var a=this.folderList().currentFolderFullName(),c=this.oPageSwitcher.currentPage();0<a.length&&e.MailCache.changeCurrentMessageList(a,
c,this.search(),this.filters())};B.prototype.calculateSearchStringFromAdvancedForm=function(){var a=this.searchInputFrom(),c=this.searchInputTo(),b=this.searchInputSubject(),d=this.searchInputText(),e=[],f=function(a){a=i.trim(a).replace(/"/g,'\\"');if(-1<a.indexOf(" ")||-1<a.indexOf('"'))a='"'+a+'"';return a};""!==a&&e.push("from:"+f(a));""!==c&&e.push("to:"+f(c));""!==b&&e.push("subject:"+f(b));""!==d&&e.push("text:"+f(d));return e.join(" ")};B.prototype.onSearchClick=function(){var a=this.folderList().currentFolderFullName(),
c=this.currentMessage()?this.currentMessage().uid():"",b=this.searchInput();this.bAdvancedSearch()&&(b=this.calculateSearchStringFromAdvancedForm(),this.searchInput(b),this.bAdvancedSearch(!1));this.changeRoutingForMessageList(a,1,c,b,this.filters())};B.prototype.onRetryClick=function(){this.requestMessageList()};B.prototype.onClearSearchClick=function(){var a=this.folderList().currentFolderFullName(),c=this.currentMessage()?this.currentMessage().uid():"";this.changeRoutingForMessageList(a,1,c,"",
this.filters())};B.prototype.onStopSearchClick=function(){this.onClearSearchClick()};B.prototype.routeForMessage=function(a){if(null!==a){var c=this.folderList().currentFolderFullName(),b=this.oPageSwitcher.currentPage(),a=a.uid(),d=this.search();""!==a&&this.changeRoutingForMessageList(c,b,a,d,this.filters())}};B.prototype.onApplyBindings=function(a){var c=this,g=_.bind(function(a){a&&a.stopPropagation&&a.stopPropagation()},this);i(".message_list",a).on("click",".message_sub_list .item .flag",function(a){c.onFlagClick(b.dataFor(this));
a&&a.stopPropagation&&a.stopPropagation()}).on("dblclick",".message_sub_list .item .flag",g).on("click",".message_sub_list .item .thread",g).on("dblclick",".message_sub_list .item .thread",g);this.selector.initOnApplyBindings(".message_sub_list .item",".message_sub_list .selected.item",".message_sub_list .item .custom_checkbox",i(".message_list",a),i(".message_list .scroll-inner",a))};B.prototype.onFlagClick=function(a){e.MailCache.executeGroupOperation("MessageSetFlagged",[a.uid()],"flagged",!a.flagged())};
B.prototype.executeMarkAsRead=function(){e.MailCache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!0)};B.prototype.executeMarkAsUnread=function(){e.MailCache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!1)};B.prototype.executeFlag=function(){e.MailCache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!0)};B.prototype.executeUnflag=function(){e.MailCache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),
"flagged",!1)};B.prototype.executeMarkAllRead=function(){e.MailCache.executeGroupOperation("MessageSetAllSeen",[],"seen",!0)};B.prototype.executeMoveToFolder=function(a){e.MailCache.moveMessagesToFolder(a,this.collectionCheckedUids())};B.prototype.onDeletePress=function(a){a=_.map(a,function(a){return a.uid()});0<a.length&&this.deleteMessages(a)};B.prototype.executeDelete=function(){this.deleteMessages(this.collectionCheckedUids())};B.prototype.deleteMessages=function(a){var c=this.folderList().currentFolderFullName(),
b=this.folderList().trashFolder(),f=b&&c===b.fullName(),h=this.folderList().spamFolder(),c=h&&c===h.fullName(),h=d.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),i=function(c){c&&e.MailCache.deleteMessages(a)};c?e.MailCache.deleteMessages(a):f?e.Screens.showPopup(G,[h,i]):b&&e.MailCache.moveMessagesToFolder(b.fullName(),this.collectionCheckedUids())};B.prototype.executeSpam=function(){var a=this.folderList().spamFolderFullName();this.folderList().currentFolderFullName()!==a&&e.MailCache.moveMessagesToFolder(a,
this.collectionCheckedUids())};B.prototype.executeNotSpam=function(){var a=this.folderList().inboxFolder();a&&this.folderList().currentFolderFullName()!==a.fullName()&&e.MailCache.moveMessagesToFolder(a.fullName(),this.collectionCheckedUids())};B.prototype.fillAdvancedSearch=function(a){a&&(this.searchInputFrom(""),this.searchInputTo(""),this.searchInputSubject(""),this.searchInputText(""),this.bAdvancedSearch(!0))};z.prototype.resizeDblClick=function(a,c){c.preventDefault();c.stopPropagation?c.stopPropagation():
c.cancelBubble=!0;d.removeSelection();this.jqPanelHelper||(this.jqPanelHelper=i(".MailLayout .panel_helper"));this.jqPanelHelper.trigger("resize",[295,"min"])};z.prototype.notifySender=function(){this.currentMessage()&&""!==this.currentMessage().readingConfirmation()&&(e.Ajax.send({Action:"MessageSendConfirmation",Confirmation:this.currentMessage().readingConfirmation(),Subject:d.i18n("MESSAGE/RETURN_RECEIPT_MAIL_SUBJECT"),Text:d.i18n("MESSAGE/RETURN_RECEIPT_MAIL_TEXT",{EMAIL:this.fullFrom(),SUBJECT:this.subject()})}),
this.currentMessage().readingConfirmation(""))};z.prototype.viewAllMailsWithContact=function(){h.SingleMode&&j.opener&&j.opener.App?(j.opener.App.MailCache.searchMessagesInCurrentFolder("email:"+this.fromEmail()),j.opener.focus(),j.close()):e.MailCache.searchMessagesInCurrentFolder("email:"+this.fromEmail())};z.prototype.onMessagesSubscribe=function(){!this.currentMessage()&&0<this.uid().length&&e.MailCache.setCurrentMessage(this.uid())};z.prototype.onFromContactResponse=function(a){a?(this.fromContact(a),
this.fromExistsInContacts(!0)):(this.fromContact(new w),this.fromExistsInContacts(!1));this.fromContactInfoReceived(!0)};z.prototype.onCurrentMessageSubscribe=function(){var a=this.currentMessage(),c="",b="",d="",f=[];this.replyText("");this.replyDraftUid("");a&&this.uid()===a.uid()?(this.subject(a.subject()),this.from(a.oFrom.getDisplay()),this.fromEmail(a.oFrom.getFirstEmail()),this.fromName(a.oFrom.getFirstName()),this.fromContactInfoReceived(!1),a.completelyFilled()&&(this.fromEmail()&&""!==this.fromEmail())&&
e.ContactsCache.getContactByEmail(this.fromEmail(),this.onFromContactResponse,this),this.fullFrom(a.oFrom.getFull()),this.to(a.oTo.getFull()),this.cc(a.oCc.getFull()),this.bcc(a.oBcc.getFull()),c=a.oTo.getDisplay(),b=a.oCc.getDisplay(),d=a.oBcc.getDisplay(),0<c.length&&f.push(c),0<b.length&&f.push(b),0<d.length&&f.push(d),this.allRecipients(f.join(", ")),this.midDate(a.oDateModel.getMidDate()),this.fullDate(a.oDateModel.getFullDate()),this.isLoading(""!==a.uid()&&!a.completelyFilled()),this.setMessageBody(a),
this.rtlMessage(a.rtl()),this.attachments(a.attachments()),this.visiblePicturesControl(a.hasExternals()&&!a.isExternalsAlwaysShown()),this.visibleShowPicturesLink(!a.isExternalsShown()),null!==this.ical()&&this.ical().animation(!1),this.ical(a.ical()),null!==this.ical()&&_.defer(_.bind(function(){this.ical().animation(!0)},this)),this.vcard(a.vcard()),a.completelyFilled()?a.completelyFilledSubscription?(a.completelyFilledSubscription.dispose(),a.completelyFilledSubscription=void 0):a.completelyFilledSingleModeSubscription&&
(a.completelyFilledSingleModeSubscription.dispose(),a.completelyFilledSingleModeSubscription=void 0):this.singleMode()?a.completelyFilledSingleModeSubscription=a.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this):a.completelyFilledSubscription=a.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this)):(this.isLoading(!1),i(this.domTextBody()).empty(),this.rtlMessage(!1),this.attachments([]),this.visiblePicturesControl(!1),this.visibleShowPicturesLink(!1),this.ical(null),this.vcard(null))};
z.prototype.setMessageBody=function(a){if(a){var c=a.text(),b=c.length,d=i(this.domTextBody());this.textBody(c);d.empty();_.defer(_.bind(function(){a.isPlain()||5E6<b?d.html(c):(d.append(a.getDomText()),this.doHidingBlockquotes())},this))}};z.prototype.doHidingBlockquotes=function(){i(i("blockquote",i(this.domTextBody())).get().reverse()).each(function(){var a=i(this),c=a.parents("blockquote"),b=i('<span class="blockquote_toggle"></span>').html(d.i18n("MESSAGE/SHOW_QUOTED_TEXT")),e=!0;0===c.length&&
120<a.height()&&(a.addClass("blockquote_before_toggle").after(b).wrapInner('<div class="blockquote_content"></div>'),b.bind("click",function(){e?(a.height("auto"),b.html(d.i18n("MESSAGE/HIDE_QUOTED_TEXT")),e=!1):(a.height(80),b.html(d.i18n("MESSAGE/SHOW_QUOTED_TEXT")),e=!0);a.toggleClass("collapsed",e)}),a.height(80).toggleClass("collapsed",e))})};z.prototype.onRoute=function(a){a=e.Links.parseMailbox(a);this.uid(a.Uid);e.MailCache.setCurrentMessage(this.uid());this.contentHasFocus(!0)};z.prototype.showPictures=
function(){e.MailCache.showExternalPictures(!1);this.visibleShowPicturesLink(!1);this.setMessageBody(this.currentMessage())};z.prototype.alwaysShowPictures=function(){var a=this.currentMessage()?this.currentMessage().oFrom.getFirstEmail():"";0<a.length&&e.Ajax.send({Action:"EmailSafety",Email:a});e.MailCache.showExternalPictures(!0);this.visiblePicturesControl(!1);this.setMessageBody(this.currentMessage())};z.prototype.showDetails=function(){this.detailsVisible(!0)};z.prototype.hideDetails=function(){this.detailsVisible(!1)};
z.prototype.openInNewWindow=function(){var a=e.MailCache.folderList().currentFolder().type()===f.FolderTypes.Drafts;d.WindowOpener.openMessage(this.currentMessage(),a)};z.prototype.addToContacts=function(){e.ContactsCache.addToContacts(this.fromName(),this.fromEmail(),this.onAddToContactsResponse,this)};z.prototype.onAddToContactsResponse=function(a,c){a.Result&&(""!==c.HomeEmail&&c.HomeEmail===this.fromEmail())&&(e.Api.showReport(d.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),e.ContactsCache.clearInfoAboutEmail(this.fromEmail()),
e.ContactsCache.getContactByEmail(this.fromEmail(),this.onFromContactResponse,this))};z.prototype.executePrevMessage=function(){};z.prototype.executeNextMessage=function(){};z.prototype.executeReplyOrForward=function(a){this.currentMessage()&&(e.MessageSender.setReplyData(this.replyHtmlText(),this.replyDraftUid()),this.replyText(""),this.replyDraftUid(""),e.Routing.setHash(e.Links.composeFromMessage(a,this.currentMessage().folder(),this.currentMessage().uid())))};z.prototype.executeReply=function(){this.executeReplyOrForward(f.ReplyType.Reply)};
z.prototype.executeReplyAll=function(){this.executeReplyOrForward(f.ReplyType.ReplyAll)};z.prototype.executeForward=function(){this.executeReplyOrForward(f.ReplyType.Forward)};z.prototype.executePrint=function(){var a=d.WindowOpener.open("",this.subject()+"-print"),c=this.currentMessage().getDomText(d.getAppPath()),b="";this.textBodyForNewWindow(c.html());b=i(this.domMessageForPrint()).html();i(a.document.body).html(b);a.print()};z.prototype.executeSave=function(){this.currentMessage()&&e.downloadByUrl(this.currentMessage().download())};
z.prototype.changeAddMenuVisibility=function(){var a=!this.visibleAddMenu();this.visibleAddMenu(a)};z.prototype.onMessageSendResponse=function(a,c){var b=e.MessageSender.onMessageSendResponse(a,c);switch(b.Action){case "MessageSend":this.replySendingStarted(!1);b.Result&&this.replyText("");break;case "MessageSave":this.replySavingStarted(!1),b.Result&&this.replyDraftUid(b.NewUid)}};z.prototype.sendReplyMessage=function(){""!==this.replyText()&&(this.replySendingStarted(!0),e.MessageSender.sendReplyMessage("MessageSend",
this.replyHtmlText(),this.replyDraftUid(),this.onMessageSendResponse,this),this.replyTextFocus(!1))};z.prototype.saveReplyMessage=function(){""!==this.replyText()&&(this.replySavingStarted(!0),e.MessageSender.sendReplyMessage("MessageSave",this.replyHtmlText(),this.replyDraftUid(),this.onMessageSendResponse,this))};ea.prototype.resizeDblClick=function(a,c){c.preventDefault();c.stopPropagation?c.stopPropagation():c.cancelBubble=!0;d.removeSelection();this.jqPanelHelper||(this.jqPanelHelper=i(".MailLayout .panel_helper"));
this.jqPanelHelper.trigger("resize",[600,"max"])};ea.prototype.onRoute=function(a){this.oMessageList.onRoute(a);this.oMessagePane.onRoute(a)};ea.prototype.onShow=function(){this.oMessageList.selector.useKeyboardKeys(!0)};ea.prototype.onHide=function(){this.oMessageList.selector.useKeyboardKeys(!1)};ea.prototype.onApplyBindings=function(){var a=this;this.oMessageList.onApplyBindings(this.$viewModel);i(this.domFolderList()).on("click","span.folder",function(){a.oMessageList.executeMoveToFolder(i(this).data("folder"))});
i(this.$viewModel).on("mousedown","a",function(a){return a&&3!==a.which&&(a=i(this).attr("href"))&&"mailto:"===a.toString().toLowerCase().substr(0,7)?(e.Api.openComposeMessage(a.toString().substr(7)),!1):!0});var c=!1;i(document).on("keyup",function(b){var d=b.keyCode,e=a.oMessageList,h=e.collection()[0],i=e.isFocused(),j=a.oMessagePane.replyTextFocus();if(b&&d===f.Key.s)a.searchFocus();else if(h){var l=h.selected();i&&b&&d===f.Key.Down?(e.isFocused(!1),e.selector.itemSelected(h),c=!0):!i&&!j&&c&&
l&&b&&d===f.Key.Up?(e.isFocused(!0),e.selector.itemSelected(!1),c=!1):l?c=!0:l||(c=!1)}})};ea.prototype.getThreadUidsFromList=function(a){var c=[];_.each(a,function(a){0<a.threadCount()&&!a.threadOpened()&&(c=_.union(c,a.threadUids()))});return c};ea.prototype.dragAndDropHelper=function(a){a&&a.checked(!0);var a=this.oMessageList.selector.itemSelected(),c=d.draggableMessages(),b=this.oMessageList.selector.listCheckedOrSelected(),e=this.getThreadUidsFromList(b),b=_.map(b,function(a){return a.uid()}),
e=_.union(b,e),b=e.length;a&&!a.checked()&&a.checked(!0);c.data("p7-message-list-folder",this.folderList().currentFolderFullName());c.data("p7-message-list-uids",e);i(".count-text",c).text(d.i18n("MAILBOX/DRAG_TEXT_PLURAL",{COUNT:b},null,b));return c};ea.prototype.messagesDrop=function(a,c,b){if(a){var e=b&&b.helper?b.helper:null,f=e?e.data("p7-message-list-folder"):"",e=e?e.data("p7-message-list-uids"):null;""!==f&&null!==e&&(d.uiDropHelperAnim(c,b),this.oMessageList.executeMoveToFolder(a.fullName()))}};
ea.prototype.searchFocus=function(){this.oMessageList.selector.useKeyboardKeys()&&!d.inFocus()&&this.oMessageList.isFocused(!0)};q.prototype.isEnableSending=function(){var a=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length;return 0!==this.folderList().iAccountId&&!this.sending()&&!a&&this.allAttachmentsUploaded()};q.prototype.isEnableSaving=function(){return 0!==this.folderList().iAccountId&&!this.sending()&&!this.saving()};q.prototype.onApplyBindings=function(){this.initUploader()};
q.prototype.getMessageOnRoute=function(){var a=this.routeParams(),c="",b="";""!==this.routeType()&&3===a.length&&(c=a[1],b=a[2],e.MailCache.getMessage(c,b,this.onMessageResponse,this));this.routeParams([])};q.prototype.onShow=function(){this.useSaveMailInSentItems(h.User.getUseSaveMailInSentItems());this.saveMailInSentItems(h.User.getSaveMailInSentItems());this.oHtmlEditor.initCrea(this.textBody(),"7");this.oHtmlEditor.clearImages();this.commitedTextBody(this.oHtmlEditor.getText());this.shown(!0);
this.startAutosave();this.focusAfterFilling();fa.addClass("screen-compose");this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)};q.prototype.onRoute=function(a){var c="";this.changeSenderAccountId(h.Accounts.currentId());this.messageUploadAttachmentsStarted(!1);this.draftUid("");this.draftInfo.removeAll();this.setDataFromMessage(new F);this.isDraftsCleared(!1);this.routeType(0<a.length?a[0]:"");switch(this.routeType()){case f.ReplyType.Reply:case f.ReplyType.ReplyAll:case f.ReplyType.Forward:case "drafts":this.routeParams(a);
0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;default:c=e.MessageSender.getSignatureText(this.senderAccountId(),null),h.SingleMode&&j.opener&&j.opener.oMessageParametersFromCompose?(this.setMessageDataInSingleMode(j.opener.oMessageParametersFromCompose),j.opener.oMessageParametersFromCompose=void 0):""!==c&&this.textBody("<br /><br />"+c),"to"===this.routeType()&&2===a.length&&this.toAddr(a[1]),"vcard"===this.routeType()&&2===a.length&&this.addContactAsAttachment(a[1]),"file"===
this.routeType()&&2===a.length&&this.addFilesAsAttachment(a[1])}this.visibleCc(""!==this.ccAddr());this.visibleBcc(""!==this.bccAddr());this.commit(this.oHtmlEditor.getText());this.focusAfterFilling()};q.prototype.focusAfterFilling=function(){0===this.toAddr().length?this.toAddrFocused(!0):0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()};q.prototype.onHide=function(){this.shown(!1);this.stopAutosave();this.oHtmlEditor.closeAllPopups();fa.removeClass("screen-compose");
this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)};q.prototype.stopAutosave=function(){j.clearInterval(this.autoSaveTimer())};q.prototype.startAutosave=function(){if(this.shown()){var a=_.bind(this.executeSave,this,!0);this.stopAutosave();h.App.AutoSave&&this.autoSaveTimer(j.setInterval(a,1E3*h.App.AutoSaveIntervalSeconds))}};q.prototype.getFetcherByEmail=function(a,c){var b=h.Accounts.getDefault();return b&&c===b.id()?b.getFetcherByEmail(a):null};q.prototype.onMessageResponse=function(a){var c=
null;if(null===a)this.setDataFromMessage(new F);else{switch(this.routeType()){case f.ReplyType.Reply:case f.ReplyType.ReplyAll:case f.ReplyType.Forward:(c=e.MessageSender.getFetcherByRecipients(a.oTo.aCollection,a.accountId()))&&this.selectedSender(c.idFetcher());c=e.MessageSender.getReplyDataFromMessage(a,this.routeType(),this.senderAccountId(),c);this.draftInfo(c.DraftInfo);this.draftUid(c.DraftUid);this.toAddr(c.To);this.ccAddr(c.Cc);this.subject(c.Subject);this.textBody(c.Text);this.attachments(c.Attachments);
this.inReplyTo(c.InReplyTo);this.references(c.References);break;case "drafts":this.draftUid(a.uid()),this.setDataFromMessage(a)}this.routeType("")}0<this.attachments().length&&this.requestAttachmentsTempName();this.visibleCc(""!==this.ccAddr());this.visibleBcc(""!==this.bccAddr());this.commit(this.oHtmlEditor.getText());this.focusAfterFilling()};q.prototype.changeSenderAccountId=function(a,c,b){h.Accounts.hasAccountWithId(a)?this.senderAccountId(a):h.Accounts.hasAccountWithId(this.senderAccountId())||
this.senderAccountId(h.Accounts.currentId());this.fillSenderList(c,b)};q.prototype.fillSenderList=function(a,c){var b=[],d=h.Accounts.getDefault(),e=[];d&&this.senderAccountId()===d.id()&&(d.fetchers()?(e=d.fetchers().collection(),0<e.length&&(b.push({fullEmail:d.fullEmail(),id:""}),_.each(e,function(a){a.isOutgoingEnabled()&&b.push({fullEmail:a.fullEmail(),id:a.idFetcher()})},this))):d.fetchers.subscribe(function(){this.fillSenderList(a,c)},this));this.senderList(b);a&&""!==a?this.changeSelectedSenderByEmail(a):
c&&""!==c?this.selectedSender(c):this.selectedSender(0)};q.prototype.changeSelectedSenderByEmail=function(a){var c=h.Accounts.getDefault();(a=c&&this.senderAccountId()===c.id()?c.getFetcherByEmail(a):null)&&a.idFetcher()&&this.selectedSender(a.idFetcher())};q.prototype.changeSignature=function(){var a="",a=h.Accounts.getDefault(),c=[],c=null;a&&(this.senderAccountId()===a.id()&&a.fetchers())&&(c=a.fetchers().collection(),0<c.length&&(a=(c=_.find(c,function(a){return a.idFetcher()===d.pInt(this.selectedSender())},
this))?c.signature():a.signature()&&a.signature().options()?a.signature().signature():"",this.oHtmlEditor.changeSignatureContent(a)))};q.prototype.setDataFromMessage=function(a){var c=a.getDomText().html();this.draftInfo(a.draftInfo());this.inReplyTo(a.inReplyTo());this.references(a.references());this.toAddr(a.oTo.getFull());this.ccAddr(a.oCc.getFull());this.bccAddr(a.oBcc.getFull());this.subject(a.subject());this.attachments(a.attachments());this.textBody(c?c:a.text());this.selectedImportance(a.importance());
this.selectedSensitivity(a.sensitivity());this.readingConfirmation(a.readingConfirmation());this.changeSenderAccountId(a.accountId(),a.oFrom.getFirstEmail())};q.prototype.addFilesAsAttachment=function(a){var c=null,b=[],d=null;_.each(a,function(a){c=new J;c.fileName(a.name());c.hash(a.hash());c.uploadStarted(!0);this.attachments.push(c);b.push(a.hash())},this);0<b.length&&(d={Action:"FilesUpload",Hashes:b},this.messageUploadAttachmentsStarted(!0),e.Ajax.send(d,this.onFilesUpload,this))};q.prototype.onFilesUpload=
function(a,c){var b=a.Result,d=c.Hashes;this.messageUploadAttachmentsStarted(!1);i.isArray(b)?_.each(b,function(c){var b=_.find(this.attachments(),function(a){return a.hash()===c.Hash});b&&(b.parseFromContact(c,a.AccountID),b.hash(c.NewHash))},this):_.each(d,function(a){var c=_.find(this.attachments(),function(c){return c.hash()===a});c&&c.errorFromContact()},this)};q.prototype.addContactAsAttachment=function(a){var c=new J,b=null;a&&(c.fileName("contact-"+a.idContact()+".vcf"),c.uploadStarted(!0),
this.attachments.push(c),b={Action:"ContactVCardUpload",ContactId:a.idContact(),Global:a.global()?"1":"0",Name:c.fileName()},this.messageUploadAttachmentsStarted(!0),e.Ajax.send(b,this.onContactVCardUpload,this))};q.prototype.onContactVCardUpload=function(a,c){var b=a.Result,d=null;this.messageUploadAttachmentsStarted(!1);b?(d=_.find(this.attachments(),function(a){return a.fileName()===b.Name&&a.uploadStarted()}))&&d.parseFromContact(b,a.AccountID):(d=_.find(this.attachments(),function(a){return a.fileName()===
c.Name&&a.uploadStarted()}))&&d.errorFromContact()};q.prototype.requestAttachmentsTempName=function(){var a=_.map(this.attachments(),function(a){a.uploadStarted(!0);return a.hash()}),c={Action:"MessageUploadAttachments",Attachments:a};0<a.length&&(this.messageUploadAttachmentsStarted(!0),e.Ajax.send(c,this.onMessageUploadAttachmentsResponse,this))};q.prototype.onMessageUploadAttachmentsResponse=function(a){this.messageUploadAttachmentsStarted(!1);a.Result&&_.each(a.Result,_.bind(this.setAttachTepmNameByHash,
this))};q.prototype.setAttachTepmNameByHash=function(a,c){_.each(this.attachments(),function(b){b.hash()===a&&(b.tempName(c),b.uploadStarted(!1))})};q.prototype.setMessageDataInSingleMode=function(a){this.draftInfo(a.draftInfo);this.draftUid(a.draftUid);this.inReplyTo(a.inReplyTo);this.references(a.references);this.toAddr(a.toAddr);this.ccAddr(a.ccAddr);this.bccAddr(a.bccAddr);this.subject(a.subject);this.attachments(_.map(a.attachments,function(a){var b=new J;b.parse(a,this.senderAccountId());return b},
this));this.textBody(a.textBody);this.selectedImportance(a.selectedImportance);this.selectedSensitivity(a.selectedSensitivity);this.readingConfirmation(a.readingConfirmation);this.changeSenderAccountId(a.senderAccountId,"",a.selectedSender)};q.prototype.isEmpty=function(){var a=d.trim(this.toAddr()),c=d.trim(this.ccAddr()),b=d.trim(this.bccAddr()),e=d.trim(this.subject()),f=this.oHtmlEditor.getText(),f=d.trim(f.replace(/<br *\/{0,1}>/gi,"\n").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," "));return""===
a&&""===c&&""===b&&""===e&&0===this.attachments().length&&""===f};q.prototype.commit=function(a){this.toAddr.commit();this.ccAddr.commit();this.bccAddr.commit();this.subject.commit();this.commitedTextBody(a);this.attachmentsChanged(!1)};q.prototype.isChanged=function(){return this.toAddr.changed()||this.ccAddr.changed()||this.bccAddr.changed()||this.subject.changed()||this.commitedTextBody()!==this.oHtmlEditor.getText()||this.attachmentsChanged()};q.prototype.executeBackToList=function(){this.isChanged()&&
!this.isEmpty()&&this.executeSave(!0);h.SingleMode?j.close():e.Routing.setPreviousHash()};q.prototype.onFileUploadSelect=function(a,c){var b;b=d.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:c.FileName});if(0<h.App.AttachmentSizeLimit&&c.Size>h.App.AttachmentSizeLimit)return e.Screens.showPopup(R,[b]),!1;b=new J;b.onUploadSelect(a,c);this.attachments.push(b);this.attachmentsChanged(!0);return!0};q.prototype.getAttachmentByUid=function(a){return _.find(this.attachments(),function(c){return c.uploadUid()===
a})};q.prototype.onFileUploadStart=function(a){if(a=this.getAttachmentByUid(a))a.onUploadStart()};q.prototype.onFileUploadProgress=function(a,c,b){if(a=this.getAttachmentByUid(a))a.onUploadProgress(c,b)};q.prototype.onFileUploadComplete=function(a,c,b){var d=this.getAttachmentByUid(a);if(d)d.onUploadComplete(a,c,b)};q.prototype.onAttachmentRemove=function(a){var c=this.getAttachmentByUid(a);this.oJua&&this.oJua.cancel(a);this.attachments.remove(c);this.attachmentsChanged(!0)};q.prototype.initUploader=
function(){this.composeUploaderButton()&&(this.oJua=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:{Token:function(){return h.Token},AccountID:function(){return h.Accounts.currentId()}},onDragEnter:_.bind(this.composeUploaderDragOver,this,!0),onDragLeave:_.bind(this.composeUploaderDragOver,this,!1),onBodyDragEnter:_.bind(this.composeUploaderBodyDragOver,
this,!0),onBodyDragLeave:_.bind(this.composeUploaderBodyDragOver,this,!1),onProgress:_.bind(this.onFileUploadProgress,this),onSelect:_.bind(this.onFileUploadSelect,this),onStart:_.bind(this.onFileUploadStart,this),onComplete:_.bind(this.onFileUploadComplete,this)}),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))};q.prototype.getSendSaveParameters=function(a){var c=e.MessageSender.convertAttachmentsForSending(this.attachments());_.each(this.oHtmlEditor.uploadedImagePathes(),function(a){c[a.TempName]=
[a.Name,a.CID,"1","1"]});return{AccountID:this.senderAccountId(),FetcherID:this.selectedSender(),DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.oHtmlEditor.getText(a),Importance:this.selectedImportance(),Sensivity:this.selectedSensitivity(),ReadingConfirmation:this.readingConfirmation()?"1":"0",Attachments:c,InReplyTo:this.inReplyTo(),References:this.references()}};q.prototype.onMessageSendResponse=function(a,
c){var b=e.MessageSender.onMessageSendResponse(a,c);this.commit(c.Text);switch(b.Action){case "MessageSave":b.Result&&b.NewUid&&(this.draftUid(b.NewUid),this.startAutosave());this.saving(!1);break;case "MessageSend":b.Result&&(e.MailCache.deletedDraftMessageUid(this.draftUid()),this.executeBackToList()),this.sending(!1)}};q.prototype.verifyDataForSending=function(){var a=d.getIncorrectEmailsFromAddressString(this.toAddr()),c=d.getIncorrectEmailsFromAddressString(this.ccAddr()),b=d.getIncorrectEmailsFromAddressString(this.bccAddr()),
a=_.union(a,c,b),c=d.i18n("COMPOSE/WARNING_INPUT_CORRECT_EMAILS")+a.join(", ");return 0<a.length?(e.Screens.showPopup(R,[c]),!1):!0};q.prototype.executeSend=function(){this.isEnableSending()&&this.verifyDataForSending()&&(this.stopAutosave(),this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),e.MessageSender.send("MessageSend",this.getSendSaveParameters(!0),this.saveMailInSentItems(),!0,this.onMessageSendResponse,this,this.requiresPostponedSending()))};q.prototype.executeSaveCommand=
function(){this.executeSave(!1)};q.prototype.executeSave=function(a){this.isEnableSaving()&&(this.stopAutosave(),this.saving(!0),e.MessageSender.send("MessageSave",this.getSendSaveParameters(!1),this.saveMailInSentItems(),!a,this.onMessageSendResponse,this))};q.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc());this.visibleBcc()?this.bccAddrFocused(!0):this.toAddrFocused(!0)};q.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc());this.visibleCc()?this.ccAddrFocused(!0):
this.toAddrFocused(!0)};q.prototype.getMessageDataForSingleMode=function(){var a=_.map(this.attachments(),function(a){return{"@Object":"Object/CApiMailAttachment",FileName:a.fileName(),TempName:a.tempName(),MimeType:a.type(),MimePartIndex:a.mimePartIndex(),EstimatedSize:a.size(),CID:a.cid(),IsInline:a.inline(),IsLinked:a.linked(),Hash:a.hash()}});return{draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),
selectedSender:this.selectedSender(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:a,textBody:this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),selectedSensitivity:this.selectedSensitivity(),readingConfirmation:this.readingConfirmation()}};q.prototype.openInNewWindow=function(){j.oMessageParametersFromCompose=this.getMessageDataForSingleMode();d.WindowOpener.openTab("#"+f.Screens.SingleCompose);this.commit(this.oHtmlEditor.getText());
this.executeBackToList()};q.prototype.computeHeight=function(){var a=this.messageForm(),c=this.messageFields();a&&c&&_.defer(function(){var b=i(c).outerHeight();i(a).css({"padding-top":b,"margin-top":-b})})};q.prototype.autocompleteCallback=function(a,c){var b={Action:"ContactSuggestions",Search:a},a=d.trim(a);""!==a?e.Ajax.send(b,function(a){var b=[];a&&(a.Result&&a.Result&&a.Result.List)&&(b=_.map(a.Result.List,function(a){return a&&a.Email?a.Name&&0<d.trim(a.Name).length?'"'+a.Name+'" <'+a.Email+
">":a.Email:""}),b=_.compact(b));c(b)},this):c([])};eb.prototype.onFileImportStart=function(){this.importing(!0)};eb.prototype.onFileImportComplete=function(a,c,b){this.importing(!1);this.oParent.requestContactList();c&&b&&b.Result?(a=d.pInt(b.Result.ImportedCount),0<a?e.Api.showReport(d.i18n("CONTACTS/CONTACT_IMPORT_HINT_PLURAL",{NUM:a},null,a)):e.Api.showError(d.i18n("WARNING/CONTACTS_IMPORT_NO_CONTACTS"))):e.Api.showError(d.i18n("WARNING/CONTACTS_IMPORT_ERROR"))};eb.prototype.onApplyBindings=function(a){this.oJua=
new Jua({action:"?/Upload/Contacts/",name:"jua-uploader",queueSize:1,clickElement:i("#jue_import_button",a),disableAjaxUpload:!1,disableDragAndDrop:!0,disableMultiple:!0,hidden:{Token:function(){return h.Token},AccountID:function(){return h.Accounts.currentId()}},onStart:_.bind(this.onFileImportStart,this),onComplete:_.bind(this.onFileImportComplete,this)})};x.prototype.executeSave=function(a){var c={},b=[];a===this.selectedItem()&&(a instanceof w&&!a.readOnly()?(_.each(this.groupFullCollection(),
function(a){a&&a.checked()&&b.push(a.Id())}),a.groups(b),c=a.toObject(),c.Action=a.isNew()?"ContactCreate":"ContactUpdate",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),e.Ajax.send(c,this.onResponse,this)):a instanceof Ba&&!a.readOnly()&&(c=a.toObject(),c.Action=a.isNew()?"GroupCreate":"GroupUpdate",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),e.Ajax.send(c,this.onResponse,this)))};x.prototype.executeBackToList=function(){e.Routing.setLastMailboxHash()};x.prototype.executeNewContact=
function(){var a=this.selectedGroupInList();this.oContactModel.switchToNew();this.oContactModel.groups(a?[a.Id()]:[]);this.selectedItem(this.oContactModel);this.selector.itemSelected(null)};x.prototype.executeNewGroup=function(){this.oGroupModel.switchToNew();this.selectedItem(this.oGroupModel);this.selector.itemSelected(null)};x.prototype.executeDelete=function(){var a=this,c=this.selectedContact(),b=this.selector.listCheckedOrSelected(),f=_.map(b,function(a){return a.ReadOnly()?"":a.Id()}),f=_.compact(f);
0<f.length&&(_.each(b,function(a){a&&(e.ContactsCache.clearInfoAboutEmail(a.Email()),c&&(!a.IsGroup()&&!a.ReadOnly()&&!c.readOnly()&&c.idContact()===a.Id())&&(c=null,this.selectedContact(null)))},this),_.each(this.collection(),function(a){-1<d.inArray(a,b)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),e.Ajax.send({Action:"ContactDelete",ContactsId:f.join(",")},this.onResponse,this),e.ContactsCache.markVcardsNonexistent(f))};x.prototype.executeRemoveFromGroup=
function(){var a=this,c=this.selectedGroupInList(),b=this.selector.listCheckedOrSelected(),f=_.map(b,function(a){return a.ReadOnly()?"":a.Id()}),f=_.compact(f);c&&0<f.length&&(_.each(this.collection(),function(a){-1<d.inArray(a,b)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),e.Ajax.send({Action:"RemoveContactsFromGroup",GroupId:c.Id(),ContactsId:f.join(",")},this.onResponse,this))};x.prototype.executeImport=function(){this.selectedItem(null);this.oContactImportViewModel.visibility(!0);
this.selector.itemSelected(null);this.selectedGroupType(f.ContactsGroupListType.Personal)};x.prototype.executeExport=function(){e.downloadByUrl(d.getExportContactsLink())};x.prototype.executeCancel=function(){var a=this.selectedItem();a&&(a instanceof w&&!a.readOnly()?a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1):a instanceof Ba&&!a.readOnly()&&(a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1)));this.oContactImportViewModel.visibility(!1)};x.prototype.executeAddContactsToGroup=
function(a,c,b){a&&(_.isArray(c)&&0<c.length)&&(a.recivedAnim(!0),e.Ajax.send({Action:"AddContactsToGroup",Global:b?"1":"0",GroupId:a.Id(),ContactsId:c.join(",")},this.onResponse,this))};x.prototype.executeAddContactsToGroupId=function(a,c,b){a&&(_.isArray(c)&&0<c.length)&&e.Ajax.send({Action:"AddContactsToGroup",Global:b?"1":"0",GroupId:a,ContactsId:c.join(",")},this.onResponse,this)};x.prototype.executeAddSelectedContactsToGroup=function(a){var c=!1,b=this.selector.listCheckedOrSelected(),d=[];
a&&(_.isArray(b)&&0<b.length)&&_.each(b,function(a){a&&!a.IsGroup()&&(c=a.Global(),d.push(a.Id()))},this);this.executeAddContactsToGroup(a,d,c)};x.prototype.groupsInContactView=function(a){var c=[],b=[];a&&!a.groupsIsEmpty()&&(b=a.groups(),c=_.filter(this.groupFullCollection(),function(a){return 0<=d.inArray(a.Id(),b)}));return c};x.prototype.isEnableAddContacts=function(){return 0<this.selector.listCheckedOrSelected().length};x.prototype.isEnableRemoveContactsFromGroup=function(){return 0<this.selector.listCheckedOrSelected().length};
x.prototype.isEnableDeleting=function(){return 0<this.selector.listCheckedOrSelected().length};x.prototype.onShow=function(){this.selector.useKeyboardKeys(!0);this.oPageSwitcher.perPage(h.User.ContactsPerPage);this.oPageSwitcher.currentPage(1);this.requestContactList()};x.prototype.onHide=function(){this.selector.listCheckedOrSelected(!1);this.selector.useKeyboardKeys(!1);this.selectedItem(null)};x.prototype.onApplyBindings=function(){this.selector.initOnApplyBindings(".contact_sub_list .item",".contact_sub_list .selected.item",
".contact_sub_list .item .custom_checkbox",i(".contact_list",this.$viewModel),i(".contact_list .scroll-inner",this.$viewModel));var a=this;this.$viewModel.on("click",".content .item.add_to .dropdown_helper .item",function(){i(this).hasClass("new-group")?a.executeNewGroup():a.executeAddSelectedContactsToGroup(b.dataFor(this))});this.showPersonalContacts(!!h.User.ShowPersonalContacts);this.showGlobalContacts(!!h.User.ShowGlobalContacts);this.selectedGroupType.valueHasMutated();this.oContactImportViewModel.onApplyBindings(this.$viewModel);
this.requestGroupFullList();var c=!1;i(document).on("keyup",function(b){var d=b.keyCode,e=a.collection()[0],h=a.isSearchFocused();if(b&&d===f.Key.s)a.searchFocus();else if(e){var i=e.selected();e&&h&&b&&d===f.Key.Down?(a.isSearchFocused(!1),a.selector.itemSelected(e),c=!0):!h&&c&&i&&b&&d===f.Key.Up?(a.isSearchFocused(!0),a.selector.itemSelected(!1),c=!1):i?c=!0:i||(c=!1)}})};x.prototype.requestContactList=function(){this.loadingList(!0);e.Ajax.send({Action:f.ContactsGroupListType.Global===this.selectedGroupType()?
"GlobalContactList":"ContactList",Offset:(this.oPageSwitcher.currentPage()-1)*h.User.ContactsPerPage,Limit:h.User.ContactsPerPage,SortField:this.sortType(),SortOrder:this.sortOrder()?"1":"0",Search:this.search(),GroupId:this.selectedGroupInList()?this.selectedGroupInList().Id():""},this.onResponse,this)};x.prototype.requestGroupFullList=function(){e.Ajax.send({Action:"GroupFullList"},this.onResponse,this)};x.prototype.requestContact=function(a){this.loadingViewPane(!0);a&&e.Ajax.send({Action:a.Global()?
"GlobalContact":"Contact",ContactId:a.Id()},this.onResponse,this)};x.prototype.requestContactById=function(a,c){this.loadingViewPane(!0);a&&e.Ajax.send({Action:c?"GlobalContact":"Contact",ContactId:a},this.onResponse,this)};x.prototype.viewGroup=function(a){if(a&&a.IsGroup()){var c=_.find(this.groupFullCollection(),function(c){return c&&a&&c===a});c&&(this.oGroupModel.clear(),this.oGroupModel.idGroup(c.Id()).name(c.Name()),this.oPageSwitcher.currentPage(1),this.selectedGroupInList(c),this.selectedItem(this.oGroupModel),
this.selector.itemSelected(null),this.selector.listCheckedOrSelected(!1))}};x.prototype.deleteGroup=function(a){a&&(e.Ajax.send({Action:"GroupDelete",GroupId:a.idGroup()},this.onResponse,this),this.selectedGroupType(f.ContactsGroupListType.Personal),this.groupFullCollection.remove(function(c){return c&&c.Id()===a.idGroup()}))};x.prototype.mailGroup=function(a){a&&e.Ajax.send({Action:"ContactList",Offset:0,Limit:99,SortField:f.ContactSortType.Email,SortOrder:"1",GroupId:a.idGroup()},function(a){if(a&&
a.Result&&a.Result.List){for(var b=0,f=0,f=[],h=null,i=[],a=a.Result.List,f=a.length;b<f;b++)a[b]&&"Object/CContactListItem"===d.pExport(a[b],"@Object","")&&(h=new X,h.parse(a[b]),i.push(h));f=_.map(i,function(a){return a.EmailAndName()});f=_.compact(f);e.Api.openComposeMessage(f.join(", "))}},this)};x.prototype.onResponse=function(a){var c=0,b=0,h=[],i=!1,n=null,j=null,b=[],k=[],l=null;if(a&&a.Action&&a.Result)if(0<=d.inArray(a.Action,["Contact","GlobalContact"])&&"Object/CContact"===d.pExport(a.Result,
"@Object",""))l=new w,l.parse(a.Result),(n=this.selector.itemSelected())&&n.Id()===l.idContact()&&this.selectedItem(l);else if(0<=d.inArray(a.Action,["ContactList","GlobalContactList"])&&a.Result&&_.isArray(a.Result.List)){i="GlobalContactList"===a.Action;for(b=a.Result.List.length;c<b;c++)a.Result.List[c]&&"Object/CContactListItem"===d.pExport(a.Result.List[c],"@Object","")&&(l=new X,l.parse(a.Result.List[c],i),h.push(l));k=(b=this.selector.listChecked())&&0<b.length?_.map(b,function(a){return a.Id()}):
[];(n=this.selector.itemSelected())&&(j=_.find(h,function(a){return n.Id()===a.Id()}));k&&0<k.length&&_.each(h,function(a){a.checked(-1<d.inArray(a.Id(),k))});this.collection(h);this.loadingList(!1);this.oPageSwitcher.setCount(d.pInt(a.Result.ContactCount));j&&this.selector.itemSelected(j)}else if(0<=d.inArray(a.Action,["ContactCreate","ContactUpdate","GroupCreate","GroupUpdate"]))"GroupCreate"===a.Action&&a.Result.IdGroup?(k=_.map(this.selector.listChecked(),function(a){return a.Id()}),this.executeAddContactsToGroupId(a.Result.IdGroup,
k,f.ContactsGroupListType.Global===this.selectedGroupType()),this.selectedItem(null),this.selector.itemSelected(null),e.Api.showReport(d.i18n("CONTACTS/REPORT_GROUP_SUCCESSFULLY_ADDED"))):"ContactCreate"===a.Action&&a.Result.IdContact&&e.Api.showReport(d.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),this.requestContactList(),0<=d.inArray(a.Action,["GroupCreate","GroupUpdate"])&&this.requestGroupFullList();else if(0<=d.inArray(a.Action,["ContactDelete","AddContactsToGroup","RemoveContactsFromGroup"]))this.requestContactList();
else if(0<=d.inArray(a.Action,["GroupDelete"]))this.requestGroupFullList();else if("GroupFullList"===a.Action){n=_.find(this.groupFullCollection(),function(a){return a.selected()});this.groupFullCollection(h);for(b=a.Result.length;c<b;c++)a.Result[c]&&"Object/CContactListItem"===d.pExport(a.Result[c],"@Object","")&&(l=new X,l.parse(a.Result[c]),l.IsGroup()&&(n&&n.Id()===l.Id()&&this.selectedGroupInList(l),h.push(l)));this.groupFullCollection(h)}};x.prototype.dragAndDropHelper=function(a){a&&a.checked(!0);
var a=this.selector.itemSelected(),c=d.draggableMessages(),b=this.selector.listCheckedOrSelected().length,e=0<b?_.map(this.selector.listCheckedOrSelected(),function(a){return a.Id()}):[];a&&!a.checked()&&a.checked(!0);c.data("p7-contatcs-type",this.selectedGroupType());c.data("p7-contatcs-uids",e);i(".count-text",c).text(d.i18n("CONTACTS/DRAG_TEXT_PLURAL",{COUNT:b},null,b));return c};x.prototype.contactsDrop=function(a,c,b){if(a){var e=b&&b.helper?b.helper:null,h=e?e.data("p7-contatcs-type"):null,
e=e?e.data("p7-contatcs-uids"):null;null!==h&&null!==e&&(d.uiDropHelperAnim(c,b),this.executeAddContactsToGroup(a,e,f.ContactsGroupListType.Global===h))}};x.prototype.searchFocus=function(){this.selector.useKeyboardKeys()&&!d.inFocus()&&this.isSearchFocused(!0)};x.prototype.onContactDblClick=function(){var a=this.selectedContact();a&&e.Api.openComposeMessage(a.email())};x.prototype.onClearSearchClick=function(){this.search("");this.searchSubmitCommand()};D.prototype.onHide=function(a){var c=null,
c=this.tab();this.confirmSaving(c);if((c=this.getCurrentViewModel())&&d.isFunc(c.onHide))c.onHide(a);fa.removeClass("non-adjustable")};D.prototype.onShow=function(a){var c=null,c=this.tab();this.confirmSaving(c);if((c=this.getCurrentViewModel())&&d.isFunc(c.onShow))c.onShow(a);fa.addClass("non-adjustable")};D.prototype.viewTab=function(a){var c=this.getViewModel(f.SettingsTab.Common)?f.SettingsTab.Common:f.SettingsTab.EmailAccounts,b=this.getViewModel(a),e=-1===d.inArray(a,f.SettingsTab);this.tab(b&&
e?a:c)};D.prototype.onRoute=function(a){var c=null,b=this.tab();_.isArray(a)&&0<a.length&&(b=a[0]);if((c=this.getCurrentViewModel())&&d.isFunc(c.onHide))c.onHide(a);this.confirmSaving(this.tab());this.viewTab(b);if((c=this.getCurrentViewModel())&&d.isFunc(c.onRoute))c.onRoute(a)};D.prototype.confirmSaving=function(a){var c=this.getViewModel(a),a=d.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),b=_.bind(function(a){if(c)if(a){if(c.onSaveClick)c.onSaveClick()}else c.init&&c.init()},this);c&&(d.isFunc(c.isChanged)&&
c.isChanged())&&e.Screens.showPopup(G,[a,b])};D.prototype.getViewModel=function(a){return _.find(this.aTabs,function(c){return c.TabName===a})};D.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())};D.prototype.showTab=function(a){e.Routing.setHash([f.Screens.Settings,a])};D.prototype.onResponseFolderDelete=function(a){a.Result?e.MailCache.getFolderList(h.Accounts.editedId()):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};D.prototype.deleteFolder=
function(a,c,b){var d={Action:"FolderDelete",AccountID:h.Accounts.editedId(),Folder:a.fullName()};b&&(c&&a)&&(c.remove(function(c){return a.fullName()===c.fullName()?!0:!1}),e.Ajax.send(d,this.onResponseFolderDelete,this))};D.prototype.onResponseFolderSubscribe=function(a){a.Result?e.MailCache.getFolderList(h.Accounts.editedId()):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};D.prototype.onSubscribeFolderClick=function(a){var c={Action:"FolderSubscribe",AccountID:h.Accounts.editedId(),
Folder:a.fullName(),SetAction:a.subscribed()?0:1};a&&a.canSubscribe()&&(a.subscribed(!a.subscribed()),e.Ajax.send(c,this.onResponseFolderSubscribe,this))};D.prototype.onDeleteFolderClick=function(a,c){var b=d.i18n("SETTINGS/ACCOUNT_FOLDERS_CONFIRMATION_DELETE"),h=this.getCollectionFromParent(c),h=_.bind(this.deleteFolder,this,a,h),i=this.getViewModel(f.SettingsTab.EmailAccounts);a&&a.canDelete()?e.Screens.showPopup(G,[b,h]):i&&i.oAccountFolders.highlighted(!0)};D.prototype.onResponseFolderRename=
function(a){a.Result?e.MailCache.getFolderList(h.Accounts.editedId()):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};D.prototype.folderEditOnEnter=function(a){var c={Action:"FolderRename",AccountID:h.Accounts.editedId(),PrevFolderFullNameRaw:a.fullName(),NewFolderNameInUtf8:a.nameForEdit()};e.Ajax.send(c,this.onResponseFolderRename,this);a.name(a.nameForEdit());a.edited(!1)};D.prototype.folderEditOnEsc=function(a){a.edited(!1)};D.prototype.getCollectionFromParent=
function(a){return a.subfolders?a.subfolders:a.collection};D.prototype.canMoveFolderUp=function(a,c,b){var b=this.getCollectionFromParent(b),d=b()[c-1],f="";0<c&&d&&(f=b()[c-1].fullName());return 0!==c&&a&&a.fullName()!==e.MailCache.editedFolderList().inboxFolderFullName()&&e.MailCache.editedFolderList().inboxFolderFullName()!==f};D.prototype.canMoveFolderDown=function(a,c,b){b=this.getCollectionFromParent(b);return c!==b().length-1&&a.fullName()!==e.MailCache.editedFolderList().inboxFolderFullName()};
D.prototype.moveFolderUp=function(a,c,b){var d=this.getCollectionFromParent(b);this.canMoveFolderUp(a,c,b)&&d&&(d.splice(c,1),d.splice(c-1,0,a),this.folderListOrderUpdateDebounce())};D.prototype.moveFolderDown=function(a,c,b){var d=this.getCollectionFromParent(b);this.canMoveFolderDown(a,c,b)&&d&&(d.splice(c,1),d.splice(c+1,0,a),this.folderListOrderUpdateDebounce())};D.prototype.folderListOrderUpdate=function(){var a=e.MailCache.editedFolderList().getOptions(),a=_.map(a,function(a){return a&&a.id?
a.id:null}),a={Action:"FolderListOrderUpdate",AccountID:h.Accounts.editedId(),FolderList:_.compact(a)};e.Ajax.send(a,this.onResponseFolderListOrderUpdate,this)};D.prototype.onResponseFolderListOrderUpdate=function(a){a.Result?e.MailCache.getFolderList(h.Accounts.editedId()):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};Z.prototype.TemplateName="Settings_CommonSettingsViewModel";Z.prototype.TabName=f.SettingsTab.Common;Z.prototype.TabTitle=d.i18n("SETTINGS/TAB_COMMON");
Z.prototype.setMessagesPerPage=function(a){var c=this.rangeOfNumbers;-1===_.indexOf(c,a)&&(c=_.sortBy(_.union(c,[a]),function(a){return a},this));this.messagesPerPageValues(c);this.messagesPerPage(a)};Z.prototype.setContactsPerPage=function(a){var c=this.rangeOfNumbers;-1===_.indexOf(c,a)&&(c=_.sortBy(_.union(c,[a]),function(a){return a},this));this.contactsPerPageValues(c);this.contactsPerPage(a)};Z.prototype.init=function(){this.selectedSkin(h.User.DefaultTheme);this.layout(h.User.Layout);this.selectedLanguage(h.User.DefaultLanguage);
this.setMessagesPerPage(h.User.MailsPerPage);this.setContactsPerPage(h.User.ContactsPerPage);this.autocheckmailInterval(h.User.autoCheckMailInterval());this.richText(h.User.DefaultEditor);this.timeFormat(h.User.defaultTimeFormat());this.dateFormat(h.User.DefaultDateFormat);this.useThreads(h.User.useThreads())};Z.prototype.getState=function(){return[this.selectedSkin(),this.layout(),this.selectedLanguage(),this.messagesPerPage(),this.contactsPerPage(),this.autocheckmailInterval(),this.richText(),this.timeFormat(),
this.dateFormat(),this.useThreads()].join(":")};Z.prototype.updateFirstState=function(){this.firstState=this.getState()};Z.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};Z.prototype.onResponse=function(a,c){var b=!1;this.loading(!1);!1===a.Result?e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(e.CalendarCache.calendarSettingsChanged(!0),(b=c.DefaultTheme!==h.User.DefaultTheme||c.DefaultLanguage!==h.User.DefaultLanguage)?
j.location.reload():(this.setMessagesPerPage(c.MailsPerPage),this.setContactsPerPage(c.ContactsPerPage),h.User.updateCommonSettings(c.MailsPerPage,c.ContactsPerPage,c.AutoCheckMailInterval,c.DefaultEditor,c.Layout,c.DefaultTheme,c.DefaultLanguage,c.DefaultDateFormat,c.DefaultTimeFormat,c.UseThreads),e.Api.showReport(d.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY"))))};Z.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",MailsPerPage:parseInt(this.messagesPerPage(),10),ContactsPerPage:parseInt(this.contactsPerPage(),
10),AutoCheckMailInterval:parseInt(this.autocheckmailInterval(),10),DefaultEditor:parseInt(this.richText(),10),Layout:parseInt(this.layout(),10),DefaultTheme:this.selectedSkin(),DefaultLanguage:this.selectedLanguage(),DefaultDateFormat:this.dateFormat(),DefaultTimeFormat:parseInt(this.timeFormat(),10),UseThreads:this.useThreads()?"1":"0"};this.loading(!0);this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};C.prototype.TemplateName="Settings_EmailAccountsSettingsViewModel";C.prototype.TabName=
f.SettingsTab.EmailAccounts;C.prototype.TabTitle=d.i18n("SETTINGS/TAB_EMAIL_ACCOUNTS");C.prototype.isChanged=function(){return!1};C.prototype.onRoute=function(a){h.Accounts.getEdited()&&(_.isArray(a)&&1<a.length&&this.tab(a[1]),this.confirmSaving(f.AccountSettingsTab.Properties),this.viewCurrentTab(a));e.populateFetchers()};C.prototype.confirmSaving=function(a,c,b){var f=this.getViewModel(a),h={},a=d.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),i=_.bind(function(a){f&&(a?f.onSaveClick&&f.saveData(h):f.updateFirstState())},
this),c=d.isUnd(c)?!1:c,b=d.isUnd(b)?null:b;!c&&(f&&d.isFunc(f.isChanged)&&f.isChanged())&&(h=f.prepareParameters(),e.Screens.showPopup(G,[a,i]))};C.prototype.onHide=function(){this.confirmSaving(this.tab())};C.prototype.viewCurrentTab=function(a){var c=h.Accounts.getEdited(),b=null,b=this.isTabAllowed(this.tab(),c);if(c)if(b){if(b=this.getCurrentViewModel()){if(d.isFunc(b.onHide))b.onHide(a);if(d.isFunc(b.onShow))b.onShow(a,c)}}else this.tab(f.AccountSettingsTab.Properties),e.Routing.replaceHash([f.Screens.Settings,
f.SettingsTab.EmailAccounts,f.AccountSettingsTab.Properties]),this.editedFetcherId(null)};C.prototype.getViewModel=function(a){switch(a){case f.AccountSettingsTab.Folders:return this.oAccountFolders;case f.AccountSettingsTab.Filters:return this.oAccountFilters;case f.AccountSettingsTab.Forward:return this.oAccountForward;case f.AccountSettingsTab.Signature:return this.oAccountSignature;case f.AccountSettingsTab.Autoresponder:return this.oAccountAutoresponder;case f.AccountSettingsTab.FetcherInc:return this.oFetcherIncoming;
case f.AccountSettingsTab.FetcherOut:return this.oFetcherOutgoing;case f.AccountSettingsTab.FetcherSig:return this.oFetcherSignature;default:case f.AccountSettingsTab.Properties:return this.oAccountProperties}};C.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())};C.prototype.isTabAllowed=function(a,c){return-1===d.inArray(a,[f.AccountSettingsTab.Properties,f.AccountSettingsTab.Signature,f.AccountSettingsTab.Filters,f.AccountSettingsTab.Autoresponder,f.AccountSettingsTab.Forward,
f.AccountSettingsTab.Folders,f.AccountSettingsTab.FetcherInc,f.AccountSettingsTab.FetcherOut,f.AccountSettingsTab.FetcherSig])||a===f.AccountSettingsTab.Filters&&!c.extensionExists("AllowSieveFiltersExtension")||a===f.AccountSettingsTab.Forward&&!c.extensionExists("AllowForwardExtension")||a===f.AccountSettingsTab.Autoresponder&&!c.extensionExists("AllowAutoresponderExtension")?!1:!0};C.prototype.onTabClick=function(a){e.Routing.setHash([f.Screens.Settings,f.SettingsTab.EmailAccounts,a])};C.prototype.onResponseAccountDelete=
function(a,c){a.Result?(h.Accounts.deleteAccount(c.AccountIDToDelete),this.defaultAccountId()===c.AccountIDToDelete&&(e.Routing.setHash([]),j.location.reload())):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};C.prototype.deleteAccount=function(a,c){var b={Action:"AccountDelete",AccountIDToDelete:a};c&&e.Ajax.send(b,this.onResponseAccountDelete,this)};C.prototype.onAccountDelete=function(a){var c="",b=_.bind(this.deleteAccount,this,a),f=h.Accounts.getAccount(a).email();
this.allowUsersChangeInterfaceSettings&&(c=this.defaultAccountId()===a?1===this.accounts().length?d.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_SINGLE_DEFAULT_DELETE"):d.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DEFAULT_DELETE"):d.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DELETE"),e.Screens.showPopup(G,[c,b,f]))};C.prototype.onEditedAccountDelete=function(){var a="",c=_.bind(this.deleteAccount,this,this.editedAccountId()),b=h.Accounts.getEdited().email();this.allowUsersChangeInterfaceSettings&&(a=this.editedAccountId()===
this.defaultAccountId()?1===this.accounts().length?d.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_SINGLE_DEFAULT_DELETE"):d.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DEFAULT_DELETE"):d.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DELETE"),e.Screens.showPopup(G,[a,c,b]))};C.prototype.onAccountAdd=function(){e.Screens.showPopup(Da,[])};C.prototype.changeAccount=function(a){var c=null,b={Action:"AccountSettings",AccountID:a};if(this.isFetcherTab(this.tab()))this.onTabClick(f.AccountSettingsTab.Properties);this.confirmSaving(this.tab());
c=h.Accounts.getAccount(a);!d.isUnd(c)&&c.isExtended()?this.populate(c):e.Ajax.send(b,this.onAccountSettingsResponse,this);this.editedFetcherId(null)};C.prototype.onAccountSettingsResponse=function(a,c){if(a.Result){var b=h.Accounts.getAccount(c.AccountID);d.isUnd(b)||(b.updateExtended(a.Result),this.populate(b))}else e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};C.prototype.populate=function(a){this.allowAutoresponderExtension(a.extensionExists("AllowAutoresponderExtension"));
this.allowForwardExtension(a.extensionExists("AllowForwardExtension"));this.allowSieveFiltersExtension(a.extensionExists("AllowSieveFiltersExtension"));h.Accounts.changeEditedAccount(a.id());this.viewCurrentTab()};C.prototype.onFetcherAdd=function(a,c){c.stopPropagation();e.Screens.showPopup(za,[])};C.prototype.fetcherDelete=function(a,c){var b={Action:"FetcherDelete",FetcherID:a};c&&e.Ajax.send(b,this.onFetcherDeleteResponse,this)};C.prototype.onFetcherDelete=function(a){var c=d.i18n("WARNING/FETCHER_DELETE_WARNING"),
b=_.bind(this.fetcherDelete,this,a.idFetcher()),a=a.incomingMailServer();e.Screens.showPopup(G,[c,b,a])};C.prototype.onFetcherDeleteResponse=function(a){a.Result?(e.populateFetchers(),this.editedFetcherId(null)):e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/FETCHER_DELETING_ERROR"))};C.prototype.onChangeFetcher=function(a){a=this.defaultAccount.fetchers().getFetcher(a);this.fetcher(a);if(!this.isFetcherTab(this.tab()))this.onTabClick(f.AccountSettingsTab.FetcherInc);this.confirmSaving(this.tab());
this.oFetcherIncoming.populate(a);this.oFetcherOutgoing.populate(a);this.oFetcherSignature.populate(a);this.editedFetcherId(a.idFetcher())};C.prototype.isFetcherTab=function(a){switch(a){case f.AccountSettingsTab.FetcherInc:return!0;case f.AccountSettingsTab.FetcherOut:return!0;case f.AccountSettingsTab.FetcherSig:return!0;default:return!1}};la.prototype.TemplateName="Settings_CalendarSettingsViewModel";la.prototype.TabName=f.SettingsTab.Calendar;la.prototype.TabTitle=d.i18n("SETTINGS/TAB_CALENDAR");
la.prototype.init=function(){this.showWeekends(h.User.CalendarShowWeekEnds);this.selectedWorkdayStarts(h.User.CalendarWorkDayStarts);this.selectedWorkdayEnds(h.User.CalendarWorkDayEnds);this.showWorkday(h.User.CalendarShowWorkDay);this.weekStartsOn(h.User.CalendarWeekStartsOn);this.defaultTab(h.User.CalendarDefaultTab)};la.prototype.getState=function(){return[this.showWeekends(),this.selectedWorkdayStarts(),this.selectedWorkdayEnds(),this.showWorkday(),this.weekStartsOn(),this.defaultTab()].join(":")};
la.prototype.updateFirstState=function(){this.firstState=this.getState()};la.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};la.prototype.onResponse=function(a,c){this.loading(!1);!1===a.Result?e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_CALENDAR_SETTINGS_SAVING_FAILED")):(e.CalendarCache.calendarSettingsChanged(!0),h.User.updateCalendarSettings(c.ShowWeekEnds,c.ShowWorkDay,c.WorkDayStarts,c.WorkDayEnds,c.WeekStartsOn,c.DefaultTab),e.Api.showReport(d.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))};
la.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",ShowWeekEnds:this.showWeekends()?1:0,ShowWorkDay:this.showWorkday()?1:0,WorkDayStarts:parseInt(this.selectedWorkdayStarts(),10),WorkDayEnds:parseInt(this.selectedWorkdayEnds(),10),WeekStartsOn:parseInt(this.weekStartsOn(),10),DefaultTab:parseInt(this.defaultTab(),10)};this.loading(!0);this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};Qa.prototype.TemplateName="Settings_MobileSyncSettingsViewModel";Qa.prototype.TabName=
f.SettingsTab.MobileSync;Qa.prototype.TabTitle=d.i18n("SETTINGS/TAB_MOBILE_SYNC");Qa.prototype.onRoute=function(){h.User.requestSyncSettings()};Qa.prototype.onMobileSyncSubscribe=function(){this.enableDav(h.User.MobileSyncEnable&&this.mobileSync()&&this.mobileSync().EnableDav);this.enableDav()&&(this.davLogin(this.mobileSync().Dav.Login),this.davServer(this.mobileSync().Dav.Server),this.davCalendars(this.mobileSync().Dav.Calendars),this.davPersonalContactsUrl(this.mobileSync().Dav.PersonalContactsUrl),
this.davCollectedAddressesUrl(this.mobileSync().Dav.CollectedAddressesUrl),this.davGlobalAddressBookUrl(this.mobileSync().Dav.GlobalAddressBookUrl))};Ra.prototype.TemplateName="Settings_OutLookSyncSettingsViewModel";Ra.prototype.TabName=f.SettingsTab.OutLookSync;Ra.prototype.TabTitle=d.i18n("SETTINGS/TAB_OUTLOOK_SYNC");Ra.prototype.onRoute=function(){h.User.requestSyncSettings()};Ra.prototype.onOutlookSyncSubscribe=function(){h.User.OutlookSyncEnable&&(this.visibleOutlookSync(!0),this.outlookSync()&&
(this.login(this.outlookSync().Login),this.server(this.outlookSync().Server)))};ga.prototype.getState=function(){return[this.friendlyName(),this.email(),this.incomingMailLogin(),this.incomingMailPort(),this.incomingMailServer(),this.outgoingMailLogin(),this.outgoingMailPort(),this.outgoingMailServer(),this.useSmtpAuthentication()].join(":")};ga.prototype.updateFirstState=function(){this.firstState=this.getState()};ga.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?
!0:!1};ga.prototype.populate=function(a){a?(this.allowChangePassword(a.extensionExists("AllowChangePasswordExtension")),this.isInternal(a.isInternal()),this.isLinked(a.isLinked()),this.isDefault(a.isDefault()),this.useSmtpAuthentication(2===d.pInt(a.outgoingMailAuth())?!0:!1),this.friendlyName(a.friendlyName()),this.email(a.email()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.outgoingMailServer(a.outgoingMailServer()),
this.outgoingMailLogin(a.outgoingMailLogin()),this.outgoingMailPort(a.outgoingMailPort()),this.updateFirstState()):(this.allowChangePassword(!1),this.isLinked(!0),this.useSmtpAuthentication(!0),this.friendlyName(""),this.email(""),this.incomingMailLogin(""),this.incomingMailServer(""),this.incomingMailPort(143),this.outgoingMailServer(""),this.outgoingMailLogin(""),this.outgoingMailPort(25))};ga.prototype.onResponse=function(a,c){this.loading(!1);if(a.Result){var b=d.pInt(a.AccountID);if(b=0<b?h.Accounts.getAccount(b):
null)b.updateExtended(c),e.Api.showReport(d.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY"))}else e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};ga.prototype.prepareParameters=function(){return{Action:"UpdateAccountSettings",AccountID:this.account().id(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:d.pInt(this.incomingMailPort()),OutgoingMailServer:this.outgoingMailServer(),
OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPort:d.pInt(this.outgoingMailPort()),OutgoingMailAuth:this.useSmtpAuthentication()?2:0}};ga.prototype.saveData=function(a){this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};ga.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.saveData(this.prepareParameters()))};ga.prototype.onChangePasswordClick=function(){e.Screens.showPopup(Ea,[!1])};ga.prototype.onShow=function(a,c){this.account(c)};fb.prototype.isChanged=
function(){return!1};fb.prototype.onAddNewFolderClick=function(){e.Screens.showPopup(Na)};fb.prototype.onSystemFoldersClick=function(){e.Screens.showPopup(Ma)};ha.prototype.getState=function(){return[this.type(),this.options(),this.oHtmlEditor.getText()].join(":")};ha.prototype.updateFirstState=function(){this.firstState=this.getState()};ha.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};ha.prototype.getSignature=function(){if(this.account())if(null!==
this.account().signature())this.type(this.account().signature().type()),this.options(this.account().signature().options()),this.signature(this.account().signature().signature());else{var a={Action:"AccountSignature",AccountID:this.account().id()};e.Ajax.send(a,this.onSignatureResponse,this)}};ha.prototype.onSignatureResponse=function(a){var c=null,b=parseInt(a.AccountID,10);a.Result?this.account()&&b===this.account().id()&&(c=new hb,c.parse(b,a.Result),this.account().signature(c),this.type(this.account().signature().type()),
this.options(this.account().signature().options()),this.signature(this.account().signature().signature())):e.Api.showErrorByCode(a.ErrorCode)};ha.prototype.prepareParameters=function(){return{Action:"UpdateAccountSignature",AccountID:this.account().id(),Type:this.type()?1:0,Options:this.options(),Signature:this.signature()}};ha.prototype.saveData=function(a){this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};ha.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.signature(this.oHtmlEditor.getText()),
this.account().signature().type(this.type()),this.account().signature().options(this.options()),this.account().signature().signature(this.signature()),this.saveData(this.prepareParameters()))};ha.prototype.onResponse=function(a){this.loading(!1);a.Result?e.Api.showReport(d.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};ha.prototype.onShow=function(a,c){this.account(c);this.oHtmlEditor.initCrea(this.signature(),
"");this.oHtmlEditor.setActivitySource(this.options);this.updateFirstState()};oa.prototype.getState=function(){return[this.enable(),this.email()].join(":")};oa.prototype.updateFirstState=function(){this.firstState=this.getState()};oa.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};oa.prototype.onResponse=function(a,c){this.loading(!1);if(c&&c.Action)if("GetForward"===c.Action){if(a&&a.Result&&a.AccountID&&this.account()){var b=null,f=new ob,i=d.pInt(a.AccountID);
if(i&&(b=h.Accounts.getAccount(i)))f.parse(i,a.Result),b.forward(f),this.enable(b.forward().enable),this.email(b.forward().email),this.updateFirstState(),i===this.account().id()&&this.account.valueHasMutated()}}else"UpdateForward"===c.Action&&(a&&a.Result?e.Api.showReport(d.i18n("SETTINGS/ACCOUNT_FORWARD_SUCCESS_REPORT")):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")));else e.Api.showError(d.i18n("WARNING/UNKNOWN_ERROR"))};oa.prototype.prepareParameters=function(){return{Action:"UpdateForward",
AccountID:this.account().id(),Enable:this.enable()?"1":"0",Email:this.email()}};oa.prototype.saveData=function(a){this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};oa.prototype.onSaveClick=function(){if(this.account()){var a=this.account().forward();a&&(a.enable=this.enable(),a.email=this.email());this.loading(!0);this.saveData(this.prepareParameters())}};oa.prototype.getForward=function(){if(this.account())if(null!==this.account().forward())this.enable(this.account().forward().enable),
this.email(this.account().forward().email),this.firstState=this.getState();else{var a={Action:"GetForward",AccountID:this.account().id()};this.loading(!0);this.updateFirstState();e.Ajax.send(a,this.onResponse,this)}};oa.prototype.onShow=function(a,c){this.account(c)};na.prototype.getState=function(){return[this.enable(),this.subject(),this.message()].join(":")};na.prototype.updateFirstState=function(){this.firstState=this.getState()};na.prototype.isChanged=function(){return this.firstState&&this.getState()!==
this.firstState?!0:!1};na.prototype.onResponse=function(a,c){this.loading(!1);if(c&&c.Action)if("GetAutoresponder"===c.Action){if(a&&a.Result&&a.AccountID&&this.account()){var b=null,f=new nb,i=d.pInt(a.AccountID);if(i&&(b=h.Accounts.getAccount(i)))f.parse(i,a.Result),b.autoresponder(f),i===this.account().id()&&this.account.valueHasMutated()}}else"UpdateAutoresponder"===c.Action&&(a&&a.Result?e.Api.showReport(d.i18n("SETTINGS/ACCOUNT_AUTORESPONDER_SUCCESS_REPORT")):e.Api.showErrorByCode(a.ErrorCode,
d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")));else e.Api.showError(d.i18n("WARNING/UNKNOWN_ERROR"))};na.prototype.prepareParameters=function(){return{Action:"UpdateAutoresponder",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Subject:this.subject(),Message:this.message()}};na.prototype.saveData=function(a){this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};na.prototype.onSaveClick=function(){if(this.account()){var a=this.account().autoresponder();a&&(a.enable=this.enable(),
a.subject=this.subject(),a.message=this.message());this.loading(!0);this.saveData(this.prepareParameters())}};na.prototype.getAutoresponder=function(){if(this.account())if(null!==this.account().autoresponder())this.enable(this.account().autoresponder().enable),this.subject(this.account().autoresponder().subject),this.message(this.account().autoresponder().message),this.updateFirstState();else{var a={Action:"GetAutoresponder",AccountID:this.account().id()};this.loading(!0);e.Ajax.send(a,this.onResponse,
this)}};na.prototype.onShow=function(a,c){this.account(c)};O.prototype.getState=function(){var a=":",c=_.map(this.collection(),function(a){return a.toString()},this);0<c.length&&(a=c.join(":"));return a};O.prototype.updateFirstState=function(){this.firstState=this.getState()};O.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};O.prototype.onResponse=function(a,c){this.loading(!1);if(c&&c.Action)if("GetSieveFilters"===c.Action){if(a&&a.Result&&a.AccountID&&
this.account()){var b=null,f=new pb,i=d.pInt(a.AccountID);if(i&&(b=h.Accounts.getAccount(i)))f.parse(i,a.Result),b.filters(f),i===this.account().id()&&this.account.valueHasMutated()}}else"UpdateSieveFilters"===c.Action&&(a&&a.Result?e.Api.showReport(d.i18n("SETTINGS/ACCOUNT_FILTERS_SUCCESS_REPORT")):e.Api.showError(d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")));else e.Api.showError(d.i18n("WARNING/UNKNOWN_ERROR"))};O.prototype.prepareParameters=function(){var a=_.map(this.collection(),function(a){return{Enable:a.enable()?
"1":"0",Field:a.field(),Filter:a.filter(),Condition:a.condition(),Action:a.action(),FolderFullName:a.folder()}});return{Action:"UpdateSieveFilters",AccountID:this.account().id(),Filters:a}};O.prototype.saveData=function(a){this.updateFirstState();e.Ajax.send(a,this.onResponse,this)};O.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.saveData(this.prepareParameters()))};O.prototype.getFilters=function(){if(this.account())if(null!==this.account().filters())this.collection(this.account().filters().collection()),
this.updateFirstState();else{var a={Action:"GetSieveFilters",AccountID:this.account().id()};this.loading(!0);e.Ajax.send(a,this.onResponse,this)}};O.prototype.onShow=function(a,c){this.account(c)};O.prototype.deleteFilter=function(a){this.collection.remove(a)};O.prototype.addFilter=function(){if(this.account()){var a=new cb(this.account().id());this.collection.push(a)}};O.prototype.displayFilterPart=function(a,c){var b="",b="%FIELD%"===a?"Field":"%CONDITION%"===a?"Condition":"%STRING%"===a?"String":
"%ACTION%"===a?"Action":"%FOLDER%"===a?"Folder":"%DEPENDED"===a.substr(0,9)?"DependedText":"Text";return c+b};O.prototype.getDependedText=function(a){(a=d.pString(a))&&(a=a.replace(/%/g,"").split("=")[1]||"");return a};O.prototype.getDependedField=function(a,c){if(a=d.pString(a))a=a.replace(/[=](.*)/g,"").split("-")[1]||"",a=a.toLowerCase();return d.isUnd(c[a])?!1:c[a]()};Ya.prototype.onSaveClick=function(){if(this.isEmptyRequiredFields())e.Api.showErrorByCode(0,d.i18n("WARNING/FETCHER_CREATE_ERROR"));
else{var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),IsEnabled:this.isEnabled()?1:0,Folder:this.folder(),IncomingMailPassword:""===this.incomingMailPassword()?"******":this.incomingMailPassword(),LeaveMessagesOnServer:this.leaveMessagesOnServer()?1:0};this.loading(!0);e.Ajax.send(a,this.onSaveFetcherResponse,this)}};Ya.prototype.onSaveFetcherResponse=function(a){this.loading(!1);a.Result?(e.populateFetchers(),e.Api.showReport(d.i18n("SETTINGS/ACCOUNT_FETCHER_SUCCESSFULLY_SAVED"))):
e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/UNKNOWN_ERROR"))};Ya.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.idFetcher()),this.isEnabled(a.isEnabled()),this.folder(a.folder()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailPassword("******"),this.leaveMessagesOnServer(a.leaveMessagesOnServer()))};Ya.prototype.isEmptyRequiredFields=function(){switch(""){case this.incomingMailServer():return this.serverIsSelected(!0),
!0;case this.incomingMailLogin():return this.loginIsSelected(!0),!0;case this.incomingMailPassword():return this.passwordIsSelected(!0),!0;default:return!1}};Za.prototype.onSaveClick=function(){if(this.outgoingMailAuth()&&this.isEmptyRequiredFields())e.Api.showErrorByCode(0,d.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),Email:this.email(),Name:this.userName(),IsOutgoingEnabled:this.isOutgoingEnabled()?1:0,OutgoingMailServer:this.outgoingMailServer(),
OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.outgoingMailAuth()?1:0};this.loading(!0);e.Ajax.send(a,this.onSaveFetcherResponse,this)}};Za.prototype.onSaveFetcherResponse=function(a){this.loading(!1);a.Result?(e.populateFetchers(),e.Api.showReport(d.i18n("SETTINGS/ACCOUNT_FETCHER_SUCCESSFULLY_SAVED"))):e.Api.showErrorByCode(a.ErrorCode,d.i18n("WARNING/UNKNOWN_ERROR"))};Za.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.idFetcher()),this.isEnabled(a.isEnabled()),
this.email(a.email()),this.userName(a.userName()),this.isOutgoingEnabled(a.isOutgoingEnabled()),this.outgoingMailServer(a.outgoingMailServer()),this.outgoingMailPort(a.outgoingMailPort()),this.outgoingMailAuth(a.outgoingMailAuth()))};Za.prototype.isEmptyRequiredFields=function(){return this.isOutgoingEnabled()&&""===this.outgoingMailServer()?(this.serverIsSelected(!0),!0):!1};Ja.prototype.onSaveClick=function(){var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),
Signature:this.oHtmlEditor.getText()};this.loading(!0);e.Ajax.send(a,this.onSaveFetcherResponse,this)};Ja.prototype.onSaveFetcherResponse=function(a){this.loading(!1);a.Result?e.Api.showReport(d.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")):e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};Ja.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.idFetcher()),this.signature(a.signature()))};Ja.prototype.getState=function(){return[this.type(),this.options(),
this.oHtmlEditor.getText()].join(":")};Ja.prototype.updateFirstState=function(){this.firstState=this.getState()};Ja.prototype.onShow=function(){this.oHtmlEditor.initCrea(this.signature(),"");this.oHtmlEditor.setActivitySource(this.options);this.updateFirstState()};Ia.prototype.TemplateName="Settings_HelpdeskSettingsViewModel";Ia.prototype.TabName=f.SettingsTab.Helpdesk;Ia.prototype.TabTitle=d.i18n("SETTINGS/TAB_HELPDESK");Ia.prototype.onShow=function(){this.allowNotifications(h.User.AllowHelpdeskNotifications)};
Ia.prototype.onResponse=function(a){this.loading(!1);!1===a.Result?e.Api.showErrorByCode(a.ErrorCode,d.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(h.User.updateHelpdeskSettings(this.allowNotifications()),e.Api.showReport(d.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))};Ia.prototype.onSaveClick=function(){var a={Action:"UpdateHelpdeskUserSettings",AllowHelpdeskNotifications:this.allowNotifications()?"1":"0"};this.loading(!0);e.Ajax.send(a,this.onResponse,this)};k.prototype.initFullCalendar=
function(){this.$calendarGrid.fullCalendar(this.fullcalendarOptions)};k.prototype.applyCalendarSettings=function(){this.timeFormatGrid=h.User.defaultTimeFormat()===f.TimeFormat.F24?"HH:mm":"hh:mm TT";this.timeFormatMoment=h.User.defaultTimeFormat()===f.TimeFormat.F24?"HH:mm":"hh:mm A";this.dateFormat=h.User.DefaultDateFormat;this.calendarGridDom().removeClass("fc-show-weekends");h.User.CalendarShowWeekEnds&&this.calendarGridDom().addClass("fc-show-weekends");this.fullcalendarOptions.timeFormat=this.timeFormatGrid+
"{ - "+this.timeFormatGrid+"}";this.fullcalendarOptions.axisFormat=this.timeFormatGrid;this.fullcalendarOptions.firstDay=h.User.CalendarWeekStartsOn;switch(h.User.CalendarDefaultTab){case f.CalendarDefaultTab.Day:this.displayDayView();break;case f.CalendarDefaultTab.Week:this.displayWeekView();break;case f.CalendarDefaultTab.Month:this.displayMonthView()}this.applyFirstDay();this.fullcalendarOptions.defaultView=this.selectedView();this.$calendarGrid.fullCalendar("destroy");this.$calendarGrid.fullCalendar(this.fullcalendarOptions)};
k.prototype.applyFirstDay=function(){var a=[],c="",c="";_.each(this.aDayNames,function(c){a.push(c)});switch(h.User.CalendarWeekStartsOn){case 1:c=a.shift();a.push(c);break;case 6:c=a.pop(),a.unshift(c)}this.correctedDayNames(a);this.$datePicker.datepicker("option","firstDay",h.User.CalendarWeekStartsOn)};k.prototype.initDatePicker=function(){this.$datePicker.datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:d.getMonthNamesArray(),dayNamesMin:d.i18n("DATETIME/DAY_NAMES_MIN").split(" "),
onChangeMonthYear:_.bind(this.changeMonthYearFromDatePicker,this),onSelect:_.bind(this.selectDateFromDatePicker,this),beforeShowDay:_.bind(this.getDayDescription,this)})};k.prototype.onApplyBindings=function(){this.$calendarGrid=i(this.calendarGridDom());this.$datePicker=i(this.datePickerDom());this.initFullCalendar();this.initDatePicker();this.applyCalendarSettings();this.highlightWeekInDayPicker();_.delay(_.bind(this.initResizing,this),300)};k.prototype.onShow=function(){e.CalendarCache&&e.CalendarCache.calendarSettingsChanged()?
(this.applyCalendarSettings(),this.reloadAll()):e.CalendarCache&&e.CalendarCache.calendarChanged()?(e.CalendarCache.calendarChanged(!1),this.reloadAll()):this.loaded||this.getCalendars()};k.prototype.displayViewCallback=function(a){var c=0,b=null;"month"!==a.name&&h.User.CalendarShowWorkDay&&i(".fc-agenda-slots tr").each(function(){var a=i(this).find("td");0!==a.length&&(i(".fc-slot"+c+" th").each(function(){var c=i(this).eq(0).text(),c=""!==c?Date.parse("01/01/2001 "+c):null,d=Date.parse("01/01/2001 "+
h.User.CalendarWorkDayStarts+":00"),e=Date.parse("01/01/2001 "+h.User.CalendarWorkDayEnds+":00");c?b=c:c=b;(c<d||c>=e)&&a.addClass("fc-non-working-time")}),c++)});this.activateCustomScrollInDayAndWeekView()};k.prototype.collectBusyDays=function(){var a=[],c=this.calendars.getEvents();_.each(c,function(c){for(var b=moment(c.start),c=(c=c.end?moment(c.end):null)?c.diff(b,"days"):0,d=0;d<=c;d++)a.push(b.clone().add("days",d).toDate())},this);this.busyDays(a)};k.prototype.refreshDatePicker=function(){_.defer(_.bind(function(){this.collectBusyDays();
this.$datePicker.datepicker("refresh");this.highlightWeekInDayPicker()},this))};k.prototype.getDayDescription=function(a){return[!0,_.find(this.busyDays(),function(c){return c.getDate()===a.getDate()&&c.getMonth()===a.getMonth()&&c.getYear()===a.getYear()},this)?"day_with_events":"",""]};k.prototype.initResizing=function(){var a=_.throttle(_.bind(this.resize,this),50);i(j).bind("resize",function(c){c.target===this&&a()});a()};k.prototype.resize=function(){var a=this.$calendarGrid.parent();a&&this.$calendarGrid.fullCalendar("option",
"height",a.height());this.dayNamesResize()};k.prototype.dayNamesResize=function(){if("month"===this.selectedView()){var a=i("div.weekday-header-item"),c=i("tr.fc-first td.fc-day"),b=i(c[0]).width(),d=0;if(7===a.length&&7===c.length&&0!==b)for(;7>d;d++)i(a[d]).width(b)}};k.prototype.changeMonthYearFromDatePicker=function(a,c){var b=this.$calendarGrid.fullCalendar("getDate");this.$calendarGrid.fullCalendar("gotoDate",a,c-1,b.getDate());this.changeDate()};k.prototype.selectDateFromDatePicker=function(a){a=
new Date(a);this.$calendarGrid.fullCalendar("gotoDate",a.getFullYear(),a.getMonth(),a.getDate());this.changeDate();_.defer(_.bind(this.highlightWeekInDayPicker,this))};k.prototype.highlightWeekInDayPicker=function(){var a=this.$datePicker.find("td.ui-datepicker-current-day").parent(),c=this.$datePicker.find("table.ui-datepicker-calendar");switch(this.$calendarGrid.fullCalendar("getView").name){case "agendaDay":c.addClass("highlight_day").removeClass("highlight_week");break;case "agendaWeek":c.removeClass("highlight_day").addClass("highlight_week");
break;default:c.removeClass("highlight_day").removeClass("highlight_week")}a.addClass("current_week")};k.prototype.changeDate=function(){var a=moment(this.$calendarGrid.fullCalendar("getDate")),c=this.$calendarGrid.fullCalendar("getView"),b=a.format("MMMM YYYY"),d=c.start?moment(c.start):null,e=c.end?moment(c.end).add("days",-1):null,f=_.map(this.calendars.collection(),function(a){return a.id},this);0<f.length&&this.getEvents(f);switch(c.name){case "agendaDay":b=a.format("MMMM D, YYYY");break;case "agendaWeek":d&&
e&&(b=d.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}this.dateTitle(b);this.selectedView(c.name)};k.prototype.changeDateInDatePicker=function(){this.$datePicker.datepicker("setDate",this.$calendarGrid.fullCalendar("getDate"));this.highlightWeekInDayPicker()};k.prototype.activateCustomScrollInDayAndWeekView=function(){i("table.fc-agenda-slots").parent().parent().each(function(){var a=i(this),c=i(this).parent();c.hasClass("scroll-wrap")||(c.css({overflow:"hidden"}).attr("data-bind","customScrollbar: {x: false, relativeToInner: true}"),
a.addClass("scroll-inner"),b.applyBindings({},c[0]))})};k.prototype.execCommand=function(a,c){c?this.$calendarGrid.fullCalendar(a,c):this.$calendarGrid.fullCalendar(a);this.changeDate();this.changeDateInDatePicker()};k.prototype.displayToday=function(){this.execCommand("today")};k.prototype.displayPrev=function(){this.execCommand("prev")};k.prototype.displayNext=function(){this.execCommand("next")};k.prototype.displayDayView=function(){this.execCommand("changeView","agendaDay")};k.prototype.displayWeekView=
function(){this.execCommand("changeView","agendaWeek")};k.prototype.displayMonthView=function(){this.execCommand("changeView","month")};k.prototype.reloadAll=function(){this.endDateTime=this.startDateTime=0;this.needsToReload=!0;this.getCalendars()};k.prototype.getCalendars=function(){this.checkStarted(!0);e.Ajax.abortRequestByActionName("CalendarList");e.Ajax.sendExt({Action:"CalendarList",IsPublic:this.isPublic?1:0,PublicCalendarId:this.publicCalendarId},this.onCalendarsResponse,this)};k.prototype.onCalendarsResponse=
function(a){var c=[],b=null;a.Result&&(this.loaded=!0,a.Result=_.sortBy(a.Result,function(a){return"Default"!==a.Id}),_.each(a.Result,function(a){if(b=this.calendars.parseAndAddCalendar(a))this.isPublic&&(e.setTitle(b.name()),this.publicCalendarName(b.name())),c.push(b.id)},this),0===c.length&&this.isPublic&&(e.setTitle(d.i18n("CALENDAR/NO_CALENDAR_FOUND")),e.Api.showErrorByCode(0,d.i18n("CALENDAR/NO_CALENDAR_FOUND"))),this.getEvents(c));this.checkStarted(!1)};k.prototype.getEvents=function(a){var c=
!1,b=this.$calendarGrid.fullCalendar("getView"),d=b&&b.visStart&&b.visStart.getTime?b.visStart.getTime()/1E3:0,b=b&&b.visEnd&&b.visEnd.getTime?b.visEnd.getTime()/1E3:0;0===this.startDateTime&&0===this.endDateTime?(this.startDateTime=d,this.endDateTime=b,c=!0):d<this.startDateTime&&b>this.endDateTime?(this.startDateTime=d,this.endDateTime=b,c=!0):d<this.startDateTime?(b=this.startDateTime,this.startDateTime=d,c=!0):b>this.endDateTime&&(d=this.endDateTime,this.endDateTime=b,c=!0);0<a.length&&c&&(this.checkStarted(!0),
1<a.length&&this.$calendarGrid.find(".fc-view div").first().css("visibility","hidden"),e.Ajax.abortRequestByActionName("EventList"),e.Ajax.sendExt({CalendarIds:JSON.stringify(a),Start:d,End:b,IsPublic:this.isPublic?1:0,Action:"EventList"},this.onEventsResponse,this))};k.prototype.onEventsResponse=function(a){a.Result&&(this.needsToReload&&this.$calendarGrid.fullCalendar("removeEvents"),_.each(this.calendars.collection(),function(a){a&&(this.$calendarGrid.fullCalendar("removeEventSource",{events:a.events}),
this.needsToReload&&a.removeEvents())},this),this.needsToReload=!1,_.each(a.Result,function(a){var b=this.calendars.getCalendarById(a.calendarId);b&&b.addEvent(a)},this),_.each(this.calendars.collection(),function(a){a&&a.active()&&this.$calendarGrid.fullCalendar("addEventSource",{events:a.events})},this),this.refreshDatePicker());this.$calendarGrid.css("visibility","");this.$calendarGrid.find(".fc-view div").first().css("visibility","");this.checkStarted(!1)};k.prototype.getUnusedColor=function(){var a=
_.difference(this.colors,this.calendars.getColors());return 0<a.length?a[0]:this.colors[0]};k.prototype.openCreateCalendarForm=function(){if(!this.isPublic){var a=new va;a.color(this.getUnusedColor());e.Screens.showPopup(Fa,[_.bind(this.createCalendar,this),this.colors,a])}};k.prototype.createCalendar=function(a,c,b){this.isPublic||e.Ajax.send({Name:a,Description:c,Color:b,Action:"CalendarCreate"},this.onCalendarCreateResponse,this)};k.prototype.onCalendarCreateResponse=function(a,c){a.Result&&this.calendars.parseAndAddCalendar({Id:a.Result,
Name:c.Name,Description:c.Description,Active:!0,isDefault:!1,Color:c.Color,Events:[]})};k.prototype.openUpdateCalendarForm=function(a){this.isPublic||e.Screens.showPopup(Fa,[_.bind(this.updateCalendar,this),this.colors,a])};k.prototype.updateCalendar=function(a,c,b,d){this.isPublic||e.Ajax.send({Name:a,Description:c,Color:b,Id:d,Action:"CalendarUpdate"},this.onCalendarUpdateResponse,this)};k.prototype.onCalendarUpdateResponse=function(a,c){var b=null,d=[];if(a.Result&&(b=this.calendars.getCalendarById(c.Id)))d=
b.events,b.name(c.Name),b.description(c.Description),b.color(c.Color),this.$calendarGrid.fullCalendar("removeEventSource",{events:d}),this.$calendarGrid.fullCalendar("addEventSource",{events:b.events})};k.prototype.updateCalendarColor=function(a,c){this.isPublic||e.Ajax.send({Color:a,Id:c,Action:"CalendarUpdateColor"},this.onCalendarUpdateColorResponse,this)};k.prototype.onCalendarUpdateColorResponse=function(a,c){var b=null,d=[];if(a.Result&&(b=this.calendars.getCalendarById(c.Id)))d=b.events,b.color(c.Color),
this.$calendarGrid.fullCalendar("removeEventSource",{events:d}),this.$calendarGrid.fullCalendar("addEventSource",{events:b.events})};k.prototype.openGetLinkCalendarForm=function(a){this.isPublic||e.Screens.showPopup($a,[_.bind(this.publicCalendar,this),a])};k.prototype.openShareCalendarForm=function(a){this.isPublic||e.Screens.showPopup(ba,[_.bind(this.shareCalendar,this),a])};k.prototype.shareCalendar=function(a,c,b){this.isPublic||e.Ajax.send({Action:"CalendarShareUpdate",Id:a,IsPublic:c?1:0,Shares:JSON.stringify(b)},
this.onCalendarShareUpdateResponse,this)};k.prototype.onCalendarShareUpdateResponse=function(a,c){if(a.Result){var b=this.calendars.getCalendarById(c.Id);b&&b.shares(JSON.parse(c.Shares))}};k.prototype.publicCalendar=function(a,c){this.isPublic||e.Ajax.send({Action:"CalendarPublicUpdate",Id:a,IsPublic:c?1:0},this.onCalendarPublicUpdateResponse,this)};k.prototype.onCalendarPublicUpdateResponse=function(a,c){if(a.Result){var b=this.calendars.getCalendarById(c.Id);b&&b.isPublic(c.IsPublic)}};k.prototype.deleteCalendar=
function(a){var c=this.calendars.getCalendarById(a),b=c?d.i18n("CALENDAR/CONFIRM_REMOVE_CALENDAR",{CALENDARNAME:c.name()}):"",f=_.bind(function(c){c&&e.Ajax.send({Id:a,Action:"CalendarDelete"},this.onCalendarDeleteResponse,this)},this);!this.isPublic&&c&&e.Screens.showPopup(G,[b,f])};k.prototype.onCalendarDeleteResponse=function(a,c){if(a.Result){var b=this.calendars.getCalendarById(c.Id);b&&!b.isDefault&&(this.calendars.currentCal().id===b.id&&this.calendars.currentCal(null),this.calendars.removeCalendar(b.id),
this.$calendarGrid.fullCalendar("removeEventSource",{events:b.events}))}};k.prototype.createNewEventInCurrentCalendar=function(){this.createNewEventToday(this.calendars.currentCal())};k.prototype.createNewEventInCalendar=function(a){this.createNewEventToday(this.calendars.getCalendarById(a))};k.prototype.createNewEventToday=function(a){var c=moment();30<c.minutes()?c.add("minutes",60-c.minutes()):c.minutes(30);c.seconds(0);c.milliseconds(0);this.openCreateEventForm(a,c,c.clone().add("minutes",30),
!1)};k.prototype.getParametersFromEventData=function(a){var c={id:a.id,uid:a.uid,calendarId:a.calendarId,newCalendarId:!d.isUnd(a.newCalendarId)?a.newCalendarId:a.calendarId,subject:a.subject,allDay:a.allDay?1:0,location:a.location,description:a.description,alarms:a.alarms?JSON.stringify(a.alarms):"[]",attendees:a.attendees?JSON.stringify(a.attendees):"[]",owner:a.owner,recurrenceId:a.recurrenceId,excluded:a.excluded,allEvents:a.allEvents,modified:a.modified?1:0};a.rrule&&(c.rrule=JSON.stringify(a.rrule));
c.start=a.start;c.end=a.end;c.startTimestamp=c.start.getTime()/1E3;c.endTimestamp=c.end?c.end.getTime()/1E3:c.startTimestamp;return c};k.prototype.getEventDataFromParameters=function(a){a.alarms=a.alarms?JSON.parse(a.alarms):[];a.attendees=a.attendees?JSON.parse(a.attendees):[];a.rrule&&(a.rrule=JSON.parse(a.rrule));return a};k.prototype.createEventFromGrid=function(a,c,b){this.openCreateEventForm(this.calendars.currentCal(),moment(a),moment(c),b)};k.prototype.openCreateEventForm=function(a,c,b,d){this.isPublic||
e.Screens.showPopup(o,[{CallbackSave:_.bind(this.createEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),Calendars:this.calendars,SelectedCalendar:a.id,StartMoment:c,EndMoment:b,AllDay:d,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this),Owner:a.owner()}])};k.prototype.createEvent=function(a){var c=this.getParametersFromEventData(a),b=this.$calendarGrid.fullCalendar("getView"),d=b&&b.visStart&&b.visStart.getTime?
b.visStart.getTime()/1E3:0,b=b&&b.visEnd&&b.visEnd.getTime?b.visEnd.getTime()/1E3:0;this.isPublic||(c.calendarId=a.newCalendarId,c.selectStart=d,c.selectEnd=b,c.Action="EventCreate",e.Ajax.send(c,this.onEventActionResponse,this))};k.prototype.openEditEventForm=function(a){var c=_.bind(function(c){var b={CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:a.id,Uid:a.uid,RecurrenceId:a.recurrenceId,Calendars:this.calendars,SelectedCalendar:a.calendarId,AllDay:a.allDay,
Location:a.location,Description:a.description,Subject:a.subject,Alarms:a.alarms,Attendees:a.attendees,RRule:a.rrule?a.rrule:null,Excluded:a.excluded?a.excluded:!1,Owner:a.owner,Appointment:a.appointment,OwnerName:a.ownerName,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,AllEvents:c,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this)};c!==f.CalendarEditRecurrenceEvent.None&&(c===f.CalendarEditRecurrenceEvent.AllEvents&&a.rrule?(b.StartMoment=moment(1E3*a.rrule.startBase),
b.EndMoment=moment(1E3*a.rrule.endBase)):(b.StartMoment=moment(a.start),b.EndMoment=moment(a.end)),e.Screens.showPopup(o,[b]))},this);a.rrule?a.excluded?c(f.CalendarEditRecurrenceEvent.OnlyThisInstance):e.Screens.showPopup(Ga,[c]):c(f.CalendarEditRecurrenceEvent.AllEvents)};k.prototype.eventAction=function(a,c,b){this.calendars.getCalendarById(c.calendarId).access===f.CalendarAccess.Read?b&&b():this.isPublic||(b&&(this.revertFunction=b),c.Action=a,e.Ajax.send(c,this.onEventActionResponse,this))};
k.prototype.updateEvent=function(a){var c=this.getParametersFromEventData(a),b=this.$calendarGrid.fullCalendar("getView"),d=b&&b.visStart&&b.visStart.getTime?b.visStart.getTime()/1E3:0,b=b&&b.visEnd&&b.visEnd.getTime?b.visEnd.getTime()/1E3:0;c.selectStart=d;c.selectEnd=b;a.modified&&this.eventAction("EventUpdate",c)};k.prototype.moveEvent=function(a,c,b,d,e){a.dayDelta=c?c:0;a.minuteDelta=b?b:0;var h=this.getParametersFromEventData(a),a=(c=this.$calendarGrid.fullCalendar("getView"))&&c.visStart&&
c.visStart.getTime?c.visStart.getTime()/1E3:0,c=c&&c.visEnd&&c.visEnd.getTime?c.visEnd.getTime()/1E3:0;_.bind(function(a){a?(h.allEvents=f.CalendarEditRecurrenceEvent.OnlyThisInstance,this.eventAction("EventUpdate",h,e)):e&&e()},this);h.selectStart=a;h.selectEnd=c;this.isPublic||(h.rrule?e(!1):(h.allEvents=f.CalendarEditRecurrenceEvent.AllEvents,this.eventAction("EventUpdate",h,e)))};k.prototype.resizeEvent=function(a,c,b,d){var h=this.getParametersFromEventData(a),c=(b=this.$calendarGrid.fullCalendar("getView"))&&
b.visStart&&b.visStart.getTime?b.visStart.getTime()/1E3:0,b=b&&b.visEnd&&b.visEnd.getTime?b.visEnd.getTime()/1E3:0,i=_.bind(function(a){a!==f.CalendarEditRecurrenceEvent.None?(h.allEvents=a,this.eventAction("EventUpdate",h,d)):d()},this);h.selectStart=c;h.selectEnd=b;a.rrule?h.excluded?i(f.CalendarEditRecurrenceEvent.OnlyThisInstance):e.Screens.showPopup(Ga,[i]):i(f.CalendarEditRecurrenceEvent.AllEvents)};k.prototype.deleteEvent=function(a){a=this.getParametersFromEventData(a);this.eventAction("EventDelete",
a)};k.prototype.onEventActionResponse=function(a,c){var b=this.calendars.getCalendarById(c.calendarId);if(a.Result&&!d.isUnd(b))if("EventUpdate"===c.Action||"EventCreate"===c.Action)this.customscrollTop(parseInt(i(".calendar .scroll-inner").scrollTop(),10)),this.$calendarGrid.fullCalendar("removeEventSource",{events:b.events}),c.rrule&&c.allEvents===f.CalendarEditRecurrenceEvent.AllEvents?b.removeEventByUid(c.uid,!0):b.removeEvent(c.id),c.newCalendarId&&c.newCalendarId!==c.calendarId&&(this.$calendarGrid.fullCalendar("addEventSource",
{events:b.events}),b=this.calendars.getCalendarById(c.newCalendarId),this.$calendarGrid.fullCalendar("removeEventSource",{events:b.events})),_.each(a.Result,function(a){b.addEvent(a)},this),b.active()?this.$calendarGrid.fullCalendar("addEventSource",{events:b.events}):b.active(!0),this.refreshDatePicker(),this.customscrollTop.valueHasMutated();else if("EventDelete"===c.Action)this.$calendarGrid.fullCalendar("removeEventSource",{events:b.events}),c.allEvents===f.CalendarEditRecurrenceEvent.OnlyThisInstance?
b.removeEvent(c.id):b.removeEventByUid(c.uid),this.$calendarGrid.fullCalendar("addEventSource",{events:b.events}),this.refreshDatePicker();else{if("EventBase"===c.Action){var h=a.Result;e.Screens.showPopup(o,[{CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:h.id,Uid:h.uid,RecurrenceId:h.recurrenceId,Calendars:this.calendars,SelectedCalendar:h.calendarId,StartMoment:moment(1E3*h.start),EndMoment:moment(1E3*h.end),AllDay:h.allDay,Location:h.location,Description:h.description,
Subject:h.subject,Alarms:h.alarms,Attendees:h.attendees,RRule:h.rrule?h.rrule:null,Excluded:h.excluded?h.excluded:!1,Owner:h.owner,Appointment:h.appointment,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,AllEvents:f.CalendarEditRecurrenceEvent.AllEvents}])}}else this.revertFunction&&this.revertFunction();this.revertFunction=null};k.prototype.attendeeActionDecline=function(a,c){this.$calendarGrid.fullCalendar("removeEventSource",{events:a.events});a.removeEvent(c);this.$calendarGrid.fullCalendar("addEventSource",
{events:a.events});this.refreshDatePicker()};p.prototype.onApplyBindings=function(a){var c=this;this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",i(".panel.files .items_list",a),i(".panel.files .items_list .scroll-inner",a));this.initUploader();i(document).on("keyup",function(a){a&&(a.keyCode===f.Key.s&&c.selector.useKeyboardKeys()&&!d.inFocus())&&c.isSearchFocused(!0)})};p.prototype.initUploader=function(){var a=this;
this.uploaderButton()&&this.uploaderArea()&&(this.oJua=new Jua({action:"?/Upload/File/",name:"jua-uploader",queueSize:2,clickElement:this.uploaderButton(),dragAndDropElement:this.uploaderArea(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:{Token:function(){return h.Token},AccountID:function(){return h.Accounts.currentId()},AdditionalData:function(c){return JSON.stringify({Type:a.storageType(),SubPath:c&&!d.isUnd(c.Folder)?c.Folder:"",Path:a.dropPath()})}},onProgress:_.bind(this.onFileUploadProgress,
this),onSelect:_.bind(this.onFileUploadSelect,this),onStart:_.bind(this.onFileUploadStart,this),onDrop:_.bind(this.onDrop,this),onComplete:_.bind(this.onFileUploadComplete,this),onBodyDragEnter:_.bind(this.bDragActive,this,!0),onBodyDragLeave:_.bind(this.bDragActive,this,!1)}))};p.prototype.onFileUploadSelect=function(a,c){if(""===this.searchPattern()){var b=new Y,e=c.FileName,f=d.getFileExtension(e),i=d.getFileNameWithoutExtension(e),j=0,k=h.Accounts.getDefault(),l=new Date,m=new T;m.parse(l.getTime()/
1E3);for(""!==f&&(f="."+f);!d.isUnd(this.getFileByName(e));)e=i+"_"+j+f,j++;b.name(e).size(c.Size).owner(k.email()).lastModified(m.getShortDate()).path(this.path()).storageType(this.storageType()).uploadUid(a).uploaded(!1).progress(0);this.uploadingFiles.push(b)}};p.prototype.onFileUploadStart=function(){};p.prototype.onFileUploadProgress=function(a,c,b){""===this.searchPattern()&&(a=this.getUploadFileByUid(a),0<b&&a&&a.progress(Math.ceil(100*(c/b))))};p.prototype.onFileUploadComplete=function(a,
c,b){if(""===this.searchPattern()){var c=!c||!b||!b.Result||b.Result.Error,f=b&&b.Result&&"size"===b.Result.Error?d.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):d.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"),h=this.getUploadFileByUid(a);h&&(h.progress(0),h.uploaded(!0));this.deleteUploadFileByUid(a);c?(this.uploadError(!0),b&&e.Api.showErrorByCode(b.ErrorCode,f)):(this.files.push(h),0===this.uploadingFiles().length&&e.Api.showReport(d.i18n("COMPOSE/UPLOAD_COMPLETE")));this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),
this.searchPattern(),!1)}};p.prototype.onDrop=function(a,c){if(c&&c.target&&""===this.searchPattern()){var g=b.dataFor(c.target);g&&(g instanceof Y&&g.isFolder())&&this.dropPath(this.path()+"/"+g.name())}else e.Api.showReport(d.i18n("FILESTORAGE/INFO_CANNOT_UPLOAD_SEARCH_RESULT"))};p.prototype.filesDrop=function(a,c,b){if(a){var f=""!==a.name()?a.path()+"/"+a.name():a.path();if(this.path()!==f&&this.storageType()===a.storageType()||this.storageType()!==a.storageType()){a.recivedAnim(!0);d.uiDropHelperAnim(c,
b);var h=this,b=c.ctrlKey?"FilesCopy":"FilesMove",i=this.selector.listCheckedAndSelected(),i=_.map(i,function(a){c.ctrlKey||(a.isFolder()?h.deleteFolderByName(a.name()):h.deleteFileByName(a.name()));return{Name:a.name(),IsFolder:a.isFolder()}});e.Ajax.send({Action:b,FromType:this.storageType(),ToType:a.storageType(),FromPath:this.path(),ToPath:f,Files:JSON.stringify(i)},this.onFilesMoveResponse,this)}}};p.prototype.onFilesMoveResponse=function(){this.getQuota(this.storageType())};p.prototype.dragAndDropHelper=
function(a){a&&a.checked(!0);var a=d.draggableMessages(),c=this.selector.listCheckedAndSelected().length;i(".count-text",a).text(d.i18n("FILESTORAGE/DRAG_TEXT_PLURAL",{COUNT:c},null,c));return a};p.prototype.onItemDelete=function(){this.executeDelete()};p.prototype.onEnter=function(a){this.onItemDblClick(a)};p.prototype.onItemDblClick=function(a){if(a)if(a.isFolder())this.aPath(this.getCollectionFromPath(a.path())),this.getFiles(this.storageType(),a.name());else if(a.isViewable())a.onViewClick();
else a.onDownloadClick()};p.prototype.onFilesResponse=function(a,c){if(a.Result){var b=new T,d=[],e=[];a.Result.Quota&&(this.quota(a.Result.Quota[0]+a.Result.Quota[1]),this.used(a.Result.Quota[0]));_.each(a.Result.Items,function(a){var c=new Y;if(a.IsFolder){c.name(a.Name).isFolder(true).path(a.Path).storageType(a.Type);d.push(c)}else{b.parse(a.LastModified);c.name(a.Name).size(a.Size).lastModified(b.getShortDate()).owner(a.Owner).path(a.Path).hash(a.Hash).shared(a.Shared).storageType(a.Type);e.push(c)}},
this);c.Type===this.storageType()&&(this.folders(d),this.files(e));this.loading(!1)}};p.prototype.onQuotaResponse=function(a){a.Result&&a.Result.Quota&&(this.quota(a.Result.Quota[0]+a.Result.Quota[1]),this.used(a.Result.Quota[0]))};p.prototype.onFilesDeleteResponse=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern())};p.prototype.executeRename=function(){var a=_.bind(this.renameItem,this),c=this.selector.listCheckedAndSelected();c[0]&&e.Screens.showPopup(Va,
[c[0],a])};p.prototype.executeDownload=function(){var a=this.selector.listCheckedAndSelected();if(a[0]&&!a[0].isFolder())a[0].onDownloadClick()};p.prototype.executeShare=function(){var a=this.selector.listCheckedAndSelected();a[0]&&e.Screens.showPopup(Aa,[a[0]])};p.prototype.executeSend=function(){var a=this.selector.listCheckedAndSelected(),a=_.filter(a,function(a){return!a.isFolder()},this);0<a.length&&e.Routing.goDirectly(e.Links.compose(),["file",a])};p.prototype.onShareIconClick=function(a){a&&
e.Screens.showPopup(Aa,[a])};p.prototype.renameItem=function(a){e.Ajax.send({Action:"FilesRename",Type:this.storageType(),Path:a.path(),Name:a.name(),NewName:a.nameForEdit()},this.onFilesRenameResponse,this)};p.prototype.onFilesRenameResponse=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern())};p.prototype.executeDelete=function(){var a=this.selector.listCheckedAndSelected(),c=d.i18n("FILESTORAGE/CONFIRMATION_DELETE"),b=_.bind(this.deleteItems,
this,a);a&&0<a.length&&e.Screens.showPopup(G,[c,b])};p.prototype.onShow=function(){this.getGroups();this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()));this.selector.useKeyboardKeys(!0);this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)};p.prototype.onHide=function(){this.selector.useKeyboardKeys(!1);this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)};p.prototype.getQuota=function(a){e.Ajax.send({Action:"FilesQuota",Type:a},this.onQuotaResponse,this)};p.prototype.getGroups=
function(){var a=null;this.groups.removeAll();a=new Y;a.storageType(f.FileStorageType.Private).displayName(d.i18n("FILESTORAGE/TAB_PRIVATE_FILES")).isFolder(!0);this.groups.push(a);a=new Y;a.storageType(f.FileStorageType.Corporate).displayName(d.i18n("FILESTORAGE/TAB_CORPORATE_FILES")).isFolder(!0);this.groups.push(a)};p.prototype.getFiles=function(a,c,b,f){this.lastPath(this.path());(d.isUnd(f)||!d.isUnd(f)&&f)&&this.loading(!0);b=d.isUnd(b)?"":d.pString(b);this.storageType(a);this.searchPattern(b);
b=new Y;d.isUnd(c)||""===c?(this.aPath.removeAll(),b.displayName(this.rootPath())):b.name(c);b.path(this.getFullPathByIndex(this.aPath().length)).storageType(a).isFolder(!0);this.aPath.push(b);this.iPathIndex(this.aPath().length-1);this.lastPath()!==this.path()&&(this.folders([]),this.files([]));e.Ajax.send({Action:"Files",Type:a,Path:this.path(),Pattern:this.searchPattern()},this.onFilesResponse,this)};p.prototype.deleteItems=function(a,c){if(c&&0<a.length){var b=_.map(a,function(a){a.deleted(!0);
return{Path:a.path(),Name:a.name()}});e.Ajax.send({Action:"FilesDelete",Type:this.storageType(),Path:this.path(),Items:JSON.stringify(b)},this.onFilesDeleteResponse,this)}};p.prototype.getPathByIndex=function(a){var c=this.aPath()[a],b="";this.aPath(this.aPath().slice(0,a));c&&(b=c.name());return b};p.prototype.getFullPathByIndex=function(a){return _.map(this.aPath().slice(0,a),function(a){return a.name()}).join("/")};p.prototype.getCollectionFromPath=function(a){var c=[],b=[],d=null;if(""!==a){var b=
a.split("/"),e=[],f="",h=[],i="";_.each(b,function(a){i=a;""===a&&(i=this.rootPath());e.push(a);h=e.slice(0,-1);f=h.join("/");d=new Y;d.name(a).displayName(i).isFolder(!0).path(f).storageType(this.storageType());c.push(d)},this)}else d=new Y,d.displayName(this.rootPath()).isFolder(!0).storageType(this.storageType()),c.push(d);return c};p.prototype.getFileByName=function(a){return _.find(this.files(),function(c){return c.name()===a})};p.prototype.deleteFileByName=function(a){var c=_.filter(this.files(),
function(c){return c.name()!==a});this.files(c)};p.prototype.deleteFolderByName=function(a){var c=_.filter(this.folders(),function(c){return c.name()!==a});this.folders(c)};p.prototype.getUploadFileByUid=function(a){return _.find(this.uploadingFiles(),function(c){return c.uploadUid()===a})};p.prototype.deleteUploadFileByUid=function(a){var c=_.filter(this.uploadingFiles(),function(c){return c.uploadUid()!==a});this.uploadingFiles(c)};p.prototype.getUploadingFiles=function(){var a=[],c=this.uploadingFiles(),
b=this;d.isUnd(c)||(a=_.filter(c,function(a){return a.path()===b.path()&&a.storageType()===b.storageType()}));return a};p.prototype.onCancelUpload=function(a){this.oJua&&this.oJua.cancel(a);this.deleteUploadFileByUid(a)};p.prototype.onCreateFolderResponse=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()))};p.prototype.createFolder=function(a){e.Ajax.send({Action:"FilesFolderCreate",Type:this.storageType(),Path:this.path(),FolderName:a},this.onCreateFolderResponse,
this)};p.prototype.onCreateFolderClick=function(){var a=_.bind(this.createFolder,this);e.Screens.showPopup(Ua,[a])};p.prototype.onSearch=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern())};p.prototype.clearSearch=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()))};m.prototype.clearQuickReply=function(){this.replyText("");this.replyTextFocus(!1);this.internalNote(!1);this.uploadedFiles([]);this.isQuickReplyActive(!1)};
m.prototype.onOwnerContactResponse=function(a){a?(this.ownerContact(a),this.ownerExistsInContacts(!0)):(this.ownerContact(new w),this.ownerExistsInContacts(!1));this.ownerContactInfoReceived(!0)};m.prototype.updateOpenerWindow=function(){this.singleMode&&(j.opener&&j.opener.App)&&j.opener.App.updateHelpdesk()};m.prototype.deletePost=function(a){if(a&&a.itsMe()){var c=this;e.Screens.showPopup(G,[d.i18n("HELPDESK/CONFIRM_DELETE_THIS_POST"),function(b){if(b)e.Ajax[c.sendFunc]({Action:"HelpdeskPostDelete",
PostId:a.Id,ThreadId:a.IdThread,IsExt:c.bExtApp?1:0},c.onHelpdeskPostDeleteResponse,c)}])}};m.prototype.onHelpdeskPostDeleteResponse=function(a){!1===a.Result?e.Api.showErrorByCode(a.ErrorCode,d.i18n("HELPDESK/ERROR_COULDNT_DELETE_POST")):e.Api.showReport(d.i18n("HELPDESK/REPORT_POST_HAS_BEEN_DELETED"));this.requestPosts();this.updateOpenerWindow()};m.prototype.addToContacts=function(){this.selectedItem()&&e.ContactsCache.addToContacts("",this.selectedItem().sEmail,this.onAddToContactsResponse,this)};
m.prototype.iHaveMoreToSay=function(){var a=this;this.isQuickReplyHidden(!1);_.delay(function(){a.replyTextFocus(!0)},300)};m.prototype.onAddToContactsResponse=function(a,c){a.Result&&(this.selectedItem()&&""!==c.HomeEmail&&c.HomeEmail===this.selectedItem().sEmail)&&(e.Api.showReport(d.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),e.ContactsCache.clearInfoAboutEmail(this.selectedItem().sEmail),e.ContactsCache.getContactByEmail(this.selectedItem().sEmail,this.onOwnerContactResponse,this))};m.prototype.viewAllMailsWithContact=
function(){this.selectedItem()&&this.selectedItem().sEmail&&e.MailCache.searchMessagesInCurrentFolder("email:"+this.selectedItem().sEmail)};m.prototype.scrollPostsToBottom=function(){this.scrollToBottomTrigger(!this.scrollToBottomTrigger())};m.prototype.scrollPostsToTop=function(){this.scrollToTopTrigger(!this.scrollToTopTrigger())};m.prototype.showClientDetails=function(){this.clientDetailsVisible(!0)};m.prototype.hideClientDetails=function(){this.clientDetailsVisible(!1)};m.prototype.onApplyBindings=
function(a){this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",i(".items_list",a),i(".items_list .scroll-inner",a));this.initUploader();i(this.domQuickReply()).on("click",_.bind(function(a){this.isQuickReplyActive(!0);a.stopPropagation()},this));i(document.body).on("click",_.bind(function(){this.isEmptyQuickReplyPane()&&this.isQuickReplyActive(!1)},this));e.registerHelpdeskUpdateFunction&&e.registerHelpdeskUpdateFunction(_.bind(this.checkCommand,
this))};m.prototype.onShow=function(){this.selector.useKeyboardKeys(!0);this.oPageSwitcher.perPage(this.ThreadsPerPage);this.oPageSwitcher.currentPage(1);this.requestThreadsList()};m.prototype.onHide=function(){this.selector.useKeyboardKeys(!1);this.selectedItem(null)};m.prototype.requestThreadsList=function(){this.loadingList(!0);this.checkStarted(!0);e.Ajax[this.sendFunc]({Action:"HelpdeskThreadsList",IsExt:this.bExtApp?1:0,Offset:(this.oPageSwitcher.currentPage()-1)*this.ThreadsPerPage,Limit:this.ThreadsPerPage,
Filter:this.listFilter(),Search:this.search()},this.onHelpdeskThreadsListResponse,this)};m.prototype.onHelpdeskThreadsListResponse=function(a){var c=0,b=0,f=this.selectedItem(),i=f?d.pString(f.Id):"",j=[],k=null,b=null,s=a.Result&&_.isArray(a.Result.List)?a.Result.List:[];if(!1===a.Result)e.Api.showErrorByCode(a.ErrorCode);else{for(b=s.length;c<b;c++)s[c]&&"Object/CHelpdeskThread"===d.pExport(s[c],"@Object","")&&(k=new Wa,k.parse(s[c]),k.OwnerIsMe=d.pString(k.IdOwner),i===d.pString(k.Id)&&(f.postsCount(k.postsCount()),
k.selected(!0),this.selector.itemSelected(k)),j.push(k));this.loadingList(!1);this.checkStarted(!1);this.threads(j);this.oPageSwitcher.setCount(d.pInt(a.Result.ItemsCount));if(h.HelpdeskThreadId&&(b=_.find(j,function(a){return a.Id===h.HelpdeskThreadId},this)))this.onItemSelect(b)}};m.prototype.requestPosts=function(a,c){var b=this.selectedItem(),b=a?a.Id:b?b.Id:0,d=c?c:0,f={};b&&(f={Action:"HelpdeskThreadPosts",IsExt:this.bExtApp?1:0,ThreadId:b,StartFromId:d,Limit:5},d&&this.loadingMoreMessages(!0),
e.Ajax[this.sendFunc](f,this.onHelpdeskThreadPostsResponse,this))};m.prototype.onHelpdeskThreadPostsResponse=function(a){var c=this,b=!1,f=0,h=0,i=[],j=null,k=a.Result&&_.isArray(a.Result.List)?a.Result.List:[];if(!1===a.Result)e.Api.showErrorByCode(a.ErrorCode);else{if(this.selectedItem()&&a.Result.ThreadId===this.selectedItem().Id){this.selectedItem().postsCount(d.pInt(a.Result.ItemsCount));for(h=k.length;f<h;f++)k[f]&&"Object/CHelpdeskPost"===d.pExport(k[f],"@Object","")&&(j=new mb,j.parse(k[f]),
i.push(j));if(a.Result.StartFromId){j=this.posts();a=a.Result.StartFromId;h=j.length;for(f=0;f<h&&j.Id!==a;f++);i=_.union(_.first(j,f).reverse(),i);this.loadingMoreMessages(!1)}else b=!0;this.selectedItem().unseen()&&this.executeThreadSeen(this.selectedItem().Id)}this.posts(i.reverse());b?(c.scrollPostsToBottom(),_.delay(function(){c.scrollPostsToBottom()},10),_.delay(function(){c.scrollPostsToBottom()},100)):c.scrollPostsToTop()}};m.prototype.onItemClick=function(a){if(e.Routing.setHash([f.Screens.Helpdesk,
a.ThreadHash]))this.onItemSelect(a)};m.prototype.onRoute=function(a){var c=a[0],b=_.find(this.threads(),function(a){return a.ThreadHash===c});if(b)this.onItemSelect(b);else if(0===this.threads().length&&this.loadingList()&&void 0===this.threadSubscription&&!h.SingleMode)this.threadSubscription=this.threads.subscribe(function(){this.onRoute(a);this.threadSubscription.dispose();this.threadSubscription=void 0},this);else if(c)e.Ajax[this.sendFunc]({Action:"HelpdeskGetThreadByHash",IsExt:this.bExtApp?
1:0,ThreadHash:c},this.onHelpdeskGetThreadByHashResponse,this)};m.prototype.onHelpdeskGetThreadByHashResponse=function(a){var c=new Wa;a.Result&&(c.parse(a.Result),c.OwnerIsMe=d.pString(c.IdOwner),this.onItemSelect(c))};m.prototype.onItemSelect=function(a){var c=this.selectedItem();this.visibleNewThread(!1);this.selector.listCheckedAndSelected(!1);this.selector.itemSelected(c);if(null===this.selectedItem()||this.selectedItem().Id!==a.Id)if(0<this.uploadedFiles().length||0<this.replyText().length){var b=
d.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),f=_.bind(function(b){b?(this.clearQuickReply(),this.selector.itemSelected(a),this.selectedItem(a),this.visibleNewThread(!1),this.isQuickReplyHidden(a.ItsMe||!this.bAgent),this.requestPosts(a)):(this.replyTextFocus(!0),this.isQuickReplyHidden(!1),this.selector.itemSelected(c),this.selectedItem(c))},this);e.Screens.showPopup(G,[b,f])}else this.clearQuickReply(),this.selector.itemSelected(a),this.selectedItem(a),this.isQuickReplyHidden(a.ItsMe||!this.bAgent),this.requestPosts(a)};
m.prototype.onItemDelete=function(){this.executeDelete()};m.prototype.onEnter=function(a){this.onItemDblClick(a)};m.prototype.onItemDblClick=function(a){if(a)if(a.isViewable())a.onViewClick();else a.onDownloadClick()};m.prototype.openNewThread=function(){if(0<this.uploadedFiles().length||0<this.replyText().length){var a=d.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),c=_.bind(function(a){a?(this.clearQuickReply(),this.visibleNewThread(!0)):this.visibleNewThread(!1)},this);e.Screens.showPopup(G,[a,c])}else this.selector.itemSelected(null),
this.selectedItem(null),this.visibleNewThread(!0)};m.prototype.cancelNewThread=function(){if(0<this.uploadedFiles().length||0<this.newThreadText().length){var a=d.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),c=_.bind(function(a){a&&(this.newThreadText(""),this.uploadedFiles([]),this.visibleNewThread(!1))},this);e.Screens.showPopup(G,[a,c])}else this.newThreadText(""),this.uploadedFiles([]),this.visibleNewThread(!1),this.selector.itemSelected(null),this.selectedItem(null)};m.prototype.onSearch=function(){this.requestThreadsList()};
m.prototype.clearSearch=function(){this.requestThreadsList()};m.prototype.isEnableListActions=function(){return!!this.selectedItem()};m.prototype.executeDelete=function(){var a=this,c=this.selectedItem();c&&(_.each(this.threads(),function(a){a===c&&a.deleted(!0)}),_.delay(function(){a.threads.remove(function(a){return a.deleted()})},500),this.selectedItem(null),e.Ajax[this.sendFunc]({Action:"HelpdeskThreadDelete",IsExt:this.bExtApp?1:0,ThreadId:c.Id},this.onHelpdeskThreadDeleteResponse,this))};m.prototype.executeOpenNewWindow=
function(){var a=e.Routing.buildHashFromArray([f.Screens.SingleHelpdesk,this.selectedItem().ThreadHash]);d.WindowOpener.openTab(a)};m.prototype.onHelpdeskThreadDeleteResponse=function(){this.requestThreadsList();this.updateOpenerWindow()};m.prototype.executeChangeState=function(a){var c=this.selectedItem();void 0!==a&&c&&(c.state(a),e.Ajax[this.sendFunc]({Action:"HelpdeskThreadChangeState",IsExt:this.bExtApp?1:0,ThreadId:c.Id,Type:c.state()},this.onHelpdeskThreadChangeStateResponse,this))};m.prototype.onHelpdeskThreadChangeStateResponse=
function(){this.requestThreadsList();this.updateOpenerWindow()};m.prototype.executeThreadSeen=function(a){if(void 0!==a)e.Ajax[this.sendFunc]({Action:"HelpdeskThreadSeen",IsExt:this.bExtApp?1:0,ThreadId:a},this.onHelpdeskThreadSeenResponse,this)};m.prototype.onHelpdeskThreadSeenResponse=function(a,c){var b=0,d=0,d=[],e=0;if(c.ThreadId&&(d=this.threads(),e=this.selectedItem()?this.selectedItem().Id:0,0<e))for(d=d.length;b<d;b++)if(e===c.ThreadId){this.selectedItem().unseen(!1);break}this.updateOpenerWindow()};
m.prototype.executeThreadCreate=function(){var a="",c=-1;this.visibleNewThread()&&(a=d.trim(this.newThreadText().replace(/[\n\r]/," ")),c=a.indexOf(" ",40),0<=c&&(a=a.substring(0,c)),this.newThreadCreating(!0),this.sendHelpdeskPostCreate(0,a,this.newThreadText(),this.onThreadCreateResponse))};m.prototype.onThreadCreateResponse=function(a,c){this.newThreadCreating(!1);a.Result&&c&&(e.Api.showReport(d.i18n("HELPDESK/REPORT_THREAD_SUCCESSFULLY_CREATED")),this.posts([]),this.uploadedFiles([]),this.newThreadText(""),
this.visibleNewThread(!1));this.requestThreadsList();this.updateOpenerWindow()};m.prototype.executePostCreate=function(){this.selectedItem()&&(this.replySendingStarted(!0),this.sendHelpdeskPostCreate(this.selectedItem().Id,"",this.replyText(),this.onPostCreateResponse))};m.prototype.onPostCreateResponse=function(a,c){this.replySendingStarted(!1);a.Result&&c&&(e.Api.showReport(d.i18n("HELPDESK/REPORT_POST_SUCCESSFULLY_ADDED")),this.clearQuickReply(),this.requestPosts());this.requestThreadsList();this.updateOpenerWindow()};
m.prototype.sendHelpdeskPostCreate=function(a,c,b,d){var f={},h={};_.each(this.uploadedFiles(),function(a){f[a.tempName()]=a.hash()});h={Action:"HelpdeskPostCreate",IsExt:this.bExtApp?1:0,ThreadId:a,IsInternal:this.internalNote()?1:0,Subject:c,Text:b,Attachments:f};e.Ajax[this.sendFunc](h,d,this)};m.prototype.executeShowThreadsByOwner=function(){this.search("owner:"+this.selectedItem().aOwner[0]);this.prevListFilter(this.listFilter());this.listFilter(f.HelpdeskFilters.All)};m.prototype.onClearSearchClick=
function(){this.search("");""!==this.prevListFilter()&&(this.listFilter(this.prevListFilter()),this.prevListFilter(""));this.searchSubmitCommand()};m.prototype.initUploader=function(){this.oJua=this.createJuaObject(this.uploaderButton());this.oJuaCompose=this.createJuaObject(this.uploaderButtonCompose())};m.prototype.createJuaObject=function(a){return a?new Jua({action:"?/Upload/HelpdeskFile/",name:"jua-uploader",queueSize:2,clickElement:a,dragAndDropElement:a,disableAjaxUpload:!1,disableFolderDragAndDrop:!1,
disableDragAndDrop:!1,hidden:{IsExt:this.bExtApp?"1":"0",Token:h.Token,TenantHash:this.bExtApp&&h?h.TenantHash:"",AccountID:this.bExtApp?0:h.Accounts.currentId()},onProgress:_.bind(this.onFileUploadProgress,this),onSelect:_.bind(this.onFileUploadSelect,this),onStart:_.bind(this.onFileUploadStart,this),onComplete:_.bind(this.onFileUploadComplete,this),onBodyDragEnter:_.bind(this.bDragActive,this,!0),onBodyDragLeave:_.bind(this.bDragActive,this,!1)}):null};m.prototype.onCancelUpload=function(a){var c=
this.getUploadedFileByUID(a);this.oJua&&this.oJua.cancel(a);this.uploadedFiles.remove(c)};m.prototype.getUploadedFileByUID=function(a){return _.find(this.uploadedFiles(),function(c){return c.uploadUID()===a})};m.prototype.onFileUploadSelect=function(a,c){var b;b=d.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:c.FileName});var f=d.i18n("HELPDESK/ERROR_UPLOAD_FILES_COUNT"),i=d.i18n("MAIN/BUTTON_CLOSE");if(5<=this.uploadedFiles().length)return e.Screens.showPopup(R,[f,null,"",i]),!1;if(h.App&&
0<h.App.AttachmentSizeLimit&&c.Size>h.App.AttachmentSizeLimit)return e.Screens.showPopup(R,[b]),!1;b=new wa;b.onUploadSelect(a,c);this.uploadedFiles.push(b);return!0};m.prototype.onFileUploadProgress=function(a,c,b){if(a=this.getUploadedFileByUID(a))a.onUploadProgress(c,b)};m.prototype.onFileUploadStart=function(a){if(a=this.getUploadedFileByUID(a))a.onUploadStart()};m.prototype.onFileUploadComplete=function(a,c,b){var d=this.getUploadedFileByUID(a);if(d)d.onUploadComplete(a,c,b)};I.prototype.initScreens=
function(){};I.prototype.initLayout=function(){};I.prototype.init=function(){this.initScreens();this.initLayout();i("#pSevenContent").addClass("single_mode");_.defer(function(){h.SingleMode||i("#pSevenContent").removeClass("single_mode")});this.informationScreen(this.showNormalScreen(f.Screens.Information))};I.prototype.showCurrentScreen=function(a,c){this.currentScreen()!==a&&(this.hideCurrentScreen(),this.currentScreen(a));this.showNormalScreen(a,c)};I.prototype.hideCurrentScreen=function(){0<this.currentScreen().length&&
this.hideScreen(this.currentScreen())};I.prototype.hideScreen=function(a){a=this.oScreens[a];"undefined"!==typeof a&&a.bInitialized&&a.Model.hideViewModel()};I.prototype.showNormalScreen=function(a,c){var b=this.oScreens[a];b&&(b.bInitialized="boolean"!==typeof b.bInitialized?!1:b.bInitialized,b.bInitialized||(b.Model=this.initViewModel(b.Model,b.TemplateName),b.bInitialized=!0),b.Model.showViewModel(c));return b?b.Model:null};I.prototype.initViewModel=function(a,c){var d=null,e=null,d=new a,e=i('div[data-view-model="'+
c+'"]').attr("data-bind","template: {name: '"+c+"'}").hide();d.$viewModel=e;d.bShown=!1;d.showViewModel=function(a){this.$viewModel.show();if("function"===typeof this.onRoute)this.onRoute(a);if(!this.bShown){if("function"===typeof this.onShow)this.onShow(a);this.bShown=!0}};d.hideViewModel=function(){this.$viewModel.hide();if("function"===typeof this.onHide)this.onHide();this.bShown=!1};b.applyBindings(d,e[0]);if("function"===typeof d.onApplyBindings)d.onApplyBindings(e);return d};I.prototype.showPopup=
function(a,c){if(a){if(!a.__builded){var g=null,f=new a,g=f.popupTemplate?f.popupTemplate():"";if(""!==g&&(g=i('div[data-view-model="'+g+'"]').attr("data-bind","template: {name: '"+g+"'}").removeClass("visible").hide())&&1===g.length)f.visibility=b.observable(!1),a.__builded=!0,a.__vm=f,f.$viewModel=g,a.__dom=g,f.showViewModel=d.createCommand(f,function(){e&&e.Screens&&e.Screens.showPopup(a)}),f.closeCommand=d.createCommand(f,function(){e&&e.Screens&&e.Screens.hidePopup(a)}),b.applyBindings(f,g[0]),
d.delegateRun(f,"onApplyBindings",[g])}a.__vm&&a.__dom&&(a.__dom.show(),_.delay(function(){a.__dom.addClass("visible")},50),a.__vm.visibility(!0),d.delegateRun(a.__vm,"onShow",c),this.popupVisibility(!0),this.popups.push(a),this.keyupPopupBinded=_.bind(this.keyupPopup,this,a.__vm),i(document).on("keyup",this.keyupPopupBinded))}};I.prototype.keyupPopup=function(a,c){if(c){var b=j.parseInt(c.keyCode,10);27===b&&a.closeCommand();if((13===b||32===b)&&a.onEnterHandler)a.onEnterHandler()}};I.prototype.hidePopup=
function(a){a&&(a.__vm&&a.__dom)&&(this.keyupPopupBinded&&(i(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),a.__dom.removeClass("visible").hide(),a.__vm.visibility(!1),d.delegateRun(a.__vm,"onHide"),this.popupVisibility(!1),this.popups=_.without(this.popups,a))};I.prototype.hideAllPopup=function(){_.each(this.popups,function(a){this.hidePopup(a)},this)};I.prototype.showLoading=function(a){this.informationScreen()&&this.informationScreen().showLoading(a)};I.prototype.hideLoading=
function(){this.informationScreen()&&this.informationScreen().hideLoading()};I.prototype.showReport=function(a,c){this.informationScreen()&&this.informationScreen().showReport(a,c)};I.prototype.showError=function(a,c,b){this.informationScreen()&&this.informationScreen().showError(a,c,b)};I.prototype.hideError=function(){this.informationScreen()&&this.informationScreen().hideError()};I.prototype.initScreens=function(){this.oScreens[f.Screens.Information]={Model:Oa,TemplateName:"Common_InformationViewModel"};
this.oScreens[f.Screens.Login]={Model:Ca,TemplateName:"Login_LoginViewModel"};this.oScreens[f.Screens.Header]={Model:Xa,TemplateName:"Common_HeaderViewModel"};this.oScreens[f.Screens.Mailbox]={Model:ea,TemplateName:"Mail_LayoutSidePane_MailViewModel"};this.oScreens[f.Screens.BottomMailbox]={Model:ea,TemplateName:"Mail_LayoutBottomPane_MailViewModel"};this.oScreens[f.Screens.SingleMessageView]={Model:z,TemplateName:"Mail_LayoutSidePane_MessagePaneViewModel"};this.oScreens[f.Screens.Compose]={Model:q,
TemplateName:"Mail_ComposeViewModel"};this.oScreens[f.Screens.SingleCompose]={Model:q,TemplateName:"Mail_ComposeViewModel"};this.oScreens[f.Screens.Settings]={Model:D,TemplateName:"Settings_SettingsViewModel"};this.oScreens[f.Screens.SingleHelpdesk]={Model:m,TemplateName:"Helpdesk_ViewThreadInNewWindow"}};I.prototype.initLayout=function(){i("#pSevenContent").append(i("#Layout").html())};u.prototype.init=function(){var a=null;h.SingleMode&&j.opener&&(a=j.opener.App.MailCache,this.oFolderListItems=
a.oFolderListItems,j.name&&this.currentAccountId(d.pInt(j.name)));this.currentAccountId.valueHasMutated()};u.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()};u.prototype.getFolderByFullName=function(a,c){var b=this.oFolderListItems[a];return b?b.getFolderByFullName(c):null};u.prototype.getFolderList=function(a){var c={Action:"FolderList"};d.isUnd(a)||(c.AccountID=a);e.Ajax.send(c,this.onFolderListResponse,this)};u.prototype.markMessageReplied=function(a,c,b,d){var a=
this.oFolderListItems[a],e=null;a&&(e=a.getFolderByFullName(c))&&e.markMessageReplied(b,d)};u.prototype.setFolderCounts=function(a,c,b,d,e,f){var a=this.oFolderListItems[a],h=null,i=!1,j=!1;if(a&&(h=a.getFolderByFullName(c)))if((i=h.setRelevantInformation(e,f,b,d))&&h.selected())j=!0,this.startCheckMail();return j};u.prototype.hideThreads=function(a){h.User.useThreads()&&(a.folder()===this.folderList().currentFolderFullName()&&!a.threadOpened())&&this.folderList().currentFolder().hideThreadMessages(a)};
u.prototype.showOpenedThreads=function(a){this.messages(this.getMessagesWithThreads(a,this.uidList(),this.messages()))};u.prototype.getMessagesWithThreads=function(a,c,b){var d=this.folderList().currentFolder(),e=d&&d.withoutThreads(),c=""===c.search()&&""===c.filters();if(a===d.fullName()&&h.User.useThreads()&&!e&&c){var a=_.filter(b,function(a){return!a.threadPart()},this),f=[];_.each(a,function(a){var c=[];f.push(a);a.threadOpened()&&(c=this.folderList().currentFolder().getThreadMessages(a),f=
_.union(f,c))},this);return f}return b};u.prototype.setMessagesFromUidList=function(a,c,b,d){var e=a.getUidsForOffset(c,b),f=_.map(e,function(a){return b[a]},this),i=f.length;d&&(this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),a,f)),c+i<a.resultCount()&&i<h.User.MailsPerPage&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&this.currentMessage(null));return e};
u.prototype.startCheckMail=function(){var a=this.folderList().currentFolderFullName(),c=this.page(),b=this.uidList().search();""!==a&&this.requestCurrentMessageList(a,c,b,"",!1)};u.prototype.executeCheckMail=function(){var a=this.folderList(),c=a?a.getInboxAndCurrentFoldersArray():[],a={Action:"FolderCounts",Folders:c,AccountID:a?a.iAccountId:0};!this.checkMailStarted()&&0<c.length&&(this.checkMailStarted(!0),e.Ajax.send(a,this.onFolderCountsResponse,this))};u.prototype.changeCurrentMessageList=function(a,
c,b,d){this.requestCurrentMessageList(a,c,b,d,!0)};u.prototype.requestCurrentMessageList=function(a,c,b,d,f){a=this.requestMessageList(a,c,b,d||"",!0,f||!1);this.uidList(a.UidList);this.page(c);this.messagesLoading(a.DataExpected);this.messagesLoadingError(!1);e.Prefetcher.start()};u.prototype.requestMessageList=function(a,c,b,d,f,i){var j=this.oFolderListItems[this.currentAccountId()],k=(j=j?j.getFolderByFullName(a):null)&&j.withoutThreads(),l=h.User.useThreads()&&!k&&""===b&&""===d,k=j?j.getUidList(b,
d):null,c=(c-1)*h.User.MailsPerPage,i=k?this.setMessagesFromUidList(k,c,j.oMessages,i):[],a={Action:"MessageList",Folder:a,Offset:c,Limit:h.User.MailsPerPage,Search:b,Filters:d,UseThreads:l?"1":"0"},d=b=!1,f=f?this.onCurrentMessageListResponse:this.onMessageListResponse;k&&(d=-1===k.resultCount()||c+i.length<k.resultCount()&&i.length<h.User.MailsPerPage,b=j.hasChanges()||d);b&&e.Ajax.send(a,f,this);return{UidList:k,RequestStarted:b,DataExpected:d}};u.prototype.executeEmptyTrash=function(){var a=this.folderList().trashFolder();
a&&a.emptyFolder()};u.prototype.executeEmptySpam=function(){var a=this.folderList().spamFolder();a&&a.emptyFolder()};u.prototype.onClearFolder=function(a){a&&a.selected()&&(this.messages.removeAll(),this.currentMessage(null),(a=a?a.getUidList(this.uidList().search(),this.uidList().filters()):null)?this.uidList(a):this.uidList(new Ha),this.checkMailStarted(!1))};u.prototype.moveMessagesToFolder=function(a,c,b){if(0<c.length){var f=this.folderList().currentFolder(),c=f.getUidsWithThread(c),h=this.folderList().getFolderByFullName(a),
a={Action:"MessageMove",Folder:f?f.fullName():"",ToFolder:a,Uids:c.join(",")},i=null;f&&(i=f.markDeletedByUids(c),h.addMessagesCountsDiff(i.MinusDiff,i.UnseenMinusDiff),(d.isUnd(b)||b)&&h.recivedAnim(!0),this.excludeDeletedMessages(),h.markHasChanges(),e.Ajax.send(a,this.onMoveMessagesResponse,this))}};u.prototype.excludeDeletedMessages=function(){_.delay(_.bind(function(){var a=this.folderList().currentFolder(),c=(this.page()-1)*h.User.MailsPerPage;this.setMessagesFromUidList(this.uidList(),c,a.oMessages,
!0)},this),500)};u.prototype.removeMessagesFromCacheForFolder=function(a){var c=this.folderList().getFolderByFullName(a),b=this.folderList().currentFolderFullName();c&&(c.markHasChanges(),a===b&&this.requestCurrentMessageList(b,this.page(),this.uidList().search(),"",!0))};u.prototype.deleteMessages=function(a){var c=this.folderList().currentFolder();c&&this.deleteMessagesFromFolder(c,a)};u.prototype.deleteMessagesFromFolder=function(a,c){var b=a.getUidsWithThread(c),d={Action:"MessageDelete",Folder:a.fullName(),
Uids:b.join(",")};a.markDeletedByUids(b);this.excludeDeletedMessages();e.Ajax.send(d,this.onMoveMessagesResponse,this)};u.prototype.showExternalPictures=function(a){var c=[],b=null;this.currentMessage()&&(c=this.currentMessage().oFrom.aCollection,b=this.folderList().getFolderByFullName(this.currentMessage().folder()),a&&0<c.length?b.alwaysShowExternalPicturesForSender(c[0].sEmail):b.showExternalPictures(this.currentMessage().uid()))};u.prototype.setCurrentMessage=function(a){var c=this.folderList().currentFolder(),
b=c&&a?c.oMessages[a]:null;b&&!b.deleted()?(this.currentMessage(b),this.currentMessage().seen()||this.executeGroupOperation("MessageSetSeen",[this.currentMessage().uid()],"seen",!0),c.getCompletelyFilledMessage(a,this.onCurrentMessageResponse,this)):this.currentMessage(null)};u.prototype.onCurrentMessageResponse=function(a,c){var b=this.currentMessage()?this.currentMessage().uid():"";null===a&&b===c&&this.currentMessage(null)};u.prototype.getMessage=function(a,c,b,d){(a=this.folderList().getFolderByFullName(a))&&
a.getCompletelyFilledMessage(c,b,d)};u.prototype.executeGroupOperation=function(a,c,b,d){var i=this.folderList().currentFolder(),a={Action:a,Folder:i?i.fullName():"",Uids:c.join(","),SetAction:d?1:0},j=(this.page()-1)*h.User.MailsPerPage,k=c.length,m=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,l=i.getUidList("",f.FolderFilter.Flagged);i&&(e.Ajax.send(a),i.executeGroupOperation(b,c,d),i.type()===f.FolderTypes.Inbox&&b===f.FolderFilter.Flagged&&(""!==this.uidList().filters()?
d||(this.uidList().deleteUids(c),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(l.resultCount())):(i.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(d?this.folderList().oStarredFolder.messageCount(m+k):this.folderList().oStarredFolder.messageCount(0<m-k?m-k:0)))),this.setMessagesFromUidList(this.uidList(),j,i.oMessages,!0))};u.prototype.onFolderListResponse=function(a,c){var b=new L,d=parseInt(a.AccountID,10),f=
this.oFolderListItems[d],h=function(a){for(var c=0,d=0,e=null,f,c=0,d=a.length;c<d;c++){e=a[c];if(f=b.getFolderByFullName(e.fullName()))f.messageCount(e.messageCount()),f.hasExtendedInfo(e.hasExtendedInfo());h(e.subfolders())}};!1===a.Result?(e.Api.showErrorByCode(a.ErrorCode),c.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(b.parse(d,a.Result),this.oFolderListItems[d]=b,setTimeout(_.bind(this.getAllFolderCounts,this,d),
2E3),f&&h(f.collection()),this.currentAccountId()===d&&this.folderList(b),this.editedAccountId()===d&&this.editedFolderList(b))};u.prototype.setCurrentFolderList=function(a){var c=a.iAccountId;c===this.currentAccountId()&&c!==this.folderList().iAccountId&&this.folderList(a)};u.prototype.getAllFolderCounts=function(a){var c=this.oFolderListItems[a],c=c?c.getFoldersWithoutCountInfo():[],a={Action:"FolderCounts",Folders:c,AccountID:a};0<c.length&&e.Ajax.send(a,this.onFolderCountsResponse,this)};u.prototype.onFolderCountsResponse=
function(a){var c=!1;!1===a.Result?e.Api.showErrorByCode(a.ErrorCode):_.each(a.Result,function(b,d){if(_.isArray(b)&&3<b.length){var e=b[0],f=b[1],h=b[2],i=b[3];c=c||this.setFolderCounts(a.AccountID,d,e,f,h,i)}},this);this.checkMailStarted(c)};u.prototype.onCurrentMessageListResponse=function(a,c){if(a.Result){if(this.messagesLoadingError(!1),this.parseMessageList(a,c),""!==this.deletedDraftMessageUid()){var b=this.deletedDraftMessageUid();_.find(a.Result["@Collection"],function(a){return a.Uid===
b})||(this.setCurrentMessage(null),this.deletedDraftMessageUid(""))}}else e.Api.showErrorByCode(a.ErrorCode),!0===this.messagesLoading()&&a.ErrorCode!==f.Errors.NotDisplayedError&&this.messagesLoadingError(!0),this.messagesLoading(!1),this.checkMailStarted(!1)};u.prototype.onMessageListResponse=function(a,c){a&&a.Result&&this.parseMessageList(a,c)};u.prototype.parseMessageList=function(a,c){var b=a.Result,d=this.oFolderListItems[a.AccountID],e=null,i=null,j="1"===c.UseThreads,k=!1,l=!1,m=!1,o=!1;
!1!==b&&"Collection/MessageCollection"===b["@Object"]&&(e=d.getFolderByFullName(b.FolderName),e.setRelevantInformation(b.UidNext.toString(),b.FolderHash,b.MessageCount,b.MessageUnseenCount),k=e.hasChanges(),e.removeAllMessageListsFromCacheIfHasChanges(),i=e.getUidList(b.Search,b.Filters),i.setUidsAndCount(b),_.each(b["@Collection"],function(c){var b=e.oMessages[c.Uid.toString()];b||(b=new F);b.parse(c,a.AccountID,!1,j);e.oMessages[b.uid()]=b},this),m=(l=this.currentAccountId()===a.AccountID&&this.folderList().currentFolderFullName()===
b.FolderName)&&this.uidList().search()===i.search()&&this.uidList().filters()===i.filters(),o=this.page()===b.Offset/h.User.MailsPerPage+1,m&&(this.uidList(i),o&&(this.setMessagesFromUidList(i,b.Offset,e.oMessages,!0),this.messagesLoading(!1),this.checkMailStarted(!1))),k&&(l&&(!m||!o))&&this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),"",!1),e.type()===f.FolderTypes.Inbox&&(i.filters()===f.FolderFilter.Flagged&&""===i.search()&&this.folderList().oStarredFolder)&&
this.folderList().oStarredFolder.messageCount(i.resultCount()))};u.prototype.onMoveMessagesResponse=function(a,c){var b=a.Result,h=this.folderList().getFolderByFullName(c.Folder),i=this.folderList().getFolderByFullName(c.ToFolder),j=i&&i.type()===f.FolderTypes.Trash,k=i&&i.type()===f.FolderTypes.Spam,m=null,l=j?d.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):d.i18n("MAILBOX/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),o=_.bind(function(a){a&&h&&this.deleteMessagesFromFolder(h,c.Uids.split(","))},
this),q=this.folderList().currentFolder(),p=q.fullName();!1===b?(m=h.revertDeleted(c.Uids.split(",")),i?(i.addMessagesCountsDiff(-m.PlusDiff,-m.UnseenPlusDiff),a.ErrorCode===f.Errors.ImapQuota&&(j||k)?e.Screens.showPopup(G,[l,o]):e.Api.showErrorByCode(a.ErrorCode,d.i18n("MAILBOX/ERROR_MOVING_MESSAGES"))):e.Api.showErrorByCode(a.ErrorCode,d.i18n("MAILBOX/ERROR_DELETING_MESSAGES"))):h.commitDeleted(c.Uids.split(","));p===h.fullName()||i&&p===i.fullName()?(q.markHasChanges(),this.requestCurrentMessageList(p,
this.page(),this.uidList().search(),"",!1)):p!==h.fullName()?e.Prefetcher.startFolderPrefetch(h):i&&p!==i.fullName()&&e.Prefetcher.startFolderPrefetch(i)};u.prototype.searchMessagesInCurrentFolder=function(a){var c=this.folderList().currentFolderFullName()||"INBOX",b=this.currentMessage()?this.currentMessage().uid():"",d=this.uidList().filters();e.Routing.setHash(e.Links.mailbox(c,1,b,a,d))};u.prototype.searchMessagesInInbox=function(a){e.Routing.setHash(e.Links.mailbox(this.folderList().inboxFolderFullName(),
1,"",a,""))};Ka.prototype.clearInfoAboutEmail=function(a){this.contacts[a]=void 0};Ka.prototype.getContactByEmail=function(a,c,b){if(h.User.ShowContacts){var d=this.contacts[a],f={Action:"ContactByEmail",Email:a};void 0!==d?c.apply(b,[d]):(this.responseHandlers[a]={Handler:c,Context:b},e.Ajax.send(f,this.onContactByEmailResponse,this))}};Ka.prototype.onContactByEmailResponse=function(a,b){var d=null,e=this.responseHandlers[b.Email];a.Result&&(d=new w,d.parse(a.Result));this.contacts[b.Email]=d;e&&
(e.Handler.apply(e.Context,[d]),this.responseHandlers[b.Email]=void 0)};Ka.prototype.addVcard=function(a){this.vcardAttachments.push(a)};Ka.prototype.markVcardsNonexistent=function(a){_.each(this.vcardAttachments,function(b){-1!==_.indexOf(a,b.uid())&&b.isExists(!1)})};Ka.prototype.addToContacts=function(a,b,d,f){e.Ajax.send({Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:a,HomeEmail:b},d,f);e.ContactsCache.recivedAnim(!0)};La.prototype.addIcal=function(a){this.icalAttachments.push(a);
0===this.calendars().length&&this.requestCalendarList()};La.prototype.onCalendarListResponse=function(a){(a=(a=a.Result)?a:null)&&this.calendars(_.map(a,function(a){return{name:a.Name,id:a.Id}}));this.calendarsLoadingStarted(!1)};La.prototype.requestCalendarList=function(){this.calendarsLoadingStarted()||(e.Ajax.send({Action:"CalendarList"},this.onCalendarListResponse,this),this.calendarsLoadingStarted(!0))};La.prototype.markIcalNonexistent=function(a){_.each(this.icalAttachments,function(b){if(a===
b.uid())b.onEventDelete()})};La.prototype.markIcalTentative=function(a){_.each(this.icalAttachments,function(b){if(a===b.uid())b.onEventTentative()})};La.prototype.markIcalAccepted=function(a){_.each(this.icalAttachments,function(b){if(a===b.uid())b.onEventAccept()})};H.prototype.init=function(){var a=h.User,b=new ca,e=h.Accounts,f=new W,i=h.App,j=new lb;b.parse(a);h.User=b;f.parse(d.pInt(h.Default),e);h.Accounts=f;j.parse(i);h.App=j;this.MailCache=new u;this.useGoogleAnalytics();this.collectScreensData()};
H.prototype.collectScreensData=function(){h.User.ShowContacts&&this.addScreenToHeader("contacts",d.i18n("HEADER/CONTACTS"),d.i18n("TITLE/CONTACTS"),"Contacts_ContactsViewModel",x,this.ContactsCache.recivedAnim);h.User.AllowCalendar&&this.addScreenToHeader("calendar",d.i18n("HEADER/CALENDAR"),d.i18n("TITLE/CALENDAR"),"Calendar_CalendarViewModel",k,this.CalendarCache.recivedAnim);h.User.IsFilesSupported&&this.addScreenToHeader("files",d.i18n("HEADER/FILESTORAGE"),d.i18n("TITLE/FILESTORAGE"),"FileStorage_FileStorageViewModel",
p);h.User.IsHelpdeskSupported&&this.addScreenToHeader("helpdesk",d.i18n("HEADER/HELPDESK"),d.i18n("TITLE/HELPDESK"),"Helpdesk_HelpdeskViewModel",m)};H.prototype.registerHelpdeskUpdateFunction=function(a){this.fHelpdeskUpdate=a};H.prototype.updateHelpdesk=function(){this.fHelpdeskUpdate&&this.fHelpdeskUpdate()};H.prototype.useGoogleAnalytics=function(){var a=null,b=null;h.App.GoogleAnalyticsAccount&&0<h.App.GoogleAnalyticsAccount.length&&(j._gaq=j._gaq||[],j._gaq.push(["_setAccount",h.App.GoogleAnalyticsAccount]),
j._gaq.push(["_trackPageview"]),a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b))};H.prototype.tokenProblem=function(){var a=d.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:"window.location.reload(); return false;"});h.Auth=!1;e.Api.showError(a,!0,!0)};H.prototype.logout=function(a){var b={Action:"Logout"};
a&&(b.LastErrorCode=a);e.Ajax.send(b,this.onLogout,this)};H.prototype.authProblem=function(){this.logout(f.Errors.AuthError)};H.prototype.onLogout=function(){d.WindowOpener.closeAll();e.Routing.finalize();""!==h.App.CustomLogoutUrl?j.location.href=h.App.CustomLogoutUrl:j.location.reload()};H.prototype.run=function(){d.log("run",h);this.Screens.init();sb&&h&&h.Auth&&h.App.IosDetectOnLogin?j.location.href="?ios":h&&h.Auth?(h.SingleMode=this.Routing.isSingleMode(),this.MailCache.init(),h.HelpdeskRedirect&&
this.Routing.setHash([f.Screens.Helpdesk]),this.Routing.init(f.Screens.Mailbox),h.SingleMode||this.doFirstRequests()):h&&""!==h.App.CustomLoginUrl?j.location.href=h.App.CustomLoginUrl:(this.Screens.showCurrentScreen(f.Screens.Login),h&&h.LastErrorCode===f.Errors.AuthError&&this.Api.showError(d.i18n("WARNING/AUTH_PROBLEM"),!1,!0));h.User.AllowVoice&&this.Phone.init()};H.prototype.addScreenToHeader=function(a,b,d,e,h,i){f.Screens[a]=a;this.Screens.oScreens[f.Screens[a]]={Model:h,TemplateName:e};this.headerTabs.push({name:f.Screens[a],
title:b,hash:this.Routing.buildHashFromArray([f.Screens[a]]),koRecivedAnim:i});this.screensTitle[f.Screens[a]]=d};H.prototype.doFirstRequests=function(){j.setTimeout(function(){e.Ajax.send({Action:"DoServerInitializations"})},3E4)};H.prototype.populateFetchers=function(){var a={Action:"FetcherList",AccountID:h.Accounts.defaultId()};e.Ajax.send(a,function(a){var b=new ib,d=parseInt(a.AccountID,10),e=h.Accounts.collection(),f=e.length,i=0;if(a.Result.length)for(b.parse(d,a.Result);i<f;i++)a.AccountID===
e[i].id()&&e[i].fetchers(b);else for(;i<f;i++)a.AccountID===e[i].id()&&e[i].fetchers(null)},this)};H.prototype.downloadByUrl=function(a){-1<navigator.userAgent.toLowerCase().indexOf("android")?j.open(a):(null===this.$downloadIframe&&(this.$downloadIframe=i('<iframe style="display: none;"></iframe>').appendTo(document.body)),this.$downloadIframe.attr("src",a))};H.prototype.initHeaderInfo=function(){this.browser.ie?i(document).bind("focusin",_.bind(this.onFocus,this)).bind("focusout",_.bind(this.onBlur,
this)):i(j).bind("focus",_.bind(this.onFocus,this)).bind("blur",_.bind(this.onBlur,this))};H.prototype.onFocus=function(){this.focused(!0)};H.prototype.onBlur=function(){this.focused(!1)};H.prototype.setTitle=function(a){a=this.newMessagesCount();if(!h.SingleMode||this.focused())a=this.focused()||0===a?this.getTitleByScreen():d.i18n("TITLE/HAS_UNSEEN_MESSAGES_PLURAL",{COUNT:a},null,a)+" - "+h.Accounts.getEmail(),document.title=".",document.title=a};H.prototype.getTitleByScreen=function(){var a="",
b="";try{this.MailCache.currentMessage()&&(b=this.MailCache.currentMessage().subject())}catch(e){}switch(this.currentScreen()){case f.Screens.Login:a=d.i18n("TITLE/LOGIN",null,"");break;case f.Screens.Mailbox:case f.Screens.BottomMailbox:a=h.Accounts.getEmail()+" - "+d.i18n("TITLE/MAILBOX");break;case f.Screens.Compose:case f.Screens.SingleCompose:a=h.Accounts.getEmail()+" - "+d.i18n("TITLE/COMPOSE");break;case f.Screens.SingleMessageView:a=h.Accounts.getEmail()+" - "+d.i18n("TITLE/VIEW_MESSAGE");
b&&(a=b+" - "+a);break;default:this.screensTitle[this.currentScreen()]&&(a=this.screensTitle[this.currentScreen()])}return a=""===a?h.App.SiteName:a+(" - "+h.App.SiteName)};H.prototype.desktopNotify=function(a,b,e,f,h,i){d.desktopNotify(a,b,e,f,h,i)};e=new H;j.App=e;i(function(){e.run()},0);j.AfterLogicApi=ma;j.Enums=f;fa.removeClass("no-js").addClass("js");fa.hasClass("pdf")&&(ab.push("application/pdf"),ab.push("application/x-pdf"))})(jQuery,window,ko,crossroads,hasher);