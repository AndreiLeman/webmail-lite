(function(i,j,b,Oa,ja){function W(){this.sUrl="index.php?/Ajax/";this.aRequests=[];this.hasOpenedRequests=!1;i(document).ajaxStart(_.bind(function(){this.hasOpenedRequests=!0},this));i(document).ajaxStop(_.bind(function(){this.hasOpenedRequests=!1},this))}function M(){var a=i(j);this.resizeAll=_.debounce(function(){a.resize()},100);this.previousHash=this.currentHash=this.lastMailboxRouting=""}function X(){}function I(){this.replyText=b.observable("");this.replyDraftUid=b.observable("");this.postponedMailData=
null}function Y(){this.prefetchStarted=b.observable(!1);this.init()}function E(a,d,h,u){this.fSelectCallback=d||function(){};this.fDeleteCallback=h||function(){};this.fDblClickCallback=u||function(){};this.useKeyboardKeys=b.observable(!1);this.list=a;this.oScrollScope=this.oListScope=this.oLast=null;this.iTimer=0;this.sCheckboxSelector=this.sSelectabelSelector=this.sActionSelector="";var c=this;this.listChecked=b.computed({read:function(){return _.filter(this.list(),function(a){return a.checked()})},
write:function(a){a=!!a;_.each(this.list(),function(d){d.checked(a)})},owner:this});this.checkAll=b.computed({read:function(){return 0<this.listChecked().length},write:function(a){this.listChecked(!!a)},owner:this});this.selectorHook=b.observable(null);this.selectorHook.subscribe(function(){var a=this.selectorHook();a&&a.selected(!1)},this,"beforeChange");this.selectorHook.subscribe(function(a){a&&a.selected(!0)},this);this.itemSelected=b.computed({read:this.selectorHook,write:function(a){this.selectorHook(a);
a&&(c.scrollToSelected(),this.oLast=a)},owner:this});this.listCheckedOrSelected=b.computed({read:function(){var a=this.itemSelected(),d=this.listChecked();return 0<d.length?d:a?[a]:[]},write:function(a){a||(this.itemSelected(null),this.listChecked(!1))},owner:this});this.isIncompleteChecked=b.computed(function(){var a=this.list().length,d=this.listChecked().length;return 0<a&&0<d&&a>d},this);this.onKeydown=_.bind(this.onKeydown,this)}function da(){}function Ha(){Data.init()}function ea(){this.title=
b.observable("");this.alertDesc=b.observable("");this.okButtonText=b.observable(c.i18n("MAIN/BUTTON_OK"))}function J(){this.fConfirmCallback=null;this.confirmDesc=b.observable("");this.title=b.observable("");this.okButtonText=b.observable(c.i18n("MAIN/BUTTON_OK"));this.cancelButtonText=b.observable(c.i18n("MAIN/BUTTON_CANCEL"))}function ka(){this.fCallback=null;this.editedAccountId=g.Accounts.editedId;this.friendlyName=b.observable("");this.email=b.observable("");this.incomingMailLogin=b.observable("");
this.incLoginFocused=b.observable(!1);this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this);this.incomingMailPassword=b.observable("");this.incomingMailPort=b.observable(143);this.incomingMailServer=b.observable("");this.outgoingMailLogin=b.observable("");this.outgoingMailPassword=b.observable("");this.outgoingMailPort=b.observable(25);this.outgoingMailServer=b.observable("");this.outServerFocused=b.observable(!1);
this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this);this.useSmtpAuthentication=b.observable(!0);this.friendlyNameFocus=b.observable(!1)}function pa(){this.folders=b.observable(null);this.options=b.computed(function(){return this.folders()?this.folders().getOptions(c.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_USAGE_ASSIGNED")):[]},this);this.sTrashFolderOld=this.sSpamFolderOld=this.sDraftFolderOld=this.sSentFolderOld=
"";this.sentFolderFullName=b.observable("");this.draftsFolderFullName=b.observable("");this.spamFolderFullName=b.observable("");this.trashFolderFullName=b.observable("");this.sentFolderFullName.subscribe(function(a){this.folders()&&this.folders().sentFolderFullName(a)},this);this.draftsFolderFullName.subscribe(function(a){this.folders()&&this.folders().draftsFolderFullName(a)},this);this.spamFolderFullName.subscribe(function(a){this.folders()&&this.folders().spamFolderFullName(a)},this);this.trashFolderFullName.subscribe(function(a){this.folders()&&
this.folders().trashFolderFullName(a)},this)}function qa(){this.folders=f.Cache.editedFolderList;this.options=b.computed(function(){return this.folders().getOptions(c.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_PARENT"),!0)},this);this.namespace=b.computed(function(){return this.folders().sNamespaceFolder},this);this.parentFolder=b.observable("");this.folderName=b.observable("");this.folderNameFocus=b.observable(!1)}function la(){this.fCallback=null;this.editedAccountId=g.Accounts.editedId;this.currentPassword=
b.observable("");this.newPassword=b.observable("");this.confirmPassword=b.observable("")}function Pa(){this.AllowUsersAddNewAccounts=this.AllowUsersChangeEmailSettings=this.AllowUsersChangeInterfaceSettings=!0;this.Languages=[{name:"English",value:"en"}];this.Themes=["Default"];this.DateFormats=["MM/DD/YYYY","DD/MM/YYYY"];this.DefaultLanguage="English";this.AttachmentSizeLimit=1024E4;this.AllowIdentities=this.AllowFirstCharacterSearch=!1;this.AutoSave=!0;this.AutoSaveIntervalSeconds=60;this.IdleSessionTimeout=
0;this.AllowInsertImage=!0;this.AllowBodySize=!1;this.MaxBodySize=600;this.MaxSubjectSize=255;this.AllowPrefetch=this.EnableMobileSync=!0;this.MaxPrefetchBodiesSize=3E4;this.DemoWebMail=!0;this.GoogleAnalyticsAccount=this.LoginDescription=this.DemoWebMailPassword=this.DemoWebMailLogin="";this.FlagsLangSelect=this.AllowLanguageOnLogin=this.ShowQuotaBar=!1;this.CustomLogoutUrl=""}function S(){this.IdUser=1;this.ContactsPerPage=this.MailsPerPage=20;this.iInterval=-1;this.autoCheckMailInterval=b.observable(0);
this.autoCheckMailInterval.subscribe(this.changeAutoCheckMailInterval,this);this.DefaultEditor=1;this.Layout=e.MailboxLayout.Side;this.DefaultTheme="Default";this.DefaultLanguage="English";this.DefaultDateFormat="MM/DD/YYYY";this.defaultTimeFormat=b.observable(0);this.AllowForward=this.AllowReply=this.AllowCompose=!0;this.SaveMail=e.SaveMail.Checked;this.ShowPersonalContacts=this.OutlookSyncEnable=!0;this.ShowGlobalContacts=!1;this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts;this.LastLogin=
0;this.IsDemo=!1;this.AllowCalendar=!0;this.CalendarShowWorkDay=this.CalendarShowWeekEnds=!1;this.CalendarWeekStartsOn=this.CalendarWorkDayEnds=this.CalendarWorkDayStarts=0;this.CalendarDefaultTab=1;this.needToReloadCalendar=b.observable(!1);this.mobileSync=b.observable(null);this.MobileSyncDemoPass="demo";this.outlookSync=b.observable(null);this.OutlookSyncDemoPass="demo"}function Z(){this.id=b.observable(0);this.email=b.observable("");this.extensions=b.observableArray([]);this.friendlyName=b.observable("");
this.incomingMailLogin=b.observable("");this.incomingMailPort=b.observable(143);this.incomingMailServer=b.observable("");this.isInternal=b.observable(!1);this.isLinked=b.observable(!1);this.isDefault=b.observable(!1);this.outgoingMailAuth=b.observable(0);this.outgoingMailLogin=b.observable("");this.outgoingMailPort=b.observable(25);this.outgoingMailServer=b.observable("");this.isExtended=b.observable(!1);this.signature=b.observable(null);this.autoresponder=b.observable(null);this.forward=b.observable(null);
this.filters=b.observable(null);this.quota=b.observable(0);this.usedSpace=b.observable(0);this.fullEmail=b.computed(function(){return""===this.friendlyName()?this.email():this.friendlyName()+" <"+this.email()+">"},this);this.isCurrent=b.observable(!1);this.isEdited=b.observable(!1)}function O(){this.defaultId=b.observable(0);this.currentId=b.observable(0);this.editedId=b.observable(0);this.currentId.subscribe(function(a){_.defer(_.bind(function(){this.editedId(a)},this))},this);this.Collection=b.observableArray([])}
function fa(){this.sEmail=this.sName=""}function K(){this.aCollection=[]}function ga(){this.oMoment=null}function N(a,d){this.folderName=b.observable(a||"");this.messageUid=b.observable(d||"");this.tempName=b.observable("");this.fileName=b.observable("");this.extension=b.computed(function(){var a=this.fileName().lastIndexOf(".");return this.fileName().substr(a+1)},this);this.mimePartIndex=b.observable("");this.type=b.observable("");this.size=b.observable(0);this.friendlySize=b.computed(function(){return c.friendlySize(this.size())},
this);this.downloadTitle=b.computed(function(){return c.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()})},this);this.cid=b.observable("");this.inline=b.observable(!1);this.linked=b.observable(!1);this.hash=b.observable("");this.accountId=b.observable(0);this.download=b.computed(function(){return c.getDownloadLinkByHash(this.accountId(),this.hash())},this);this.viewLink=b.computed(function(){return c.getViewLinkByHash(this.accountId(),this.hash())},this);
this.uploadUid=b.observable("");this.uploaded=b.observable(!1);this.uploadError=b.observable(!1);this.isMessageType=b.computed(function(){return"message/rfc822"===this.type()&&""!==this.mimePartIndex()},this);this.messagePart=b.observable(null);this.visibleViewLink=b.computed(function(){var a=-1!==i.inArray(this.type(),"image/jpeg image/png image/gif text/plain text/css application/x-httpd-php application/javascript".split(" "));return this.uploaded()&&!this.uploadError()&&(a||this.isMessageType())},
this);this.visibleSpinner=b.observable(!1);this.statusText=b.observable("");this.progressPercent=b.observable(0);this.visibleProgress=b.observable(!1);this.uploadStarted=b.observable(!1);this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this)}function r(){this.iAccountId=0;this.account=b.computed(function(){return g.Accounts.getAccount(this.iAccountId)},
this);this.level=b.observable(0);this.name=b.observable("");this.nameForEdit=b.observable("");this.fullName=b.observable("");this.uidNext=b.observable("");this.hash=b.observable("");this.routingHash=b.observable("");this.delimiter=b.observable("");this.type=b.observable(e.FolderTypes.User);this.showUnseenMessages=b.computed(function(){return this.type()!==e.FolderTypes.Drafts},this);this.messageCount=b.observable(0);this.messageCount.subscribe(function(){this.getUidList("").searchCount(this.messageCount())},
this);this.unseenMessageCount=b.observable(0);this.messageCountToShow=b.computed(function(){return this.showUnseenMessages()?this.unseenMessageCount():this.messageCount()},this);this.enableEmptyFolder=b.computed(function(){return 0<this.messageCount()&&(this.type()===e.FolderTypes.Spam||this.type()===e.FolderTypes.Trash)},this);this.hasExtendedInfo=b.observable(!1);this.selectable=b.observable(!0);this.subscribed=b.observable(!0);this.existen=b.observable(!0);this.subfolders=b.observableArray([]);
this.isNamespace=b.observable(!1);this.isSubFolder=b.computed(function(){return 0<this.level()},this);this.selected=b.observable(!1);this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500});this.hasSubscribedSubfolders=b.computed(function(){return!!b.utils.arrayFirst(this.subfolders(),function(a){return a.subscribed()})},this);this.isSystem=b.computed(function(){return this.type()!==e.FolderTypes.User?!0:!1},this);this.visible=b.computed(function(){var a=this.subscribed(),d=this.existen(),
h=this.selectable(),b=this.hasSubscribedSubfolders(),c=this.isSystem();return a||c||b&&(!d||!h)},this);this.edited=b.observable(!1);this.edited.subscribe(function(a){!1===a&&this.nameForEdit(this.name())},this);this.canBeSelected=b.computed(function(){var a=this.existen(),d=this.selectable();return a&&d},this);this.canSubscribe=b.computed(function(){var a=this.account(),d=!1;a&&(d=a.extensionExists("DisableManageSubscribe"));return!this.isSystem()&&this.canBeSelected()&&!d},this);this.canDelete=b.computed(function(){return!this.isSystem()&&
this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this);this.canRename=b.computed(function(){return!this.isSystem()&&this.canBeSelected()},this);this.usedAs=b.computed(function(){var a="";switch(this.type()){case e.FolderTypes.Inbox:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_INBOX");break;case e.FolderTypes.Sent:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SENT");break;case e.FolderTypes.Drafts:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_DRAFTS");break;case e.FolderTypes.Trash:a=
c.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_TRASH");break;case e.FolderTypes.Spam:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SPAM");break;default:a=""}return a},this);this.oMessages={};this.oUids={};this.aResponseHandlers=[];this.displayName=b.computed(function(){var a=this.name();switch(this.type()){case e.FolderTypes.Inbox:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_INBOX");break;case e.FolderTypes.Sent:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_SENT");break;case e.FolderTypes.Drafts:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_DRAFTS");
break;case e.FolderTypes.Trash:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_TRASH");break;case e.FolderTypes.Spam:a=c.i18n("SETTINGS/ACCOUNT_FOLDERS_SPAM")}return a},this);this.aRequestedUids=[];this.requestedLists=[];this.hasChanges=b.observable(!1);this.hasChanges.subscribe(function(){this.requestedLists=[]},this)}function F(){this.iAccountId=0;this.bInitialized=b.observable(!1);this.collection=b.observableArray([]);this.options=b.observableArray([]);this.sNamespaceFolder=this.sNamespace="";this.oNamedCollection=
{};var a=this,d=function(a){return function(d){d&&d.type(a)}},h=function(d){return{read:function(){this.collection();return d()?d().fullName():""},write:function(a){d(this.getFolderByFullName(a))},owner:a}};this.messageCount=b.computed(function(){return this.getMessageCount(this.collection())},this);this.currentFolder=b.observable(null);this.inboxFolder=b.observable(null);this.sentFolder=b.observable(null);this.draftsFolder=b.observable(null);this.spamFolder=b.observable(null);this.trashFolder=b.observable(null);
this.inboxFolder.subscribe(d(e.FolderTypes.User),this,"beforeChange");this.sentFolder.subscribe(d(e.FolderTypes.User),this,"beforeChange");this.draftsFolder.subscribe(d(e.FolderTypes.User),this,"beforeChange");this.spamFolder.subscribe(d(e.FolderTypes.User),this,"beforeChange");this.trashFolder.subscribe(d(e.FolderTypes.User),this,"beforeChange");this.inboxFolder.subscribe(d(e.FolderTypes.Inbox));this.sentFolder.subscribe(d(e.FolderTypes.Sent));this.draftsFolder.subscribe(d(e.FolderTypes.Drafts));
this.spamFolder.subscribe(d(e.FolderTypes.Spam));this.trashFolder.subscribe(d(e.FolderTypes.Trash));this.inboxFolderFullName=b.computed(h(this.inboxFolder));this.sentFolderFullName=b.computed(h(this.sentFolder));this.draftsFolderFullName=b.computed(h(this.draftsFolder));this.spamFolderFullName=b.computed(h(this.spamFolder));this.trashFolderFullName=b.computed(h(this.trashFolder));this.currentFolderFullName=b.computed(h(this.currentFolder));this.currentFolderType=b.computed(function(){return this.currentFolder()?
this.currentFolder().type():e.FolderTypes.User},this);this.delimiter=b.computed(function(){return this.inboxFolder()?this.inboxFolder().delimiter():""},this)}function B(){this.accountId=b.observable(0);this.folder=b.observable("");this.uid=b.observable("");this.subject=b.observable("");this.emptySubject=b.computed(function(){return""===c.trim(this.subject())},this);this.subjectForDisplay=b.computed(function(){return this.emptySubject()?c.i18n("MAILBOX/EMPTY_SUBJECT"):this.subject()},this);this.messageId=
b.observable("");this.textPartId=b.observable(0);this.size=b.observable(0);this.friendlySize=b.computed(function(){return c.friendlySize(this.size())},this);this.textSize=b.observable(0);this.oDateModel=new ga;this.fullDate=b.observable("");this.oFrom=new K;this.fullFrom=b.observable("");this.oTo=new K;this.to=b.observable("");this.fromOrToText=b.observable("");this.oCc=new K;this.cc=b.observable("");this.oBcc=new K;this.bcc=b.observable("");this.oSender=new K;this.seen=b.observable(!1);this.flagged=
b.observable(!1);this.answered=b.observable(!1);this.forwarded=b.observable(!1);this.hasAttachments=b.observable(!1);this.importance=b.observable(e.Importance.Normal);this.draftInfo=b.observableArray([]);this.sensitivity=b.observable(e.Sensivity.Nothing);this.hash=b.observable("");this.download=b.computed(function(){return 0<this.hash().length?c.getDownloadLinkByHash(this.accountId(),this.hash()):""},this);this.completelyFilled=b.observable(!1);this.checked=b.observable(!1);this.selected=b.observable(!1);
this.deleted=b.observable(!1);this.inReplyTo=b.observable("");this.references=b.observable("");this.readingConfirmation=b.observable("");this.text=b.observable("");this.textBodyForNewWindow=b.observable("");this.$text=null;this.hasExternals=b.observable(!1);this.isExternalsShown=b.observable(!1);this.isExternalsAlwaysShown=b.observable(!1);this.foundedCids=b.observableArray([]);this.attachments=b.observableArray([]);this.usesAttachmentString=!1;this.safety=b.observable(!1);this.ical=b.observable(null);
this.vcard=b.observable(null);this.domMessageForPrint=b.observable(null)}function va(){this.searchCount=b.observable(-1);this.search=b.observable("");this.collection=b.observableArray([])}function C(){this.uid=b.observable("");this.uid.subscribe(function(){""!==this.uid()&&"0"!==this.uid()&&f.EventsCache.addIcal(this)},this);this.file=b.observable("");this.type=b.observable("");this.icalType=b.observable("");this.icalConfig=b.observable("");this.type.subscribe(function(){var a=this.type().split("-"),
d=a.shift(),h=_.find(e.IcalType,function(a){return d===a},this),b=a.join("-"),a=_.find(e.IcalConfig,function(a){return b===a},this);d!==h&&(d=e.IcalType.Save);this.icalType(d);b!==a&&(b=e.IcalConfig.NeedsAction);this.icalConfig(b)},this);this.isRequestType=b.computed(function(){return this.icalType()===e.IcalType.Request},this);this.isCancelType=b.computed(function(){return this.icalType()===e.IcalType.Cancel},this);this.cancelDecision=b.observable("");this.isReplyType=b.computed(function(){return this.icalType()===
e.IcalType.Reply},this);this.replyDecision=b.observable("");this.isSaveType=b.computed(function(){return this.icalType()===e.IcalType.Save},this);this.isJustSaved=b.observable(!1);this.fillDecisions();this.isAccepted=b.computed(function(){return this.icalConfig()===e.IcalConfig.Accepted},this);this.isDeclined=b.computed(function(){return this.icalConfig()===e.IcalConfig.Declined},this);this.isTentative=b.computed(function(){return this.icalConfig()===e.IcalConfig.Tentative},this);this.location=b.observable("");
this.description=b.observable("");this.when=b.observable("");this.calendarId=b.observable("");this.calendars=f.EventsCache.calendars;this.selectedCalendar=b.observable("");this.chosenCalendarName=b.computed(function(){var a=null;""!==this.calendarId()&&(a=_.find(this.calendars(),function(a){return a.id===this.calendarId()},this));return a?a.name:""},this);this.calendarIsChosen=b.computed(function(){return""!==this.chosenCalendarName()},this)}function xa(){this.uid=b.observable("");this.uid.subscribe(function(){""!==
this.uid()&&"0"!==this.uid()&&f.ContactsCache.addVcard(this)},this);this.file=b.observable("");this.name=b.observable("");this.email=b.observable("");this.isExists=b.observable(!1);this.isJustSaved=b.observable(!1)}function x(){this.sDefaultType=e.ContactEmailType.Personal;this.idContact=b.observable("");this.idUser=b.observable("");this.isNew=b.observable(!1);this.readOnly=b.observable(!1);this.edited=b.observable(!1);this.extented=b.observable(!1);this.personalCollapsed=b.observable(!1);this.businessCollapsed=
b.observable(!1);this.otherCollapsed=b.observable(!1);this.groupsCollapsed=b.observable(!1);this.displayName=b.observable("");this.firstName=b.observable("");this.lastName=b.observable("");this.nickName=b.observable("");this.displayNameFocused=b.observable(!1);this.primaryEmail=b.observable(this.sDefaultType);this.mainPrimaryEmail=b.computed({read:this.primaryEmail,write:function(a){!c.isUnd(a)&&0<=c.inArray(a,[e.ContactEmailType.Personal,e.ContactEmailType.Business,e.ContactEmailType.Other])?this.primaryEmail(a):
this.primaryEmail(e.ContactEmailType.Personal)},owner:this});this.personalEmail=b.observable("");this.personalStreetAddress=b.observable("");this.personalCity=b.observable("");this.personalState=b.observable("");this.personalZipCode=b.observable("");this.personalCountry=b.observable("");this.personalWeb=b.observable("");this.personalFax=b.observable("");this.personalPhone=b.observable("");this.personalMobile=b.observable("");this.personalIsEmpty=b.computed(function(){return""===""+this.personalEmail()+
this.personalStreetAddress()+this.personalCity()+this.personalState()+this.personalZipCode()+this.personalCountry()+this.personalWeb()+this.personalFax()+this.personalPhone()+this.personalMobile()},this);this.businessEmail=b.observable("");this.businessCompany=b.observable("");this.businessDepartment=b.observable("");this.businessJob=b.observable("");this.businessOffice=b.observable("");this.businessStreetAddress=b.observable("");this.businessCity=b.observable("");this.businessState=b.observable("");
this.businessZipCode=b.observable("");this.businessCountry=b.observable("");this.businessWeb=b.observable("");this.businessFax=b.observable("");this.businessPhone=b.observable("");this.businessIsEmpty=b.computed(function(){return""===""+this.businessEmail()+this.businessCompany()+this.businessDepartment()+this.businessJob()+this.businessOffice()+this.businessStreetAddress()+this.businessCity()+this.businessState()+this.businessZipCode()+this.businessCountry()+this.businessWeb()+this.businessFax()+
this.businessPhone()},this);this.otherEmail=b.observable("");this.otherBirthdayMonth=b.observable("0");this.otherBirthdayDay=b.observable("0");this.otherBirthdayYear=b.observable("0");this.otherNotes=b.observable("");this.etag=b.observable("");this.birthdayIsEmpty=b.computed(function(){var a="0"===this.otherBirthdayMonth(),d="0"===this.otherBirthdayDay(),b="0"===this.otherBirthdayYear();return a||d||b},this);this.otherBirthday=b.computed(function(){var a="",d=c.pInt(this.otherBirthdayYear()),b=c.pInt(this.otherBirthdayMonth()),
f=c.pInt(this.otherBirthdayDay()),e=new ga;this.birthdayIsEmpty()||(e.setDate(d,b,f),a=e.getShortDate());return a},this);this.otherIsEmpty=b.computed(function(){return""===""+this.otherEmail()+this.otherNotes()&&this.birthdayIsEmpty()},this);this.groups=b.observableArray([]);this.groupsIsEmpty=b.computed(function(){return 0===this.groups().length},this);this.email=b.computed({read:function(){var a="";switch(this.primaryEmail()){case e.ContactEmailType.Personal:a=this.personalEmail();break;case e.ContactEmailType.Business:a=
this.businessEmail();break;case e.ContactEmailType.Other:a=this.otherEmail()}return a},write:function(a){switch(this.primaryEmail()){case e.ContactEmailType.Personal:this.personalEmail(a);break;case e.ContactEmailType.Business:this.businessEmail(a);break;case e.ContactEmailType.Other:this.otherEmail(a);break;default:this.primaryEmail(this.sDefaultType),this.email(a)}},owner:this});this.emails=b.computed(function(){var a=[];""!==this.personalEmail()&&a.push({text:c.i18n("CONTACTS/OPTION_PERSONAL")+
": "+this.personalEmail(),value:e.ContactEmailType.Personal});""!==this.businessEmail()&&a.push({text:c.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessEmail(),value:e.ContactEmailType.Business});""!==this.otherEmail()&&a.push({text:c.i18n("CONTACTS/OPTION_OTHER")+": "+this.otherEmail(),value:e.ContactEmailType.Other});return a},this);this.hasEmails=b.computed(function(){return 0<this.emails().length},this);this.extented.subscribe(function(a){a&&(this.personalCollapsed(!this.personalIsEmpty()),
this.businessCollapsed(!this.businessIsEmpty()),this.otherCollapsed(!this.otherIsEmpty()),this.groupsCollapsed(!this.groupsIsEmpty()))},this);this.birthdayMonthSelect=x.birthdayMonthSelect;this.birthdayYearSelect=x.birthdayYearSelect;this.birthdayDaySelect=b.computed(function(){for(var a=1,d=c.pInt(c.daysInMonth(this.otherBirthdayMonth(),this.otherBirthdayYear())),b="",f=[{text:c.i18n("DATETIME/DAY"),value:"0"}];a<=d;a++)b=a.toString(),f.push({text:b,value:b});return f},this);for(var a="",d=(new Date).getFullYear();1932<=
d;d--)a=d.toString(),this.birthdayYearSelect.push({text:a,value:a});this.canBeSave=b.computed(function(){return!0},this);this.sendMailLink=b.computed(function(){return this.getSendMailLink(this.email())},this);this.sendMailToPersonalLink=b.computed(function(){return this.getSendMailLink(this.personalEmail())},this);this.sendMailToBusinessLink=b.computed(function(){return this.getSendMailLink(this.businessEmail())},this);this.sendMailToOtherLink=b.computed(function(){return this.getSendMailLink(this.otherEmail())},
this)}function aa(){this.isNew=b.observable(!1);this.readOnly=b.observable(!1);this.idGroup=b.observable("");this.idUser=b.observable("");this.name=b.observable("");this.edited=b.observable(!1);this.nameFocused=b.observable(!1);this.canBeSave=b.computed(function(){return""!==this.name()},this);this.newContactsInGroupCount=b.observable(0);this.newContactsInGroupHint=b.computed(function(){var a=this.newContactsInGroupCount();return this.isNew()&&0<a?c.i18n("CONTACTS/CONTACT_ADD_TO_NEW_HINT",{COUNT:a}):
""},this)}function P(){this.bGlobal=this.bReadOnly=this.bIsGroup=!1;this.sEmail=this.sName=this.sId="";this.deleted=b.observable(!1);this.checked=b.observable(!1);this.selected=b.observable(!1);this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500})}function Ia(){this.name=b.observable("");this.size=b.observable(0);this.type=b.observable("");this.friendlySize=b.computed(function(){return c.friendlySize(this.size())},this);this.hash=b.observable("");this.download=b.computed(function(){return c.getDownloadLinkByHash(g.Accounts.currentId(),
this.hash())},this)}function Ja(){this.iAccountId=0;this.type=b.observable(!0);this.options=b.observable(0);this.signature=b.observable("")}function Qa(){this.iAccountId=0;this.enable=!1;this.message=this.subject=""}function Ra(){this.iAccountId=0;this.enable=!1;this.email=""}function Sa(){this.iAccountId=0;this.collection=b.observableArray([])}function ya(a){this.iAccountId=a;this.enable=b.observable(!0);this.field=b.observable("");this.condition=b.observable("");this.filter=b.observable("");this.action=
b.observable("");this.folder=b.observable("")}function wa(){this.loadingMessage=b.observable("");this.loadingVisible=b.observable(!1);this.reportMessage=b.observable("");this.reportVisible=b.observable(!1);this.iReportTimeout=NaN;this.errorMessage=b.observable("");this.errorVisible=b.observable(!1);this.iErrorTimeout=-1;this.isHtmlError=b.observable(!1)}function ra(){this.currentAccountId=g.Accounts.currentId;this.currentAccountId.subscribe(function(){this.changeCurrentAccount()},this);this.email=
b.observable("");this.accounts=g.Accounts.Collection;this.bAllowContacts=g.User.ShowContacts;this.bAllowCalendar=g.User.AllowCalendar;this.currentTab=f.Screens.currentScreen;this.sMailboxHash=f.Routing.buildHashFromArray([e.Screens.Mailbox]);this.sContactsHash=f.Routing.buildHashFromArray([e.Screens.Contacts]);this.sCalendarHash=f.Routing.buildHashFromArray([e.Screens.Calendar]);this.sFileStorageHash=f.Routing.buildHashFromArray([e.Screens.FileStorage]);this.sSettingsHash=f.Routing.buildHashFromArray([e.Screens.Settings]);
this.contactsRecivedAnim=f.ContactsCache.recivedAnim;this.calendarRecivedAnim=f.EventsCache.recivedAnim}function T(a,d){this.currentPage=b.observable(1);this.count=b.observable(a);this.perPage=b.observable(d);this.pagesCount=b.computed(function(){return Math.ceil(this.count()/this.perPage())},this);this.firstPage=b.computed(function(){var a=this.currentPage()-2;return 0<a?a:1},this);this.lastPage=b.computed(function(){var a=this.firstPage()+4;return a<=this.pagesCount()?a:this.pagesCount()},this);
this.visibleFirst=b.computed(function(){return 1<this.firstPage()},this);this.visibleLast=b.computed(function(){return this.lastPage()<this.pagesCount()},this);this.pages=b.computed(function(){var a=this.firstPage(),d=[];if(this.firstPage()<this.lastPage())for(;a<=this.lastPage();a++)d.push({number:a,current:a===this.currentPage(),clickFunc:_.bind(this.clickPage,this)});return d},this)}function m(a){this.containerDom=b.observable(null);this.headerDom=b.observable(null);this.creaId="creaId"+Math.random().toString().replace(".",
"");this.allowInsertImage=b.observable(a&&g.App.AllowInsertImage);this.lockFontSubscribing=b.observable(!1);this.aFonts="Arial;Arial Black;Courier New;Tahoma;Times New Roman;Verdana".split(";");this.iDefaultFont="Tahoma";this.selectedFont=b.observable(this.iDefaultFont);this.selectedFont.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontName(this.selectedFont())},this);this.aSizes=[1,2,3,4,5,6,7];this.iDefaultSize=3;this.selectedSize=b.observable(this.iDefaultSize);this.selectedSize.subscribe(function(){this.lockFontSubscribing()||
this.oCrea.fontSize(this.selectedSize())},this);this.visibleInsertLinkPopup=b.observable(!1);this.linkForInsert=b.observable("");this.linkFocused=b.observable(!1);this.visibleLinkPopup=b.observable(!1);this.linkPopupTop=b.observable(0);this.linkPopupLeft=b.observable(0);this.linkHref=b.observable("");this.visibleLinkHref=b.observable(!1);this.visibleInsertImagePopup=b.observable(!1);this.imageUploaderButton=b.observable(null);this.uploadedImagePathes=b.observableArray([]);this.imagePathFromWeb=b.observable("");
this.visibleFontColorPopup=b.observable(!1);this.oFontColorPicker=new za(c.i18n("HTMLEDITOR/TEXT_COLOR_CAPTION"),this.setTextColorFromPopup,this);this.oBackColorPicker=new za(c.i18n("HTMLEDITOR/BACKGROUND_COLOR_CAPTION"),this.setBackColorFromPopup,this);this.activitySource=b.observable(1);this.inactive=b.observable(!1);this.inactive.subscribe(function(){var a=this.removeAllTags(this.getText());this.inactive()?(""===a||"&nbsp;"===a)&&this.setText('<span style="color: #AAAAAA;">'+c.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")+
"</span>"):a===c.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")&&this.setText("")},this)}function za(a,d,h){this.aGreyColors="rgb(0, 0, 0);rgb(68, 68, 68);rgb(102, 102, 102);rgb(153, 153, 153);rgb(204, 204, 204);rgb(238, 238, 238);rgb(243, 243, 243);rgb(255, 255, 255)".split(";");this.aBrightColors="rgb(255, 0, 0);rgb(255, 153, 0);rgb(255, 255, 0);rgb(0, 255, 0);rgb(0, 255, 255);rgb(0, 0, 255);rgb(153, 0, 255);rgb(255, 0, 255)".split(";");this.aColorLines=["rgb(244, 204, 204);rgb(252, 229, 205);rgb(255, 242, 204);rgb(217, 234, 211);rgb(208, 224, 227);rgb(207, 226, 243);rgb(217, 210, 233);rgb(234, 209, 220)".split(";"),
"rgb(234, 153, 153);rgb(249, 203, 156);rgb(255, 229, 153);rgb(182, 215, 168);rgb(162, 196, 201);rgb(159, 197, 232);rgb(180, 167, 214);rgb(213, 166, 189)".split(";"),"rgb(224, 102, 102);rgb(246, 178, 107);rgb(255, 217, 102);rgb(147, 196, 125);rgb(118, 165, 175);rgb(111, 168, 220);rgb(142, 124, 195);rgb(194, 123, 160)".split(";"),"rgb(204, 0, 0);rgb(230, 145, 56);rgb(241, 194, 50);rgb(106, 168, 79);rgb(69, 129, 142);rgb(61, 133, 198);rgb(103, 78, 167);rgb(166, 77, 121)".split(";"),"rgb(153, 0, 0);rgb(180, 95, 6);rgb(191, 144, 0);rgb(56, 118, 29);rgb(19, 79, 92);rgb(11, 83, 148);rgb(53, 28, 117);rgb(116, 27, 71)".split(";"),
"rgb(102, 0, 0);rgb(120, 63, 4);rgb(127, 96, 0);rgb(39, 78, 19);rgb(12, 52, 61);rgb(7, 55, 99);rgb(32, 18, 77);rgb(76, 17, 48)".split(";")];this.caption=a;this.pickHandler=d;this.pickContext=h;this.colorPickerDom=b.observable(null)}function sa(){this.email=b.observable("");this.login=b.observable("");this.password=b.observable("");this.loginDescription=b.observable("");this.emailFocus=b.observable(!1);this.loginFocus=b.observable(!1);this.passwordFocus=b.observable(!1);this.loading=b.observable(!1);
this.loginFocus.subscribe(function(a){a&&""===this.login()&&this.login(this.email())},this);this.loginFormType=b.observable(e.LoginFormType.Email);this.emailVisible=b.computed(function(){return e.LoginFormType.Login!==this.loginFormType()},this);this.loginVisible=b.computed(function(){return e.LoginFormType.Email!==this.loginFormType()},this);this.signMeType=b.observable(e.LoginSignMeType.DefaultOn);this.signMe=b.observable(e.LoginSignMeType.DefaultOn===this.signMeType());this.signMeType.subscribe(function(){this.signMe(e.LoginSignMeType.DefaultOn===
this.signMeType())},this);this.focusedField="";this.aLanguages=g.App.Languages;this.currentLanguage=b.observable(g.App.DefaultLanguage);this.allowLanguages=b.observable(g.App.AllowLanguageOnLogin);this.viewLanguagesAsDropdown=b.observable(!g.App.FlagsLangSelect);this.canBeLogin=b.computed(function(){var a=this.loginFormType(),d=this.email(),h=this.login(),b=this.password();return!this.loading()&&""!==c.trim(b)&&(e.LoginFormType.Login===a&&""!==c.trim(h)||e.LoginFormType.Email===a&&""!==c.trim(d))},
this);this.signInButtonText=b.computed(function(){return this.loading()?c.i18n("LOGIN/BUTTON_SIGNING_IN"):c.i18n("LOGIN/BUTTON_SIGN_IN")},this);this.loginCommand=c.createCommand(this,this.signIn,this.canBeLogin);this.email(g.App.DemoWebMailLogin||"");this.password(g.App.DemoWebMailPassword||"");this.loginDescription(g.App.LoginDescription||"")}function Ka(){this.foldersContainer=b.observable(null);this.folderList=f.Cache.folderList;this.manageFoldersHash=f.Routing.buildHashFromArray([e.Screens.Settings,
e.SettingsTab.EmailAccounts,e.AccountSettingsTab.Folders]);this.quotaProc=b.observable(-1);this.quotaDesc=b.observable("");b.computed(function(){if(!g.App.ShowQuotaBar)return!0;f.Cache.quotaChangeTrigger();var a=g.Accounts.getCurrent(),d=a?a.quota():0,a=a?a.usedSpace():0,a=0<d?Math.ceil(100*(a/d)):-1,a=100<a?100:a;this.quotaProc(a);this.quotaDesc(-1<a?c.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:a,QUOTA:c.friendlySize(1024*d)}):"");return!0},this)}function o(){this.isFocused=b.observable(!1);this.messagesContainer=
b.observable(null);this.searchInput=b.observable("");this.searchInputFrom=b.observable("");this.searchInputTo=b.observable("");this.searchInputSubject=b.observable("");this.searchInputText=b.observable("");this.bAdvancedSearch=b.observable(!1);this.currentMessage=f.Cache.currentMessage;this.currentMessage.subscribe(function(){this.selector.itemSelected(this.currentMessage())},this);this.folderList=f.Cache.folderList;this.folderList.subscribe(this.onFolderListSubscribe,this);this.folderFullName=b.observable("");
this.uidList=f.Cache.uidList;this.uidList.subscribe(function(){0<=this.uidList().searchCount()&&this.oPageSwitcher.setCount(this.uidList().searchCount())},this);this.collection=f.Cache.messages;this.search=b.observable("");this.isEmptyList=b.computed(function(){return 0===this.collection().length},this);this.isSearch=b.computed(function(){return 0<this.search().length},this);this.isLoading=f.Cache.messagesLoading;this.isError=f.Cache.messagesLoadingError;this.visibleInfoSearchLoading=b.computed(function(){return this.isSearch()&&
this.isLoading()},this);this.visibleInfoSearchList=b.computed(function(){return this.isSearch()&&!this.isLoading()&&!this.isEmptyList()},this);this.visibleInfoMessageListEmpty=b.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.isEmptyList()&&!this.isError()},this);this.visibleInfoSearchEmpty=b.computed(function(){return this.isSearch()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()},this);this.visibleInfoMessageListError=b.computed(function(){return!this.isSearch()&&this.isError()},
this);this.visibleInfoSearchError=b.computed(function(){return this.isSearch()&&this.isError()},this);this.searchText=b.computed(function(){return c.i18n("MAILBOX/INFO_SEARCH_RESULT",{SEARCH:this.search(),FOLDER:this.folderList().currentFolder()?this.folderList().currentFolder().displayName():""})},this);this.collectionChecked=b.computed(function(){var a=_.filter(this.collection(),function(a){return!a.deleted()&&a.checked()});0===a.length&&(f.Cache.currentMessage()&&!f.Cache.currentMessage().deleted())&&
(a=[f.Cache.currentMessage()]);return a},this);this.collectionCheckedUids=b.computed(function(){return _.map(this.collectionChecked(),function(a){return a.uid()})},this);this.isEnableGroupOperations=b.observable(!1).extend({throttle:250});this.selector=new E(this.collection,_.bind(this.routeForMessage,this),_.bind(this.onDeletePress,this),_.bind(this.onMessageDblClick,this));b.computed(function(){this.isEnableGroupOperations(0<this.selector.listCheckedOrSelected().length)},this);this.checkAll=this.selector.koCheckAll();
this.checkAllIncomplite=this.selector.koCheckAllIncomplete();this.pageSwitcherLocked=b.observable(!1);this.oPageSwitcher=new T(0,g.User.MailsPerPage);this.oPageSwitcher.currentPage.subscribe(function(a){var d=this.folderList().currentFolderFullName(),h=this.currentMessage()?this.currentMessage().uid():"",b=this.search();this.pageSwitcherLocked()||this.changeRoutingForMessageList(d,a,h,b)},this);this.listChangedThrottle=i.browser.mozilla||i.browser.msie?b.observable(!1).extend({throttle:10}):b.observable(!1);
this.listChanged=b.computed(function(){return[this.folderFullName(),this.search(),this.oPageSwitcher.currentPage()]},this);this.listChanged.subscribe(function(){this.listChangedThrottle(!this.listChangedThrottle())},this)}function p(){this.singleMode=b.observable(g.SingleMode);this.isLoading=b.observable(!1);this.messages=f.Cache.messages;this.messages.subscribe(this.onMessagesSubscribe,this);this.currentMessage=f.Cache.currentMessage;this.currentMessage.subscribe(this.onCurrentMessageSubscribe,this);
g.User.defaultTimeFormat.subscribe(this.onCurrentMessageSubscribe,this);this.isCurrentMessage=b.computed(function(){return!!this.currentMessage()},this);this.isCurrentMessageLoaded=b.computed(function(){return this.isCurrentMessage()&&!this.isLoading()},this);this.visibleNoMessageSelectedText=b.computed(function(){return 0<this.messages().length&&!this.isCurrentMessage()},this);this.isEnablePrint=this.isEnableForward=this.isEnableReplyAll=this.isEnableReply=this.isCurrentMessageLoaded;this.isEnableSave=
this.isCurrentMessage;this.prevMessageCommand=c.createCommand(this,this.executePrevMessage);this.nextMessageCommand=c.createCommand(this,this.executeNextMessage);this.replyCommand=c.createCommand(this,this.executeReply,this.isEnableReply);this.replyAllCommand=c.createCommand(this,this.executeReplyAll,this.isEnableReplyAll);this.forwardCommand=c.createCommand(this,this.executeForward,this.isEnableForward);this.printCommand=c.createCommand(this,this.executePrint,this.isEnablePrint);this.saveCommand=
c.createCommand(this,this.executeSave,this.isEnableSave);this.ical=b.observable(null);this.vcard=b.observable(null);this.visiblePicturesControl=b.observable(!1);this.visibleShowPicturesLink=b.observable(!1);this.visibleAppointmentInfo=b.computed(function(){return null!==this.ical()},this);this.visibleVcardInfo=b.computed(function(){return null!==this.vcard()},this);this.sesitivityText=b.computed(function(){var a="";if(this.currentMessage())switch(this.currentMessage().sensitivity()){case e.Sensivity.Confidential:a=
c.i18n("MESSAGE/SENSIVITY_CONFIDENTIAL");break;case e.Sensivity.Personal:a=c.i18n("MESSAGE/SENSIVITY_PERSONAL");break;case e.Sensivity.Private:a=c.i18n("MESSAGE/SENSIVITY_PRIVATE")}return a},this);this.visibleConfirmationControl=b.computed(function(){return this.currentMessage()&&""!==this.currentMessage().readingConfirmation()},this);this.isVisibleReplyTool=b.computed(function(){var a=f.Cache.folderList().currentFolder();return a&&0<a.fullName().length&&a.type()!==e.FolderTypes.Drafts&&a.type()!==
e.FolderTypes.Sent},this);this.isVisibleForwardTool=b.computed(function(){var a=f.Cache.folderList().currentFolder();return a&&0<a.fullName().length&&a.type()!==e.FolderTypes.Drafts},this);this.uid=b.observable("");this.subject=b.observable("");this.from=b.observable("");this.fullFrom=b.observable("");this.to=b.observable("");this.cc=b.observable("");this.bcc=b.observable("");this.allRecipients=b.observable("");this.fullDate=b.observable("");this.midDate=b.observable("");this.fromEmail=b.observable("");
this.fromName=b.observable("");this.fromExistsInContacts=b.observable(!1);this.fromContactInfoReceived=b.observable(!1);this.fromContact=b.observable(new x);this.hasFromContact=b.computed(function(){return this.fromContactInfoReceived()&&this.fromExistsInContacts()},this);this.shortFromToDisplay=b.computed(function(){var a=this.from();""===this.fromName()&&(this.hasFromContact()&&""!==this.fromContact().displayName())&&(a=this.fromContact().displayName());return a},this);this.visibleAddToContacts=
b.computed(function(){return this.fromContactInfoReceived()&&!this.fromExistsInContacts()},this);this.textBody=b.observable("");this.textBodyForNewWindow=b.observable("");this.domTextBody=b.observable(null);this.attachments=b.observableArray([]);this.usesAttachmentString=!0;this.attachmentsInString=b.computed(function(){return _.map(this.attachments(),function(a){return a.fileName()},this).join(", ")},this);this.notInlineAttachments=b.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},
this);this.detailsVisible=b.observable(!1);this.hasNotInlineAttachments=b.computed(function(){return 0<this.notInlineAttachments().length},this);this.hasBodyText=b.computed(function(){return 0<this.textBody().length},this);this.visibleAddMenu=b.observable(!1);this.replyText=b.observable("");this.replyTextFocus=b.observable(!1);this.replyPaneVisible=b.computed(function(){return this.currentMessage()&&this.currentMessage().completelyFilled()},this);this.replySendingStarted=b.observable(!1);this.replySavingStarted=
b.observable(!1);this.replyDraftUid=b.observable("");this.replyLoadingText=b.computed(function(){return this.replySendingStarted()?c.i18n("COMPOSE/INFO_SENDING"):this.replySavingStarted()?c.i18n("COMPOSE/INFO_SAVING"):""},this);this.domPreviewPane=b.observable(null);this.domMessageHeader=b.observable(null);this.domQuickReply=b.observable(null);this.domMessageForPrint=b.observable(null);this.replyTextFocusThrottled=b.observable(!1).extend({throttle:50});this.replyTextFocus.subscribe(function(){this.replyTextFocusThrottled(this.replyTextFocus())},
this);this.isQuickReplyActive=b.computed(function(){return 0<this.replyText().length||this.replyTextFocusThrottled()},this);b.computed(function(){var a=this.domPreviewPane(),d=this.domMessageHeader(),h=this.domQuickReply();this.detailsVisible();this.currentMessage();this.replyPaneVisible();this.replyTextFocusThrottled();a&&(d&&h)&&_.delay(function(){var b=d.is(":visible")?d.outerHeight():0,c=h.is(":visible")?h.outerHeight():0;a.css({"padding-top":b,"margin-top":-b,"padding-bottom":c,"margin-bottom":-c})},
300)},this);this.viewAllMailsWithContactBinded=_.bind(this.viewAllMailsWithContact,this)}function ba(){this.folderList=f.Cache.folderList;this.domFolderList=b.observable(null);this.oFolderList=new Ka;this.oMessageList=new o;this.oMessagePane=new p;this.isEnableGroupOperations=this.oMessageList.isEnableGroupOperations;this.composeLink=b.observable(f.Routing.buildHashFromArray(f.Links.compose()));this.checkMailCommand=c.createCommand(f.Cache,f.Cache.executeCheckMail);this.checkMailStarted=f.Cache.checkMailStarted;
this.markAsReadCommand=c.createCommand(this.oMessageList,this.oMessageList.executeMarkAsRead,this.isEnableGroupOperations);this.markAsUnreadCommand=c.createCommand(this.oMessageList,this.oMessageList.executeMarkAsUnread,this.isEnableGroupOperations);this.markAllReadCommand=c.createCommand(this.oMessageList,this.oMessageList.executeMarkAllRead);this.moveToFolderCommand=c.createCommand(this,c.emptyFunction,this.isEnableGroupOperations);this.deleteCommand=c.createCommand(this.oMessageList,this.oMessageList.executeDelete,
this.isEnableGroupOperations);this.emptyTrashCommand=c.createCommand(f.Cache,f.Cache.executeEmptyTrash);this.emptySpamCommand=c.createCommand(f.Cache,f.Cache.executeEmptySpam);this.spamCommand=c.createCommand(this.oMessageList,this.oMessageList.executeSpam,this.isEnableGroupOperations);this.notSpamCommand=c.createCommand(this.oMessageList,this.oMessageList.executeNotSpam,this.isEnableGroupOperations);this.bVisibleComposeMessage=g.User.AllowCompose;this.isVisibleReplyTool=b.computed(function(){return this.folderList().currentFolder()&&
0<this.folderList().currentFolderFullName().length&&this.folderList().currentFolderType()!==e.FolderTypes.Drafts&&this.folderList().currentFolderType()!==e.FolderTypes.Sent},this);this.isVisibleForwardTool=b.computed(function(){return this.folderList().currentFolder()&&0<this.folderList().currentFolderFullName().length&&this.folderList().currentFolderType()!==e.FolderTypes.Drafts},this);this.isSpamFolder=b.computed(function(){return this.folderList().currentFolderType()===e.FolderTypes.Spam},this);
this.isTrashFolder=b.computed(function(){return this.folderList().currentFolderType()===e.FolderTypes.Trash},this)}function l(){this.folderList=f.Cache.folderList;this.folderList.subscribe(function(){this.getMessageOnRoute()},this);this.singleMode=b.observable(g.SingleMode);this.isDemo=b.observable(g.User.IsDemo);this.sending=b.observable(!1);this.saving=b.observable(!1);this.oHtmlEditor=new m(!0);this.visibleBcc=b.observable(!1);this.visibleBcc.subscribe(function(){this.computeHeight()},this);this.visibleCc=
b.observable(!1);this.visibleCc.subscribe(function(){this.computeHeight()},this);this.visibleCounter=b.observable(!1);this.readingConfirmation=b.observable(!1);this.saveMailInSentItems=b.observable(!0);this.useSaveMailInSentItems=b.observable(!1);this.composeUploaderButton=b.observable(null);this.composeUploaderDropPlace=b.observable(null);this.composeUploaderBodyDragOver=b.observable(!1);this.composeUploaderDragOver=b.observable(!1);this.allowDragNDrop=b.observable(!1);this.uploaderBodyDragOver=
b.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this);this.uploaderDragOver=b.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this);this.selectedImportance=b.observable(e.Importance.Normal);this.selectedSensitivity=b.observable(e.Sensivity.Nothing);this.accounts=g.Accounts.Collection;this.visibleFrom=b.computed(function(){return 1<this.accounts().length},this);this.selectedAccountId=b.observable(g.Accounts.currentId());this.toAddr=
b.observable("").extend({reversible:!0});this.ccAddr=b.observable("").extend({reversible:!0});this.bccAddr=b.observable("").extend({reversible:!0});this.subject=b.observable("").extend({reversible:!0});this.counter=b.observable(0);this.commitedTextBody=b.observable("");this.textBody=b.observable("");this.textBody.subscribe(function(){this.oHtmlEditor.setText(this.textBody());this.commitedTextBody(this.oHtmlEditor.getText())},this);this.toAddrFocused=b.observable(!1);this.ccAddrFocused=b.observable(!1);
this.bccAddrFocused=b.observable(!1);this.subjectFocused=b.observable(!1);this.draftUid=b.observable("");this.draftInfo=b.observableArray([]);this.routeType=b.observable("");this.routeParams=b.observableArray([]);this.inReplyTo=b.observable("");this.references=b.observable("");this.uploadAttachmentsTimer=-1;this.messageUploadAttachmentsStarted=b.observable(!1);this.messageUploadAttachmentsStarted.subscribe(function(){clearTimeout(this.uploadAttachmentsTimer);this.messageUploadAttachmentsStarted()?
this.uploadAttachmentsTimer=setTimeout(function(){f.Api.showLoading(c.i18n("COMPOSE/INFO_ATTACHMENTS_LOADING"))},4E3):f.Api.hideLoading()},this);this.attachments=b.observableArray([]);this.attachmentsChanged=b.observable(!1);this.attachments.subscribe(function(){this.computeHeight()},this);this.notUploadedAttachments=b.computed(function(){return _.filter(this.attachments(),function(a){return!a.uploaded()})},this);this.allAttachmentsUploaded=b.computed(function(){return 0===this.notUploadedAttachments().length&&
!this.messageUploadAttachmentsStarted()},this);this.notInlineAttachments=b.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},this);this.allowStartSending=b.computed(function(){return!this.saving()},this);this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(f.MessageSender.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this);this.requiresPostponedSending=b.observable(!1);this.oJua=null;
this.isDraftsCleared=b.observable(!1);this.autoSaveTimer=b.observable(-1);this.backToListCommand=c.createCommand(this,this.executeBackToList);this.sendCommand=c.createCommand(this,this.executeSend,this.isEnableSending);this.saveCommand=c.createCommand(this,this.executeSaveCommand,this.isEnableSaving);this.messageForm=b.observable(null);this.messageFields=b.observable(null);this.shown=b.observable(!1)}function Aa(a){this.oJua=null;this.oParent=a;this.visibility=b.observable(!1);this.importing=b.observable(!1)}
function n(){var a=this;this.isFocused=b.observable(!1);this.searchInput=b.observable("");this.loadingList=b.observable(!1);this.loadingViewPane=b.observable(!1);this.showPersonalContacts=b.observable(!1);this.showGlobalContacts=b.observable(!1);this.selectedGroupType=b.observable(e.ContactsGroupListType.Personal);this.selectedGroupInList=b.observable(null);this.selectedGroupInList.subscribe(function(){var a=this.selectedGroupInList();a&&a.selected(!1)},this,"beforeChange");this.selectedGroupInList.subscribe(function(a){a&&
this.showPersonalContacts()&&(a.selected(!0),this.selectedGroupType(e.ContactsGroupListType.SubGroup),this.requestContactList())},this);this.selectedGroup=b.observable(null);this.selectedContact=b.observable(null);this.oContactModel=new x;this.oGroupModel=new aa;this.oContactImportViewModel=new Aa(this);this.selectedItem=b.computed({read:function(){return this.selectedContact()||this.selectedGroup()||null},write:function(a){a instanceof x?(this.oContactImportViewModel.visibility(!1),this.selectedGroup(null),
this.selectedContact(a)):a instanceof aa?(this.oContactImportViewModel.visibility(!1),this.selectedContact(null),this.selectedGroup(a)):(this.selectedGroup(null),this.selectedContact(null));this.loadingViewPane(!1)},owner:this});this.sortOrder=b.observable(!0);this.sortType=b.observable(e.ContactSortType.Email);this.collection=b.observableArray([]);this.search=b.observable("");this.groupFullCollection=b.observableArray([]);this.selectedContact.subscribe(function(a){if(a){var h=a.groups();_.each(this.groupFullCollection(),
function(a){a.checked(a&&0<=c.inArray(a.Id(),h))})}},this);this.selectedGroupType.subscribe(function(a){if(e.ContactsGroupListType.Personal===a&&!this.showPersonalContacts()&&this.showGlobalContacts())this.selectedGroupType(e.ContactsGroupListType.Global);else if(e.ContactsGroupListType.Global===a&&!this.showGlobalContacts()&&this.showPersonalContacts())this.selectedGroupType(e.ContactsGroupListType.Personal);else if(e.ContactsGroupListType.Personal===a||e.ContactsGroupListType.Global===a)this.selectedGroupInList(null),
this.selectedItem(null),this.selector.listCheckedOrSelected(!1),this.requestContactList()},this);this.oPageSwitcher=new T(0,g.User.ContactsPerPage);this.oPageSwitcher.currentPage.subscribe(function(){this.requestContactList()},this);this.search.subscribe(function(a){this.searchInput(a)},this);this.searchSubmitCommand=c.createCommand(this,function(){this.oPageSwitcher.currentPage(1);this.search(this.searchInput());this.requestContactList()});this.selector=new E(this.collection,function(d){d&&a.requestContact(d)},
_.bind(this.executeDelete,this),_.bind(this.onContactDblClick,this));this.checkAll=this.selector.koCheckAll();this.checkAllIncomplite=this.selector.koCheckAllIncomplete();this.newContactCommand=c.createCommand(this,this.executeNewContact);this.newGroupCommand=c.createCommand(this,this.executeNewGroup);this.addContactsCommand=c.createCommand(this,c.emptyFunction,this.isEnableAddContacts);this.deleteCommand=c.createCommand(this,this.executeDelete,this.isEnableDeleting);this.removeFromGroupCommand=c.createCommand(this,
this.executeRemoveFromGroup,this.isEnableRemoveContactsFromGroup);this.importCommand=c.createCommand(this,this.executeImport);this.exportCommand=c.createCommand(this,this.executeExport);this.saveCommand=c.createCommand(this,this.executeSave,function(){var a=this.selectedItem();return a?a.canBeSave():!1});this.newMessageCommand=c.createCommand(this,function(){var a=this.selector.listCheckedOrSelected(),h=[];_.isArray(a)&&0<a.length&&(h=_.map(a,function(a){return a.EmailAndName()}),h=_.compact(h),f.Api.openComposeMessage(h.join(", ")))},
function(){return 0<this.selector.listCheckedOrSelected().length});this.selector.listCheckedOrSelected.subscribe(function(a){this.oGroupModel.newContactsInGroupCount(a.length)},this);this.isLoading=this.loadingList;this.isSearch=b.computed(function(){return""!==this.search()},this);this.isEmptyList=b.computed(function(){return 0===this.collection().length},this);this.inGrooup=b.computed(function(){return e.ContactsGroupListType.SubGroup===this.selectedGroupType()},this);this.searchText=b.computed(function(){return c.i18n("CONTACTS/INFO_SEARCH_RESULT",
{SEARCH:this.search()})},this)}function s(){this.oCommon=new ma;this.oEmailAccounts=new z;this.oCalendar=new na;this.oMobileSync=new La;this.oOutLookSync=new Ma;this.tab=b.observable(e.SettingsTab.Common);this.bAllowCalendar=(this.bAllowUsersChangeInterfaceSettings=g.App.AllowUsersChangeInterfaceSettings)&&g.User.AllowCalendar;this.bAllowOutlookSync=g.User.OutlookSyncEnable;this.bAllowMobileSync=g.App.EnableMobileSync;this.folderListOrderUpdate=_.debounce(this.folderListOrderUpdate,5E3)}function ma(){this.aSkins=
g.App.Themes;this.selectedSkin=b.observable(g.User.DefaultTheme);this.layout=b.observable(g.User.Layout);this.aLanguages=g.App.Languages;this.selectedLanguage=b.observable(g.User.DefaultLanguage);this.messagesPerPage=b.observable(g.User.MailsPerPage);this.contactsPerPage=b.observable(g.User.ContactsPerPage);this.rangeOfNumbers=b.observableArray([10,20,30,50,75,100,150,200]);this.autocheckmailInterval=b.observable(g.User.autoCheckMailInterval());this.richText=b.observable(g.User.DefaultEditor);this.timeFormat=
b.observable(g.User.defaultTimeFormat());this.aDateFormats=g.App.DateFormats;this.dateFormat=b.observable(g.User.DefaultDateFormat);this.bAllowContacts=g.User.ShowContacts;this.bAllowCalendar=g.User.AllowCalendar;this.firstState=this.getState()}function z(){this.accounts=g.Accounts.Collection;this.currentAccountId=g.Accounts.currentId;this.editedAccountId=g.Accounts.editedId;this.defaultAccountId=g.Accounts.defaultId;this.oAccountProperties=new Q(this);this.oAccountSignature=new R(this);this.oAccountFilters=
new G(this);this.oAccountAutoresponder=new U(this);this.oAccountForward=new V(this);this.oAccountFolders=new Ba(this);this.tab=b.observable(e.AccountSettingsTab.Properties);this.allowUsersAddNewAccounts=g.App.AllowUsersAddNewAccounts;this.allowAutoresponderExtension=b.observable(!1);this.allowForwardExtension=b.observable(!1);this.allowSieveFiltersExtension=b.observable(!1);this.changeAccount(this.editedAccountId())}function na(){this.showWeekends=b.observable(g.User.CalendarShowWeekEnds);this.availableTimes=
b.observableArray([{text:"00:00",value:"0"},{text:"01:00",value:"1"},{text:"02:00",value:"2"},{text:"03:00",value:"3"},{text:"04:00",value:"4"},{text:"05:00",value:"5"},{text:"06:00",value:"6"},{text:"07:00",value:"7"},{text:"08:00",value:"8"},{text:"09:00",value:"9"},{text:"10:00",value:"10"},{text:"11:00",value:"11"},{text:"12:00",value:"12"},{text:"13:00",value:"13"},{text:"14:00",value:"14"},{text:"15:00",value:"15"},{text:"16:00",value:"16"},{text:"17:00",value:"17"},{text:"18:00",value:"18"},
{text:"19:00",value:"19"},{text:"20:00",value:"20"},{text:"21:00",value:"21"},{text:"22:00",value:"22"},{text:"23:00",value:"23"},{text:"24:00",value:"24"}]);this.selectedWorkdayStarts=b.observable(g.User.CalendarWorkDayStarts);this.selectedWorkdayEnds=b.observable(g.User.CalendarWorkDayEnds);this.showWorkday=b.observable(g.User.CalendarShowWorkDay);this.weekStartsOn=b.observable(g.User.CalendarWeekStartsOn);this.defaultTab=b.observable(g.User.CalendarDefaultTab);this.firstState=this.getState()}function La(){this.mobileSync=
g.User.mobileSync;this.mobileSync.subscribe(this.onMobileSyncSubscribe,this);this.enableDav=b.observable(!1);this.davLogin=b.observable("");this.davServer=b.observable("");this.davCalendars=b.observable([]);this.visibleCalendars=b.computed(function(){return 0<this.davCalendars().length},this);this.davPersonalContactsUrl=b.observable("");this.davCollectedAddressesUrl=b.observable("");this.davGlobalAddressBookUrl=b.observable("");this.bVisiblePersonalContacts=g.User.ShowPersonalContacts;this.bVisibleGlobalContacts=
g.User.ShowGlobalContacts;this.bVisibleContacts=g.User.ShowContacts;this.bVisibleCalendar=g.User.AllowCalendar;this.bVisibleIosLink=-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPod")||-1!==navigator.platform.indexOf("iPad");this.visibleDavViaUrls=b.computed(function(){return this.visibleCalendars()||this.bVisibleContacts},this);this.enableActiveSync=b.observable(!1);this.activeLogin=b.observable("");this.activeServer=b.observable("");this.password=b.observable(g.User.IsDemo?
g.User.MobileSyncDemoPass:c.i18n("SETTINGS/MOBILE_DAVSYNC_PASSWORD_VALUE"));this.bChanged=!1}function Ma(){this.outlookSync=g.User.outlookSync;this.outlookSync.subscribe(this.onOutlookSyncSubscribe,this);this.visibleOutlookSync=b.observable(!1);this.login=b.observable("");this.server=b.observable("");this.password=b.observable(g.User.IsDemo?g.User.OutlookSyncDemoPass:c.i18n("SETTINGS/OUTLOOKSYNC_PASSWORD_VALUE"));this.bChanged=!1}function Q(){this.account=b.observable(null);this.isInternal=b.observable(!0);
this.isLinked=b.observable(!0);this.isDefault=b.observable(!1);this.friendlyName=b.observable("");this.email=b.observable("");this.incomingMailLogin=b.observable("");this.incomingMailPassword=b.observable("");this.incomingMailPort=b.observable(0);this.incomingMailServer=b.observable("");this.outgoingMailLogin=b.observable("");this.outgoingMailPassword=b.observable("");this.outgoingMailPort=b.observable(0);this.outgoingMailServer=b.observable("");this.allowChangePassword=b.observable(!1);this.useSmtpAuthentication=
b.observable(!1);this.incLoginFocused=b.observable(!1);this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this);this.outServerFocused=b.observable(!1);this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this);this.account.subscribe(function(a){this.populate(a)},this);this.firstState=null}function Ba(a){this.parent=a;
this.highlighted=b.observable(!1).extend({autoResetToFalse:5E3});this.collection=b.observableArray(f.Cache.editedFolderList().collection());this.messageCount=b.computed(function(){return f.Cache.editedFolderList().messageCount()},this);this.enableButtons=b.computed(function(){return f.Cache.editedFolderList().bInitialized()},this);f.Cache.editedFolderList.subscribe(function(a){this.collection(a.collection())},this);this.addNewFolderCommand=c.createCommand(this,this.onAddNewFolderClick,this.enableButtons);
this.systemFoldersCommand=c.createCommand(this,this.onSystemFoldersClick,this.enableButtons)}function R(a){this.parent=a;this.account=b.observable(null);this.type=b.observable(!1);this.options=b.observable(0);this.signature=b.observable("");this.account.subscribe(function(){this.getSignature()},this);this.oHtmlEditor=new m(!1);this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this);g.Accounts.editedId.subscribe(function(){this.account(g.Accounts.getEdited())},this);this.getSignature();
this.firstState=null}function V(){this.account=b.observable(null);this.available=b.observable(!1);this.loading=b.observable(!1);this.enable=b.observable(!1);this.email=b.observable("");this.available=b.computed(function(){var a=this.account();return a&&a.forward()},this);this.account.subscribe(function(){this.getForward()},this);this.firstState=null}function U(){this.account=b.observable(null);this.available=b.observable(!1);this.loading=b.observable(!1);this.enable=b.observable(!1);this.subject=
b.observable("");this.message=b.observable("");this.available=b.computed(function(){var a=this.account();return a&&a.autoresponder()},this);this.account.subscribe(function(){this.getAutoresponder()},this);this.firstState=null}function G(){this.account=b.observable(null);this.folderList=b.observable(f.Cache.editedFolderList());f.Cache.editedFolderList.subscribe(function(a){this.folderList(a)},this);this.foldersOptions=b.computed(function(){return this.folderList()?this.folderList().getOptions(c.i18n("SETTINGS/ACCOUNT_FOLDERS_NOT_SELECTED"),
!0,!0):[]},this);this.available=b.observable(!1);this.loading=b.observable(!1);this.collection=b.observableArray([]);this.available=b.computed(function(){var a=this.account();return!(!a||!a.filters())},this);this.account.subscribe(function(){this.getFilters()},this);this.fieldOptions=[{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_FROM"),value:0},{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_TO"),value:1},{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_SUBJECT"),value:2}];this.conditionOptions=[{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_COND_CONTAIN_SUBSTR"),
value:0},{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_COND_EQUAL_TO"),value:1},{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_COND_NOT_CONTAIN_SUBSTR"),value:2}];this.actionOptions=[{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_MOVE"),value:3},{text:c.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_DELETE"),value:1}];this.phaseArray=[""];_.each(c.i18n("SETTINGS/ACCOUNT_FILTERS_PHRASE").split(/\s/),function(a){var d=this.phaseArray.length-1;"%"===a.substr(0,1)||"%"===this.phaseArray[d].substr(-1,1)?this.phaseArray.push(a):
this.phaseArray[d]+=" "+a},this);this.firstState=null}function Na(){this.calendarIframe=b.observable();this.calendarUrl="legacy/calendar.php";this.variableCalendarUrl=b.observable(this.calendarUrl)}function ha(){this.files=b.observableArray()}function H(){this.oScreens={};this.oScreens[e.Screens.Information]={Model:wa,TemplateName:"Common_InformationViewModel"};this.oScreens[e.Screens.Login]={Model:sa,TemplateName:"Login_LoginViewModel"};this.oScreens[e.Screens.Header]={Model:ra,TemplateName:"Common_HeaderViewModel"};
this.oScreens[e.Screens.Mailbox]={Model:ba,TemplateName:"Mail_LayoutSidePane_MailViewModel"};this.oScreens[e.Screens.BottomMailbox]={Model:ba,TemplateName:"Mail_LayoutBottomPane_MailViewModel"};this.oScreens[e.Screens.SingleMessageView]={Model:p,TemplateName:"Mail_LayoutSidePane_MessagePaneViewModel"};this.oScreens[e.Screens.Compose]={Model:l,TemplateName:"Mail_ComposeViewModel"};this.oScreens[e.Screens.SingleCompose]={Model:l,TemplateName:"Mail_ComposeViewModel"};this.oScreens[e.Screens.Settings]=
{Model:s,TemplateName:"Settings_SettingsViewModel"};this.oScreens[e.Screens.Contacts]={Model:n,TemplateName:"Contacts_ContactsViewModel"};this.oScreens[e.Screens.Calendar]={Model:Na,TemplateName:"Calendar_CalendarViewModel"};this.oScreens[e.Screens.FileStorage]={Model:ha,TemplateName:"FileStorage_FileStorageViewModel"};this.currentScreen=b.observable("");this.popupVisibility=b.observable(!1);this.informationScreen=b.observable(null);this.popups=[]}function k(){this.currentAccountId=g.Accounts.currentId;
this.currentAccountId.subscribe(function(a){var d=g.Accounts.getAccount(a),h=this.oFolderListItems[a],a={Action:"FolderList",AccountID:a};d&&(_.delay(_.bind(d.updateQuotaParams,d),5E3),this.messagesLoading(!0),h?this.folderList(h):(this.folderList(new F),this.messages([]),this.currentMessage(null),f.Ajax.send(a,this.onFolderListResponse,this)))},this);this.editedAccountId=g.Accounts.editedId;this.editedAccountId.subscribe(function(a){var d=this.oFolderListItems[a],h={};d?this.editedFolderList(d):
this.currentAccountId()!==a&&(this.editedFolderList(new F),h={Action:"FolderList",AccountID:a},f.Ajax.send(h,this.onFolderListResponse,this))},this);this.oFolderListItems={};this.quotaChangeTrigger=b.observable(!1);this.checkMailStarted=b.observable(!1);this.folderList=b.observable(new F);this.editedFolderList=b.observable(new F);this.newMessagesCount=b.computed(function(){var a=this.folderList().inboxFolder();return a?a.unseenMessageCount():0},this);this.messages=b.observableArray([]);this.uidList=
b.observable(new va);this.page=b.observable(1);this.messagesLoading=b.observable(!0);this.messagesLoadingError=b.observable(!1);this.currentMessage=b.observable(null);this.aResponseHandlers=[]}function ta(){this.contacts={};this.responseHandlers={};this.vcardAttachments=[];this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500})}function oa(){this.calendars=b.observableArray([]);this.icalAttachments=[];this.recivedAnim=b.observable(!1).extend({autoResetToFalse:500})}function L(){this.Ajax=
new W;this.Routing=new M;this.Screens=new H;this.Links=new X;this.Api=new da;this.MessageSender=new I;this.Prefetcher=new Y;this.Cache=null;this.ContactsCache=new ta;this.EventsCache=new oa;this.Storage=new Ha;this.$downloadIframe=null;this.currentScreen=this.Screens.currentScreen;this.currentScreen.subscribe(this.setTitle,this);this.focused=b.observable(!0);this.focused.subscribe(this.setTitle,this);this.init();this.newMessagesCount=this.Cache.newMessagesCount;this.newMessagesCount.subscribe(this.setTitle,
this);this.currentMessage=this.Cache.currentMessage;this.currentMessage.subscribe(this.setTitle,this);this.initHeaderInfo()}var e={},c={},Ua=j.pSevenI18N||{},f={},g=j.pSevenAppData||{},Oa=-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad"),Va=-1<navigator.userAgent.toLowerCase().indexOf("android"),Wa=Oa||Va;W.prototype.isAllowedOnLoginAction=function(a){return"Login"===a||"LoginLanguageUpdate"===a||"Logout"===a};W.prototype.send=
function(a,d,h){if(a&&(g.Auth||this.isAllowedOnLoginAction(a.Action))){var b=_.bind(this.done,this,a,d,h),d=_.bind(this.fail,this,a,d,h),h=_.bind(this.always,this,a),c=g.Token,f=null;void 0===a.AccountID&&"Login"!==a.Action&&(a.AccountID=g.Accounts.currentId());c&&(a.Token=c);this.abortRequests(a);f=i.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:a,success:b,error:d,complete:h});this.aRequests.push({Parameters:a,Xhr:f})}};W.prototype.abortRequests=function(a){switch(a.Action){case "MessageMove":case "MessageDelete":this.abortRequestByActionName("MessageList",
a.Folder);this.abortRequestByActionName("Message");break;case "MessageList":case "FolderClear":this.abortRequestByActionName("MessageList",a.Folder);break;case "ContactList":case "GlobalContactList":this.abortRequestByActionName("ContactList");this.abortRequestByActionName("GlobalContactList");break;case "Contact":case "GlobalContact":this.abortRequestByActionName("Contact"),this.abortRequestByActionName("GlobalContact")}};W.prototype.abortRequestByActionName=function(a,d){_.each(this.aRequests,function(h,
b){if(h&&h.Parameters.Action===a&&("MessageList"!==a||d===h.Parameters.Folder))h.Xhr.abort(),this.aRequests[b]=void 0},this);this.aRequests=_.compact(this.aRequests)};W.prototype.abortAllRequests=function(){_.each(this.aRequests,function(a){a&&a.Xhr.abort()},this);this.aRequests=[]};W.prototype.done=function(a,d,h,b){var c=!0,t=this.isAllowedOnLoginAction(a.Action),Ta=g.Accounts.hasAccountWithId(a.AccountID),i=a.AccountID===g.Accounts.defaultId();if(t||Ta){if(b&&!b.Result)switch(b.ErrorCode){case e.Errors.InvalidToken:t||
(f.tokenProblem(),c=!1);break;case e.Errors.AuthError:i&&(!t&&"AccountCreate"!==a.Action)&&(this.abortAllRequests(),f.authProblem(),c=!1)}c&&"function"===typeof d&&d.apply(h,[b,a])}};W.prototype.fail=function(a,d,h,b,v,e){b={Result:!1};switch(v){case "abort":break;default:case "error":case "parseerror":""!==e&&(f.Api.showError(c.i18n("WARNING/DATA_TRANSFER_FAILED")),"function"===typeof d&&d.apply(h,[b,a]))}};W.prototype.always=function(a){_.each(this.aRequests,function(d,h){d&&_.isEqual(d.Parameters,
a)&&(this.aRequests[h]=void 0)},this);this.aRequests=_.compact(this.aRequests)};e.Screens={Login:"login",Information:"information",Header:"header",Mailbox:"mailbox",BottomMailbox:"bottommailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files"};e.MailboxLayout={Side:0,Bottom:1};e.TimeFormat={F24:0,F12:1};e.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,
DemoLimitations:106,CanNotGetMessage:202,ImapQuota:205,MailServerError:901};e.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,System:9,User:10};e.LoginFormType={Email:0,Login:1,Both:2};e.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2};e.ReplyType={Reply:"reply",ReplyAll:"reply-all",Forward:"forward"};e.Importance={Low:5,Normal:3,High:1};e.Sensivity={Nothing:0,Confidential:1,Private:2,Personal:3};e.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"};e.ContactSortType=
{Email:"Email",Name:"Name",Frequency:"Frequency"};e.SaveMail={Hidden:0,Checked:1,Unchecked:2};e.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobilesync",OutLookSync:"outlooksync"};e.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders"};e.ContactsGroupListType={Personal:0,SubGroup:1,Global:2};e.IcalType={Request:"REQUEST",Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"};
e.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"};e.Key={Tab:9,Enter:13,Shift:16,Ctrl:17,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Del:46,a:65,c:67,n:78,p:80,r:82,s:83,F5:116,Comma:188,Dot:190};b.bindingHandlers.command={init:function(a,d,h,u){var c=i(a),f=d();if(!f||!f.enabled||!f.canExecute)throw Error("You are not using command function");c.addClass("command");b.bindingHandlers[c.is("form")?"submit":"click"].init.apply(u,arguments)},
update:function(a,d){var h=!0,b=i(a),c=d(),h=c.enabled();b.toggleClass("command-not-enabled",!h);h&&(h=c.canExecute(),b.toggleClass("unavailable",!h));b.toggleClass("command-disabled disable disabled",!h);b.toggleClass("command-disabled",!h)}};b.bindingHandlers.onEnter={init:function(a,d,h,c){b.bindingHandlers.event.init(a,function(){return{keyup:function(h,b){b&&13===j.parseInt(b.keyCode,10)&&(i(a).trigger("change"),d().call(this,h))}}},h,c)}};b.bindingHandlers.onCtrlEnter={init:function(a,d,h,c){b.bindingHandlers.event.init(a,
function(){return{keyup:function(h,b){b&&(13===j.parseInt(b.keyCode,10)&&b.ctrlKey)&&(i(a).trigger("change"),d().call(this,h))}}},h,c)}};b.bindingHandlers.onEsc={init:function(a,d,h,c){b.bindingHandlers.event.init(a,function(){return{keyup:function(h,b){b&&27===j.parseInt(b.keyCode,10)&&(i(a).trigger("change"),d().call(this,h))}}},h,c)}};b.bindingHandlers.onFocusSelect={init:function(a,d,h,c){b.bindingHandlers.event.init(a,function(){return{focus:function(){a.select()},mouseup:function(){return!1}}},
h,c)}};b.bindingHandlers.onFocusMoveCaretToEnd={init:function(a,d,h,u){b.bindingHandlers.event.init(a,function(){return{focus:function(){c.moveCaretToEnd(a)}}},h,u)}};b.bindingHandlers.onEnterChange={init:function(a,d,h,c){b.bindingHandlers.event.init(a,function(){return{keyup:function(d,h){h&&13===j.parseInt(h.keyCode,10)&&i(a).trigger("change")}}},h,c)}};b.bindingHandlers.jhasfocus={init:function(a,d){i(a).on("focus",function(){d()(!0)}).on("blur",function(){d()(!1)})},update:function(a,d){b.utils.unwrapObservable(d())?
i(a).is(":focus")||i(a).focus():i(a).is(":focus")&&i(a).blur()}};b.bindingHandlers.fadeIn={update:function(a,d){b.utils.unwrapObservable(d())&&i(a).hide().fadeIn("fast")}};b.bindingHandlers.i18n={init:function(a,d){var h=i(a).data("i18n"),h=h?c.i18n(h):h;if(""!==h)switch(d()){case "value":i(a).val(h);break;case "text":i(a).text(h);break;case "html":i(a).html(h);break;case "title":i(a).attr("title",h);break;case "placeholder":i(a).attr({placeholder:h})}}};b.bindingHandlers.link={init:function(a,d){i(a).attr("href",
b.utils.unwrapObservable(d()))}};b.bindingHandlers.title={init:function(a,d){i(a).attr("title",b.utils.unwrapObservable(d()))}};b.bindingHandlers.fadeOut={update:function(a,d){b.utils.unwrapObservable(d())&&i(a).fadeOut()}};b.bindingHandlers.initDom={init:function(a,d){if(d())if(_.isArray(d()))for(var h=d(),b=h.length-1;0<=b;b--)h[b](i(a));else d()(i(a))}};b.bindingHandlers.customScrollbar={init:function(a,d){var h=i(a),b=d();h.addClass("scroll-wrap").customscroll(b);c.isUnd(b.reset)||(a._customscroll_reset=
_.throttle(function(){h.data("customscroll").reset()},100))},update:function(a){a._customscroll_reset&&a._customscroll_reset()}};b.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(a,d,h,c,f){for(var e=c=0,g=b.utils.arrayMap(b.utils.arrayFilter(a.childNodes,function(a){return a.tagName&&"OPTION"===a.tagName&&a.selected}),function(a){return b.selectExtensions.readValue(a)||a.innerText||a.textContent}),i=a.scrollTop,d=b.utils.unwrapObservable(d());0<
a.length;)b.cleanNode(a.options[0]),a.remove(0);if(d){"number"!==typeof d.length&&(d=[d]);h=h().optionsBind;c=0;for(e=d.length;c<e;c++){var D=document.createElement("OPTION"),w=b.utils.unwrapObservable(d[c]);b.selectExtensions.writeValue(D,w);D.appendChild(document.createTextNode(w));a.appendChild(D);h&&(D.setAttribute("data-bind",h),b.applyBindings(f.createChildContext(w),D))}f=a.getElementsByTagName("OPTION");d=0;h=0<=navigator.userAgent.indexOf("MSIE 6");c=0;for(e=f.length;c<e;c++)0<=b.utils.arrayIndexOf(g,
b.selectExtensions.readValue(f[c]))&&(h?f[c].setAttribute("selected",!0):f[c].selected=!0,d++);a.scrollTop=i;d<g.length&&b.utils.triggerEvent(a,"change")}}};b.bindingHandlers.splitter={init:function(a,d){var h=i(a),b=d();setTimeout(function(){h.splitter(_.defaults(b,{name:"",sizeLeft:200,minLeft:20,minRight:40}))},1)}};b.bindingHandlers.dropdown={init:function(a,d,h,b){var f=i(a),e=_.defaults(d(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",passClick:!0}),a=e.control?
f.find(".control"):f,g=i(document);e.passClick||f.find(e.container).click(function(a){a.stopPropagation()});f.removeClass(e.expand);e.close&&e.close.subscribe&&e.close.subscribe(function(a){a||(g.unbind("click.dropdown"),f.removeClass(e.expand))});a.click(function(){f.hasClass(e.disabled)||(f.toggleClass(e.expand),f.hasClass(e.expand)&&(c.isUnd(e.callback)||e.callback.call(b),e.close&&e.close.subscribe&&e.close(!0),_.defer(function(){g.one("click.dropdown",function(){e.close&&e.close.subscribe&&e.close(!1);
f.removeClass(e.expand)})})))})}};b.bindingHandlers.customSelect={init:function(a,d,h,b){var f=i(a),e=_.defaults(d(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0}),g=[],a=e.control?f.find(".control"):f,q=f.find(".dropdown_content"),D=f.find(".link");_.each(e.options,function(a){a=i('<span class="item"></span>').text(a[e.optionsText]).data("value",a[e.optionsValue]);g.push(a);q.append(a)},this);q.on("click",".item",function(){var a=i(this).data("value");e.value(a)});e.value&&
e.value.subscribe&&(e.value.subscribe(function(){var a,d=e.value();_.each(g,function(a){a.removeClass(e.selected)});a=_.find(e.options,function(a){return a[e.optionsValue]===d});c.isUnd(a)&&(a=e.options[0]);g[_.indexOf(e.options,a)].addClass(e.selected);D.text(i.trim(a[e.optionsText]));a=a[e.optionsValue];e.value()!==a&&e.value(a)},b),e.value.valueHasMutated());f.removeClass(e.expand);a.click(function(){if(!f.hasClass(e.disabled)){f.toggleClass(e.expand);f.hasClass(e.expand)&&_.defer(function(){i(document).one("click",
function(){f.removeClass(e.expand)})})}})}};b.bindingHandlers.moveToFolderFilter={init:function(a,d){var h=i(a),b=_.defaults(d(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),c=b.control?h.find(".control"):h,f=h.find(b.container),e=h.find(".link"),g=_.isArray(b.options)?b.options:b.options();h.removeClass(b.expand);b.value&&b.value.subscribe&&(b.value.subscribe(function(a){var d=_.find(g,function(d){return d[b.optionsValue]===a});d||(d=_.find(g,function(a){return""===
a[b.optionsValue]}))&&""!==a&&b.value("");d&&e.text(i.trim(d[b.optionsText]))}),b.value.valueHasMutated());f.on("click",".item",function(){var a=i(this).data("value");b.value(a)});c.click(function(){if(!h.hasClass(b.disabled)){h.toggleClass(b.expand);h.hasClass(b.expand)&&_.defer(function(){i(document).one("click",function(){h.removeClass(b.expand)})})}})},update:function(a,d){var h=_.defaults(d(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),b=i(a).find(h.container),
c=_.isArray(h.options)?h.options:h.options(),f=h.value?h.value():"";b.empty();_.each(c,function(a){var d=i('<span class="item"></span>').text(a[h.optionsText]).data("value",a[h.optionsValue]);f===a[h.optionsValue]&&d.addClass("selected");b.append(d)})}};b.bindingHandlers.contactcard={init:function(a,d){var h=i(a),b=!1,c=_.defaults(d(),{disabled:"disabled",expand:"expand",control:!0}),f=c.control?h.find(".control"):h;h.removeClass(c.expand);f.bind("mouseover",function(){h.hasClass(c.disabled)||(b=
!0,setTimeout(function(){b&&h.addClass(c.expand)},200))});f.bind("mouseout",function(){b=!1;setTimeout(function(){b||h.removeClass(c.expand)},200)})}};var Ca=null,Da=null,ia=null;b.bindingHandlers.checkmail={update:function(a,d){var h=d(),b=h.state;void 0!==h.state&&(Da||(Da=i(a)),Ca||(Ca=_.defaults(h,{activeClass:"process",duration:800})),c.deferedUpdate(Da,b,Ca.duration,function(a,d){if(i.browser.msie&&9>=c.pInt(i.browser.version))if(ia||(ia=Da.find(".icon")),!ia.__intervalIE&&d){var h=0,b="";ia.__intervalIE=
setInterval(function(){b="0px -"+20*h+"px";h=7>h?h+1:0;ia.css({"background-position":b})},1E3/12)}else ia.css({"background-position":"0px 0px"}),clearInterval(ia.__intervalIE),ia.__intervalIE=null;else a.toggleClass(Ca.activeClass,d)}))}};var ca=null,Ea=null,ua=null,y=null,Fa={saveAction:null,sendAction:null,activeAction:null};b.bindingHandlers.quickReplyAnim={update:function(a,d){var h=d(),b=null,b=_.defaults(h,{saveAction:!1,sendAction:!1,activeAction:!1});y||(y=i(a),ca=y.find("textarea"),Ea=y.find(".status"),
ua=y.find(".buttons"));y.is(":visible")&&(i.browser.msie&&9>=c.pInt(i.browser.version)?(ca&&(!y.defualtHeight&&!ca.defualtHeight)&&(y.defualtHeight=y.outerHeight(),ca.defualtHeight=ca.outerHeight(),Ea.defualtHeight=ua.outerHeight(),ua.defualtHeight=ua.outerHeight()),_.defer(function(){var a=Fa.sendAction!==b.sendAction,d=Fa.saveAction!==b.saveAction;if(Fa.activeAction!==b.activeAction)if(b.activeAction){ca.animate({height:ca.defualtHeight+50},300);y.animate({"max-height":y.defualtHeight+ua.defualtHeight+
50},300)}else{ca.animate({height:ca.defualtHeight},300);y.animate({"max-height":y.defualtHeight},300)}if(a||d)if(b.sendAction){y.animate({"max-height":"30px"},300);Ea.animate({"max-height":"30px",opacity:1},300)}else if(b.saveAction)y.animate({"max-height":0},300);else{y.animate({"max-height":y.defualtHeight+ua.defualtHeight+50},300);Ea.animate({"max-height":0,opacity:0},300)}})):(y.toggleClass("saving",b.saveAction),y.toggleClass("sending",b.sendAction),y.toggleClass("active",b.activeAction)));_.defer(function(){Fa=
b})}};b.extenders.reversible=function(a){var d=a();a.commit=function(){d=a()};a.revert=function(){a(d)};a.commitedValue=function(){return d};a.changed=function(){return d!==a()};return a};b.extenders.autoResetToFalse=function(a,d){a.iTimeout=0;a.subscribe(function(h){h&&(j.clearTimeout(a.iTimeout),a.iTimeout=j.setTimeout(function(){a.iTimeout=0;a(!1)},c.pInt(d)))});return a};c.createCommand=function(a,d,h){var u=d?function(){return u.canExecute&&u.canExecute()?d.apply(a,Array.prototype.slice.call(arguments)):
!1}:function(){};u.enabled=b.observable(!0);h=c.isUnd(h)?!0:h;u.canExecute=c.isFunc(h)?b.computed(function(){return u.enabled()&&h.call(a)}):b.computed(function(){return u.enabled()&&!!h});return u};b.bindingHandlers.autocomplete={init:function(a,d){var h=d(),b=i(a);h&&(b&&b[0])&&b.autocomplete({minLength:1,source:function(a,d){h(a.term.split(/,\s*/).pop(),d)},search:function(){return 1>this.value.split(/,\s*/).pop().length?!1:!0},focus:function(){return!1},select:function(a,d){var h=this.value.split(/,\s*/);
h.pop();h.push(d.item.value);h.push("");this.value=h.join(", ").slice(0,-2);b.trigger("change");var h=b[0],c=h.value.length;h.blur();h.focus();h.setSelectionRange&&h.setSelectionRange(c,c);return!1}})}};b.bindingHandlers.draggablePlace={init:function(a,d,h,u){i(a).draggable({distance:20,handle:".dragHandle",cursorAt:{top:22,left:3},helper:function(a){return d().call(u,a&&a.target?b.dataFor(a.target):null)}}).on("mousedown",function(){c.removeActiveFocus()})}};b.bindingHandlers.droppable={init:function(a,
d){var h=d();!1!==h&&i(a).droppable({hoverClass:"droppableHover",drop:function(a,d){h(a,d)}})}};M.prototype.init=function(){ja.initialized.removeAll();ja.changed.removeAll();ja.initialized.add(this.parseRouting,this);ja.changed.add(this.parseRouting,this);ja.init()};M.prototype.finalize=function(){ja.initialized.removeAll();ja.changed.removeAll();this.setHashFromString("")};M.prototype.setHashFromString=function(a){location.hash!==a&&(location.hash=a)};M.prototype.replaceHashFromString=function(a){location.hash!==
a&&location.replace(a)};M.prototype.setHash=function(a){this.setHashFromString(this.buildHashFromArray(a))};M.prototype.replaceHash=function(a){this.replaceHashFromString(this.buildHashFromArray(a))};M.prototype.setLastMailboxHash=function(){this.setHashFromString(this.lastMailboxRouting)};M.prototype.setPreviousHash=function(){location.hash=this.previousHash};M.prototype.buildHashFromArray=function(a){var d=0,h=0,h="";if(_.isArray(a))for(h=a.length;d<h;d++)a[d]=encodeURIComponent(a[d]);else a=[encodeURIComponent(a.toString())];
h=a.join("/");""!==h&&(h="#"+h);return h};M.prototype.getHashFromHref=function(){var a=location.href.indexOf("#"),d="";-1!==a&&(d=location.href.substr(a+1));return d};M.prototype.parseRouting=function(){var a=this.getHashFromHref(),d=a.split("/"),h=decodeURIComponent(d.shift())||e.Screens.Mailbox,b=0,c=d.length;h===e.Screens.Mailbox&&(this.lastMailboxRouting=a);this.previousHash=this.currentHash;for(this.currentHash=a;b<c;b++)d[b]=decodeURIComponent(d[b]);switch(h){case e.Screens.SingleMessageView:case e.Screens.SingleCompose:g.SingleMode=
!0;f.Screens.showCurrentScreen(h,d);break;case e.Screens.Compose:case e.Screens.Contacts:case e.Screens.Calendar:case e.Screens.FileStorage:case e.Screens.Settings:g.SingleMode=!1;f.Screens.showNormalScreen(e.Screens.Header);f.Screens.showCurrentScreen(h,d);break;default:case e.Screens.Mailbox:g.SingleMode=!1,f.Screens.showNormalScreen(e.Screens.Header),g.User.Layout===e.MailboxLayout.Side?f.Screens.showCurrentScreen(e.Screens.Mailbox,d):f.Screens.showCurrentScreen(e.Screens.BottomMailbox,d)}this.resizeAll()};
X.prototype.mailbox=function(a,d,h,b){var f=[e.Screens.Mailbox],d=c.isNormal(d)?c.pInt(d):1,h=c.isNormal(h)?c.pString(h):"",b=c.isNormal(b)?c.pString(b):"";a&&""!==a&&f.push(a);1<d&&f.push("p"+d);h&&""!==h&&f.push("msg"+h);b&&""!==b&&f.push(b);return f};X.prototype.inbox=function(){return this.mailbox()};X.prototype.parseMailbox=function(a){var d="INBOX",h=1,b="",f="",e="";if(0<a.length&&(c.isNormal(a[0])&&(d=c.pString(a[0])),a[1]&&(e=c.pString(a[1]),this.isPageParam(e)?(h=c.pInt(e.substr(1)),0>=
h&&(h=1)):this.isMsgParam(e)?b=e.substr(3):f=e),""===f))a[2]&&(e=c.pString(a[2]),this.isMsgParam(e)?b=e.substr(3):f=e),a[3]&&(f=c.pString(a[3]));return{Folder:d,Page:h,Uid:b,Search:f}};X.prototype.isPageParam=function(a){return"p"===a.substr(0,1)&&/^[1-9][\d]*$/.test(a.substr(1))};X.prototype.isMsgParam=function(a){return"msg"===a.substr(0,3)&&/^[1-9][\d]*$/.test(a.substr(3))};X.prototype.compose=function(){return[g.SingleMode?e.Screens.SingleCompose:e.Screens.Compose]};X.prototype.composeFromMessage=
function(a,d,h){return[g.SingleMode?e.Screens.SingleCompose:e.Screens.Compose,a,d,h]};X.prototype.composeWithToField=function(a){return[g.SingleMode?e.Screens.SingleCompose:e.Screens.Compose,"to",a]};I.prototype.setReplyData=function(a,d){this.replyText(a);this.replyDraftUid(d)};I.prototype.send=function(a,d,h,b,e,g,i){var q="",D=f.Cache.folderList().sentFolderFullName(),j=f.Cache.folderList().draftsFolderFullName();d.Action=a;d.IsHtml="1";d.ShowReport=b;switch(a){case "MessageSend":q=c.i18n("COMPOSE/INFO_SENDING");
h&&(d.SentFolder=D);""!==d.DraftUid&&(d.DraftFolder=j);break;case "MessageSave":q=c.i18n("COMPOSE/INFO_SAVING"),d.DraftFolder=j}b&&f.Api.showLoading(q);i?this.postponedMailData={Parameters:d,MessageSendResponseHandler:e,MessageSendResponseContext:g}:f.Ajax.send(d,e,g)};I.prototype.sendPostponedMail=function(a){var d=this.postponedMailData,h=f.Cache.folderList().draftsFolderFullName();""!==a&&(d.Parameters.DraftUid=a,d.Parameters.DraftFolder=h);this.postponedMailData&&(f.Ajax.send(d.Parameters,d.MessageSendResponseHandler,
d.MessageSendResponseContext),this.postponedMailData=null)};I.prototype.sendReplyMessage=function(a,d,h,b,c){var t=null;f.Cache.currentMessage()&&(t=this.getReplyDataFromMessage(f.Cache.currentMessage(),e.ReplyType.ReplyAll,g.Accounts.currentId(),d,h),t.Bcc="",t.Importance=e.Importance.Normal,t.Sensivity=e.Sensivity.Nothing,t.ReadingConfirmation="0",t.Attachments=this.convertAttachmentsForSending(t.Attachments),this.send(a,t,g.User.getSaveMailInSentItems(),!1,b,c))};I.prototype.convertAttachmentsForSending=
function(a){var d={};_.each(a,function(a){d[a.tempName()]=[a.fileName(),a.cid(),a.inline()?"1":"0",a.linked()?"1":"0"]});return d};I.prototype.onMessageSendResponse=function(a,d){var h=g.SingleMode?j.opener.App:f,b=!!a.Result,e,t,i;f.Api.hideLoading();switch(d.Action){case "MessageSave":b?(d.ShowReport&&f.Api.showReport(c.i18n("COMPOSE/REPORT_MESSAGE_SAVED")),a.Result.NewUid||(g.App.AutoSave=!1)):d.ShowReport&&f.Api.showError(c.i18n("COMPOSE/ERROR_MESSAGE_SAVING"));break;case "MessageSend":b?(h.Api.showReport(c.i18n("COMPOSE/REPORT_MESSAGE_SENT")),
_.isArray(d.DraftInfo)&&3===d.DraftInfo.length&&(i=d.DraftInfo[0],t=d.DraftInfo[1],e=d.DraftInfo[2],f.Cache.markMessageReplied(d.AccountID,e,t,i))):f.Api.showError(c.i18n("COMPOSE/ERROR_MESSAGE_SENDING")),d.SentFolder&&h.Cache.removeMessagesFromCacheForFolder(d.SentFolder)}d.DraftFolder&&h.Cache.removeMessagesFromCacheForFolder(d.DraftFolder);return{Action:d.Action,Result:b,NewUid:a.Result?a.Result.NewUid:""}};I.prototype.getReplyDataFromMessage=function(a,d,h,b,f){var g={DraftInfo:[],DraftUid:"",
To:"",Cc:"",Subject:"",Attachments:[],InReplyTo:a.messageId(),References:this.getReplyReferences(a)};if(!b||""===b)b=this.replyText(),this.replyText("");g.Text=b+this.getReplyMessageBody(a,h);f?g.DraftUid=f:(g.DraftUid=this.replyDraftUid(),this.replyDraftUid(""));switch(d){case e.ReplyType.Reply:g.DraftInfo=[e.ReplyType.Reply,a.uid(),a.folder()];g.To=a.oFrom.getFull();g.Subject=this.replySubjectAdd(c.i18n("COMPOSE/REPLY_PREFIX"),a.subject());g.Attachments=_.filter(a.attachments(),function(a){return a.linked()});
break;case e.ReplyType.ReplyAll:g.DraftInfo=[e.ReplyType.ReplyAll,a.uid(),a.folder()];g.To=a.oFrom.getFull();g.Cc=this.getReplyAllCcAddr(a,h);g.Subject=this.replySubjectAdd(c.i18n("COMPOSE/REPLY_PREFIX"),a.subject());g.Attachments=_.filter(a.attachments(),function(a){return a.linked()});break;case e.ReplyType.Forward:g.DraftInfo=[e.ReplyType.Forward,a.uid(),a.folder()],g.Subject=this.replySubjectAdd(c.i18n("COMPOSE/FORWARD_PREFIX"),a.subject()),g.Attachments=a.attachments()}return g};I.prototype.getReplyReferences=
function(a){var d=a.references(),a=a.messageId();-1===d.indexOf(a)&&(d+=" "+a);return d};I.prototype.getReplyMessageBody=function(a,d){var h=a.getDomText(),h=0<h.length?h.html():"",b=c.encodeHtml(a.oCc.getFull()),b=""!==b?c.i18n("COMPOSE/REPLY_MESSAGE_BODY_CC",{CCADDR:b}):"",b=c.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{FROMADDR:c.encodeHtml(a.oFrom.getFull()),TOADDR:c.encodeHtml(a.oTo.getFull()),CCPART:b,FULLDATE:a.oDateModel.getFullDate(),SUBJECT:a.subject()}),f=g.Accounts.getAccount(d).signature();return"<br /><br />"+
(f&&f.options()?f.signature()+"<br />":"")+"<blockquote>"+b+"<br /><br />"+h+"</blockquote>"};I.prototype.getReplyAllCcAddr=function(a,d){var h=new K,b=_.union(a.oTo.aCollection,a.oCc.aCollection,a.oBcc.aCollection),c=_.find(g.Accounts.Collection(),function(a){return a.id()===d},this),f=new fa;f.sEmail=c.email();h.addCollection(b);h.excludeCollection(_.union(a.oFrom.aCollection,[f]));return h.getFull()};I.prototype.replySubjectAdd=function(a,d){var h=null,b=c.trim(d);null!==(h=(new j.RegExp("^"+a+
"[\\s]?\\:(.*)$","gi")).exec(d))&&!c.isUnd(h[1])?b=a+"[2]: "+h[1]:null!==(h=(new j.RegExp("^("+a+"[\\s]?[\\[\\(]?)([\\d]+)([\\]\\)]?[\\s]?\\:.*)$","gi")).exec(d))&&!c.isUnd(h[1])&&!c.isUnd(h[2])&&!c.isUnd(h[3])?(c.pInt(h[2]),b=h[1]+(c.pInt(h[2])+1)+h[3]):b=a+": "+d;return b};I.prototype.getHtmlFromText=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")};Y.prototype.init=function(){setInterval(_.bind(function(){this.prefetchStarted(!1);
this.start()},this),2E3)};Y.prototype.start=function(){!g.SingleMode&&(g.App.AllowPrefetch&&!f.Ajax.hasOpenedRequests&&!this.prefetchStarted())&&(this.startMessagesPrefetch(),this.startOtherPagesPrefetch(),this.startOtherFoldersPrefetch())};Y.prototype.startOtherPagesPrefetch=function(){var a=f.Cache.folderList().currentFolder();this.startPagePrefetch(a,f.Cache.page()+1);this.startPagePrefetch(a,f.Cache.page()-1)};Y.prototype.startPagePrefetch=function(a,d){if(!this.prefetchStarted()&&a){var h=f.Cache.uidList(),
b=(d-1)*g.User.MailsPerPage,b=0<d&&b<h.searchCount(),h={folder:a.fullName(),page:d,search:h.search()},c=null;b&&!a.hasListBeenRequested(h)&&(c=f.Cache.requestMessageList(h.folder,h.page,h.search,!1))&&c.RequestStarted&&this.prefetchStarted(!0)}};Y.prototype.startOtherFoldersPrefetch=function(){if(!this.prefetchStarted()){var a=f.Cache.folderList().sentFolder(),d=f.Cache.folderList().draftsFolder(),h=f.Cache.folderList().inboxFolder(),b=h?h.subfolders():[],c=_.filter(f.Cache.folderList().collection(),
function(a){return!a.isSystem()},this),e=_.union(b,c),b=0<e.length?e[0]:null,c=1<e.length?e[1]:null,e=2<e.length?e[2]:null;this.startFolderPrefetch(h);this.startFolderPrefetch(a);this.startFolderPrefetch(d);this.startFolderPrefetch(b);this.startFolderPrefetch(c);this.startFolderPrefetch(e)}};Y.prototype.startFolderPrefetch=function(a){if(!this.prefetchStarted()&&a){var d={folder:a.fullName(),page:1,search:""},b=null;a.hasListBeenRequested(d)||(b=f.Cache.requestMessageList(d.folder,d.page,d.search,
!1))&&b.RequestStarted&&this.prefetchStarted(!0)}};Y.prototype.startMessagesPrefetch=function(){var a=f.Cache.currentAccountId(),d=f.Cache.getCurrentFolder(),b=0,c=g.App.MaxPrefetchBodiesSize,e=[],t=null,t=function(a){var f=!a.deleted()&&!a.completelyFilled(),g=!_.find(e,function(d){return d===a.uid()},this),t=!d.hasUidBeenRequested(a.uid());b<c&&(f&&g&&t)&&(e.push(a.uid()),b+=a.textSize()+2048)};d&&(d.selected()&&!this.prefetchStarted())&&(_.each(f.Cache.messages(),t),_.each(d.oMessages,t),0<e.length&&
(d.addRequestedUids(e),t={AccountID:a,Action:"Messages",Folder:d.fullName(),Uids:e},f.Ajax.send(t,this.onPrefetchResponse,this),this.prefetchStarted(!0)))};Y.prototype.onPrefetchResponse=function(a,d){var b=f.Cache.getFolderByFullName(d.AccountID,d.Folder);_.isArray(a.Result)&&_.each(a.Result,function(d){var c=d.Uid.toString(),e=b.oMessages[c]||new B;e.parse(d,a.AccountID);b.oMessages[c]=e})};c.inArray=i.inArray;c.isFunc=i.isFunction;c.trim=i.trim;c.emptyFunction=function(){};c.isUnd=function(a){return void 0===
a};c.isNull=function(a){return null===a};c.isNormal=function(a){return!c.isUnd(a)&&!c.isNull(a)};c.isNumeric=function(a){return c.isNormal(a)?/^[1-9]+[0-9]*$/.test(a.toString()):!1};c.pInt=function(a){return c.isNormal(a)&&""!==a?j.parseInt(a,10):0};c.pString=function(a){return c.isNormal(a)?a.toString():""};c.isNonEmptyArray=function(a){return _.isArray(a)&&0<a.length};c.pImport=function(a,d,b){a[d]=b};c.pExport=function(a,d,b){return c.isUnd(a[d])?b:a[d]};c.encodeHtml=function(a){return a?a.toString().replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""};c.i18n=function(a,d,b,e){var f="",a=Ua[a]||(c.isNormal(b)?b:a);c.isUnd(e)||(e=c.getPlural(g.User.DefaultLanguage,e),a=(b=a.split("|"))&&b[e]?b[e]:b&&b[0]?b[0]:a);if(!c.isUnd(d)&&!c.isNull(d))for(f in d)d.hasOwnProperty(f)&&(a=a.replace("%"+f+"%",d[f]));return a};c.roundNumber=function(a,d){return Math.round(a*Math.pow(10,d))/Math.pow(10,d)};c.friendlySize=function(a){a=c.pInt(a);return 1073741824<=
a?c.roundNumber(a/1073741824,1)+c.i18n("MAIN/GIGABYTES"):1048576<=a?c.roundNumber(a/1048576,1)+c.i18n("MAIN/MEGABYTES"):1024<=a?c.roundNumber(a/1024,0)+c.i18n("MAIN/KILOBYTES"):a+c.i18n("MAIN/BYTES")};var Ga={};c.timeOutAction=function(a,d,b){c.isUnd(Ga[a])&&(Ga[a]=0);j.clearTimeout(Ga[a]);Ga[a]=j.setTimeout(d,b)};c.log=function(){};c.getEmailParts=function(a){for(var d=a.indexOf('"'),b=a.indexOf('"',d+1),c=a.indexOf("<",b),e=-1,f=-1,g="",f="";-1!==c;)e=c,c=a.indexOf("<",c+1);c=e;f=a.indexOf(">",
c+1);-1===c?f=i.trim(a):(g=-1===d?i.trim(a.substring(0,c)):i.trim(a.substring(d+1,b)),f=i.trim(a.substring(c+1,f)));return{name:g,email:f,FullEmail:a}};c.isCorrectEmail=function(a){return a.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)};c.getIncorrectEmailsFromAddressString=function(a){for(var a=a.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),d=[],b=0,e=a.length,f="",f=null;b<e;b++)f=i.trim(a[b]),0<f.length&&(f=c.getEmailParts(i.trim(a[b])),c.isCorrectEmail(f.email)||d.push(f.email));
return d};c.getImportContactsLink=function(){return"index.php?/ImportContacts/"};c.getExportContactsLink=function(){return"index.php?/Raw/Contacts/"};c.getExportCalendarLinkByHash=function(a,d){return"index.php?/Raw/Calendar/"+a+"/"+d};c.getDownloadLinkByHash=function(a,d){return"index.php?/Raw/Download/"+a+"/"+d};c.getViewLinkByHash=function(a,d){return"index.php?/Raw/View/"+a+"/"+d};c.daysInMonth=function(a,d){return 0<a&&13>a&&0<d?(new Date(d,a,0)).getDate():31};c.getAppPath=function(){return j.location.protocol+
"//"+j.location.host+j.location.pathname};c.WindowOpener={_iDefaultRatio:0.8,_aOpenedWins:[],openMessage:function(a,d){if(a){var b=a.folder(),c=a.uid(),g="",g=d?f.Routing.buildHashFromArray([e.Screens.SingleCompose,"drafts",b,c]):f.Routing.buildHashFromArray([e.Screens.SingleMessageView,b,"msg"+c]);this.open(g,a.subject())}},open:function(a,d,b){var b="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+(b?",menubar=yes":",menubar=no"),c=null,d=d.replace(/\W/g,""),b=b+this._getSizeParameters(),
c=j.open(a,d,b);c.focus();this._aOpenedWins.push(c);return c},closeAll:function(){for(var a=this._aOpenedWins.length,d=0,b=null;d<a;d++)b=this._aOpenedWins[d],b.closed||b.close();this._aOpenedWins=[]},_getSizeParameters:function(){var a=j.screen.width,d=Math.ceil(a*this._iDefaultRatio),a=Math.ceil((a-d)/2),b=j.screen.height,c=Math.ceil(b*this._iDefaultRatio),b=Math.ceil((b-c)/2);return",width="+d+",height="+c+",top="+b+",left="+a}};c.moveCaretToEnd=function(a){var d;a.createTextRange?(a=a.createTextRange(),
a.collapse(!1),a.select()):a.setSelectionRange&&(d=2*a.value.length,a.setSelectionRange(d,d))};c.delegateRun=function(a,d,b){a&&a[d]&&a[d].apply(a,_.isArray(b)?b:[])};c.strRepeat=function(a,d){return Array(d+1).join(a)};c.deferedUpdate=function(a,d,b,c){!a.__interval&&d?(a.__state=!0,c(a,!0),a.__interval=j.setInterval(function(){a.__state||(c(a,!1),j.clearInterval(a.__interval),a.__interval=null)},b)):d||(a.__state=!1)};c.draggebleMessages=function(){return i('<div class="draggeble draggebleMessages"><span class="count-text"></span></div>').appendTo("#pSevenHidden")};
c.draggebleContacts=function(){return i('<div class="draggeble draggebleContacts"><span class="count-text"></span></div>').appendTo("#pSevenHidden")};c.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var a=i(document.activeElement);(a.is("input")||a.is("textarea"))&&document.activeElement.blur()}};c.uiDropHelperAnim=function(a,d){var b=d.helper.clone().appendTo("#pSevenHidden"),c=i(a.target).find(".text").offset();b.animate({left:c.left+"px",top:c.top+
"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){i(this).remove()})};c.inFocus=function(){var a=document&&document.activeElement?document.activeElement.tagName:null;return"INPUT"===a||"TEXTAREA"===a||"IFRAME"===a};c.getPlural=function(a,d){var b=0,d=c.pInt(d);switch(a){case "Arabic":b=0===d?0:1===d?1:2===d?2:3<=d%100&&10>=d%100?3:11<=d%100?4:5;break;case "Bulgarian":b=1===d?0:1;break;case "Chinese-Simplified":b=0;break;case "Chinese-Traditional":b=1===d?0:1;break;case "Czech":b=1===
d?0:2<=d&&4>=d?1:2;break;case "Danish":b=1===d?0:1;break;case "Dutch":b=1===d?0:1;break;case "English":b=1===d?0:1;break;case "Estonian":b=1===d?0:1;break;case "Finish":b=1===d?0:1;break;case "French":b=1===d?0:1;break;case "German":b=1===d?0:1;break;case "Greek":b=1===d?0:1;break;case "Hebrew":b=1===d?0:1;break;case "Hungarian":b=1===d?0:1;break;case "Italian":b=1===d?0:1;break;case "Japanese":b=0;break;case "Korean":b=0;break;case "Latvian":b=1===d%10&&11!==d%100?0:0!==d?1:2;break;case "Lithuanian":b=
1===d%10&&11!==d%100?0:2<=d%10&&(10>d%100||20<=d%100)?1:2;break;case "Norwegian":b=1===d?0:1;break;case "Persian":b=0;break;case "Polish":b=1===d?0:2<=d%10&&4>=d%10&&(10>d%100||20<=d%100)?1:2;break;case "Portuguese-Brazil":b=1===d?0:1;break;case "Romanian":b=1===d?0:0===d||0<d%100&&20>d%100?1:2;break;case "Russian":b=1===d%10&&11!==d%100?0:2<=d%10&&4>=d%10&&(10>d%100||20<=d%100)?1:2;break;case "Serbian":b=1===d%10&&11!==d%100?0:2<=d%10&&4>=d%10&&(10>d%100||20<=d%100)?1:2;break;case "Spanish":b=1===
d?0:1;break;case "Swedish":b=1===d?0:1;break;case "Thai":b=0;break;case "Turkish":b=1===d?0:1;break;case "Ukrainian":b=1===d%10&&11!==d%100?0:2<=d%10&&4>=d%10&&(10>d%100||20<=d%100)?1:2;break;default:b=0}return b};E.prototype.iTimer=0;E.prototype.inFocus=function(){var a=document&&document.activeElement?document.activeElement.tagName:null;return"INPUT"===a||"TEXTAREA"===a||"IFRAME"===a};E.prototype.initOnApplyBindings=function(a,d,h,c,f){i(document).on("keydown",this.onKeydown);this.oListScope=c;
this.oScrollScope=f;this.sActionSelector=a;this.sSelectabelSelector=d;this.sCheckboxSelector=h;var e=this,g=function(a,d){var b=0,h=0,c=null,f=!1,u=!1,g=[],v=!1,a=a?a:null;if(d&&d.shiftKey&&null!==a&&null!==e.oLast&&a!==e.oLast){g=e.list();v=a.checked();b=0;for(h=g.length;b<h;b++){c=g[b];f=!1;if(c===e.oLast||c===a)f=!0;f&&(u=!u);(u||f)&&c.checked(v)}}a&&(e.oLast=a)};i(this.oListScope).on("dblclick",a,function(){var a=b.dataFor(this);if(a)e.onDblClick(a)});if(Wa)i(this.oListScope).on("touchstart",
a,function(a){if(a){var d=a.timeStamp,b=i(this).data("lastTouch")||d,b=d-b,h=a.originalEvent&&a.originalEvent.touches?a.originalEvent.touches.length:0;i(this).data("lastTouch",d);if(b&&!(250<b||1<h))a.preventDefault(),i(this).trigger("dblclick")}});i(this.oListScope).on("click",a,function(a){var d=!0,h=null,c=b.dataFor(this);if(c&&a&&(a.shiftKey?(d=!1,null===e.oLast&&(e.oLast=c),c.checked(!c.checked()),g(c,a)):a.ctrlKey&&(d=!1,e.oLast=c,(h=e.itemSelected())&&!h.checked()&&h.checked(!0),c.checked(!c.checked())),
d))e.onSelect(c)});i(this.oListScope).on("click",h,function(a){var d=b.dataFor(this);d&&a&&(a.shiftKey?(null===e.oLast&&(e.oLast=d),g(d,a)):e.oLast=d);a&&a.stopPropagation&&a.stopPropagation()});i(this.oListScope).on("dblclick",h,function(a){a&&a.stopPropagation&&a.stopPropagation()})};E.prototype.getResultSelection=function(a,d){var b=!1,f=!1,g=null,i=[];!a&&-1<c.inArray(d,[e.Key.Up,e.Key.Down,e.Key.PageUp,e.Key.PageDown,e.Key.Home,e.Key.End])?(i=this.list())&&0<i.length&&(-1<c.inArray(d,[e.Key.Down,
e.Key.PageUp,e.Key.Home])?g=i[0]:-1<c.inArray(d,[e.Key.Up,e.Key.PageDown,e.Key.End])&&(g=i[i.length-1])):a&&_.each(this.list(),function(c){if(!b)switch(d){case e.Key.Up:a===c?b=!0:g=c;break;case e.Key.Home:case e.Key.PageUp:g=c;b=!0;break;case e.Key.Down:f?(g=c,b=!0):a===c&&(f=!0);break;case e.Key.End:case e.Key.PageDown:g=c}});return g};E.prototype.shiftClickResult=function(a,d,b){if(d&&(e.Key.Up===b||e.Key.Down===b))d.checked(!d.checked());else if(d&&-1<c.inArray(b,[e.Key.PageUp,e.Key.PageDown,
e.Key.Home,e.Key.End])){var f=!1,g=!d.checked();_.each(this.list(),function(b){var h=!1;if(b===a||d===b)f=!f,h=!0;(f||h)&&b.checked(g)})}};E.prototype.clickNewSelectPosition=function(a,d){var b=this,f=0,g=null,f=this.itemSelected();(g=this.getResultSelection(f,a))?(d&&this.shiftClickResult(g,f,a),this.itemSelected(g),f=0===this.iTimer?50:150,0!==this.iTimer&&j.clearTimeout(this.iTimer),this.iTimer=j.setTimeout(function(){b.iTimer=0;b.onSelect(g)},f)):f&&d&&-1<c.inArray(a,[e.Key.Up,e.Key.Down,e.Key.PageUp,
e.Key.PageDown,e.Key.Home,e.Key.End])&&f.checked(!f.checked())};E.prototype.onKeydown=function(a){var d=!0,b=0;this.useKeyboardKeys()&&(a&&!this.inFocus())&&(b=a.keyCode,e.Key.Up===b||e.Key.Down===b||e.Key.PageUp===b||e.Key.PageDown===b||e.Key.Home===b||e.Key.End===b?(this.clickNewSelectPosition(b,a.shiftKey),d=!1):e.Key.Del===b&&!a.ctrlKey&&!a.shiftKey?0<this.list().length&&(this.onDelete(),d=!1):a.ctrlKey&&e.Key.a===b&&(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),d=!1));return d};
E.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected());this.itemSelected(null);this.listChecked(!1)};E.prototype.onSelect=function(a){this.itemSelected(a);this.fSelectCallback.call(this,a)};E.prototype.onDblClick=function(a){this.fDblClickCallback.call(this,a)};E.prototype.koCheckAll=function(){return b.computed({read:this.checkAll,write:this.checkAll,owner:this})};E.prototype.koCheckAllIncomplete=function(){return b.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,
owner:this})};E.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var a=i(this.sSelectabelSelector,this.oListScope),d=a.position(),b=this.oListScope.height(),a=a.outerHeight();return d&&(0>d.top||d.top+a>b)?(0>d.top?this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+d.top-20):this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+d.top-b+a+20),!0):!1};var A=jQuery;A.fn.splitter=function(a){a=a||{};return this.each(function(){var d=function(a){e(w[0]._posSplit+
a[i.eventPos])},b=a.name,c=function Xa(){l.removeClass(i.activeClass);A("body").attr({unselectable:"off"}).removeClass("unselectable");b&&f.Storage.setData(b+"ResizerWidth",w[0].width());A(document).unbind("mousemove",d).unbind("mouseup",Xa)},e=function(a){a=j.Math.max(w[0]._min,q._DA-w[1]._max,j.Math.min(a,w[0]._max,q._DA-w[1]._min));w[0].css(i.split,a);w[1].css(i.split,q._DA-a);A.browser.msie&&9>A.browser.version||D.trigger("resize")},g=function(a,d){for(var b=0,h=1;h<arguments.length;h++)b+=j.Math.max(j.parseInt(a.css(arguments[h]),
10)||0,0);return b},i=A.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,cursor:"e-resize",outlineClass:"voutline",type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,cursor:"n-resize",outlineClass:"houtline",type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",
pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[(a.splitHorizontal?"h":a.splitVertical?"v":a.type)||"v"],a),q=A(this).css({position:"relative"}),D=A(">*:not(css3pie)",q[0]),w=[],l=A(".resize_handler",D[0]).attr({unselectable:"on"}).bind("mousedown",function(a){l.addClass(i.activeClass);w[0]._posSplit=w[0][0][i.pxSplit]-a[i.eventPos];A("body").attr({unselectable:"on"}).addClass("unselectable");A(document).bind("mousemove",d).bind("mouseup",c)});A.each(D,function(){w.push(A(this))});w[0]._pane=i.side1;
w[1]._pane=i.side2;A.each(w,function(){this._min=i["min"+this._pane]||g(this,"min-"+i.split);this._max=i["max"+this._pane]||g(this,"max-"+i.split)||9999;this._init=!0===i["size"+this._pane]?j.parseInt(A.css(this[0],i.split),10):i["size"+this._pane]});var k=0,k=b?f.Storage.getData(b)||w[0]._init:w[0]._init;isNaN(w[1]._init)||(k=q[0][i.pxSplit]-w[1]._init);isNaN(k)&&(k=q[0][i.pxSplit],k=j.Math.round(k/D.length));i.resizeToWidth&&!(A.browser.msie&&9>A.browser.version)&&A(j).bind("resize",function(a){a.target===
this&&q.trigger("resize")});q.bind("resize",function(a,d){if(a.target===this){q._DA=q[0][i.pxSplit];if(!(q._DA<=0)){isNaN(d)&&(d=!i.sizeRight&&!i.sizeBottom?D[0][i.pxSplit]:q._DA-D[1][i.pxSplit]);e(d)}}}).trigger("resize",[k])})};da.prototype.searchMessagesInInbox=function(a){f.Cache.searchMessagesInInbox(a)};da.prototype.searchMessagesInCurrentFolder=function(a){f.Cache.searchMessagesInCurrentFolder(a);j.focus()};da.prototype.openComposeMessage=function(a){f.Routing.setHash(f.Links.composeWithToField(a))};
da.prototype.showLoading=function(a){f.Screens.showLoading(a)};da.prototype.hideLoading=function(){f.Screens.hideLoading()};da.prototype.showReport=function(a,d){f.Screens.showReport(a,d)};da.prototype.showError=function(a,d,b){f.Screens.showError(a,d,b)};Ha.prototype.setData=function(a,d){Data.setVar(a,d)};Ha.prototype.getData=function(a){return Data.getVar(a)};ea.prototype.onShow=function(a){this.alertDesc(a)};ea.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"};ea.prototype.onEnterHandler=
function(){this.closeCommand()};J.prototype.onShow=function(a,d,b){this.title(b||"");c.isFunc(d)?(this.fConfirmCallback=d,this.confirmDesc(a)):j.alert("Second parameter is not a function!")};J.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"};J.prototype.onEnterHandler=function(){this.yesClick()};J.prototype.yesClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!0);this.closeCommand()};J.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1);
this.closeCommand()};ka.prototype.onShow=function(){this.friendlyNameFocus(!0);this.init()};ka.prototype.popupTemplate=function(){return"Popups_AccountCreatePopupViewModel"};ka.prototype.init=function(){this.friendlyName("");this.email("");this.incomingMailLogin("");this.incLoginFocused(!1);this.incomingMailPassword("");this.incomingMailPort(143);this.incomingMailServer("");this.outgoingMailLogin("");this.outgoingMailPassword("");this.outgoingMailPort(25);this.outgoingMailServer("");this.outServerFocused(!1);
this.useSmtpAuthentication(!0)};ka.prototype.onResponseAddAccount=function(a,d){var b=a?a.ErrorCode:0;if(!1===(a?a.Result:!1))switch(b){case e.Errors.MailServerError:f.Api.showError(c.i18n("WARNING/CANT_CONNECT_TO_SERVER"));break;case e.Errors.AuthError:f.Api.showError(c.i18n("WARNING/LOGIN_PASS_INCORRECT"));break;default:f.Api.showError(c.i18n("WARNING/CREATING_ACCOUNT_ERROR"))}else{var b=new Z,u=parseInt(a.Result,10);b.init(u,d.Email,d.FriendlyName);b.updateExtended(d);g.Accounts.addAccount(b);
g.Accounts.changeEditedAccount(u);this.closeCommand();this.init()}};ka.prototype.onSaveClick=function(){var a={Action:"AccountCreate",AccountID:this.editedAccountId(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:this.incomingMailPassword(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:parseInt(this.incomingMailPort(),10),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPassword:this.outgoingMailPassword(),
OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.useSmtpAuthentication()?2:0};f.Ajax.send(a,this.onResponseAddAccount,this)};ka.prototype.onCancelClick=function(){this.closeCommand()};pa.prototype.onShow=function(){var a=f.Cache.editedFolderList();this.sSentFolderOld=a.sentFolderFullName();this.sDraftFolderOld=a.draftsFolderFullName();this.sSpamFolderOld=a.spamFolderFullName();this.sTrashFolderOld=a.trashFolderFullName();this.sentFolderFullName(this.sSentFolderOld);this.draftsFolderFullName(this.sDraftFolderOld);
this.spamFolderFullName(this.sSpamFolderOld);this.trashFolderFullName(this.sTrashFolderOld);this.folders(a)};pa.prototype.popupTemplate=function(){return"Popups_FolderSystemPopupViewModel"};pa.prototype.onResponseSetupSystemFolders=function(a){a&&!1!==a.Result&&f.Cache.getFolderList(g.Accounts.editedId())};pa.prototype.onOKClick=function(){var a=this.folders(),a={Action:"SetupSystemFolders",AccountID:g.Accounts.editedId(),Sent:a.sentFolderFullName(),Drafts:a.draftsFolderFullName(),Trash:a.trashFolderFullName(),
Spam:a.spamFolderFullName()};f.Ajax.send(a,this.onResponseSetupSystemFolders,this);this.closeCommand()};pa.prototype.onCancelClick=function(){var a=this.folders();a.sentFolderFullName(this.sSentFolderOld);a.draftsFolderFullName(this.sDraftFolderOld);a.spamFolderFullName(this.sSpamFolderOld);a.trashFolderFullName(this.sTrashFolderOld);this.closeCommand()};qa.prototype.onShow=function(){this.folderNameFocus(!0)};qa.prototype.popupTemplate=function(){return"Popups_FolderCreatePopupViewModel"};qa.prototype.onResponseFolderCreate=
function(a){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ACCOUNT_FOLDERS_CANT_CREATE_FOLDER")):(this.folderName(""),this.parentFolder(""),f.Cache.getFolderList(g.Accounts.editedId()),this.closeCommand())};qa.prototype.onOKClick=function(){var a=""===this.parentFolder()?this.namespace():this.parentFolder(),a={Action:"FolderCreate",AccountID:g.Accounts.editedId(),FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:a,Delimiter:this.folders().delimiter()};f.Ajax.send(a,this.onResponseFolderCreate,
this)};qa.prototype.onCancelClick=function(){this.closeCommand()};la.prototype.onShow=function(){this.init()};la.prototype.popupTemplate=function(){return"Popups_ChangePasswordPopupViewModel"};la.prototype.init=function(){this.currentPassword("");this.newPassword("");this.confirmPassword("")};la.prototype.onResponse=function(a){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ACCOUNT_PROPERTIES_NEW_PASSWORD_UPDATE_ERROR")):(f.Api.showReport(c.i18n("SETTINGS/ACCOUNT_PROPERTIES_CHANGE_PASSWORD_SUCCESS")),
this.closeCommand(),this.init())};la.prototype.onOKClick=function(){var a={Action:"UpdateAccountPassword",AccountID:this.editedAccountId(),CurrentIncomingMailPassword:this.currentPassword(),NewIncomingMailPassword:this.newPassword()};this.confirmPassword()!==this.newPassword()?f.Api.showError(c.i18n("SETTINGS/ACCOUNT_PROPERTIES_PASSWORDS_DO_NOT_MATCH")):f.Ajax.send(a,this.onResponse,this)};la.prototype.onCancelClick=function(){this.closeCommand()};Pa.prototype.parse=function(a){this.AllowUsersChangeInterfaceSettings=
!!a.AllowUsersChangeInterfaceSettings;this.AllowUsersChangeEmailSettings=!!a.AllowUsersChangeEmailSettings;this.AllowUsersAddNewAccounts=!!a.AllowUsersAddNewAccounts||this.AllowUsersChangeEmailSettings;this.Languages=a.Languages;this.Themes=a.Themes;this.DateFormats=a.DateFormats;this.AttachmentSizeLimit=c.pInt(a.AttachmentSizeLimit);this.AllowFirstCharacterSearch=!!a.AllowFirstCharacterSearch;this.AllowIdentities=!!a.AllowIdentities;this.AutoSave=!!a.AutoSave;this.IdleSessionTimeout=c.pInt(a.IdleSessionTimeout);
this.AllowInsertImage=!!a.AllowInsertImage;this.AllowBodySize=!!a.AllowBodySize;this.MaxBodySize=c.pInt(a.MaxBodySize);this.MaxSubjectSize=c.pInt(a.MaxSubjectSize);this.EnableMobileSync=!!a.EnableMobileSync;this.AllowPrefetch=!!a.AllowPrefetch;this.DemoWebMail=!!a.DemoWebMail;this.DemoWebMailLogin=a.DemoWebMailLogin;this.DemoWebMailPassword=a.DemoWebMailPassword;this.GoogleAnalyticsAccount=a.GoogleAnalyticsAccount;this.ShowQuotaBar=!!a.ShowQuotaBar;this.AllowLanguageOnLogin=!!a.AllowLanguageOnLogin;
this.FlagsLangSelect=!!a.FlagsLangSelect;this.DefaultLanguage=a.DefaultLanguage;this.LoginDescription=a.LoginDescription;this.CustomLogoutUrl=a.CustomLogoutUrl};S.prototype.changeAutoCheckMailInterval=function(){clearInterval(this.iInterval);!g.SingleMode&&0<this.autoCheckMailInterval()&&(this.iInterval=setInterval(function(){f.Cache.executeCheckMail()},6E4*this.autoCheckMailInterval()))};S.prototype.getSaveMailInSentItems=function(){var a=!0;switch(this.SaveMail){case e.SaveMail.Unchecked:a=!1;break;
case e.SaveMail.Checked:case e.SaveMail.Hidden:a=!0}return a};S.prototype.getUseSaveMailInSentItems=function(){var a=!1;switch(this.SaveMail){case e.SaveMail.Unchecked:case e.SaveMail.Checked:a=!0;break;case e.SaveMail.Hidden:a=!1}return a};S.prototype.parse=function(a){var d=null;null!==a&&(this.IdUser=c.pInt(a.IdUser),this.MailsPerPage=c.pInt(a.MailsPerPage),this.ContactsPerPage=c.pInt(a.ContactsPerPage),this.autoCheckMailInterval(c.pInt(a.AutoCheckMailInterval)),this.DefaultEditor=c.pInt(a.DefaultEditor),
this.Layout=c.pInt(a.Layout),this.DefaultTheme=a.DefaultTheme.toString(),this.DefaultLanguage=a.DefaultLanguage.toString(),this.DefaultDateFormat=a.DefaultDateFormat.toString(),this.defaultTimeFormat(c.pInt(a.DefaultTimeFormat)),this.AllowCompose=!!a.AllowCompose,this.AllowReply=!!a.AllowReply,this.AllowForward=!!a.AllowForward,this.SaveMail=c.pInt(a.SaveMail),this.OutlookSyncEnable=!!a.OutlookSyncEnable,this.ShowPersonalContacts=!!a.ShowPersonalContacts,this.ShowGlobalContacts=!!a.ShowGlobalContacts,
this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.LastLogin=c.pInt(a.LastLogin),this.AllowCalendar=!!a.AllowCalendar,this.IsDemo=!!a.IsDemo,d=a.Calendar,"object"===typeof d&&(this.CalendarShowWeekEnds=!!d.ShowWeekEnds,this.CalendarShowWorkDay=!!d.ShowWorkDay,this.CalendarWorkDayStarts=c.pInt(d.WorkDayStarts),this.CalendarWorkDayEnds=c.pInt(d.WorkDayEnds),this.CalendarWeekStartsOn=c.pInt(d.WeekStartsOn),this.CalendarDefaultTab=c.pInt(d.DefaultTab)))};S.prototype.updateCommonSettings=
function(a,d,b,c,f,e,g,i,j){(this.DefaultTheme!==e||this.DefaultLanguage!==g||this.DefaultDateFormat!==i||this.defaultTimeFormat()!==j)&&this.needToReloadCalendar(!0);this.MailsPerPage=a;this.ContactsPerPage=d;this.autoCheckMailInterval(b);this.DefaultEditor=c;this.Layout=f;this.DefaultTheme=e;this.DefaultLanguage=g;this.DefaultDateFormat=i;this.defaultTimeFormat(j)};S.prototype.updateCalendarSettings=function(a,d,b,c,f,e){(this.CalendarShowWeekEnds!==a||this.CalendarShowWorkDay!==d||this.CalendarWorkDayStarts!==
b||this.CalendarWorkDayEnds!==c||this.CalendarWeekStartsOn!==f||this.CalendarDefaultTab!==e)&&this.needToReloadCalendar(!0);this.CalendarShowWeekEnds=a;this.CalendarShowWorkDay=d;this.CalendarWorkDayStarts=b;this.CalendarWorkDayEnds=c;this.CalendarWeekStartsOn=f;this.CalendarDefaultTab=e};S.prototype.isNeedToReloadCalendar=function(){var a=this.needToReloadCalendar();this.needToReloadCalendar(!1);return a};S.prototype.onSyncSettingsResponse=function(a){a.Result&&(this.mobileSync(a.Result.Mobile),
this.outlookSync(a.Result.Outlook))};S.prototype.requestSyncSettings=function(){(null===this.mobileSync()||null===this.outlookSync())&&f.Ajax.send({Action:"SyncSettings"},this.onSyncSettingsResponse,this)};Z.prototype.init=function(a,d,b){this.id(a);this.email(d);this.friendlyName(b)};Z.prototype.onQuotaParamsResponse=function(a){a&&(a.Result&&_.isArray(a.Result)&&2===a.Result.length)&&(this.quota(c.pInt(a.Result[1])),this.usedSpace(c.pInt(a.Result[0])),f.Cache.quotaChangeTrigger(!f.Cache.quotaChangeTrigger()))};
Z.prototype.updateQuotaParams=function(){var a={Action:"Quota",AccountID:this.id()};g.App&&g.App.ShowQuotaBar&&f.Ajax.send(a,this.onQuotaParamsResponse,this)};Z.prototype.parse=function(a,d){var b=new Ja;this.init(parseInt(a.AccountID,10),a.Email.toString(),a.FriendlyName.toString());b.parse(this.id(),a.Signature);this.signature(b);this.isCurrent(d===this.id());this.isEdited(d===this.id())};Z.prototype.extensionExists=function(a){return-1===_.indexOf(this.extensions(),a)?!1:!0};Z.prototype.updateExtended=
function(a){a&&(this.isExtended(!0),a.FriendlyName&&this.friendlyName(a.FriendlyName),a.IncomingMailLogin&&this.incomingMailLogin(a.IncomingMailLogin),a.IncomingMailPort&&this.incomingMailPort(a.IncomingMailPort),a.IncomingMailServer&&this.incomingMailServer(a.IncomingMailServer),a.IsInternal&&this.isInternal(a.IsInternal),a.IsLinked&&this.isLinked(a.IsLinked),a.IsDefault&&this.isDefault(a.IsDefault),a.OutgoingMailAuth&&this.outgoingMailAuth(a.OutgoingMailAuth),a.OutgoingMailLogin&&this.outgoingMailLogin(a.OutgoingMailLogin),
a.OutgoingMailPort&&this.outgoingMailPort(a.OutgoingMailPort),a.OutgoingMailServer&&this.outgoingMailServer(a.OutgoingMailServer),a.Extensions&&this.extensions(a.Extensions))};Z.prototype.changeAccount=function(){g.Accounts.changeCurrentAccount(this.id())};O.prototype.changeCurrentAccount=function(a){var d=this.getCurrent(),b=this.getAccount(a);b&&this.currentId()!==a&&(d.isCurrent(!1),this.currentId(a),b.isCurrent(!0),f.Routing.setHash(f.Links.inbox()))};O.prototype.changeEditedAccount=function(a){var d=
this.getEdited(),b=this.getAccount(a);b&&this.editedId()!==a&&(d.isEdited(!1),this.editedId(a),b.isEdited(!0))};O.prototype.parse=function(a,d){var b=null,c=!1;_.isArray(d)&&this.Collection(_.map(d,function(d){b=new Z;b.parse(d,a);b.id()===a&&(c=!0);return b}));!c&&0<this.Collection.length&&(b=this.Collection()[0],a=b.id(),c=!0);c&&(this.defaultId(a),this.currentId(a),this.editedId(a))};O.prototype.getAccount=function(a){return _.find(this.Collection(),function(d){return d.id()===a},this)};O.prototype.getCurrent=
function(){return _.find(this.Collection(),function(a){return a.id()===this.currentId()},this)};O.prototype.getEmail=function(){var a="",d=g.Accounts.getCurrent();d&&(a=d.email());return a};O.prototype.getEdited=function(){return _.find(this.Collection(),function(a){return a.id()===this.editedId()},this)};O.prototype.addAccount=function(a){this.Collection.push(a)};O.prototype.deleteAccount=function(a){this.currentId()===a&&this.changeCurrentAccount(this.defaultId());this.editedId()===a&&this.changeEditedAccount(this.defaultId());
this.Collection.remove(function(d){return d.id()===a})};O.prototype.hasAccountWithId=function(a){return!!_.find(this.Collection(),function(d){return d.id()===a},this)};fa.prototype.parse=function(a){if(null!==a&&(this.sName=c.pExport(a,"DisplayName",this.sName),"string"!==typeof this.sName&&(this.sName=""),this.sEmail=c.pExport(a,"Email",this.sEmail),"string"!==typeof this.sEmail))this.sEmail=""};fa.prototype.getEmail=function(){return this.sEmail};fa.prototype.getName=function(){return this.sName};
fa.prototype.getDisplay=function(){return 0<this.sName.length?this.sName:this.sEmail};fa.prototype.getFull=function(){var a="";return a=0<this.sEmail.length?0<this.sName.length?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail:this.sName};K.prototype.parse=function(a){this.aCollection=_.map(a,function(a){var b=new fa;b.parse(a);return b})};K.prototype.addCollection=function(a){_.each(a,function(a){_.find(this.aCollection,function(b){return a.sEmail===b.sEmail})||this.aCollection.push(a)},this)};K.prototype.excludeCollection=
function(a){_.each(a,function(a){this.aCollection=_.filter(this.aCollection,function(b){return a.sEmail!==b.sEmail})},this)};K.prototype.getFirstEmail=function(){return 0<this.aCollection.length?this.aCollection[0].getEmail():""};K.prototype.getFirstName=function(){return 0<this.aCollection.length?this.aCollection[0].getName():""};K.prototype.getDisplay=function(){return _.map(this.aCollection,function(a){return a.getDisplay()}).join(", ")};K.prototype.getFull=function(){return _.map(this.aCollection,
function(a){return a.getFull()}).join(", ")};ga.prototype.parse=function(a){this.oMoment=moment.unix(a)};ga.prototype.setDate=function(a,d,b){this.oMoment=moment([a,d,b])};ga.prototype.getTimeFormat=function(){return g.User.defaultTimeFormat()===e.TimeFormat.F24?"HH:mm":"hh:mm A"};ga.prototype.getFullDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY, "+this.getTimeFormat()):""};ga.prototype.getMidDate=function(){return this.getShortDate(!0)};ga.prototype.getShortDate=function(a){var d=
"",b=null;if(this.oMoment)if(b=moment(),b.format("L")===this.oMoment.format("L"))d=this.oMoment.format(this.getTimeFormat());else if(d=b.clone().subtract("days",1).format("L")===this.oMoment.format("L")?c.i18n("DATETIME/YESTERDAY"):b.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),c.isUnd(a)?0:a)d+=", "+this.oMoment.format(this.getTimeFormat());return d};N.prototype.parse=function(a,d){"Object/CApiMailAttachment"===a["@Object"]&&(a.FileName&&(this.tempName(a.FileName.toString()),
this.fileName(a.FileName.toString())),this.mimePartIndex(a.MimePartIndex.toString()),this.type(a.MimeType.toString()),this.size(parseInt(a.EstimatedSize,10)),this.cid(a.CID.toString()),this.inline(!!a.IsInline),this.linked(!!a.IsLinked),this.hash(a.Hash),this.accountId(d),this.uploadUid(this.hash()),this.uploaded(!0))};N.prototype.onUploadSelect=function(a,d){this.fileName(d.FileName);this.type(d.Type);this.size(c.pInt(d.Size));this.uploadUid(a);this.uploaded(!1);this.visibleSpinner(!1);this.statusText("");
this.progressPercent(0);this.visibleProgress(!1)};N.prototype.onUploadStart=function(){this.visibleSpinner(!0);this.visibleProgress(!0)};N.prototype.onUploadProgress=function(a,d){0<d&&(this.progressPercent(Math.ceil(100*(a/d))),this.visibleProgress(!0))};N.prototype.onUploadComplete=function(a,d,b,f){var d=!d||!b||b.Error,e=b&&"size"===b.Error?c.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):c.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN");!d&&!f&&(d=!0);this.visibleSpinner(!1);this.progressPercent(0);this.visibleProgress(!1);
if(d)this.uploaded(!0),this.uploadError(!0),this.statusText(e);else{this.cid(a);this.tempName(b.Attachment.TempName);this.uploadError(!1);this.uploaded(!0);this.statusText(c.i18n("COMPOSE/UPLOAD_COMPLETE"));this.type(b.Attachment.MimeType);this.hash(b.Attachment.Hash);this.accountId(f);var g=this;setTimeout(function(){g.statusText("")},3E3)}};N.prototype.onMessageResponse=function(a){var d=a.Result,b=new B;d&&this.oNewWindow&&(b.parse(d,a.AccountID),this.messagePart(b),this.messagePart().viewMessage(this.oNewWindow),
this.oNewWindow=void 0)};N.prototype.viewAttachment=function(){var a=null,d='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+c.i18n("MAIN/LOADING")+"</div>",a=c.getAppPath()+this.viewLink();if(this.isMessageType()){if(a=c.WindowOpener.open("",this.fileName())){if(this.messagePart())this.messagePart().viewMessage(a);else{var b={Action:"Message",Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()};i(a.document.body).html(d);this.oNewWindow=
a;f.Ajax.send(b,this.onMessageResponse,this)}a.focus()}}else this.visibleViewLink()&&(0<this.viewLink().length&&"#"!==this.viewLink())&&(a=c.getAppPath()+this.viewLink(),(a=j.open(a,a,"location=no,menubar=no,status=no,titlebar=no,toolbar=no,resizable=yes,scrollbars=yes"+this.getNewWindowSizeParameters()))&&a.focus())};N.prototype.downloadAttachment=function(){0<this.download().length&&"#"!==this.download()&&f.downloadByUrl(this.download())};N.prototype.getNewWindowSizeParameters=function(){var a=
j.screen.width,d=Math.ceil(0.8*a),a=Math.ceil((a-d)/2),b=j.screen.height,c=Math.ceil(0.8*b),b=Math.ceil((b-c)/2);return",width="+d+",height="+c+",top="+b+",left="+a};r.prototype.addRequestedUids=function(a){this.aRequestedUids=_.union(this.aRequestedUids,a)};r.prototype.hasUidBeenRequested=function(a){return-1!==_.indexOf(this.aRequestedUids,a)};r.prototype.hasListBeenRequested=function(a){var d=0<_.where(this.requestedLists,a).length;d||this.requestedLists.push(a);return d};r.prototype.markMessageReplied=
function(a,d){var b=this.oMessages[a];if(b)switch(d){case e.ReplyType.Reply:case e.ReplyType.ReplyAll:b.answered(!0);break;case e.ReplyType.Forward:b.forwarded(!0)}};r.prototype.removeAllMessages=function(){var a=null;this.oMessages={};this.oUids={};this.messageCount(0);this.unseenMessageCount(0);a=this.getUidList("");a.searchCount(0)};r.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.hasChanges(!1))};r.prototype.setRelevantInformation=
function(a,d,b,c){var f=this.hasExtendedInfo()&&(this.hash()!==d||this.messageCount()!==b||this.unseenMessageCount()!==c);this.uidNext(a);this.hash(d);this.messageCount(b);this.unseenMessageCount(c);this.hasExtendedInfo(!0);f&&this.markHasChanges();return f};r.prototype.markHasChanges=function(){this.hasChanges(!0)};r.prototype.addMessagesCountsDiff=function(a,d){var b=this.messageCount()+a,c=this.unseenMessageCount()+d;0>b&&(b=0);this.messageCount(b);0>c&&(c=0);c>b&&(c=b);this.unseenMessageCount(c)};
r.prototype.markDeletedByUids=function(a){var d=0,b=0;_.each(a,function(a){if(a=this.oMessages[a])d++,a.seen()||b++,a.deleted(!0)},this);this.addMessagesCountsDiff(-d,-b);return{MinusDiff:d,UnseenMinusDiff:b}};r.prototype.revertDeleted=function(a){var d=0,b=0;_.each(a,function(a){if((a=this.oMessages[a])&&a.deleted())d++,a.seen()||b++,a.deleted(!1)},this);this.addMessagesCountsDiff(d,b);return{PlusDiff:d,UnseenPlusDiff:b}};r.prototype.commitDeleted=function(a){_.each(this.oUids,function(d){d.deleteUids(a)},
this)};r.prototype.getUidList=function(a){var d=null;void 0===this.oUids[a]&&(d=new va,d.search(a),this.oUids[a]=d);return this.oUids[a]};r.prototype.parse=function(a){return"Object/Folder"===a["@Object"]?(this.name(a.Name),this.nameForEdit(a.Name),this.fullName(a.FullNameRaw),this.routingHash(f.Routing.buildHashFromArray([e.Screens.Mailbox,this.fullName()])),this.delimiter(a.Delimiter),this.type(a.Type),this.subscribed(a.IsSubscribed),this.selectable(a.IsSelectable),this.existen(a.IsExisten),a.Extended&&
this.setRelevantInformation(a.Extended.UidNext.toString(),a.Extended.Hash,a.Extended.MessageCount,a.Extended.MessageUnseenCount),a.SubFolders):null};r.prototype.onFolderClick=function(){this.canBeSelected()&&f.Routing.setHash(f.Links.mailbox(this.fullName()))};r.prototype.onMessageResponse=function(a,d){var b=a.Result,g=null,v=b?b.Uid.toString():d.Uid.toString(),i=this.oMessages[v]?this.oMessages[v]:new B,g=i.selected();!1===b?(g&&(a.ErrorCode===e.Errors.CanNotGetMessage?f.Api.showError(c.i18n("MESSAGE/ERROR_MESSAGE_DELETED")):
f.Api.showError(c.i18n("WARNING/UNKNOWN_ERROR"))),i=null):(i.parse(b,a.AccountID),this.oMessages[v]=i);if(g=this.aResponseHandlers[v])g.handler.call(g.context,i,v),delete this.aResponseHandlers[v]};r.prototype.getCompletelyFilledMessage=function(a,d,b){var c=this.oMessages[a],e={Action:"Message",Folder:this.fullName(),Uid:a};0<a.length&&(!c||!c.completelyFilled()?(d&&b&&(this.aResponseHandlers[a]={handler:d,context:b}),f.Ajax.send(e,this.onMessageResponse,this)):d&&b&&d.call(b,c,a))};r.prototype.showExternalPictures=
function(a){a=this.oMessages[a];void 0!==a&&a.showExternalPictures()};r.prototype.alwaysShowExternalPicturesForSender=function(a){_.each(this.oMessages,function(d){var b=d.oFrom.aCollection;0<b.length&&b[0].sEmail===a&&d.alwaysShowExternalPicturesForSender()},this)};r.prototype.executeGroupOperation=function(a,d,b){var c=0;_.each(this.oMessages,function(f){if(0<d.length)_.each(d,function(d){f&&(f.uid()===d&&f[a]()!==b)&&(f[a](b),c++)});else f[a](b)});0===d.length&&(c=b?this.unseenMessageCount():this.messageCount()-
this.unseenMessageCount());"seen"===a&&0<c&&(b?this.addMessagesCountsDiff(0,-c):this.addMessagesCountsDiff(0,c))};r.prototype.emptyFolder=function(){var a=c.i18n("MAILBOX/CONFIRM_EMPTY_FOLDER"),d=_.bind(this.clearFolder,this);this.enableEmptyFolder()&&f.Screens.showPopup(J,[a,d])};r.prototype.clearFolder=function(a){var d={Action:"FolderClear",Folder:this.fullName()};this.enableEmptyFolder()&&a&&(f.Ajax.send(d),this.removeAllMessages(),f.Cache.onClearFolder(this))};r.prototype.getNameWhithLevel=function(){var a=
this.level();!this.isNamespace()&&0<a&&a--;return c.strRepeat("\u00a0",3*a)+this.name()};F.prototype.getFoldersWithoutCountInfo=function(){return _.compact(_.map(this.oNamedCollection,function(a,d){return a.canBeSelected()&&!a.hasExtendedInfo()?d:null}))};F.prototype.getInboxAndCurrentFoldersArray=function(){var a=[this.inboxFolderFullName()];this.currentFolderType()!==e.FolderTypes.Inbox&&a.push(this.currentFolderFullName());return _.compact(a)};F.prototype.setCurrentFolder=function(a){a=this.getFolderByFullName(a);
null===a&&(a=this.inboxFolder());null!==a&&(this.currentFolder()&&this.currentFolder().selected(!1),this.currentFolder(a),this.currentFolder().selected(!0))};F.prototype.getFolderByType=function(a){switch(a){case e.FolderTypes.Inbox:return this.inboxFolder();case e.FolderTypes.Sent:return this.sentFolder();case e.FolderTypes.Drafts:return this.draftsFolder();case e.FolderTypes.Trash:return this.trashFolder();case e.FolderTypes.Spam:return this.spamFolder()}return null};F.prototype.getFolderByFullName=
function(a){return(a=this.oNamedCollection[a])?a:null};F.prototype.parse=function(a,d){this.iAccountId=a;this.sNamespace=c.pExport(d,"Namespace",this.sNamespace);this.bInitialized(!0);this.sNamespaceFolder=0<this.sNamespace.length?this.sNamespace.substring(0,this.sNamespace.length-1):this.sNamespace;this.collection(this.parseRecursively(d["@Collection"]))};F.prototype.parseRecursively=function(a,d){var b=[],f=0,g=0,i=null,j=null,j=[],q=!1;c.isUnd(d)&&(d=-1);d++;if(_.isArray(a))for(g=a.length;f<g;f++){i=
new r;i.iAccountId=this.iAccountId;j=i.parse(a[f]);q=this.sNamespace===i.fullName()+i.delimiter();i.isNamespace(q);null!==j&&(j=this.parseRecursively(j["@Collection"],d),i.subfolders(j));i.level(d);this.oNamedCollection[i.fullName()]=i;switch(i.type()){case e.FolderTypes.Inbox:this.inboxFolder(i);break;case e.FolderTypes.Sent:this.sentFolder(i);break;case e.FolderTypes.Drafts:this.draftsFolder(i);break;case e.FolderTypes.Trash:this.trashFolder(i);break;case e.FolderTypes.Spam:this.spamFolder(i)}b.push(i)}return b};
F.prototype.getOptions=function(a,d,b){var f=function(a){var g=0,i=0,v=null,j=[];c.isUnd(d)&&(d=!1);c.isUnd(b)&&(b=!1);g=0;for(i=a.length;g<i;g++){v=a[g];if(v.type()!==e.FolderTypes.Inbox&&b||!b)j.push({id:v.fullName(),name:Array(v.level()+1).join("\u00a0\u00a0\u00a0\u00a0")+v.name(),displayName:Array(v.level()+1).join("\u00a0\u00a0\u00a0\u00a0")+v.displayName(),disable:v.isSystem()&&!d||!v.canBeSelected()});j=j.concat(f(v.subfolders()))}return j},g=f(this.collection());c.isUnd(a)||g.unshift({id:"",
name:a,displayName:a,disable:!1});return g};F.prototype.getMessageCount=function(a){for(var d=0,b=0,c=null,f=0,d=0,b=a.length;d<b;d++)c=a[d],f+=c.messageCount(),f+=this.getMessageCount(c.subfolders());return f};F.prototype.deleteFolder=function(a){var d=function(b){if(a&&a.fullName()===b.fullName())return!0;b.subfolders.remove(d);return!1};this.collection.remove(d)};B.prototype.viewMessage=function(a){var d=this.getDomText(c.getAppPath()),b="";this.textBodyForNewWindow(d.html());b=i(this.domMessageForPrint()).html();
a&&(i(a.document.body).html(b),a.focus(),_.each(this.attachments(),function(d){var b=i(a.document.body).find("[data-hash='download-"+d.hash()+"']");b.on("click",_.bind(d.downloadAttachment,d));b=i(a.document.body).find("[data-hash='view-"+d.hash()+"']");b.on("click",_.bind(d.viewAttachment,d))},this))};B.prototype.fillFromOrToText=function(){var a=f.Cache.getFolderByFullName(this.accountId(),this.folder());a.type()===e.FolderTypes.Drafts||a.type()===e.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay()):
this.fromOrToText(this.oFrom.getDisplay())};B.prototype.parse=function(a,d){var b=null,b=null;"Object/MessageListItem"===a["@Object"]&&(this.seen(!!a.IsSeen),this.flagged(!!a.IsFlagged),this.answered(!!a.IsAnswered),this.forwarded(!!a.IsForwarded));if("Object/Message"===a["@Object"]||"Object/MessageListItem"===a["@Object"])if(this.accountId(d),this.folder(a.Folder),this.uid(a.Uid.toString()),this.subject(a.Subject),this.messageId(a.MessageId),this.textPartId(a.TextPartID),this.size(a.Size),this.textSize(a.TextSize),
this.oDateModel.parse(a.InternalTimeStampInUTC),this.oFrom.parse(a.From),this.oTo.parse(a.To),this.fillFromOrToText(),this.oCc.parse(a.Cc),this.oBcc.parse(a.Bcc),this.oSender.parse(a.Sender),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!a.HasAttachments),this.importance(a.Priority),_.isArray(a.DraftInfo)&&this.draftInfo(a.DraftInfo),this.sensitivity(a.Sensitivity),
this.hash(a.Hash),"Object/Message"===a["@Object"])this.inReplyTo(a.InReplyTo),this.references(a.References),this.readingConfirmation(a.ReadingConfirmation),""!==a.Html?this.text(a.Html):this.text(""!==a.Plain?"<div>"+a.Plain+"</div>":""),this.hasExternals(!!a.HasExternals),this.foundedCids(a.FoundedCIDs),this.parseAttachments(a.Attachments,d),this.safety(a.Safety),null!==a.ICAL&&(b=new C,b.parse(a.ICAL),this.ical(b)),null!==a.VCARD&&(b=new xa,b.parse(a.VCARD),this.vcard(b)),this.completelyFilled(!0)};
B.prototype.getDomText=function(a){var d=this.$text,a=a||"";if(null===this.$text||""!==a)this.completelyFilled()?(this.$text=i(this.text()),this.showInlinePictures(a),!0===this.safety()&&this.alwaysShowExternalPicturesForSender(),d=this.$text):d=i("");return d.clone()};B.prototype.parseAttachments=function(a,d){_.isArray(a)&&this.attachments(_.map(a,function(a){var b=new N(this.folder(),this.uid());b.parse(a,d);return b},this))};B.prototype.parseAddressArray=function(a){var d=[];_.isArray(a)&&(d=
_.map(a,function(a){var d=new fa;d.parse(a);return d}));return d};B.prototype.findAttachmentByCid=function(a){a="<"+a+">";return _.find(this.attachments(),function(d){return d.cid()===a})};B.prototype.showInlinePictures=function(a){var d=this;0<this.foundedCids().length&&(i("[data-x-src-cid]",this.$text).each(function(){var b=i(this).attr("data-x-src-cid");(b=d.findAttachmentByCid(b))&&0<b.viewLink().length&&i(this).attr("src",a+b.viewLink())}),i("[data-x-style-cid]",this.$text).each(function(){var a=
"",b=i(this).attr("data-x-style-cid-name"),a=i(this).attr("data-x-style-cid"),f=d.findAttachmentByCid(a);f&&(0<f.viewLink().length&&""!==b)&&(a=c.trim(i(this).attr("style")),a=""===a?"":";"===a.substr(-1)?a+" ":a+"; ",i(this).attr("style",a+b+": url('"+f.viewLink()+"')"))}))};B.prototype.showExternalPictures=function(){i("[data-x-src]",this.$text).each(function(){i(this).attr("src",i(this).attr("data-x-src")).removeAttr("data-x-src")});i("[data-x-style-url]",this.$text).each(function(){var a=c.trim(i(this).attr("style")),
a=""===a?"":";"===a.substr(-1)?a+" ":a+"; ";i(this).attr("style",a+i(this).attr("data-x-style-url")).removeAttr("data-x-style-url")});this.isExternalsShown(!0)};B.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())};va.prototype.setUidsAndCount=function(a){"Collection/MessageCollection"===a["@Object"]&&(_.each(a.Uids,function(d,b){this.collection()[b+a.Offset]=d.toString()},this),this.searchCount(a.MessageSearchCount))};
va.prototype.getUidsForOffset=function(a,d){for(var b=0,c=this.collection().length,f="",e=0,i=[],j=null;b<c;b++)if(b>=a&&e<g.User.MailsPerPage&&(f=this.collection()[b],(j=d[f])&&!j.deleted()||void 0===f))e++,void 0!==f&&i.push(f);return i};va.prototype.deleteUids=function(a){for(var d=0,b=this.collection().length,c="",f=[];d<b;d++)c=this.collection()[d],-1===_.indexOf(a,c)&&f.push(c);this.collection(f)};C.prototype.fillDecisions=function(){var a=g.Accounts.getCurrent(),a=a?a.email():"";this.cancelDecision(c.i18n("MESSAGE/APPOINTMENT_CANCELED",
{SENDER:a}));switch(this.icalConfig()){case e.IcalConfig.Accepted:this.replyDecision(c.i18n("MESSAGE/APPOINTMENT_ACCEPTED",{SENDER:a}));break;case e.IcalConfig.Declined:this.replyDecision(c.i18n("MESSAGE/APPOINTMENT_DECLINED",{SENDER:a}));break;case e.IcalConfig.Tentative:this.replyDecision(c.i18n("MESSAGE/APPOINTMENT_TENTATIVELY_ACCEPTED",{SENDER:a}))}};C.prototype.parse=function(a){a&&"Object/CApiMailIcs"===a["@Object"]&&(this.uid(a.Uid.toString()),this.file(a.File),this.type(a.Type),this.location(a.Location),
this.description(a.Description.replace(/\r/g,"").replace(/\n/g,"<br />")),this.when(a.When),this.calendarId(a.CalendarId),this.selectedCalendar(a.CalendarId))};C.prototype.acceptAppointment=function(){this.changeAndSaveConfig(e.IcalConfig.Accepted)};C.prototype.tentativeAppointment=function(){this.changeAndSaveConfig(e.IcalConfig.Tentative)};C.prototype.declineAppointment=function(){this.changeAndSaveConfig(e.IcalConfig.Declined)};C.prototype.changeAndSaveConfig=function(a){this.changeConfig(a);this.doProcessAppointment()};
C.prototype.changeConfig=function(a){this.type(this.icalType()+"-"+a)};C.prototype.onProcessAppointmentResponse=function(a){(!a||!a.Result)&&f.Api.showError(c.i18n("WARNING/UNKNOWN_ERROR"))};C.prototype.doProcessAppointment=function(){var a={Action:"ProcessAppointment",AppointmentAction:this.icalConfig(),CalendarId:this.selectedCalendar(),File:this.file()};f.Ajax.send(a,this.onProcessAppointmentResponse,this)};C.prototype.onAddEventResponse=function(a){a&&(a.Result&&a.Result.Uid)&&this.uid(a.Result.Uid)};
C.prototype.addEvent=function(){var a={Action:"SaveIcs",CalendarId:this.selectedCalendar(),File:this.file()};f.Ajax.send(a,this.onAddEventResponse,this);this.isJustSaved(!0);this.calendarId(this.selectedCalendar());setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2E4);f.EventsCache.recivedAnim(!0)};C.prototype.onEventDelete=function(){this.calendarId("");this.selectedCalendar("");this.icalConfig(e.IcalConfig.NeedsAction)};C.prototype.onEventTentative=function(){this.changeConfig(e.IcalConfig.Tentative)};
C.prototype.onEventAccept=function(){this.changeConfig(e.IcalConfig.Accepted)};C.prototype.firstCalendarName=function(){return this.calendars()[0]?this.calendars()[0].name:""};xa.prototype.parse=function(a){a&&"Object/CApiMailVcard"===a["@Object"]&&(this.uid(a.Uid.toString()),this.file(a.File),this.name(a.Name),this.email(a.Email),this.isExists(a.Exists))};xa.prototype.onAddContactResponse=function(a){a&&(a.Result&&a.Result.Uid)&&this.uid(a.Result.Uid)};xa.prototype.addContact=function(){var a={Action:"SaveVcf",
File:this.file()};f.Ajax.send(a,this.onAddContactResponse,this);this.isJustSaved(!0);this.isExists(!0);setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2E4);f.ContactsCache.recivedAnim(!0)};x.birthdayMonthSelect=[{text:c.i18n("DATETIME/MONTH"),value:"0"},{text:c.i18n("DATETIME_MONTH/JANUARY"),value:"1"},{text:c.i18n("DATETIME_MONTH/FEBRUARY"),value:"2"},{text:c.i18n("DATETIME_MONTH/MARCH"),value:"3"},{text:c.i18n("DATETIME_MONTH/APRIL"),value:"4"},{text:c.i18n("DATETIME_MONTH/MAY"),value:"5"},
{text:c.i18n("DATETIME_MONTH/JUNE"),value:"6"},{text:c.i18n("DATETIME_MONTH/JULY"),value:"7"},{text:c.i18n("DATETIME_MONTH/AUGUST"),value:"8"},{text:c.i18n("DATETIME_MONTH/SEPTEMBER"),value:"9"},{text:c.i18n("DATETIME_MONTH/OCTOBER"),value:"10"},{text:c.i18n("DATETIME_MONTH/NOVEMBER"),value:"11"},{text:c.i18n("DATETIME_MONTH/DECEMBER"),value:"12"}];x.birthdayYearSelect=[{text:c.i18n("DATETIME/YEAR"),value:"0"}];x.prototype.getSendMailLink=function(a){a=this.getFullEmail(a);a=f.Links.composeWithToField(a);
return f.Routing.buildHashFromArray(a)};x.prototype.clear=function(){this.isNew(!1);this.readOnly(!1);this.idContact("");this.idUser("");this.edited(!1);this.extented(!1);this.personalCollapsed(!1);this.businessCollapsed(!1);this.otherCollapsed(!1);this.groupsCollapsed(!1);this.displayName("");this.firstName("");this.lastName("");this.nickName("");this.primaryEmail(this.sDefaultType);this.personalEmail("");this.personalStreetAddress("");this.personalCity("");this.personalState("");this.personalZipCode("");
this.personalCountry("");this.personalWeb("");this.personalFax("");this.personalPhone("");this.personalMobile("");this.businessEmail("");this.businessCompany("");this.businessDepartment("");this.businessJob("");this.businessOffice("");this.businessStreetAddress("");this.businessCity("");this.businessState("");this.businessZipCode("");this.businessCountry("");this.businessWeb("");this.businessFax("");this.businessPhone("");this.otherEmail("");this.otherBirthdayMonth("0");this.otherBirthdayDay("0");
this.otherBirthdayYear("0");this.otherNotes("");this.etag("");this.groups([])};x.prototype.switchToNew=function(){this.clear();this.edited(!0);this.extented(!1);this.isNew(!0);this.displayNameFocused(!0)};x.prototype.switchToView=function(){this.edited(!1);this.extented(!1)};x.prototype.toObject=function(){return{ContactId:this.idContact(),PrimaryEmail:this.primaryEmail(),UseFriendlyName:"1",Title:"",FullName:this.displayName(),FirstName:this.firstName(),LastName:this.lastName(),NickName:this.nickName(),
HomeEmail:this.personalEmail(),HomeStreet:this.personalStreetAddress(),HomeCity:this.personalCity(),HomeState:this.personalState(),HomeZip:this.personalZipCode(),HomeCountry:this.personalCountry(),HomeFax:this.personalFax(),HomePhone:this.personalPhone(),HomeMobile:this.personalMobile(),HomeWeb:this.personalWeb(),BusinessEmail:this.businessEmail(),BusinessCompany:this.businessCompany(),BusinessJobTitle:this.businessJob(),BusinessDepartment:this.businessDepartment(),BusinessOffice:this.businessOffice(),
BusinessStreet:this.businessStreetAddress(),BusinessCity:this.businessCity(),BusinessState:this.businessState(),BusinessZip:this.businessZipCode(),BusinessCountry:this.businessCountry(),BusinessFax:this.businessFax(),BusinessPhone:this.businessPhone(),BusinessWeb:this.businessWeb(),OtherEmail:this.otherEmail(),Notes:this.otherNotes(),ETag:this.etag(),BirthdayDay:this.otherBirthdayDay(),BirthdayMonth:this.otherBirthdayMonth(),BirthdayYear:this.otherBirthdayYear(),GroupsIds:this.groups()}};x.prototype.parse=
function(a){if(a&&"Object/CContact"===a["@Object"]){this.idContact(c.pExport(a,"IdContact","").toString());this.idUser(c.pExport(a,"IdUser","").toString());this.readOnly(!!c.pExport(a,"ReadOnly",!1));this.displayName(c.pExport(a,"FullName",""));this.firstName(c.pExport(a,"FirstName",""));this.lastName(c.pExport(a,"LastName",""));this.nickName(c.pExport(a,"NickName",""));var d=c.pInt(c.pExport(a,"PrimaryEmail",0));switch(d){case 1:d=e.ContactEmailType.Business;break;case 2:d=e.ContactEmailType.Other;
break;default:case 0:d=e.ContactEmailType.Personal}this.primaryEmail(d);this.personalEmail(c.pExport(a,"HomeEmail",""));this.personalStreetAddress(c.pExport(a,"HomeStreet",""));this.personalCity(c.pExport(a,"HomeCity",""));this.personalState(c.pExport(a,"HomeState",""));this.personalZipCode(c.pExport(a,"HomeZip",""));this.personalCountry(c.pExport(a,"HomeCountry",""));this.personalWeb(c.pExport(a,"HomeWeb",""));this.personalFax(c.pExport(a,"HomeFax",""));this.personalPhone(c.pExport(a,"HomePhone",
""));this.personalMobile(c.pExport(a,"HomeMobile",""));this.businessEmail(c.pExport(a,"BusinessEmail",""));this.businessCompany(c.pExport(a,"BusinessCompany",""));this.businessDepartment(c.pExport(a,"BusinessDepartment",""));this.businessJob(c.pExport(a,"BusinessJobTitle",""));this.businessOffice(c.pExport(a,"BusinessOffice",""));this.businessStreetAddress(c.pExport(a,"BusinessStreet",""));this.businessCity(c.pExport(a,"BusinessCity",""));this.businessState(c.pExport(a,"BusinessState",""));this.businessZipCode(c.pExport(a,
"BusinessZip",""));this.businessCountry(c.pExport(a,"BusinessCountry",""));this.businessWeb(c.pExport(a,"BusinessWeb",""));this.businessFax(c.pExport(a,"BusinessFax",""));this.businessPhone(c.pExport(a,"BusinessPhone",""));this.otherEmail(c.pExport(a,"OtherEmail",""));this.otherBirthdayMonth(c.pExport(a,"BirthdayMonth","0").toString());this.otherBirthdayDay(c.pExport(a,"BirthdayDay","0").toString());this.otherBirthdayYear(c.pExport(a,"BirthdayYear","0").toString());this.otherNotes(c.pExport(a,"Notes",
""));this.etag(c.pExport(a,"ETag",""));a=c.pExport(a,"GroupsIds",[]);_.isArray(a)&&this.groups(a)}};x.prototype.getFullEmail=function(a){var d=a;""!==this.displayName()&&(d=""!==a?'"'+this.displayName()+'" <'+a+">":this.displayName());return d};x.prototype.viewAllMails=function(){f.Api.searchMessagesInInbox("email:"+this.email())};aa.prototype.clear=function(){this.isNew(!1);this.idGroup("");this.idUser("");this.name("");this.nameFocused(!1);this.edited(!1)};aa.prototype.switchToNew=function(){this.clear();
this.edited(!0);this.isNew(!0);this.nameFocused(!0)};aa.prototype.switchToView=function(){this.edited(!1)};aa.prototype.addContactFromList=function(){};aa.prototype.toObject=function(){return{GroupId:this.idGroup(),Name:this.name()}};P.prototype.parse=function(a,d){a&&"Object/CContactListItem"===c.pExport(a,"@Object","")&&(this.sId=a.Id.toString(),this.sName=a.Name.toString(),this.sEmail=a.Email.toString(),this.bIsGroup=!!a.IsGroup,this.bReadOnly=!!a.ReadOnly,this.bGlobal=c.isUnd(d)?!1:!!d)};P.prototype.IsGroup=
function(){return this.bIsGroup};P.prototype.Global=function(){return this.bGlobal};P.prototype.ReadOnly=function(){return this.bReadOnly};P.prototype.Id=function(){return this.sId};P.prototype.Name=function(){return this.sName};P.prototype.Email=function(){return this.sEmail};P.prototype.EmailAndName=function(){return this.sName&&this.sEmail&&0<this.sName.length&&0<this.sEmail.length?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail};Ia.prototype.onDownloadClick=function(){f.downloadByUrl(this.download())};
Ja.prototype.parse=function(a,d){this.iAccountId=a;this.options(parseInt(d.Options,10));this.signature(d.Signature)};Qa.prototype.parse=function(a,d){this.iAccountId=a;this.enable=!!d.Enable;this.subject=c.pString(d.Subject);this.message=c.pString(d.Message)};Ra.prototype.parse=function(a,d){this.iAccountId=a;this.enable=!!d.Enable;this.email=c.pString(d.Email)};Sa.prototype.parse=function(a,d){var b=0,c=d.length,f=null;this.iAccountId=a;if(_.isArray(d))for(c=d.length;b<c;b++)f=new ya(a),f.parse(d[b]),
this.collection.push(f)};ya.prototype.parse=function(a){this.enable(!!a.Enable);this.field(c.pInt(a.Field));this.condition(c.pInt(a.Condition));this.filter(c.pString(a.Filter));this.action(c.pInt(a.Action));this.folder(c.pString(a.FolderFullName))};ya.prototype.toString=function(){return[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()].join(":")};wa.prototype.showLoading=function(a){a&&""!==a?this.loadingMessage(a):this.loadingMessage(c.i18n("MAIN/LOADING"));
this.loadingVisible(!0)};wa.prototype.hideLoading=function(){this.loadingVisible(!1)};wa.prototype.showReport=function(a,d){var b=this,d=d||5E3;a&&""!==a?(this.reportMessage(a),this.reportVisible(!0),isNaN(this.iReportTimeout)||clearTimeout(this.iReportTimeout),this.iReportTimeout=setTimeout(function(){b.reportVisible(!1)},d)):this.reportVisible(!1)};wa.prototype.showError=function(a,d,b){var c=this;a&&""!==a?(this.errorMessage(a),this.errorVisible(!0),this.isHtmlError(d),clearTimeout(this.iErrorTimeout),
b||(this.iErrorTimeout=setTimeout(function(){c.errorVisible(!1)},5E3))):this.errorVisible(!1)};ra.prototype.gotoMailbox=function(){f.Routing.setLastMailboxHash();return!1};ra.prototype.onRoute=function(){this.changeCurrentAccount()};ra.prototype.changeCurrentAccount=function(){this.email(g.Accounts.getEmail())};ra.prototype.onLogoutResponse=function(){f.Routing.finalize();""!==g.App.CustomLogoutUrl?j.location.href=g.App.CustomLogoutUrl:j.location.reload()};ra.prototype.logout=function(){f.Ajax.send({Action:"Logout"},
this.onLogoutResponse,this)};T.prototype.clear=function(){this.currentPage(1);this.count(0)};T.prototype.setCount=function(a){this.count(a)};T.prototype.setPage=function(a,d){this.perPage(d);this.currentPage(a)};T.prototype.clickPage=function(a){a=a.number;1>a&&(a=1);a>this.pagesCount()&&(a=this.pagesCount());this.currentPage(a)};T.prototype.clickFirstPage=function(){this.currentPage(1)};T.prototype.clickPreviousPage=function(){var a=this.firstPage()-1;1>a&&(a=1);this.currentPage(a)};T.prototype.clickNextPage=
function(){var a=this.lastPage()+1;a>this.pagesCount()&&(a=this.pagesCount());this.currentPage(a)};T.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())};m.prototype.showLinkPopup=function(a){var d=a.position(),b=a.height();this.linkHref(a.attr("href"));this.linkPopupLeft(Math.round(d.left));this.linkPopupTop(Math.round(d.top+b));this.visibleLinkPopup(!0)};m.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)};m.prototype.showChangeLink=function(){this.visibleLinkHref(!0);
this.hideLinkPopup()};m.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref());this.hideChangeLink()};m.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)};m.prototype.initCrea=function(a,d){this.oCrea?(this.setText(a),this.oCrea.setTabIndex(d)):this.oCrea=new Crea({creaId:this.creaId,tabindex:d,text:a,fontNameArray:this.aFonts,defaultFontName:this.iDefaultFont,defaultFontSize:this.iDefaultSize,onCursorMove:_.bind(this.setFontValuesFromText,this),onFocus:_.bind(this.onCreaFocus,
this),onUrlIn:_.bind(this.showLinkPopup,this),onUrlOut:_.bind(this.hideLinkPopup,this)});this.resize()};m.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus()};m.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0);this.selectedFont(this.oCrea.getFontName());this.selectedSize(this.oCrea.getFontSize());this.lockFontSubscribing(!1)};m.prototype.getText=function(){return this.oCrea?this.oCrea.getText():""};m.prototype.setText=function(a){this.oCrea&&(this.oCrea.setText(a),
this.inactive.valueHasMutated())};m.prototype.removeAllTags=function(a){return a.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")};m.prototype.setActivitySource=function(a){this.activitySource=a;this.activitySource.subscribe(function(){this.inactive(0===c.pInt(this.activitySource()))},this);this.inactive(0===c.pInt(this.activitySource()))};m.prototype.onCreaFocus=function(){this.closeAllPopups();this.activitySource(1)};m.prototype.closeAllPopups=function(){this.visibleInsertLinkPopup(!1);
this.visibleInsertImagePopup(!1);this.visibleFontColorPopup(!1)};m.prototype.insertLink=function(){this.visibleInsertLinkPopup()||(this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))};m.prototype.insertLinkFromPopup=function(a,d){0<this.linkForInsert().length&&this.oCrea.insertLink(this.linkForInsert());this.closeInsertLinkPopup(a,d)};m.prototype.closeInsertLinkPopup=function(a,d){this.visibleInsertLinkPopup(!1);d&&d.stopPropagation()};
m.prototype.textColor=function(){this.closeAllPopups();this.visibleFontColorPopup(!0);this.oFontColorPicker.onShow();this.oBackColorPicker.onShow()};m.prototype.colorToHex=function(a){if("#"===a.substr(0,1))return a;for(var a=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a),d=parseInt(a[2],10),b=parseInt(a[3],10),d=(parseInt(a[4],10)|b<<8|d<<16).toString(16);6>d.length;)d="0"+d;return a[1]+"#"+d};m.prototype.setTextColorFromPopup=function(a){this.oCrea.textColor(this.colorToHex(a));this.visibleFontColorPopup(!1)};
m.prototype.setBackColorFromPopup=function(a){this.oCrea.backgroundColor(this.colorToHex(a));this.visibleFontColorPopup(!1)};m.prototype.resize=function(){var a=i(this.containerDom()),d=i(this.headerDom()),b=a.width(),a=a.height()-d.height();this.oCrea&&this.oCrea.resize(b,a)};m.prototype.insertImage=function(){this.allowInsertImage()&&!this.visibleInsertImagePopup()&&(this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader());return!0};m.prototype.insertWebImageFromPopup=
function(a,d){this.allowInsertImage()&&0<this.imagePathFromWeb().length&&this.oCrea.insertImage(this.imagePathFromWeb());this.closeInsertImagePopup(a,d)};m.prototype.clearImages=function(){this.uploadedImagePathes([])};m.prototype.insertComputerImageFromPopup=function(a,d){var b=c.getViewLinkByHash(g.Accounts.currentId(),d.Hash),f=!1;if(this.allowInsertImage()&&0<b.length&&(f=this.oCrea.insertImage(b)))i(this.oCrea.$editableArea).find('img[src="'+b+'"]').attr("data-x-src-cid",a),d.CID=a,this.uploadedImagePathes.push(d);
this.closeInsertImagePopup()};m.prototype.closeInsertImagePopup=function(a,d){this.visibleInsertImagePopup(!1);d&&d.stopPropagation()};m.prototype.initUploader=function(){this.imageUploaderButton()&&!this.oJua&&(this.oJua=new Jua({action:"index.php?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:{Token:function(){return g.Token},AccountID:function(){return g.Accounts.currentId()}},onSelect:_.bind(this.onFileUploadSelect,
this),onComplete:_.bind(this.onFileUploadComplete,this)}))};m.prototype.isFileImage=function(a){if("string"===typeof a.Type)return-1!==a.Type.indexOf("image");var d=a.FileName.lastIndexOf("."),a=a.FileName.substr(d+1);return-1!==i.inArray(a,"jpg jpeg gif tif tiff png".split(" "))};m.prototype.onFileUploadSelect=function(a,d){if(!this.isFileImage(d))return f.Screens.showPopup(ea,[c.i18n("HTMLEDITOR/UPLOAD_ERROR_NOT_IMAGE")]),!1;this.closeInsertImagePopup();return!0};m.prototype.onFileUploadComplete=
function(a,d,b){d="";b&&b.Result?b.Result.Error?(d="size"===b.Result.Error?c.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):c.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"),f.Screens.showPopup(ea,[d])):this.insertComputerImageFromPopup(a,b.Result.Attachment):f.Screens.showPopup(ea,[c.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN")])};za.prototype.onShow=function(){i(this.colorPickerDom()).find("span.color-item").on("click",function(a){return function(){a.setColorFromPopup(i(this).data("color"))}}(this))};za.prototype.setColorFromPopup=
function(a){this.pickHandler.call(this.pickContext,a)};sa.prototype.onShow=function(){this.emailFocus(!0)};sa.prototype.signIn=function(){this.sendRequest()};sa.prototype.onResponse=function(a){!1===a.Result?(this.loading(!1),f.Api.showError(c.i18n("WARNING/LOGIN_PASS_INCORRECT"))):location.reload()};sa.prototype.sendRequest=function(){var a={Action:"Login",Email:this.email(),IncLogin:this.login(),IncPassword:this.password(),SignMe:this.signMe()?"1":"0"};this.loading(!0);f.Ajax.send(a,this.onResponse,
this)};sa.prototype.changeLanguage=function(a){a&&this.allowLanguages()&&(this.currentLanguage(a),f.Ajax.send({Action:"LoginLanguageUpdate",Language:a},function(){j.location.reload()},this))};Ka.prototype.onApplyBindings=function(){};Ka.prototype.onLineClick=function(a){a.onFolderClick()};o.prototype.changeRoutingForMessageList=function(a,d,b,c){f.Routing.setHash(f.Links.mailbox(a,d,b,c))};o.prototype.onMessageDblClick=function(a){this.folderList().getFolderByFullName(a.folder()).type()===e.FolderTypes.Drafts?
f.Routing.setHash(f.Links.composeFromMessage("drafts",a.folder(),a.uid())):c.WindowOpener.openMessage(a)};o.prototype.onFolderListSubscribe=function(){this.folderList().setCurrentFolder(this.folderFullName());this.requestMessageList()};o.prototype.onRoute=function(a){a=f.Links.parseMailbox(a);this.pageSwitcherLocked(!0);this.folderFullName()!==a.Folder||this.search()!==a.Search?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(a.Page,g.User.MailsPerPage);this.pageSwitcherLocked(!1);a.Page!==this.oPageSwitcher.currentPage()&&
f.Routing.replaceHash(f.Links.mailbox(a.Folder,this.oPageSwitcher.currentPage(),a.Uid,a.Search));this.folderFullName(a.Folder);this.search(a.Search);this.searchInput(this.search());this.folderList().setCurrentFolder(this.folderFullName());this.requestMessageList()};o.prototype.requestMessageList=function(){var a=this.folderList().currentFolderFullName(),d=this.oPageSwitcher.currentPage();0<a.length&&f.Cache.changeCurrentMessageList(a,d,this.search())};o.prototype.calculateSearchStringFromAdvancedForm=
function(){var a=this.searchInputFrom(),d=this.searchInputTo(),b=this.searchInputSubject(),c=this.searchInputText(),f=[],e=function(a){a=i.trim(a).replace(/"/g,'\\"');if(-1<a.indexOf(" ")||-1<a.indexOf('"'))a='"'+a+'"';return a};""!==a&&f.push("from:"+e(a));""!==d&&f.push("to:"+e(d));""!==b&&f.push("subject:"+e(b));""!==c&&f.push("text:"+e(c));return f.join(" ")};o.prototype.onSearchClick=function(){var a=this.folderList().currentFolderFullName(),d=this.currentMessage()?this.currentMessage().uid():
"",b=this.searchInput();this.bAdvancedSearch()&&(b=this.calculateSearchStringFromAdvancedForm(),this.searchInput(b),this.bAdvancedSearch(!1));this.changeRoutingForMessageList(a,1,d,b)};o.prototype.onRetryClick=function(){this.requestMessageList()};o.prototype.onClearSearchClick=function(){var a=this.folderList().currentFolderFullName(),d=this.currentMessage()?this.currentMessage().uid():"";this.changeRoutingForMessageList(a,1,d,"")};o.prototype.onStopSearchClick=function(){this.onClearSearchClick()};
o.prototype.routeForMessage=function(a){if(null!==a){var d=this.folderList().currentFolderFullName(),b=this.oPageSwitcher.currentPage(),a=a.uid(),c=this.search();""!==a&&this.changeRoutingForMessageList(d,b,a,c)}};o.prototype.onApplyBindings=function(a){var d=this;i(".message_list",a).on("click",".message_sub_list .item .flag",function(a){d.onFlagClick(b.dataFor(this));a&&a.stopPropagation&&a.stopPropagation()}).on("dblclick",".message_sub_list .item .flag",function(a){a&&a.stopPropagation&&a.stopPropagation()});
this.selector.initOnApplyBindings(".message_sub_list .item",".message_sub_list .selected.item",".message_sub_list .item .custom_checkbox",i(".message_list",a),i(".message_list .scroll-inner",a))};o.prototype.onFlagClick=function(a){f.Cache.executeGroupOperation("MessageSetFlagged",[a.uid()],"flagged",!a.flagged())};o.prototype.executeMarkAsRead=function(){f.Cache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!0)};o.prototype.executeMarkAsUnread=function(){f.Cache.executeGroupOperation("MessageSetSeen",
this.collectionCheckedUids(),"seen",!1)};o.prototype.executeFlag=function(){f.Cache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!0)};o.prototype.executeUnflag=function(){f.Cache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!1)};o.prototype.executeMarkAllRead=function(){f.Cache.executeGroupOperation("MessageSetAllSeen",[],"seen",!0)};o.prototype.executeMoveToFolder=function(a){f.Cache.moveMessagesToFolder(a,this.collectionCheckedUids())};
o.prototype.onDeletePress=function(a){a=_.map(a,function(a){return a.uid()});this.deleteMessages(a)};o.prototype.executeDelete=function(){this.deleteMessages(this.collectionCheckedUids())};o.prototype.deleteMessages=function(a){var d=this.folderList().currentFolderFullName(),b=this.folderList().trashFolder(),e=b&&d===b.fullName(),g=this.folderList().spamFolder(),d=g&&d===g.fullName(),g=c.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),i=function(d){d&&f.Cache.deleteMessages(a)};d?f.Cache.deleteMessages(a):
e?f.Screens.showPopup(J,[g,i]):b&&f.Cache.moveMessagesToFolder(b.fullName(),this.collectionCheckedUids())};o.prototype.executeSpam=function(){var a=this.folderList().spamFolderFullName();this.folderList().currentFolderFullName()!==a&&f.Cache.moveMessagesToFolder(a,this.collectionCheckedUids())};o.prototype.executeNotSpam=function(){var a=this.folderList().inboxFolder();a&&this.folderList().currentFolderFullName()!==a.fullName()&&f.Cache.moveMessagesToFolder(a.fullName(),this.collectionCheckedUids())};
o.prototype.fillAdvancedSearch=function(){this.searchInputFrom("");this.searchInputTo("");this.searchInputSubject("");this.searchInputText("");this.bAdvancedSearch(!0)};p.prototype.notifySender=function(){this.currentMessage()&&""!==this.currentMessage().readingConfirmation()&&(f.Ajax.send({Action:"MessageSendConfirmation",Confirmation:this.currentMessage().readingConfirmation(),Subject:c.i18n("MESSAGE/RETURN_RECEIPT_MAIL_SUBJECT"),Text:c.i18n("MESSAGE/RETURN_RECEIPT_MAIL_TEXT",{EMAIL:this.fullFrom(),
SUBJECT:this.subject()})}),this.currentMessage().readingConfirmation(""))};p.prototype.viewAllMailsWithContact=function(){g.SingleMode&&j.opener&&j.opener.App?(j.opener.App.Api.searchMessagesInCurrentFolder("email:"+this.fromEmail()),j.close()):f.Api.searchMessagesInCurrentFolder("email:"+this.fromEmail())};p.prototype.onMessagesSubscribe=function(){!this.currentMessage()&&0<this.uid().length&&f.Cache.setCurrentMessage(this.uid())};p.prototype.onFromContactResponse=function(a){a?(this.fromContact(a),
this.fromExistsInContacts(!0)):(this.fromContact(new x),this.fromExistsInContacts(!1));this.fromContactInfoReceived(!0)};p.prototype.onCurrentMessageSubscribe=function(){var a=this.currentMessage(),d="",b="",c="",e=[];this.replyText("");this.replyDraftUid("");a&&this.uid()===a.uid()?(this.subject(a.subject()),this.from(a.oFrom.getDisplay()),this.fromEmail(a.oFrom.getFirstEmail()),this.fromName(a.oFrom.getFirstName()),this.fromContactInfoReceived(!1),a.completelyFilled()&&(this.fromEmail()&&""!==this.fromEmail())&&
f.ContactsCache.getContactByEmail(this.fromEmail(),this.onFromContactResponse,this),this.fullFrom(a.oFrom.getFull()),this.to(a.oTo.getFull()),this.cc(a.oCc.getFull()),this.bcc(a.oBcc.getFull()),d=a.oTo.getDisplay(),b=a.oCc.getDisplay(),c=a.oBcc.getDisplay(),0<d.length&&e.push(d),0<b.length&&e.push(b),0<c.length&&e.push(c),this.allRecipients(e.join(", ")),this.midDate(a.oDateModel.getMidDate()),this.fullDate(a.oDateModel.getFullDate()),this.isLoading(""!==a.uid()&&!a.completelyFilled()),this.setMessageBody(a),
this.attachments(a.attachments()),this.visiblePicturesControl(a.hasExternals()&&!a.isExternalsAlwaysShown()),this.visibleShowPicturesLink(!a.isExternalsShown()),this.ical(a.ical()),this.vcard(a.vcard()),a.completelyFilled()?a.completelyFilledSubscription&&(a.completelyFilledSubscription.dispose(),a.completelyFilledSubscription=void 0):a.completelyFilledSubscription=a.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this)):(this.isLoading(!1),i(this.domTextBody()).empty(),this.attachments([]),
this.visiblePicturesControl(!1),this.visibleShowPicturesLink(!1),this.ical(null),this.vcard(null))};p.prototype.setMessageBody=function(a){a&&(this.textBody(a.text()),i(this.domTextBody()).empty().append(a.getDomText().html()))};p.prototype.onRoute=function(a){a=f.Links.parseMailbox(a);this.uid(a.Uid);f.Cache.setCurrentMessage(this.uid())};p.prototype.showPictures=function(){f.Cache.showExternalPictures(!1);this.visibleShowPicturesLink(!1);this.setMessageBody(this.currentMessage())};p.prototype.alwaysShowPictures=
function(){var a=this.currentMessage()?this.currentMessage().oFrom.getFirstEmail():"";0<a.length&&f.Ajax.send({Action:"EmailSafety",Email:a});f.Cache.showExternalPictures(!0);this.visiblePicturesControl(!1);this.setMessageBody(this.currentMessage())};p.prototype.showDetails=function(){this.detailsVisible(!0)};p.prototype.hideDetails=function(){this.detailsVisible(!1)};p.prototype.openInNewWindow=function(){var a=f.Cache.folderList().currentFolder().type()===e.FolderTypes.Drafts;c.WindowOpener.openMessage(this.currentMessage(),
a)};p.prototype.addToContacts=function(){var a={Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:this.fromName(),HomeEmail:this.fromEmail()};f.Ajax.send(a,this.onAddToContactsResponse,this)};p.prototype.onAddToContactsResponse=function(a,d){a.Result&&(""!==d.HomeEmail&&d.HomeEmail===this.fromEmail())&&(f.Api.showReport(c.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),f.ContactsCache.clearInfoAboutEmail(this.fromEmail()),f.ContactsCache.getContactByEmail(this.fromEmail(),
this.onFromContactResponse,this))};p.prototype.executePrevMessage=function(){};p.prototype.executeNextMessage=function(){};p.prototype.executeReplyOrForward=function(a){this.currentMessage()&&(f.MessageSender.setReplyData(this.replyText(),this.replyDraftUid()),this.replyText(""),this.replyDraftUid(""),f.Routing.setHash(f.Links.composeFromMessage(a,this.currentMessage().folder(),this.currentMessage().uid())))};p.prototype.executeReply=function(){this.executeReplyOrForward(e.ReplyType.Reply)};p.prototype.executeReplyAll=
function(){this.executeReplyOrForward(e.ReplyType.ReplyAll)};p.prototype.executeForward=function(){this.executeReplyOrForward(e.ReplyType.Forward)};p.prototype.executePrint=function(){var a=c.WindowOpener.open("",this.subject()+"-print"),d=this.currentMessage().getDomText(c.getAppPath()),b="";this.textBodyForNewWindow(d.html());b=i(this.domMessageForPrint()).html();i(a.document.body).html(b);a.print()};p.prototype.executeSave=function(){this.currentMessage()&&f.downloadByUrl(this.currentMessage().download())};
p.prototype.changeAddMenuVisibility=function(){var a=!this.visibleAddMenu();this.visibleAddMenu(a)};p.prototype.onMessageSendResponse=function(a,d){var b=f.MessageSender.onMessageSendResponse(a,d);switch(b.Action){case "MessageSend":this.replySendingStarted(!1);b.Result&&this.replyText("");break;case "MessageSave":this.replySavingStarted(!1),b.Result&&this.replyDraftUid(b.NewUid)}};p.prototype.sendReplyMessage=function(){if(""!==this.replyText()){var a=f.MessageSender.getHtmlFromText(this.replyText());
this.replySendingStarted(!0);f.MessageSender.sendReplyMessage("MessageSend",a,this.replyDraftUid(),this.onMessageSendResponse,this)}};p.prototype.saveReplyMessage=function(){if(""!==this.replyText()){var a=f.MessageSender.getHtmlFromText(this.replyText());this.replySavingStarted(!0);f.MessageSender.sendReplyMessage("MessageSave",a,this.replyDraftUid(),this.onMessageSendResponse,this)}};ba.prototype.onRoute=function(a){this.oMessageList.onRoute(a);this.oMessagePane.onRoute(a)};ba.prototype.onShow=
function(){this.oMessageList.selector.useKeyboardKeys(!0)};ba.prototype.onHide=function(){this.oMessageList.selector.useKeyboardKeys(!1)};ba.prototype.onApplyBindings=function(){var a=this;this.oMessageList.onApplyBindings(this.$viewModel);i(this.domFolderList()).on("click","span.folder",function(){a.oMessageList.executeMoveToFolder(i(this).data("folder"))});i(this.$viewModel).on("click","a",function(){var a=i(this).attr("href");return a&&"mailto:"===a.toString().toLowerCase().substr(0,7)?(f.Api.openComposeMessage(a.toString().substr(7)),
!1):!0});i(document).on("keyup",function(b){b&&b.keyCode===e.Key.s&&a.searchFocus()})};ba.prototype.dragAndDronHelper=function(a){a&&a.checked(!0);var a=c.draggebleMessages(),b=this.oMessageList.selector.listCheckedOrSelected().length,h=0<b?_.map(this.oMessageList.selector.listCheckedOrSelected(),function(a){return a.uid()}):[];a.data("p7-message-list-folder",this.folderList().currentFolderFullName());a.data("p7-message-list-uids",h);i(".count-text",a).text(c.i18n("MAILBOX/DRAG_TEXT_PLURAL",{COUNT:b},
null,b));return a};ba.prototype.messagesDrop=function(a,b,h){if(a){var f=h&&h.helper?h.helper:null,e=f?f.data("p7-message-list-folder"):"",f=f?f.data("p7-message-list-uids"):null;""!==e&&null!==f&&(c.uiDropHelperAnim(b,h),this.oMessageList.executeMoveToFolder(a.fullName()))}};ba.prototype.searchFocus=function(){this.oMessageList.selector.useKeyboardKeys()&&!c.inFocus()&&this.oMessageList.isFocused(!0)};l.prototype.isEnableSending=function(){var a=0===this.toAddr().length&&0===this.ccAddr().length&&
0===this.bccAddr().length;return 0!==this.folderList().iAccountId&&!this.sending()&&!a&&this.allAttachmentsUploaded()};l.prototype.isEnableSaving=function(){return 0!==this.folderList().iAccountId&&!this.sending()&&!this.saving()};l.prototype.onApplyBindings=function(){this.initUploader()};l.prototype.getMessageOnRoute=function(){var a=this.routeParams(),b="",c="";""!==this.routeType()&&3===a.length&&(b=a[1],c=a[2],f.Cache.getMessage(b,c,this.onMessageResponse,this));this.routeParams([])};l.prototype.onShow=
function(){this.useSaveMailInSentItems(g.User.getUseSaveMailInSentItems());this.saveMailInSentItems(g.User.getSaveMailInSentItems());this.oHtmlEditor.initCrea(this.textBody(),"7");this.oHtmlEditor.clearImages();this.commitedTextBody(this.oHtmlEditor.getText());this.shown(!0);this.startAutosave();this.focusAfterFilling()};l.prototype.onRoute=function(a){this.selectedAccountId(g.Accounts.currentId());var b=g.Accounts.getAccount(this.selectedAccountId()),b=(b=b?b.signature():null)&&b.options()?b.signature():
"";this.messageUploadAttachmentsStarted(!1);this.draftUid("");this.draftInfo.removeAll();this.setDataFromMessage(new B);this.isDraftsCleared(!1);this.routeType(0<a.length?a[0]:"");switch(this.routeType()){case e.ReplyType.Reply:case e.ReplyType.ReplyAll:case e.ReplyType.Forward:case "drafts":this.routeParams(a);0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;default:this.singleMode()&&j.opener&&j.opener.oMessageParametersFromCompose?(this.setMessageDataInSingleMode(j.opener.oMessageParametersFromCompose),
j.opener.oMessageParametersFromCompose=void 0):""!==b&&this.textBody("<br /><br />"+b),"to"===this.routeType()&&1<a.length&&this.toAddr(a[1])}this.visibleCc(""!==this.ccAddr());this.visibleBcc(""!==this.bccAddr());this.commit(this.oHtmlEditor.getText());this.focusAfterFilling()};l.prototype.focusAfterFilling=function(){0===this.toAddr().length?this.toAddrFocused(!0):0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()};l.prototype.onHide=function(){this.shown(!1);this.stopAutosave();
this.oHtmlEditor.closeAllPopups()};l.prototype.stopAutosave=function(){j.clearInterval(this.autoSaveTimer())};l.prototype.startAutosave=function(){if(this.shown()){var a=_.bind(this.executeSave,this,!0);this.stopAutosave();g.App.AutoSave&&this.autoSaveTimer(j.setInterval(a,1E3*g.App.AutoSaveIntervalSeconds))}};l.prototype.onMessageResponse=function(a){var b=null;if(null===a)this.setDataFromMessage(new B);else{switch(this.routeType()){case e.ReplyType.Reply:case e.ReplyType.ReplyAll:case e.ReplyType.Forward:b=
f.MessageSender.getReplyDataFromMessage(a,this.routeType(),this.selectedAccountId());this.draftInfo(b.DraftInfo);this.draftUid(b.DraftUid);this.toAddr(b.To);this.ccAddr(b.Cc);this.subject(b.Subject);this.textBody(b.Text);this.attachments(b.Attachments);this.inReplyTo(b.InReplyTo);this.references(b.References);break;case "drafts":this.draftUid(a.uid()),this.setDataFromMessage(a)}this.routeType("")}0<this.attachments().length&&this.requestAttachmentsTempName();this.visibleCc(""!==this.ccAddr());this.visibleBcc(""!==
this.bccAddr());this.commit(this.oHtmlEditor.getText());this.focusAfterFilling()};l.prototype.changeSelectedAccountId=function(a){g.Accounts.hasAccountWithId(a)&&this.selectedAccountId(a)};l.prototype.setDataFromMessage=function(a){var b=a.getDomText().html();this.draftInfo(a.draftInfo());this.inReplyTo(a.inReplyTo());this.references(a.references());this.changeSelectedAccountId(a.accountId());this.toAddr(a.oTo.getFull());this.ccAddr(a.oCc.getFull());this.bccAddr(a.oBcc.getFull());this.subject(a.subject());
this.attachments(a.attachments());this.textBody(b?b:a.text());this.selectedImportance(a.importance());this.selectedSensitivity(a.sensitivity());this.readingConfirmation(a.readingConfirmation())};l.prototype.requestAttachmentsTempName=function(){var a=_.map(this.attachments(),function(a){a.uploadStarted(!0);return a.hash()}),b={Action:"MessageUploadAttachments",Attachments:a};0<a.length&&(f.Ajax.send(b,this.onMessageUploadAttachmentsResponse,this),this.messageUploadAttachmentsStarted(!0))};l.prototype.onMessageUploadAttachmentsResponse=
function(a){a.Result&&_.each(a.Result,_.bind(this.setAttachTepmNameByHash,this));this.messageUploadAttachmentsStarted(!1)};l.prototype.setAttachTepmNameByHash=function(a,b){_.each(this.attachments(),function(c){c.hash()===a&&(c.tempName(b),c.uploadStarted(!1))})};l.prototype.setMessageDataInSingleMode=function(a){this.draftInfo(a.draftInfo);this.draftUid(a.draftUid);this.inReplyTo(a.inReplyTo);this.references(a.references);this.changeSelectedAccountId(a.selectedAccountId);this.toAddr(a.toAddr);this.ccAddr(a.ccAddr);
this.bccAddr(a.bccAddr);this.subject(a.subject);this.attachments(_.map(a.attachments,function(a){var b=new N;b.parse(a,this.selectedAccountId());return b},this));this.textBody(a.textBody);this.selectedImportance(a.selectedImportance);this.selectedSensitivity(a.selectedSensitivity);this.readingConfirmation(a.readingConfirmation)};l.prototype.isEmpty=function(){var a=c.trim(this.toAddr()),b=c.trim(this.ccAddr()),h=c.trim(this.bccAddr()),f=c.trim(this.subject()),e=this.oHtmlEditor.getText(),e=c.trim(e.replace(/<br *\/{0,1}>/gi,
"\n").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," "));return""===a&&""===b&&""===h&&""===f&&0===this.attachments().length&&""===e};l.prototype.commit=function(a){this.toAddr.commit();this.ccAddr.commit();this.bccAddr.commit();this.subject.commit();this.commitedTextBody(a);this.attachmentsChanged(!1)};l.prototype.isChanged=function(){return this.toAddr.changed()||this.ccAddr.changed()||this.bccAddr.changed()||this.subject.changed()||this.commitedTextBody()!==this.oHtmlEditor.getText()||this.attachmentsChanged()};
l.prototype.executeBackToList=function(){this.isChanged()&&!this.isEmpty()&&this.executeSave(!0);this.singleMode()?j.close():e.Screens.Contacts===f.Routing.previousHash?f.Routing.setPreviousHash():f.Routing.setLastMailboxHash()};l.prototype.onFileUploadSelect=function(a,b){var h;h=c.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:b.FileName});if(0<g.App.AttachmentSizeLimit&&b.Size>g.App.AttachmentSizeLimit)return f.Screens.showPopup(ea,[h]),!1;h=new N;h.onUploadSelect(a,b);this.attachments.push(h);
this.attachmentsChanged(!0);return!0};l.prototype.getAttachmentByUid=function(a){return _.find(this.attachments(),function(b){return b.uploadUid()===a})};l.prototype.onFileUploadStart=function(a){if(a=this.getAttachmentByUid(a))a.onUploadStart()};l.prototype.onFileUploadProgress=function(a,b,c){if(a=this.getAttachmentByUid(a))a.onUploadProgress(b,c)};l.prototype.onFileUploadComplete=function(a,b,c){var f=this.getAttachmentByUid(a);if(f)f.onUploadComplete(a,b,c?c.Result:!1,c?c.AccountID:null)};l.prototype.onAttachmentRemove=
function(a){var b=this.getAttachmentByUid(a);this.oJua&&this.oJua.cancel(a);this.attachments.remove(b);this.attachmentsChanged(!0)};l.prototype.initUploader=function(){this.composeUploaderButton()&&(this.oJua=new Jua({action:"index.php?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableDragAndDrop:!1,hidden:{Token:function(){return g.Token},AccountID:function(){return g.Accounts.currentId()}},
onDragEnter:_.bind(this.composeUploaderDragOver,this,!0),onDragLeave:_.bind(this.composeUploaderDragOver,this,!1),onBodyDragEnter:_.bind(this.composeUploaderBodyDragOver,this,!0),onBodyDragLeave:_.bind(this.composeUploaderBodyDragOver,this,!1),onProgress:_.bind(this.onFileUploadProgress,this),onSelect:_.bind(this.onFileUploadSelect,this),onStart:_.bind(this.onFileUploadStart,this),onComplete:_.bind(this.onFileUploadComplete,this)}),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))};l.prototype.getSendSaveParameters=
function(){var a=f.MessageSender.convertAttachmentsForSending(this.attachments());_.each(this.oHtmlEditor.uploadedImagePathes(),function(b){a[b.TempName]=[b.Name,b.CID,"1","1"]});return{DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.oHtmlEditor.getText(),Importance:this.selectedImportance(),Sensivity:this.selectedSensitivity(),ReadingConfirmation:this.readingConfirmation()?"1":"0",Attachments:a,InReplyTo:this.inReplyTo(),
References:this.references()}};l.prototype.onMessageSendResponse=function(a,b){var c=f.MessageSender.onMessageSendResponse(a,b);this.commit(b.Text);switch(c.Action){case "MessageSave":c.Result&&c.NewUid&&(this.draftUid(c.NewUid),this.startAutosave());this.saving(!1);break;case "MessageSend":c.Result&&this.executeBackToList(),this.sending(!1)}};l.prototype.verifyDataForSending=function(){var a=c.getIncorrectEmailsFromAddressString(this.toAddr()),b=c.getIncorrectEmailsFromAddressString(this.ccAddr()),
h=c.getIncorrectEmailsFromAddressString(this.bccAddr()),a=_.union(a,b,h),b=c.i18n("COMPOSE/WARNING_INPUT_CORRECT_EMAILS")+a.join(", ");return 0<a.length?(f.Screens.showPopup(ea,[b]),!1):!0};l.prototype.executeSend=function(){this.isEnableSending()&&this.verifyDataForSending()&&(this.stopAutosave(),this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),f.MessageSender.send("MessageSend",this.getSendSaveParameters(),this.saveMailInSentItems(),!0,this.onMessageSendResponse,this,this.requiresPostponedSending()))};
l.prototype.executeSaveCommand=function(){this.executeSave(!1)};l.prototype.executeSave=function(a){this.isEnableSaving()&&(this.stopAutosave(),this.saving(!0),f.MessageSender.send("MessageSave",this.getSendSaveParameters(),this.saveMailInSentItems(),!a,this.onMessageSendResponse,this))};l.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc());this.visibleBcc()?this.bccAddrFocused(!0):this.toAddrFocused(!0)};l.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc());
this.visibleCc()?this.ccAddrFocused(!0):this.toAddrFocused(!0)};l.prototype.getMessageDataForSingleMode=function(){var a=_.map(this.attachments(),function(a){return{"@Object":"Object/CApiMailAttachment",FileName:a.fileName(),MimeType:a.type(),EstimatedSize:a.size(),CID:a.cid(),IsInline:a.inline(),IsLinked:a.linked(),Hash:a.hash()}});return{draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),selectedAccountId:this.selectedAccountId(),toAddr:this.toAddr(),
ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:a,textBody:this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),selectedSensitivity:this.selectedSensitivity(),readingConfirmation:this.readingConfirmation()}};l.prototype.openInNewWindow=function(){j.oMessageParametersFromCompose=this.getMessageDataForSingleMode();c.WindowOpener.open("#"+e.Screens.SingleCompose,"new_message_window"+Math.random());this.commit(this.oHtmlEditor.getText());this.executeBackToList()};
l.prototype.computeHeight=function(){var a=this.messageForm(),b=this.messageFields();a&&b&&_.defer(function(){var c=i(b).outerHeight();i(a).css({"padding-top":c,"margin-top":-c})})};l.prototype.autocompleteCallback=function(a,b){var h={Action:"ContactSuggestions",Search:a},a=c.trim(a);""!==a?f.Ajax.send(h,function(a){var h=[];a&&(a.Result&&a.Result&&a.Result.List)&&(h=_.map(a.Result.List,function(a){return a&&a.Email?a.Name&&0<c.trim(a.Name).length?'"'+a.Name+'" <'+a.Email+">":a.Email:""}),h=_.compact(h));
b(h)},this):b([])};Aa.prototype.onFileImportStart=function(){this.importing(!0)};Aa.prototype.onFileImportComplete=function(a,b,h){this.importing(!1);this.oParent.requestContactList();b&&h&&h.Result?(a=c.pInt(h.Result.ImportedCount),0<a?f.Api.showReport(c.i18n("CONTACTS/CONTACT_IMPORT_HINT_PLURAL",{NUM:a},null,a)):f.Api.showError(c.i18n("WARNING/CONTACTS_IMPORT_NO_CONTACTS"))):f.Api.showError(c.i18n("WARNING/CONTACTS_IMPORT_ERROR"))};Aa.prototype.onApplyBindings=function(a){this.oJua=new Jua({action:"index.php?/Upload/Contacts/",
name:"jua-uploader",queueSize:1,clickElement:i("#jue_import_button",a),disableAjaxUpload:!1,disableDragAndDrop:!0,disableMultiple:!0,hidden:{Token:function(){return g.Token},AccountID:function(){return g.Accounts.currentId()}},onStart:_.bind(this.onFileImportStart,this),onComplete:_.bind(this.onFileImportComplete,this)})};n.prototype.executeSave=function(a){var b={},c=[];a===this.selectedItem()&&(a instanceof x&&!a.readOnly()?(_.each(this.groupFullCollection(),function(a){a&&a.checked()&&c.push(a.Id())}),
a.groups(c),b=a.toObject(),b.Action=a.isNew()?"ContactCreate":"ContactUpdate",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),f.Ajax.send(b,this.onResponse,this)):a instanceof aa&&!a.readOnly()&&(b=a.toObject(),b.Action=a.isNew()?"GroupCreate":"GroupUpdate",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),f.Ajax.send(b,this.onResponse,this)))};n.prototype.executeBackToList=function(){f.Routing.setLastMailboxHash()};n.prototype.executeNewContact=function(){var a=this.selectedGroupInList();
this.oContactModel.switchToNew();this.oContactModel.groups(a?[a.Id()]:[]);this.selectedItem(this.oContactModel);this.selector.itemSelected(null)};n.prototype.executeNewGroup=function(){this.oGroupModel.switchToNew();this.selectedItem(this.oGroupModel);this.selector.itemSelected(null)};n.prototype.executeDelete=function(){var a=this,b=this.selectedContact(),h=this.selector.listCheckedOrSelected(),e=_.map(h,function(a){return a.ReadOnly()?"":a.Id()}),e=_.compact(e);0<e.length&&(_.each(h,function(a){a&&
(f.ContactsCache.clearInfoAboutEmail(a.Email()),b&&(!a.IsGroup()&&!a.ReadOnly()&&!b.readOnly()&&b.idContact()===a.Id())&&(b=null,this.selectedContact(null)))},this),_.each(this.collection(),function(a){-1<c.inArray(a,h)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),f.Ajax.send({Action:"ContactDelete",ContactsId:e.join(",")},this.onResponse,this),f.ContactsCache.markVcardsNonexistent(e))};n.prototype.executeRemoveFromGroup=function(){var a=this,b=this.selectedGroupInList(),
h=this.selector.listCheckedOrSelected(),e=_.map(h,function(a){return a.ReadOnly()?"":a.Id()}),e=_.compact(e);b&&0<e.length&&(_.each(this.collection(),function(a){-1<c.inArray(a,h)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),f.Ajax.send({Action:"RemoveContactsFromGroup",GroupId:b.Id(),ContactsId:e.join(",")},this.onResponse,this))};n.prototype.executeImport=function(){this.selectedItem(null);this.oContactImportViewModel.visibility(!0);this.selector.itemSelected(null);
this.selectedGroupType(e.ContactsGroupListType.Personal)};n.prototype.executeExport=function(){f.downloadByUrl(c.getExportContactsLink())};n.prototype.executeCancel=function(){var a=this.selectedItem();a&&(a instanceof x&&!a.readOnly()?a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1):a instanceof aa&&!a.readOnly()&&(a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1)));this.oContactImportViewModel.visibility(!1)};n.prototype.executeAddContactsToGroup=function(a,b,c){a&&(_.isArray(b)&&
0<b.length)&&(a.recivedAnim(!0),f.Ajax.send({Action:"AddContactsToGroup",Global:c?"1":"0",GroupId:a.Id(),ContactsId:b.join(",")},this.onResponse,this))};n.prototype.executeAddContactsToGroupId=function(a,b,c){a&&(_.isArray(b)&&0<b.length)&&f.Ajax.send({Action:"AddContactsToGroup",Global:c?"1":"0",GroupId:a,ContactsId:b.join(",")},this.onResponse,this)};n.prototype.executeAddSelectedContactsToGroup=function(a){var b=!1,c=this.selector.listCheckedOrSelected(),f=[];a&&(_.isArray(c)&&0<c.length)&&_.each(c,
function(a){a&&!a.IsGroup()&&(b=a.Global(),f.push(a.Id()))},this);this.executeAddContactsToGroup(a,f,b)};n.prototype.groupsInContactView=function(a){var b=[],h=[];a&&!a.groupsIsEmpty()&&(h=a.groups(),b=_.filter(this.groupFullCollection(),function(a){return 0<=c.inArray(a.Id(),h)}));return b};n.prototype.isEnableAddContacts=function(){return 0<this.selector.listCheckedOrSelected().length};n.prototype.isEnableRemoveContactsFromGroup=function(){return 0<this.selector.listCheckedOrSelected().length};
n.prototype.isEnableDeleting=function(){return 0<this.selector.listCheckedOrSelected().length};n.prototype.onShow=function(){this.selector.useKeyboardKeys(!0);this.oPageSwitcher.perPage(g.User.ContactsPerPage);this.oPageSwitcher.currentPage(1);this.requestContactList()};n.prototype.onHide=function(){this.selector.useKeyboardKeys(!1)};n.prototype.onApplyBindings=function(){this.selector.initOnApplyBindings(".contact_sub_list .item",".contact_sub_list .selected.item",".contact_sub_list .item .custom_checkbox",
i(".contact_list",this.$viewModel),i(".contact_list .scroll-inner",this.$viewModel));var a=this;this.$viewModel.on("click",".content .item.add_to .dropdown_helper .item",function(){i(this).hasClass("new-group")?a.executeNewGroup():a.executeAddSelectedContactsToGroup(b.dataFor(this))});this.showPersonalContacts(!!g.User.ShowPersonalContacts);this.showGlobalContacts(!!g.User.ShowGlobalContacts);this.selectedGroupType.valueHasMutated();this.oContactImportViewModel.onApplyBindings(this.$viewModel);this.requestGroupFullList();
i(document).on("keyup",function(b){b&&b.keyCode===e.Key.s&&a.searchFocus()})};n.prototype.requestContactList=function(){this.loadingList(!0);f.Ajax.send({Action:e.ContactsGroupListType.Global===this.selectedGroupType()?"GlobalContactList":"ContactList",Offset:(this.oPageSwitcher.currentPage()-1)*g.User.ContactsPerPage,Limit:g.User.ContactsPerPage,SortField:this.sortType(),SortOrder:this.sortOrder()?"1":"0",Search:this.search(),GroupId:this.selectedGroupInList()?this.selectedGroupInList().Id():""},
this.onResponse,this)};n.prototype.requestGroupFullList=function(){f.Ajax.send({Action:"GroupFullList"},this.onResponse,this)};n.prototype.requestContact=function(a){this.loadingViewPane(!0);a&&f.Ajax.send({Action:a.Global()?"GlobalContact":"Contact",ContactId:a.Id()},this.onResponse,this)};n.prototype.requestContactById=function(a,b){this.loadingViewPane(!0);a&&f.Ajax.send({Action:b?"GlobalContact":"Contact",ContactId:a},this.onResponse,this)};n.prototype.viewGroup=function(a){if(a&&a.IsGroup()){var b=
_.find(this.groupFullCollection(),function(b){return b&&a&&b===a});b&&(this.oGroupModel.clear(),this.oGroupModel.idGroup(b.Id()).name(b.Name()),this.oPageSwitcher.currentPage(1),this.selectedGroupInList(b),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null),this.selector.listCheckedOrSelected(!1))}};n.prototype.deleteGroup=function(a){a&&(f.Ajax.send({Action:"GroupDelete",GroupId:a.idGroup()},this.onResponse,this),this.selectedGroupType(e.ContactsGroupListType.Personal),this.groupFullCollection.remove(function(b){return b&&
b.Id()===a.idGroup()}))};n.prototype.mailGroup=function(a){a&&f.Ajax.send({Action:"ContactList",Offset:0,Limit:99,SortField:"Email",SortOrder:"1",GroupId:a.idGroup()},function(a){if(a&&a.Result&&a.Result.List){for(var b=0,e=0,e=[],g=null,i=[],a=a.Result.List,e=a.length;b<e;b++)a[b]&&"Object/CContactListItem"===c.pExport(a[b],"@Object","")&&(g=new P,g.parse(a[b]),i.push(g));e=_.map(i,function(a){return a.EmailAndName()});e=_.compact(e);f.Api.openComposeMessage(e.join(", "))}},this)};n.prototype.onResponse=
function(a){var b=0,h=0,g=[],i=!1,j=null,l=null,h=[],q=[],k=null;if(a&&a.Action&&a.Result)if(0<=c.inArray(a.Action,["Contact","GlobalContact"])&&"Object/CContact"===c.pExport(a.Result,"@Object",""))k=new x,k.parse(a.Result),(j=this.selector.itemSelected())&&j.Id()===k.idContact()&&this.selectedItem(k);else if(0<=c.inArray(a.Action,["ContactList","GlobalContactList"])&&a.Result&&_.isArray(a.Result.List)){i="GlobalContactList"===a.Action;for(h=a.Result.List.length;b<h;b++)a.Result.List[b]&&"Object/CContactListItem"===
c.pExport(a.Result.List[b],"@Object","")&&(k=new P,k.parse(a.Result.List[b],i),g.push(k));h=this.selector.listChecked();q=_.map(h,function(a){return a.Id()});(j=this.selector.itemSelected())&&(l=_.find(g,function(a){return j.Id()===a.Id()}));q&&0<q.length&&_.each(g,function(a){a.checked(-1<c.inArray(a.Id(),q))});this.collection(g);this.loadingList(!1);this.oPageSwitcher.setCount(c.pInt(a.Result.ContactCount));l&&this.selector.itemSelected(l)}else if(0<=c.inArray(a.Action,["ContactCreate","ContactUpdate",
"GroupCreate","GroupUpdate"]))"GroupCreate"===a.Action&&a.Result.IdGroup?(q=_.map(this.selector.listChecked(),function(a){return a.Id()}),this.executeAddContactsToGroupId(a.Result.IdGroup,q,e.ContactsGroupListType.Global===this.selectedGroupType()),this.selectedItem(null),this.selector.itemSelected(null),f.Api.showReport(c.i18n("CONTACTS/REPORT_GROUP_SUCCESSFULLY_ADDED"))):"ContactCreate"===a.Action&&a.Result.IdContact&&f.Api.showReport(c.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),this.requestContactList(),
0<=c.inArray(a.Action,["GroupCreate","GroupUpdate"])&&this.requestGroupFullList();else if(0<=c.inArray(a.Action,["ContactDelete","AddContactsToGroup","RemoveContactsFromGroup"]))this.requestContactList();else if(0<=c.inArray(a.Action,["GroupDelete"]))this.requestGroupFullList();else{if("GroupFullList"===a.Action){j=_.find(this.groupFullCollection(),function(a){return a.selected()});this.groupFullCollection(g);for(h=a.Result.length;b<h;b++)a.Result[b]&&"Object/CContactListItem"===c.pExport(a.Result[b],
"@Object","")&&(k=new P,k.parse(a.Result[b]),k.IsGroup()&&(j&&j.Id()===k.Id()&&this.selectedGroupInList(k),g.push(k)));this.groupFullCollection(g)}}else this.requestContactList()};n.prototype.dragAndDronHelper=function(a){a&&a.checked(!0);var a=c.draggebleMessages(),b=this.selector.listCheckedOrSelected().length,f=0<b?_.map(this.selector.listCheckedOrSelected(),function(a){return a.Id()}):[];a.data("p7-contatcs-type",this.selectedGroupType());a.data("p7-contatcs-uids",f);i(".count-text",a).text(c.i18n("CONTACTS/DRAG_TEXT_PLURAL",
{COUNT:b},null,b));return a};n.prototype.contactsDrop=function(a,b,f){if(a){var g=f&&f.helper?f.helper:null,i=g?g.data("p7-contatcs-type"):null,g=g?g.data("p7-contatcs-uids"):null;null!==i&&null!==g&&(c.uiDropHelperAnim(b,f),this.executeAddContactsToGroup(a,g,e.ContactsGroupListType.Global===i))}};n.prototype.searchFocus=function(){this.selector.useKeyboardKeys()&&!c.inFocus()&&this.isFocused(!0)};n.prototype.onContactDblClick=function(){f.Api.openComposeMessage(this.selectedContact().email())};n.prototype.onClearSearchClick=
function(){this.search("");this.searchSubmitCommand()};s.prototype.onHide=function(a){var b=null,b=this.tab();this.confirmSaving(b);if((b=this.getCurrentViewModel())&&c.isFunc(b.onHide))b.onHide(a)};s.prototype.onShow=function(a){var b=null,b=this.tab();this.confirmSaving(b);if((b=this.getCurrentViewModel())&&c.isFunc(b.onShow))b.onShow(a)};s.prototype.viewTab=function(a){var b=this.bAllowUsersChangeInterfaceSettings?e.SettingsTab.Common:e.SettingsTab.EmailAccounts,c=!1,f=!1,f=a===e.SettingsTab.Common||
a===e.SettingsTab.EmailAccounts||a===e.SettingsTab.Calendar||a===e.SettingsTab.MobileSync||a===e.SettingsTab.OutLookSync,c=a===e.SettingsTab.Common&&!this.bAllowUsersChangeInterfaceSettings||a===e.SettingsTab.Calendar&&!this.bAllowCalendar||a===e.SettingsTab.MobileSync&&!this.bAllowMobileSync||a===e.SettingsTab.OutLookSync&&!this.bAllowOutlookSync;this.tab(!f||c?b:a)};s.prototype.onRoute=function(a){var b=null,f=this.tab();_.isArray(a)&&0<a.length&&(f=a[0]);if((b=this.getCurrentViewModel())&&c.isFunc(b.onHide))b.onHide(a);
this.confirmSaving(this.tab());this.viewTab(f);if((b=this.getCurrentViewModel())&&c.isFunc(b.onRoute))b.onRoute(a)};s.prototype.confirmSaving=function(a){var b=this.getViewModel(a),a=c.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),h=_.bind(function(a){if(b)if(a){if(b.onSaveClick)b.onSaveClick()}else b.init&&b.init()},this);b&&(c.isFunc(b.isChanged)&&b.isChanged())&&f.Screens.showPopup(J,[a,h])};s.prototype.getViewModel=function(a){switch(a){case e.SettingsTab.Common:return this.oCommon;case e.SettingsTab.EmailAccounts:return this.oEmailAccounts;
case e.SettingsTab.Calendar:return this.oCalendar;case e.SettingsTab.MobileSync:return this.oMobileSync;case e.SettingsTab.OutLookSync:return this.oOutLookSync}};s.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())};s.prototype.showTab=function(a){f.Routing.setHash([e.Screens.Settings,a])};s.prototype.onResponseFolderDelete=function(a){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):f.Cache.getFolderList(g.Accounts.editedId())};s.prototype.deleteFolder=
function(a,b,c){var e={Action:"FolderDelete",AccountID:g.Accounts.editedId(),Folder:a.fullName()};c&&(b&&a)&&(b.remove(function(b){return a.fullName()===b.fullName()?!0:!1}),f.Ajax.send(e,this.onResponseFolderDelete,this))};s.prototype.onResponseFolderSubscribe=function(a){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):f.Cache.getFolderList(g.Accounts.editedId())};s.prototype.onSubscribeFolderClick=function(a){var b={Action:"FolderSubscribe",AccountID:g.Accounts.editedId(),
Folder:a.fullName(),SetAction:a.subscribed()?0:1};a&&a.canSubscribe()&&(a.subscribed(!a.subscribed()),f.Ajax.send(b,this.onResponseFolderSubscribe,this))};s.prototype.onDeleteFolderClick=function(a,b){var h=c.i18n("SETTINGS/ACCOUNT_FOLDERS_CONFIRMATION_DELETE"),e=this.getCollectionFromParent(b),e=_.bind(this.deleteFolder,this,a,e);a&&a.canDelete()?f.Screens.showPopup(J,[h,e]):this.oEmailAccounts.oAccountFolders.highlighted(!0)};s.prototype.onResponseFolderRename=function(a){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):
f.Cache.getFolderList(g.Accounts.editedId())};s.prototype.folderEditOnEnter=function(a){var b={Action:"FolderRename",AccountID:g.Accounts.editedId(),PrevFolderFullNameRaw:a.fullName(),NewFolderNameInUtf8:a.nameForEdit()};f.Ajax.send(b,this.onResponseFolderRename,this);a.name(a.nameForEdit());a.edited(!1)};s.prototype.folderEditOnEsc=function(a){a.edited(!1)};s.prototype.getCollectionFromParent=function(a){var b=null;return b=a.subfolders?a.subfolders:a.collection};s.prototype.canMoveFolderUp=function(a,
b,c){var c=this.getCollectionFromParent(c),e=c()[b()-1],g="";0<b()&&e&&(g=c()[b()-1].fullName());return 0!==b()&&a&&a.fullName()!==f.Cache.editedFolderList().inboxFolderFullName()&&f.Cache.editedFolderList().inboxFolderFullName()!==g};s.prototype.canMoveFolderDown=function(a,b,c){c=this.getCollectionFromParent(c);return b()!==c().length-1&&a.fullName()!==f.Cache.editedFolderList().inboxFolderFullName()};s.prototype.moveFolderUp=function(a,b,c){var f=this.getCollectionFromParent(c);this.canMoveFolderUp(a,
b,c)&&f&&(f.splice(b(),1),f.splice(b()-1,0,a),this.folderListOrderUpdate())};s.prototype.moveFolderDown=function(a,b,c){var f=this.getCollectionFromParent(c);this.canMoveFolderDown(a,b,c)&&f&&(f.splice(b(),1),f.splice(b()+1,0,a),this.folderListOrderUpdate())};s.prototype.folderListOrderUpdate=function(){var a=f.Cache.editedFolderList().getOptions(),a=_.map(a,function(a){return a&&a.id?a.id:null}),a={Action:"FolderListOrderUpdate",AccountID:g.Accounts.editedId(),FolderList:_.compact(a)};f.Ajax.send(a,
this.onResponseFolderListOrderUpdate,this)};s.prototype.onResponseFolderListOrderUpdate=function(a){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):f.Cache.getFolderList(g.Accounts.editedId())};ma.prototype.init=function(){this.selectedSkin(g.User.DefaultTheme);this.layout(g.User.Layout);this.selectedLanguage(g.User.DefaultLanguage);this.messagesPerPage(g.User.MailsPerPage);this.contactsPerPage(g.User.ContactsPerPage);this.autocheckmailInterval(g.User.autoCheckMailInterval());
this.richText(g.User.DefaultEditor);this.timeFormat(g.User.defaultTimeFormat());this.dateFormat(g.User.DefaultDateFormat)};ma.prototype.getState=function(){return[this.selectedSkin(),this.layout(),this.selectedLanguage(),this.messagesPerPage(),this.contactsPerPage(),this.autocheckmailInterval(),this.richText(),this.timeFormat(),this.dateFormat()].join(":")};ma.prototype.updateFirstState=function(){this.firstState=this.getState()};ma.prototype.isChanged=function(){return this.firstState&&this.getState()!==
this.firstState?!0:!1};ma.prototype.onResponse=function(a,b){var e=!1;!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(e=b.DefaultTheme!==g.User.DefaultTheme||b.DefaultLanguage!==g.User.DefaultLanguage)?location.reload():(g.User.updateCommonSettings(b.MailsPerPage,b.ContactsPerPage,b.AutoCheckMailInterval,b.DefaultEditor,b.Layout,b.DefaultTheme,b.DefaultLanguage,b.DefaultDateFormat,b.DefaultTimeFormat),f.Api.showReport(c.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))};
ma.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",MailsPerPage:parseInt(this.messagesPerPage(),10),ContactsPerPage:parseInt(this.contactsPerPage(),10),AutoCheckMailInterval:parseInt(this.autocheckmailInterval(),10),DefaultEditor:parseInt(this.richText(),10),Layout:parseInt(this.layout(),10),DefaultTheme:this.selectedSkin(),DefaultLanguage:this.selectedLanguage(),DefaultDateFormat:this.dateFormat(),DefaultTimeFormat:parseInt(this.timeFormat(),10)};this.updateFirstState();f.Ajax.send(a,
this.onResponse,this)};z.prototype.isChanged=function(){return!1};z.prototype.confirmSaving=function(a,b,e){var g=this.getViewModel(a),i={},a=c.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),j=_.bind(function(a){g&&(a?g.onSaveClick&&g.saveData(i):g.updateFirstState())},this),b=c.isUnd(b)?!1:b,e=c.isUnd(e)?null:e;!b&&(g&&c.isFunc(g.isChanged)&&g.isChanged())&&(i=g.prepareParameters(),f.Screens.showPopup(J,[a,j]))};z.prototype.onRoute=function(a){g.Accounts.getEdited()&&(_.isArray(a)&&1<a.length&&this.tab(a[1]),
this.confirmSaving(this.tab()),this.viewCurrentTab(a))};z.prototype.onHide=function(){this.confirmSaving(this.tab())};z.prototype.viewCurrentTab=function(a){var b=g.Accounts.getEdited(),h=null;if(b)if(this.isTabAllowed(this.tab(),b)){if(h=this.getCurrentViewModel()){if(c.isFunc(h.onHide))h.onHide(a);if(c.isFunc(h.onShow))h.onShow(a,b)}}else this.tab(e.AccountSettingsTab.Properties),f.Routing.replaceHash([e.Screens.Settings,e.SettingsTab.EmailAccounts,e.AccountSettingsTab.Properties])};z.prototype.getViewModel=
function(a){switch(a){case e.AccountSettingsTab.Folders:return this.oAccountFolders;case e.AccountSettingsTab.Filters:return this.oAccountFilters;case e.AccountSettingsTab.Forward:return this.oAccountForward;case e.AccountSettingsTab.Signature:return this.oAccountSignature;case e.AccountSettingsTab.Autoresponder:return this.oAccountAutoresponder;default:case e.AccountSettingsTab.Properties:return this.oAccountProperties}};z.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())};
z.prototype.isTabAllowed=function(a,b){return-1===c.inArray(a,[e.AccountSettingsTab.Properties,e.AccountSettingsTab.Signature,e.AccountSettingsTab.Filters,e.AccountSettingsTab.Autoresponder,e.AccountSettingsTab.Forward,e.AccountSettingsTab.Folders])||a===e.AccountSettingsTab.Filters&&!b.extensionExists("AllowSieveFiltersExtension")||a===e.AccountSettingsTab.Forward&&!b.extensionExists("AllowForwardExtension")||a===e.AccountSettingsTab.Autoresponder&&!b.extensionExists("AllowAutoresponderExtension")?
!1:!0};z.prototype.onTabClick=function(a){f.Routing.setHash([e.Screens.Settings,e.SettingsTab.EmailAccounts,a])};z.prototype.onResponseAccountDelete=function(a,b){!a||!a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(g.Accounts.deleteAccount(b.AccountIDToDelete),this.defaultAccountId()===b.AccountIDToDelete&&(f.Routing.setHash([]),location.reload()))};z.prototype.deleteAccount=function(a,b){var c={Action:"AccountDelete",AccountIDToDelete:a};b&&f.Ajax.send(c,this.onResponseAccountDelete,
this)};z.prototype.onAccountDelete=function(a){var b="",e=_.bind(this.deleteAccount,this,a),i=g.Accounts.getAccount(a).email(),b=this.defaultAccountId()===a?1===this.accounts().length?c.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_SINGLE_DEFAULT_DELETE"):c.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DEFAULT_DELETE"):c.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DELETE");f.Screens.showPopup(J,[b,e,i])};z.prototype.onEditedAccountDelete=function(){var a="",b=_.bind(this.deleteAccount,this,this.editedAccountId()),e=g.Accounts.getEdited().email(),
a=this.editedAccountId()===this.defaultAccountId()?1===this.accounts().length?c.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_SINGLE_DEFAULT_DELETE"):c.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DEFAULT_DELETE"):c.i18n("SETTINGS/ACCOUNTS_CONFIRMATION_DELETE");f.Screens.showPopup(J,[a,b,e])};z.prototype.onAccountAdd=function(){f.Screens.showPopup(ka,[])};z.prototype.changeAccount=function(a){var b=null,e={Action:"AccountSettings",AccountID:a};this.confirmSaving(this.tab());b=g.Accounts.getAccount(a);!c.isUnd(b)&&
b.isExtended()?this.populate(b):f.Ajax.send(e,this.onAccountSettingsResponse,this)};z.prototype.onAccountSettingsResponse=function(a,b){if(!a&&!1===a.Result)f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"));else{var e=g.Accounts.getAccount(b.AccountID);c.isUnd(e)||(e.updateExtended(a.Result),this.populate(e))}};z.prototype.populate=function(a){this.allowAutoresponderExtension(a.extensionExists("AllowAutoresponderExtension"));this.allowForwardExtension(a.extensionExists("AllowForwardExtension"));
this.allowSieveFiltersExtension(a.extensionExists("AllowSieveFiltersExtension"));g.Accounts.changeEditedAccount(a.id());this.viewCurrentTab()};na.prototype.init=function(){this.showWeekends(g.User.CalendarShowWeekEnds);this.selectedWorkdayStarts(g.User.CalendarWorkDayStarts);this.selectedWorkdayEnds(g.User.CalendarWorkDayEnds);this.showWorkday(g.User.CalendarShowWorkDay);this.weekStartsOn(g.User.CalendarWeekStartsOn);this.defaultTab(g.User.CalendarDefaultTab)};na.prototype.getState=function(){return[this.showWeekends(),
this.selectedWorkdayStarts(),this.selectedWorkdayEnds(),this.showWorkday(),this.weekStartsOn(),this.defaultTab()].join(":")};na.prototype.updateFirstState=function(){this.firstState=this.getState()};na.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};na.prototype.onResponse=function(a,b){!1===a.Result?f.Api.showError(c.i18n("SETTINGS/ERROR_CALENDAR_SETTINGS_SAVING_FAILED")):(g.User.updateCalendarSettings(b.ShowWeekEnds,b.ShowWorkDay,b.WorkDayStarts,b.WorkDayEnds,
b.WeekStartsOn,b.DefaultTab),f.Api.showReport(c.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))};na.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",ShowWeekEnds:this.showWeekends(),ShowWorkDay:this.showWorkday(),WorkDayStarts:parseInt(this.selectedWorkdayStarts(),10),WorkDayEnds:parseInt(this.selectedWorkdayEnds(),10),WeekStartsOn:parseInt(this.weekStartsOn(),10),DefaultTab:parseInt(this.defaultTab(),10)};this.updateFirstState();f.Ajax.send(a,this.onResponse,this)};La.prototype.onRoute=
function(){g.User.requestSyncSettings()};La.prototype.onMobileSyncSubscribe=function(){this.enableDav(g.App.EnableMobileSync&&this.mobileSync()&&this.mobileSync().EnableDav);this.enableDav()&&(this.davLogin(this.mobileSync().Dav.Login),this.davServer(this.mobileSync().Dav.Server),this.davCalendars(this.mobileSync().Dav.Calendars),this.davPersonalContactsUrl(this.mobileSync().Dav.PersonalContactsUrl),this.davCollectedAddressesUrl(this.mobileSync().Dav.CollectedAddressesUrl),this.davGlobalAddressBookUrl(this.mobileSync().Dav.GlobalAddressBookUrl));
this.enableActiveSync(g.App.EnableMobileSync&&this.mobileSync()&&this.mobileSync().EnableActiveSync);this.enableActiveSync()&&(this.activeLogin(this.mobileSync().ActiveSync.Login),this.activeServer(this.mobileSync().ActiveSync.Server))};Ma.prototype.onRoute=function(){g.User.requestSyncSettings()};Ma.prototype.onOutlookSyncSubscribe=function(){g.User.OutlookSyncEnable&&(this.visibleOutlookSync(!0),this.outlookSync()&&(this.login(this.outlookSync().Login),this.server(this.outlookSync().Server)))};
Q.prototype.getState=function(){return[this.friendlyName(),this.email(),this.incomingMailLogin(),this.incomingMailPort(),this.incomingMailServer(),this.outgoingMailLogin(),this.outgoingMailPort(),this.outgoingMailServer(),this.useSmtpAuthentication()].join(":")};Q.prototype.updateFirstState=function(){this.firstState=this.getState()};Q.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};Q.prototype.populate=function(a){a?(this.allowChangePassword(a.extensionExists("AllowChangePasswordExtension")),
this.isInternal(a.isInternal()),this.isLinked(a.isLinked()),this.isDefault(a.isDefault()),this.useSmtpAuthentication(2===c.pInt(a.outgoingMailAuth())?!0:!1),this.friendlyName(a.friendlyName()),this.email(a.email()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.outgoingMailServer(a.outgoingMailServer()),this.outgoingMailLogin(a.outgoingMailLogin()),this.outgoingMailPort(a.outgoingMailPort()),this.updateFirstState()):
(this.allowChangePassword(!1),this.isLinked(!0),this.useSmtpAuthentication(!0),this.friendlyName(""),this.email(""),this.incomingMailLogin(""),this.incomingMailServer(""),this.incomingMailPort(143),this.outgoingMailServer(""),this.outgoingMailLogin(""),this.outgoingMailPort(25))};Q.prototype.onResponse=function(a,b){if(!a||!a.Result)f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"));else{var e=c.pInt(a.AccountID);if(e=0<e?g.Accounts.getAccount(e):null)e.updateExtended(b),f.Api.showReport(c.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY"))}};
Q.prototype.prepareParameters=function(){return{Action:"UpdateAccountSettings",AccountID:this.account().id(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:c.pInt(this.incomingMailPort()),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPort:c.pInt(this.outgoingMailPort()),OutgoingMailAuth:this.useSmtpAuthentication()?2:0}};Q.prototype.saveData=
function(a){this.updateFirstState();f.Ajax.send(a,this.onResponse,this)};Q.prototype.onSaveClick=function(){this.account()&&this.saveData(this.prepareParameters())};Q.prototype.onChangePasswordClick=function(){f.Screens.showPopup(la,[])};Q.prototype.onShow=function(a,b){this.account(b)};Ba.prototype.isChanged=function(){return!1};Ba.prototype.onAddNewFolderClick=function(){f.Screens.showPopup(qa)};Ba.prototype.onSystemFoldersClick=function(){f.Screens.showPopup(pa)};R.prototype.getState=function(){return[this.type(),
this.options(),this.oHtmlEditor.getText()].join(":")};R.prototype.updateFirstState=function(){this.firstState=this.getState()};R.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};R.prototype.getSignature=function(){if(this.account())if(null!==this.account().signature())this.type(this.account().signature().type()),this.options(this.account().signature().options()),this.signature(this.account().signature().signature());else{var a={Action:"AccountSignature",
AccountID:this.account().id()};f.Ajax.send(a,this.onSignatureResponse,this)}};R.prototype.onSignatureResponse=function(a){var b=null,c=parseInt(a.AccountID,10);a&&(a.Result&&this.account()&&c===this.account().id())&&(b=new Ja,b.parse(c,a.Result),this.account().signature(b),this.type(this.account().signature().type()),this.options(this.account().signature().options()),this.signature(this.account().signature().signature()))};R.prototype.prepareParameters=function(){return{Action:"UpdateAccountSignature",
AccountID:this.account().id(),Type:this.type()?1:0,Options:this.options(),Signature:this.signature()}};R.prototype.saveData=function(a){this.updateFirstState();f.Ajax.send(a,this.onResponse,this)};R.prototype.onSaveClick=function(){this.account()&&(this.signature(this.oHtmlEditor.getText()),this.account().signature().type(this.type()),this.account().signature().options(this.options()),this.account().signature().signature(this.signature()),this.saveData(this.prepareParameters()))};R.prototype.onResponse=
function(a){a&&a.Result?f.Api.showReport(c.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")):f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))};R.prototype.onShow=function(a,b){this.account(b);this.oHtmlEditor.initCrea(this.signature(),"");this.oHtmlEditor.setActivitySource(this.options);this.updateFirstState()};V.prototype.getState=function(){return[this.enable(),this.email()].join(":")};V.prototype.updateFirstState=function(){this.firstState=this.getState()};V.prototype.isChanged=
function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};V.prototype.onResponse=function(a,b){this.loading(!1);if(b&&b.Action)if("GetForward"===b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var e=null,i=new Ra,j=c.pInt(a.AccountID);if(j&&(e=g.Accounts.getAccount(j)))i.parse(j,a.Result),e.forward(i),this.enable(e.forward().enable),this.email(e.forward().email),this.updateFirstState(),j===this.account().id()&&this.account.valueHasMutated()}}else"UpdateForward"===b.Action&&
(a&&a.Result?f.Api.showReport(c.i18n("SETTINGS/ACCOUNT_FORWARD_SUCCESS_REPORT")):f.showErrorByCode(a.ErrorCode,c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")));else f.Api.showError(c.i18n("WARNING/UNKNOWN_ERROR"))};V.prototype.prepareParameters=function(){return{Action:"UpdateForward",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Email:this.email()}};V.prototype.saveData=function(a){this.updateFirstState();f.Ajax.send(a,this.onResponse,this)};V.prototype.onSaveClick=function(){if(this.account()){var a=
this.account().forward();a&&(a.enable=this.enable(),a.email=this.email());this.loading(!0);this.saveData(this.prepareParameters())}};V.prototype.getForward=function(){if(this.account())if(null!==this.account().forward())this.enable(this.account().forward().enable),this.email(this.account().forward().email),this.firstState=this.getState();else{var a={Action:"GetForward",AccountID:this.account().id()};this.loading(!0);this.updateFirstState();f.Ajax.send(a,this.onResponse,this)}};V.prototype.onShow=
function(a,b){this.account(b)};U.prototype.getState=function(){return[this.enable(),this.subject(),this.message()].join(":")};U.prototype.updateFirstState=function(){this.firstState=this.getState()};U.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1};U.prototype.onResponse=function(a,b){this.loading(!1);if(b&&b.Action)if("GetAutoresponder"===b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var e=null,i=new Qa,j=c.pInt(a.AccountID);if(j&&(e=g.Accounts.getAccount(j)))i.parse(j,
a.Result),e.autoresponder(i),j===this.account().id()&&this.account.valueHasMutated()}}else"UpdateAutoresponder"===b.Action&&(a&&a.Result?f.Api.showReport(c.i18n("SETTINGS/ACCOUNT_AUTORESPONDER_SUCCESS_REPORT")):f.showErrorByCode(a.ErrorCode,c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")));else f.Api.showError(c.i18n("WARNING/UNKNOWN_ERROR"))};U.prototype.prepareParameters=function(){return{Action:"UpdateAutoresponder",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Subject:this.subject(),
Message:this.message()}};U.prototype.saveData=function(a){this.updateFirstState();f.Ajax.send(a,this.onResponse,this)};U.prototype.onSaveClick=function(){if(this.account()){var a=this.account().autoresponder();a&&(a.enable=this.enable(),a.subject=this.subject(),a.message=this.message());this.loading(!0);this.saveData(this.prepareParameters())}};U.prototype.getAutoresponder=function(){if(this.account())if(null!==this.account().autoresponder())this.enable(this.account().autoresponder().enable),this.subject(this.account().autoresponder().subject),
this.message(this.account().autoresponder().message),this.updateFirstState();else{var a={Action:"GetAutoresponder",AccountID:this.account().id()};this.loading(!0);f.Ajax.send(a,this.onResponse,this)}};U.prototype.onShow=function(a,b){this.account(b)};G.prototype.getState=function(){var a=":",b=_.map(this.collection(),function(a){return a.toString()},this);0<b.length&&(a=b.join(":"));return a};G.prototype.updateFirstState=function(){this.firstState=this.getState()};G.prototype.isChanged=function(){return this.firstState&&
this.getState()!==this.firstState?!0:!1};G.prototype.onResponse=function(a,b){this.loading(!1);if(b&&b.Action)if("GetSieveFilters"===b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var e=null,i=new Sa,j=c.pInt(a.AccountID);if(j&&(e=g.Accounts.getAccount(j)))i.parse(j,a.Result),e.filters(i),j===this.account().id()&&this.account.valueHasMutated()}}else"UpdateSieveFilters"===b.Action&&(a&&a.Result?f.Api.showReport(c.i18n("SETTINGS/ACCOUNT_FILTERS_SUCCESS_REPORT")):f.Api.showError(c.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")));
else f.Api.showError(c.i18n("WARNING/UNKNOWN_ERROR"))};G.prototype.prepareParameters=function(){var a=_.map(this.collection(),function(a){return{Enable:a.enable()?"1":"0",Field:a.field(),Filter:a.filter(),Condition:a.condition(),Action:a.action(),FolderFullName:a.folder()}});return{Action:"UpdateSieveFilters",AccountID:this.account().id(),Filters:a}};G.prototype.saveData=function(a){this.updateFirstState();f.Ajax.send(a,this.onResponse,this)};G.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),
this.saveData(this.prepareParameters()))};G.prototype.getFilters=function(){if(this.account())if(null!==this.account().filters())this.collection(this.account().filters().collection()),this.updateFirstState();else{var a={Action:"GetSieveFilters",AccountID:this.account().id()};this.loading(!0);f.Ajax.send(a,this.onResponse,this)}};G.prototype.onShow=function(a,b){this.account(b)};G.prototype.deleteFilter=function(a){this.collection.remove(a)};G.prototype.addFilter=function(){if(this.account()){var a=
new ya(this.account().id());this.collection.push(a)}};G.prototype.displayFilterPart=function(a,b){var c="",c="%FIELD%"===a?"Field":"%CONDITION%"===a?"Condition":"%STRING%"===a?"String":"%ACTION%"===a?"Action":"%FOLDER%"===a?"Folder":"%DEPENDED"===a.substr(0,9)?"DependedText":"Text";return b+c};G.prototype.getDependedText=function(a){(a=c.pString(a))&&(a=a.replace(/%/g,"").split("=")[1]||"");return a};G.prototype.getDependedField=function(a,b){if(a=c.pString(a))a=a.replace(/[=](.*)/g,"").split("-")[1]||
"",a=a.toLowerCase();return c.isUnd(b[a])?!1:b[a]()};Na.prototype.onRoute=function(){var a=i(this.calendarIframe()),b=null;g.User.isNeedToReloadCalendar()?this.variableCalendarUrl(this.calendarUrl+"?p="+Math.random()):this.calendarIframe()&&(0<a.length&&(b=a[0].contentWindow),b&&"function"===typeof b.RefreshData&&b.RefreshData())};Na.prototype.onHide=function(){f.EventsCache.requestCalendarList()};ha.prototype.onApplyBindings=function(){};ha.prototype.onShow=function(){f.Ajax.send({Action:"Files"},
this.onFilesResponse,this)};ha.prototype.onFilesResponse=function(a,b){j.console.log(a,b);var c=new Ia;c.name("suggest.docx").size(300).hash("quooqweytriouwter");this.files.removeAll();this.files.push(c);c=new Ia;c.name("tulips.png").size(3E3).hash("lakjdhflasj");this.files.push(c)};ha.prototype.onRoute=function(a){j.console.log(a)};ha.prototype.onHide=function(){};ha.prototype.getPrivateFiles=function(){f.Ajax.send({Action:"FilesPrivate"},this.onFilesResponse,this)};ha.prototype.getCorporateFiles=
function(){f.Ajax.send({Action:"FilesCorporate"},this.onFilesResponse,this)};H.prototype.init=function(){i("#pSevenContent").append(i("#Layout").html());i("#pSevenContent").addClass("single_mode");_.defer(function(){g.SingleMode||i("#pSevenContent").removeClass("single_mode")});this.informationScreen(this.showNormalScreen(e.Screens.Information))};H.prototype.showCurrentScreen=function(a,b){this.currentScreen()!==a&&(this.hideCurrentScreen(),this.currentScreen(a));this.showNormalScreen(a,b)};H.prototype.hideCurrentScreen=
function(){0<this.currentScreen().length&&this.hideScreen(this.currentScreen())};H.prototype.hideScreen=function(a){a=this.oScreens[a];"undefined"!==typeof a&&a.bInitialized&&a.Model.hideViewModel()};H.prototype.showNormalScreen=function(a,b){var c=this.oScreens[a];c&&(c.bInitialized="boolean"!==typeof c.bInitialized?!1:c.bInitialized,c.bInitialized||(c.Model=this.initViewModel(c.Model,c.TemplateName),c.bInitialized=!0),c.Model.showViewModel(b));return c?c.Model:null};H.prototype.initViewModel=function(a,
d){var c=null,f=null,c=new a,f=i('div[data-view-model="'+d+'"]').attr("data-bind","template: {name: '"+d+"'}").hide();c.$viewModel=f;c.bShown=!1;c.showViewModel=function(a){this.$viewModel.show();if("function"===typeof this.onRoute)this.onRoute(a);if(!this.bShown){if("function"===typeof this.onShow)this.onShow(a);this.bShown=!0}};c.hideViewModel=function(){this.$viewModel.hide();if("function"===typeof this.onHide)this.onHide();this.bShown=!1};b.applyBindings(c,f[0]);if("function"===typeof c.onApplyBindings)c.onApplyBindings(f);
return c};H.prototype.showPopup=function(a,d){if(a){if(!a.__builded){var e=null,g=new a,e=g.popupTemplate?g.popupTemplate():"";if(""!==e&&(e=i('div[data-view-model="'+e+'"]').attr("data-bind","template: {name: '"+e+"'}").removeClass("visible").hide())&&1===e.length)g.visibility=b.observable(!1),a.__builded=!0,a.__vm=g,g.$viewModel=e,a.__dom=e,g.showViewModel=c.createCommand(g,function(){f&&f.Screens&&f.Screens.showPopup(a)}),g.closeCommand=c.createCommand(g,function(){f&&f.Screens&&f.Screens.hidePopup(a)}),
b.applyBindings(g,e[0]),c.delegateRun(g,"onApplyBindings",[e])}a.__vm&&a.__dom&&(a.__dom.show(),_.delay(function(){a.__dom.addClass("visible")},50),a.__vm.visibility(!0),c.delegateRun(a.__vm,"onShow",d),this.popupVisibility(!0),this.popups.push(a),this.keyupPopupBinded=_.bind(this.keyupPopup,this,a.__vm),i(document).on("keyup",this.keyupPopupBinded))}};H.prototype.keyupPopup=function(a,b){if(b){var c=j.parseInt(b.keyCode,10);27===c&&a.closeCommand();if((13===c||32===c)&&a.onEnterHandler)a.onEnterHandler()}};
H.prototype.hidePopup=function(a){a&&(a.__vm&&a.__dom)&&(this.keyupPopupBinded&&(i(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),a.__dom.removeClass("visible").hide(),a.__vm.visibility(!1),c.delegateRun(a.__vm,"onHide"),this.popupVisibility(!1),this.popups=_.without(this.popups,a))};H.prototype.hideAllPopup=function(){_.each(this.popups,function(a){this.hidePopup(a)},this)};H.prototype.showLoading=function(a){this.informationScreen()&&this.informationScreen().showLoading(a)};
H.prototype.hideLoading=function(){this.informationScreen()&&this.informationScreen().hideLoading()};H.prototype.showReport=function(a,b){this.informationScreen()&&this.informationScreen().showReport(a,b)};H.prototype.showError=function(a,b,c){this.informationScreen()&&this.informationScreen().showError(a,b,c)};k.prototype.init=function(){var a=null;g.SingleMode&&j.opener?(a=j.opener.App.Cache,this.oFolderListItems=a.oFolderListItems,this.folderList(a.folderList()),this.messages(a.messages()),this.uidList(a.uidList()),
this.page(a.page())):this.currentAccountId.valueHasMutated()};k.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()};k.prototype.getFolderByFullName=function(a,b){var c=this.oFolderListItems[a];return c?c.getFolderByFullName(b):null};k.prototype.getFolderList=function(a){var b={Action:"FolderList"};c.isUnd(a)||(b.AccountID=a);f.Ajax.send(b,this.onFolderListResponse,this)};k.prototype.markMessageReplied=function(a,b,c,f){var a=this.oFolderListItems[a],e=null;a&&(e=a.getFolderByFullName(b))&&
e.markMessageReplied(c,f)};k.prototype.setFolderCounts=function(a,b,c,f,e,g){var a=this.oFolderListItems[a],i=null,j=!1,k=!1;if(a&&(i=a.getFolderByFullName(b)))if((j=i.setRelevantInformation(e,g,c,f))&&i.selected())k=!0,this.startCheckMail();this.checkMailStarted(k)};k.prototype.setMessagesFromUidList=function(a,b,c,f){var a=a.getUidsForOffset(b,c),e=_.map(a,function(a){return c[a]},this),i=e.length,j=this.folderList().currentFolder();f&&(this.messages(e),b+i<j.messageCount()&&i<g.User.MailsPerPage&&
this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&this.currentMessage(null));return a};k.prototype.startCheckMail=function(){var a=this.folderList().currentFolderFullName(),b=this.page(),c=this.uidList().search();""!==a&&this.requestCurrentMessageList(a,b,c)};k.prototype.executeCheckMail=function(){var a=this.folderList(),b=a?a.getInboxAndCurrentFoldersArray():[],a={Action:"FolderCounts",Folders:b,
AccountID:a?a.iAccountId:0};!this.checkMailStarted()&&0<b.length&&(this.checkMailStarted(!0),f.Ajax.send(a,this.onFolderCountsResponse,this))};k.prototype.changeCurrentMessageList=function(a,b,c){this.requestCurrentMessageList(a,b,c)};k.prototype.requestCurrentMessageList=function(a,b,c){a=this.requestMessageList(a,b,c,!0);this.uidList(a.UidList);this.page(b);this.messagesLoading(a.DataExpected);this.messagesLoadingError(!1);f.Prefetcher.start()};k.prototype.requestMessageList=function(a,b,c,e){var i=
this.oFolderListItems[this.currentAccountId()],j=(i=i?i.getFolderByFullName(a):null)?i.getUidList(c):null,b=(b-1)*g.User.MailsPerPage,k=j?this.setMessagesFromUidList(j,b,i.oMessages,e):[],a={Action:"MessageList",Folder:a,Offset:b,Limit:g.User.MailsPerPage,Search:c,ExistenUids:i.hasChanges()?[]:k},l=c=!1,e=e?this.onCurrentMessageListResponse:this.onMessageListResponse;j&&(l=-1===j.searchCount()||b+k.length<j.searchCount()&&k.length<g.User.MailsPerPage,c=i.hasChanges()||l);c&&f.Ajax.send(a,e,this);
return{UidList:j,RequestStarted:c,DataExpected:l}};k.prototype.executeEmptyTrash=function(){var a=this.folderList().trashFolder();a&&a.emptyFolder()};k.prototype.executeEmptySpam=function(){var a=this.folderList().spamFolder();a&&a.emptyFolder()};k.prototype.onClearFolder=function(a){a&&a.selected()&&(this.messages.removeAll(),this.currentMessage(null))};k.prototype.moveMessagesToFolder=function(a,b,e){var g=this.folderList().currentFolder(),i=this.folderList().getFolderByFullName(a),a={Action:"MessageMove",
Folder:g?g.fullName():"",ToFolder:a,Uids:b.join(",")},j=null;g&&(j=g.markDeletedByUids(b),i.addMessagesCountsDiff(j.MinusDiff,j.UnseenMinusDiff),(c.isUnd(e)||e)&&i.recivedAnim(!0),this.excludeDeletedMessages(),i.markHasChanges(),f.Ajax.send(a,this.onMoveMessagesResponse,this))};k.prototype.excludeDeletedMessages=function(){_.delay(_.bind(function(){var a=this.folderList().currentFolder(),b=(this.page()-1)*g.User.MailsPerPage;this.setMessagesFromUidList(this.uidList(),b,a.oMessages,!0)},this),500)};
k.prototype.removeMessagesFromCacheForFolder=function(a){(a=this.folderList().getFolderByFullName(a))&&a.markHasChanges()};k.prototype.deleteMessages=function(a){var b=this.folderList().currentFolder();b&&this.deleteMessagesFromFolder(b,a)};k.prototype.deleteMessagesFromFolder=function(a,b){var c={Action:"MessageDelete",Folder:a.fullName(),Uids:b.join(",")};a.markDeletedByUids(b);this.excludeDeletedMessages();f.Ajax.send(c,this.onMoveMessagesResponse,this)};k.prototype.showExternalPictures=function(a){var b=
[],c=null;this.currentMessage()&&(b=this.currentMessage().oFrom.aCollection,c=this.folderList().getFolderByFullName(this.currentMessage().folder()),a&&0<b.length?c.alwaysShowExternalPicturesForSender(b[0].sEmail):c.showExternalPictures(this.currentMessage().uid()))};k.prototype.setCurrentMessage=function(a){var b=this.folderList().currentFolder(),c=b?b.oMessages[a]:null;c&&!c.deleted()?(this.currentMessage(c),this.currentMessage().seen()||this.executeGroupOperation("MessageSetSeen",[this.currentMessage().uid()],
"seen",!0),b.getCompletelyFilledMessage(a,this.onCurrentMessageResponse,this)):this.currentMessage(null)};k.prototype.onCurrentMessageResponse=function(a,b){var c=this.currentMessage()?this.currentMessage().uid():"";null===a&&c===b&&this.currentMessage(null)};k.prototype.getMessage=function(a,b,c,e){(a=this.folderList().getFolderByFullName(a))&&a.getCompletelyFilledMessage(b,c,e)};k.prototype.executeGroupOperation=function(a,b,c,e){var i=this.folderList().currentFolder(),a={Action:a,Folder:i?i.fullName():
"",Uids:b.join(","),SetAction:e?1:0},j=(this.page()-1)*g.User.MailsPerPage;i&&(f.Ajax.send(a),i.executeGroupOperation(c,b,e),this.setMessagesFromUidList(this.uidList(),j,i.oMessages,!0))};k.prototype.onFolderListResponse=function(a,b){var c=new F,e=parseInt(a.AccountID,10),f=this.oFolderListItems[e],g=function(a){for(var b=0,d=0,e=null,f,b=0,d=a.length;b<d;b++){e=a[b];if(f=c.getFolderByFullName(e.fullName()))f.messageCount(e.messageCount()),f.hasExtendedInfo(e.hasExtendedInfo());g(e.subfolders())}};
!1===a.Result?b.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0)):(c.parse(e,a.Result),this.oFolderListItems[e]=c,setTimeout(_.bind(this.getAllFolderCounts,this,e),3E3),f&&g(f.collection()),this.currentAccountId()===e&&this.folderList(c),this.editedAccountId()===e&&this.editedFolderList(c))};k.prototype.setCurrentFolderList=function(a){var b=a.iAccountId;b===this.currentAccountId()&&b!==this.folderList().iAccountId&&this.folderList(a)};
k.prototype.getAllFolderCounts=function(a){var b=this.oFolderListItems[a],b=b?b.getFoldersWithoutCountInfo():[],a={Action:"FolderCounts",Folders:b,AccountID:a};0<b.length&&f.Ajax.send(a,this.onFolderCountsResponse,this)};k.prototype.onFolderCountsResponse=function(a){var b=this;!1!==a.Result&&_.each(a.Result,function(c,e){_.isArray(c)&&0<c.length&&b.setFolderCounts(a.AccountID,e,c[0],c[1],c[2],c[3])})};k.prototype.onCurrentMessageListResponse=function(a,b){!1===a.Result?(!0===this.messagesLoading()&&
this.messagesLoadingError(!0),this.messagesLoading(!1),this.checkMailStarted(!1)):(this.messagesLoadingError(!1),this.parseMessageList(a,b))};k.prototype.onMessageListResponse=function(a,b){a&&a.Result&&this.parseMessageList(a,b)};k.prototype.parseMessageList=function(a){var b=a.Result,c=this.oFolderListItems[a.AccountID],e=null,f=null;!1!==b&&"Collection/MessageCollection"===b["@Object"]&&(e=c.getFolderByFullName(b.FolderName),e.setRelevantInformation(b.UidNext.toString(),b.FolderHash,b.MessageCount,
b.MessageUnseenCount),e.removeAllMessageListsFromCacheIfHasChanges(),f=e.getUidList(b.Search),f.setUidsAndCount(b),_.each(b["@Collection"],function(b){var d=e.oMessages[b.Uid.toString()];d||(d=new B);d.parse(b,a.AccountID);e.oMessages[d.uid()]=d},this),this.currentAccountId()===a.AccountID&&(this.folderList().currentFolderFullName()===b.FolderName&&this.uidList().search()===f.search())&&(this.page()===b.Offset/g.User.MailsPerPage+1&&(this.setMessagesFromUidList(f,b.Offset,e.oMessages,!0),this.messagesLoading(!1),
this.checkMailStarted(!1)),this.uidList(f)))};k.prototype.onMoveMessagesResponse=function(a,b){var g=a.Result,i=this.folderList().getFolderByFullName(b.Folder),j=this.folderList().getFolderByFullName(b.ToFolder),k=j&&j.type()===e.FolderTypes.Trash,l=j&&j.type()===e.FolderTypes.Spam,m=null,n=k?c.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):c.i18n("MAILBOX/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),p=_.bind(function(a){a&&i&&this.deleteMessagesFromFolder(i,b.Uids.split(","))},this),o=this.folderList().currentFolderFullName();
!1===g?(m=i.revertDeleted(b.Uids.split(",")),j?(j.addMessagesCountsDiff(-m.PlusDiff,-m.UnseenPlusDiff),a.ErrorCode===e.Errors.ImapQuota&&(k||l)?f.Screens.showPopup(J,[n,p]):f.Api.showError(c.i18n("MAILBOX/ERROR_MOVING_MESSAGES"))):f.Api.showError(c.i18n("MAILBOX/ERROR_DELETING_MESSAGES"))):i.commitDeleted(b.Uids.split(","));(o===i.fullName()||j&&o===j.fullName())&&this.requestCurrentMessageList(o,this.page(),this.uidList().search());o!==i.fullName()&&setTimeout(function(){f.Prefetcher.startFolderPrefetch(i)},
1E3);j&&o!==j.fullName()&&setTimeout(function(){f.Prefetcher.startFolderPrefetch(j)},1E3)};k.prototype.searchMessagesInCurrentFolder=function(a){var b=this.currentMessage()?this.currentMessage().uid():"";f.Routing.setHash(f.Links.mailbox(this.folderList().currentFolderFullName(),1,b,a))};k.prototype.searchMessagesInInbox=function(a){f.Routing.setHash(f.Links.mailbox(this.folderList().inboxFolderFullName(),1,"",a))};ta.prototype.clearInfoAboutEmail=function(a){this.contacts[a]=void 0};ta.prototype.getContactByEmail=
function(a,b,c){if(g.User.ShowContacts){var e=this.contacts[a],i={Action:"ContactByEmail",Email:a};void 0!==e?b.apply(c,[e]):(this.responseHandlers[a]={Handler:b,Context:c},f.Ajax.send(i,this.onContactByEmailResponse,this))}};ta.prototype.onContactByEmailResponse=function(a,b){var c=null,e=this.responseHandlers[b.Email];a.Result&&(c=new x,c.parse(a.Result));this.contacts[b.Email]=c;e&&(e.Handler.apply(e.Context,[c]),this.responseHandlers[b.Email]=void 0)};ta.prototype.addVcard=function(a){this.vcardAttachments.push(a)};
ta.prototype.markVcardsNonexistent=function(a){_.each(this.vcardAttachments,function(b){-1!==_.indexOf(a,b.uid())&&b.isExists(!1)})};oa.prototype.addIcal=function(a){this.icalAttachments.push(a);0===this.calendars().length&&this.requestCalendarList()};oa.prototype.onCalendarListResponse=function(a){(a=(a=a.Result)?a.user:null)&&this.calendars(_.map(a,function(a){return{name:a.name,id:a.calendar_id}}))};oa.prototype.requestCalendarList=function(){f.Ajax.send({Action:"CalendarList"},this.onCalendarListResponse,
this)};oa.prototype.markIcalNonexistent=function(a){_.each(this.icalAttachments,function(b){if(a===b.uid())b.onEventDelete()})};oa.prototype.markIcalTentative=function(a){_.each(this.icalAttachments,function(b){if(a===b.uid())b.onEventTentative()})};oa.prototype.markIcalAccepted=function(a){_.each(this.icalAttachments,function(b){if(a===b.uid())b.onEventAccept()})};L.prototype.init=function(){var a=null,b=null,a=new S,b=new O,c=new Pa;a.parse(g.User);g.User=a;b.parse(g.Default,g.Accounts);g.Accounts=
b;c.parse(g.App);g.App=c;this.Cache=new k;g.App.GoogleAnalyticsAccount&&0<g.App.GoogleAnalyticsAccount.length&&(j._gaq=j._gaq||[],j._gaq.push(["_setAccount",g.App.GoogleAnalyticsAccount]),j._gaq.push(["_trackPageview"]),a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b))};L.prototype.tokenProblem=function(){var a=
c.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:"window.location.reload(); return false;"});g.Auth=!1;f.Api.showError(a,!0,!0)};L.prototype.authProblem=function(){j.location.reload()};L.prototype.run=function(){c.log("run",g);this.Screens.init();g&&g.Auth?(this.Routing.init(),this.Cache.init(),g.SingleMode||this.doFirstRequests()):(this.Screens.showCurrentScreen(e.Screens.Login),g&&g.LastErrorCode===e.Errors.AuthError&&this.Api.showError(c.i18n("WARNING/AUTH_PROBLEM"),!1,!0))};L.prototype.doFirstRequests=
function(){var a=j.jstz?j.jstz.determine():null;f.Ajax.send({Action:"IsAuth",ClientTimeZone:a?a.name():""});j.setTimeout(function(){f.Ajax.send({Action:"DoServerInitializations"})},3E4)};L.prototype.showErrorByCode=function(a,b){var g=b;e.Errors.DemoLimitations===a&&(g=c.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED"));f.Api.showError(g)};L.prototype.downloadByUrl=function(a){null===this.$downloadIframe&&(this.$downloadIframe=i('<iframe style="display: none;"></iframe>').appendTo(document.body));this.$downloadIframe.attr("src",
a)};L.prototype.initHeaderInfo=function(){i.browser.msie?i(document).bind("focusin",_.bind(this.onFocus,this)).bind("focusout",_.bind(this.onBlur,this)):i(j).bind("focus",_.bind(this.onFocus,this)).bind("blur",_.bind(this.onBlur,this))};L.prototype.onFocus=function(){this.focused(!0)};L.prototype.onBlur=function(){this.focused(!1)};L.prototype.setTitle=function(){var a="",a=this.newMessagesCount();if(!g.SingleMode||this.focused())a=this.focused()||0===a?this.getTitleByScreen():c.i18n("TITLE/HAS_UNSEEN_MESSAGES_PLURAL",
{COUNT:a},null,a)+" - "+g.Accounts.getEmail(),document.title=".",document.title=a};L.prototype.getTitleByScreen=function(){var a="",b="";try{f.Cache.currentMessage()&&(b=f.Cache.currentMessage().subject())}catch(h){}switch(this.currentScreen()){case e.Screens.Login:a=c.i18n("TITLE/LOGIN");break;case e.Screens.Mailbox:case e.Screens.BottomMailbox:a=g.Accounts.getEmail()+" - "+c.i18n("TITLE/MAILBOX");break;case e.Screens.Compose:case e.Screens.SingleCompose:a=g.Accounts.getEmail()+" - "+c.i18n("TITLE/COMPOSE");
break;case e.Screens.SingleMessageView:a=g.Accounts.getEmail()+" - "+c.i18n("TITLE/VIEW_MESSAGE");b&&(a=b+" - "+a);break;case e.Screens.Contacts:a=c.i18n("TITLE/CONTACTS");break;case e.Screens.Calendar:a=c.i18n("TITLE/CALENDAR");break;case e.Screens.Settings:a=c.i18n("TITLE/SETTINGS");break;case e.Screens.FileStorage:a=c.i18n("TITLE/FILESTORAGE")}return a};i(function(){j.setTimeout(function(){f=new L;f.run();j.App=f},10)});j.Enums=e;i("html").removeClass("no-js").addClass("js")})(jQuery,window,ko,
crossroads,hasher);